import {clpp} from "./cl.core.esm.js";let g={};var _ = clpp._;var f=function(window){/*

 Copyright 2016 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var Wr,Xr,Yr,Zr,$r,bs,cs,es,fs,gs,hs,is,js,ks,ms,ns,os,ps,qs,rs,ss,ts,us,vs,ws,xs,ys,zs,As,Bs,Cs,Ds,Es,Fs,Gs,Hs,Is,Js,Ks,Ls,Ns,Ms,Os,Qs,Rs,Ss,Ts,Us,Vs,Ws,Xs,Ys,Zs,at,$s,ct,dt,bt,gt,et,ht,it,ft,kt,mt,ot,lt,pt,nt,qt,st,tt,ut,rt,vt,wt,xt,yt,zt,At,Ct,Et,Ft,Dt,Gt,Jt,Kt,Lt,Mt,Ot,Nt,Qt,St,Rt,Pt,Tt,Vt,Ut,Wt,Xt,$t,Zt,au,bu,cu,du,eu,gu,hu,Yt,iu,ju,ku,lu,mu,nu,ou,qu,ru,pu,Au,zu,xu,Bu,Cu,Du,Fu,Gu,Iu,Hu,Ju,Mu,Ku,Lu,Ou,Nu,Pu,Qu,Tu,Uu,Vu,Wu,Xu,Zu,$u,av,Yu,cv,bv,gv,hv,jv,fv,ev,kv,dv,iv,ov,qv,nv,rv,mv,pv,lv,uv,wv,
xv,Cv,Ev,Jv,Nv,Gv,Pv,Av,Qv,yv,Ov,Uv,Rv,Vv,Hv,Mv,Yv,Xv,Wv,cw,$v,Zv,dw,bw,Tv,zv,Fv,aw,Lv,Bv,Kv,Sv,Iv,ew,hw,iw,kw,qw,ow,nw,mw,pw,sw,ww,yw,Mw,vw,Hw,Dw,Ew,Fw,zw,Gw,vu,tu,wu,uu,yu,su,Sw,Qw,Bw,uw,Tw,Rw,Iw,Nw,rw,Aw,Lw,Uw,Yw,Xw,Cw,Jw,Ww,tw,xw,Vw,Pw,ax,Kw,Ow,Zw,bx;Wr=" buffer";Xr=" is being or has been set up";Yr="Cannot find matching variant";Zr="Jumping forward";$r="MediaSource threw QuotaExceededError:";_.as="No stream with id";bs="Not a persistent session.";cs="PatchedMediaKeysWebkit.MediaKeys.findSession_";
_.ds="Player is in ERROR state and can not switch to ";es="PrestoPlay TextTrack";fs="Removing audio from variant - audio not compatible with platform";gs="bufferBehind\x3d";hs="bufferedBehind\x3d";is="calling onCanSwitch()...";js="clpp.mse.Player";ks="currentPeriod.startTime\x3d";_.ls="onChooseStreams_";ms="output-restricted";ns="presentationTime\x3d";os="reference.endTime\x3d";ps="reference.startTime\x3d";qs="switch: Stream ";rs="webkit-org.w3.clearkey";
ss=function(a,b,c,d){return Promise.resolve().then(function(){if(a.i&&a.c)if(null==c||null==d)a.i.parseInit(_.ef(b));else{var e={periodStart:a.l,segmentStart:c,segmentEnd:d};e=a.i.parseMedia(_.ef(b),e).filter(function(f){return f.startTime>=a.f&&f.startTime<a.g});a.c.append(e);null==a.a&&(a.a=Math.max(c,a.f));a.b=Math.min(d,a.g)}})};
ts=function(a,b,c,d,e){var f=c+" "+d,g=new Map;b=_.u(b);for(var h=b.next();!h.done;h=b.next()){var l=h.value;h=l.stream;g.has(h)||g.set(h,new Map);g.get(h).has(f)||g.get(h).set(f,[]);l.startTime+=e;l.endTime+=e;l.startTime>=a.f&&l.startTime<a.g&&(l=new _.eg(l.startTime,l.endTime,l.text),g.get(h).get(f).push(l),h==a.j&&a.c.append([l]))}e=_.u(g.keys());for(f=e.next();!f.done;f=e.next())for(f=f.value,a.h.has(f)||a.h.set(f,new Map),b=_.u(g.get(f).keys()),h=b.next();!h.done;h=b.next())h=h.value,l=g.get(f).get(h),
a.h.get(f).set(h,l);a.a=null==a.a?Math.max(c,a.f):Math.min(a.a,Math.max(c,a.f));a.b=Math.max(a.b,Math.min(d,a.g))};us=function(a){for(var b=a.a;_.ah(a)&&0!==a.b.getUint8(a.a);)a.a+=1;b=a.b.buffer.slice(b,a.a);a.a+=1;return _.hf(b)};vs=function(a,b){return _.Dh("Edge/")||_.Dh("Edg/")?!0:a.G.has(b)};
ws=function(a,b){var c=b.audio,d=b.video;if(c&&c.encrypted&&!vs(a,_.hg(c.mimeType,c.codecs))||d&&d.encrypted&&!vs(a,_.hg(d.mimeType,d.codecs)))return!1;var e=a.keySystem();return 0==b.drmInfos.length||b.drmInfos.some(function(f){return f.keySystem==e})};xs=function(a){var b=a.Nb()||!a.isLive()&&(Infinity==a.f||a.b)?0:a.u;return Math.max(0,_.Sn(a)-b)};ys=function(a,b){var c=Math.max(a.g,0);if(Infinity==a.Sb)return c;var d=_.Sn(a)-a.Sb;d=Math.min(d+b,xs(a));return Math.max(c,d)};
zs=function(a,b){for(var c in b)if(b.hasOwnProperty(c)&&b[c]===a)return c;return""};As=function(a){var b=[a.mimeType];_.oo.forEach(function(c,d){var e=a[d];e&&b.push(c+'\x3d"'+e+'"')});return b.join(";")};Bs=function(a,b){var c=0;a.forEach(function(d){c+=b(d)?1:0});return c};Cs=function(a,b){var c=new _.Vi(void 0,void 0===b?"total":b);a.forEach(function(d){c.a.push(d)});c.length=a.length;return c};
Ds=function(a,b){for(var c=null,d=_.u(a),e=d.next();!e.done;e=d.next())e=e.value,b>=e.startTime&&(c=e);return c};Es=function(a,b){if(a===b)return!0;if(!a||!b||a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0};Fs=function(a,b){a=_.dn(a);b=_.dn(b);var c=a.split("-"),d=b.split("-");return c[0]==d[0]&&1==c.length&&2==d.length};
Gs=function(a){return a.language?_.dn(a.language):a.audio&&a.audio.language?_.dn(a.audio.language):a.video&&a.video.language?_.dn(a.video.language):_.Od};
Hs=function(a,b){for(var c=_.dn(a),d=new Set,e=_.u(b),f=e.next();!f.done;f=e.next())d.add(_.dn(f.value));e=_.u(d);for(f=e.next();!f.done;f=e.next())if(f=f.value,f==c)return f;e=_.u(d);for(f=e.next();!f.done;f=e.next())if(f=f.value,Fs(f,c))return f;e=_.u(d);for(f=e.next();!f.done;f=e.next()){var g=f=f.value,h=c;g=_.dn(g);h=_.dn(h);g=g.split("-");h=h.split("-");if(2==g.length&&2==h.length&&g[0]==h[0])return f}d=_.u(d);for(f=d.next();!f.done;f=d.next())if(e=f.value,Fs(c,e))return e;return null};
Is=function(){this.b=function(){};this.a=new Set};Js=function(a,b){a.b=b};
Ks=function(a){var b=this;this.g=a;this.f=new Map;this.a=function(){};this.b=function(){};this.c=function(){};this.i=[{Yb:null,Xb:2,Ib:function(c,d){return b.a(c,d)}},{Yb:1,Xb:2,Ib:function(c,d){return b.a(c,d)}},{Yb:3,Xb:2,Ib:function(c,d){return b.a(c,d)}},{Yb:2,Xb:1,Ib:function(c,d){return b.b(c,d)}},{Yb:2,Xb:3,Ib:function(c,d){return b.b(c,d)}},{Yb:1,Xb:3,Ib:function(c,d){return b.c(c,d)}},{Yb:3,Xb:1,Ib:function(c,d){return b.c(c,d)}}]};Ls=function(a,b,c,d){a.a=b;a.b=c;a.c=d};
Ns=function(a){var b=this;this.b=a;this.a=new Set;this.c=(new _.Hf(function(){Ms(b,!1)})).Ga(.25)};Ms=function(a,b){for(var c=_.u(a.a),d=c.next();!d.done;d=c.next())d.value.h(a.b.currentTime,b)};Os=function(a,b){return a.start-b.start};_.Ps=function(a){this.h=a;this.log=new _.H("clpp.renditions");this.b=[];this.g=this.a=null;this.f=!1};Qs=function(a){var b=[];a.b.forEach(function(c){b.push({start:c.start,end:c.end,width:c.width,height:c.height,bandwidth:c.bandwidth,rendition:c.rendition})});return b};
Rs=function(a){a.a&&a.a.trigger(new _.O(_.Rb))};Ss=function(a){if(a.a){for(var b=!1,c={},d=0;d<a.b.length;d++){var e=a.b[d],f=e.width+"x"+e.height,g=c[f];if(g&&g!==e.bandwidth){b=!0;break}c[f]=e.bandwidth}b&&!a.f?(a.log.debug("Tracking timeupdates"),a.a.on(_.Nd,a.c,a),a.f=!0):!b&&a.f&&(a.log.debug("Stop tracking timeupdates"),a.a.off(_.Nd,a.c),a.f=!1)}};
Ts=function(a,b,c){a.b=a.b.filter(function(d){if(d.end<=b||d.start>=c)return!1;d.start=Math.max(d.start,b);d.end=Math.min(d.end,c);return!0});a.a&&a.a.trigger(new _.O(_.$d))};Us=function(a){_.Nf.call(this,a);a=a.getSurface().H();this.a=null;for(var b=0;b<a.textTracks.length;++b){var c=a.textTracks[b];c.mode=_.pc;c.label===es&&(this.a=c)}this.a||(this.a=a.addTextTrack(_.Id,es));this.a.mode=_.Fc};
Vs=function(a){if(a.startTime>=a.endTime)return _.G("Invalid cue times: "+a.startTime+" - "+a.endTime),null;var b=new VTTCue(a.startTime,a.endTime,a.payload);b.lineAlign=a.lineAlign;b.positionAlign=a.positionAlign;b.size=a.size;try{b.align=a.textAlign}catch(c){}a.textAlign===_.bc&&b.align!==_.bc&&(b.align="middle");a.writingMode===_.Vd?b.vertical="lr":a.writingMode===_.Wd&&(b.vertical="rl");1===a.lineInterpretation&&(b.snapToLines=!1);null!=a.line&&(b.line=a.line);null!=a.position&&(b.position=a.position);
return b};Ws=function(a,b){var c=a.mode;a.mode=c==_.zd?_.zd:_.Fc;for(var d=a.cues,e=d.length-1;0<=e;e--){var f=d[e];f&&b(f)&&a.removeCue(f)}a.mode=c};Xs=function(){};Ys=function(a,b){b=void 0===b?{}:b;for(var c in b)this[c]=b[c];this.defaultPrevented=this.cancelable=this.bubbles=!1;this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now();this.type=a;this.isTrusted=!1;this.target=this.currentTarget=null;this.a=!1};Zs=function(){this.h=new _.fi;this.j=this};
at=function(a,b){_.I("PatchedMediaKeysMs.requestMediaKeySystemAccess");try{var c=new $s(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}};
$s=function(a,b){_.I("PatchedMediaKeysMs.MediaKeySystemAccess");this.keySystem=a;for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:_.bd,distinctiveIdentifier:_.bd,initDataTypes:e.initDataTypes,sessionTypes:[_.Jd],label:e.label},g=!1;if(e.audioCapabilities)for(var h=0;h<e.audioCapabilities.length;++h){var l=e.audioCapabilities[h];l.contentType&&(g=!0,MSMediaKeys.isTypeSupported(this.keySystem,l.contentType.split(";")[0])&&(f.audioCapabilities.push(l),
c=!0))}if(e.videoCapabilities)for(h=0;h<e.videoCapabilities.length;++h)l=e.videoCapabilities[h],l.contentType&&(g=!0,MSMediaKeys.isTypeSupported(this.keySystem,l.contentType.split(";")[0])&&(f.videoCapabilities.push(l),c=!0));g||(c=MSMediaKeys.isTypeSupported(this.keySystem,_.Zd));e.persistentState==_.sd&&(c=!1);if(c){this.a=f;return}}c=Error(_.$a);c.name=_.Ha;c.code=DOMException.NOT_SUPPORTED_ERR;throw c;};
ct=function(a){_.I("PatchedMediaKeysMs.setMediaKeys");var b=this.mediaKeys;b&&b!=a&&bt(b,null);delete this.mediaKeys;return(this.mediaKeys=a)?bt(a,this):Promise.resolve()};dt=function(a){_.I("PatchedMediaKeysMs.MediaKeys");this.a=new MSMediaKeys(a);this.b=new _.ii};bt=function(a,b){function c(){b.msSetMediaKeys(d.a);b.removeEventListener(_.Qc,c)}_.li(a.b);if(!b)return Promise.resolve();a.b.on(b,"msneedkey",et);var d=a;try{return 1<=b.readyState?b.msSetMediaKeys(a.a):b.addEventListener(_.Qc,c),Promise.resolve()}catch(e){return Promise.reject(e)}};
gt=function(a){_.I("PatchedMediaKeysMs.MediaKeySession");Zs.call(this);this.c=null;this.g=a;this.b=this.a=null;this.f=new _.ii;this.sessionId="";this.expiration=NaN;this.closed=new _.nj;this.keyStatuses=new ft};et=function(a){_.I("PatchedMediaKeysMs.onMsNeedKey_",a);if(a.initData){var b=document.createEvent("CustomEvent");b.initCustomEvent(_.xc,!1,!1,null);b.initDataType=_.ac;b.initData=ht(a.initData);this.dispatchEvent(b)}};
ht=function(a){if(!a)return a;var b=new _.fk(a);if(1>=b.a.length)return a;for(var c=[],d=0;d<b.a.length;d++)c.push(a.subarray(b.a[d].start,b.a[d].end+1));a=[];b={};d=_.u(c);for(c=d.next();!c.done;b={Nc:b.Nc},c=d.next())b.Nc=c.value,a.some(function(e){return function(f){return _.Zj(f,e.Nc)}}(b))||a.push(b.Nc);b=0;d=_.u(a);for(c=d.next();!c.done;c=d.next())b+=c.value.length;b=new Uint8Array(+b);d=0;a=_.u(a);for(c=a.next();!c.done;c=a.next())c=c.value,b.set(c,d),d+=c.length;return b};
it=function(a,b){var c=a.keyStatuses;c.size=void 0==b?0:1;c.a=b;a.dispatchEvent(new Ys(_.Jc))};ft=function(){this.size=0;this.a=void 0};kt=function(a){var b=jt;return b?b+a.charAt(0).toUpperCase()+a.slice(1):a};mt=function(a,b){_.I("PatchedMediaKeysWebkit.requestMediaKeySystemAccess");try{var c=new lt(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}};
ot=function(a){_.I("PatchedMediaKeysWebkit.setMediaKeys");var b=this.mediaKeys;b&&b!==a&&nt(b,null);delete this.mediaKeys;(this.mediaKeys=a)&&nt(a,this);return Promise.resolve()};
lt=function(a,b){_.I("PatchedMediaKeysWebkit.MediaKeySystemAccess");this.a=this.keySystem=a;var c=!1;a===_.cd&&(this.a=rs,c=!1);var d=!1;var e=document.getElementsByTagName(_.Xd);e=e.length?e[0]:document.createElement(_.Xd);for(var f=0;f<b.length;++f){var g=b[f],h={audioCapabilities:[],videoCapabilities:[],persistentState:_.bd,distinctiveIdentifier:_.bd,initDataTypes:g.initDataTypes,sessionTypes:[_.Jd],label:g.label},l=!1;if(g.audioCapabilities)for(var m=0;m<g.audioCapabilities.length;++m){var n=
g.audioCapabilities[m];n.contentType&&(l=!0,e.canPlayType(n.contentType.split(";")[0],this.a)&&(h.audioCapabilities.push(n),d=!0))}if(g.videoCapabilities)for(m=0;m<g.videoCapabilities.length;++m)n=g.videoCapabilities[m],n.contentType&&(l=!0,e.canPlayType(n.contentType,this.a)&&(h.videoCapabilities.push(n),d=!0));l||(d=e.canPlayType(_.Zd,this.a)||e.canPlayType("video/webm",this.a));g.persistentState===_.sd&&(c?(h.persistentState=_.sd,h.sessionTypes=[_.hd]):d=!1);if(d){this.b=h;return}}c=_.$a;if(a===
_.cd||a===_.mc)c="None of the requested configurations were supported.";c=Error(c);c.name=_.Ha;c.code=DOMException.NOT_SUPPORTED_ERR;throw c;};pt=function(a){_.I("PatchedMediaKeysWebkit.MediaKeys");this.g=a;this.b=null;this.a=new _.ii;this.c=[];this.f={}};nt=function(a,b){a.b=b;_.li(a.a);var c=jt;b&&(a.a.on(b,c+"needkey",a.hj.bind(a)),a.a.on(b,c+"keymessage",a.gh.bind(a)),a.a.on(b,c+"keyadded",a.eh.bind(a)),a.a.on(b,c+"keyerror",a.fh.bind(a)))};
qt=function(a,b){var c=a.f[b];return c?(_.I(cs,c),c):(c=a.c.shift())?(c.sessionId=b,a.f[b]=c,_.I(cs,c),c):null};st=function(a,b,c){_.I("PatchedMediaKeysWebkit.MediaKeySession");Zs.call(this);this.f=a;this.i=!1;this.a=this.b=null;this.c=b;this.g=c;this.sessionId="";this.expiration=NaN;this.closed=new _.nj;this.keyStatuses=new rt};
tt=function(a,b,c){if(a.i)return Promise.reject(Error("The session is already initialized."));a.i=!0;try{if(a.g===_.hd)if(c)var d=_.qf("LOAD_SESSION|"+c);else{var e=_.qf("PERSISTENT|"),f=new Uint8Array(e.byteLength+b.byteLength);f.set(e,0);f.set(_.ef(b),e.byteLength);d=f}else d=_.ef(b)}catch(h){return Promise.reject(h)}a.b=new _.nj;var g=kt("generateKeyRequest");try{a.f[g](a.c,d)}catch(h){if("InvalidStateError"!==h.name)return a.b=null,Promise.reject(h);(new _.Hf(function(){try{a.f[g](a.c,d)}catch(l){a.b.reject(l),
a.b=null}})).R(.01)}return a.b};ut=function(a,b){var c=a.keyStatuses;c.size=void 0===b?0:1;c.a=b;a.dispatchEvent(new Ys(_.Jc))};rt=function(){this.size=0;this.a=void 0};vt=function(){var a=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];c=a.apply(this,c);c.abort=function(){};return c}};
wt=function(){var a=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(b,c){return a.call(this,b,c-.001)}};xt=function(){var a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(b){return"mp2t"==b.split(/ *; */)[0].split("/")[1].toLowerCase()?!1:a(b)}};yt=function(){var a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(b){return"opus"!=_.ig(b)[0]&&a(b)}};
zt=function(){var a=MediaSource.isTypeSupported,b=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(c){var d=c.split(/ *; */),e=d.shift(),f={};d=_.u(d);for(var g=d.next();!g.done;g=d.next())g=g.value.split("\x3d"),f[g[0]]=g[1].replace(/"(.*)"/,"$1");d=f.codecs;if(!d)return a(c);var h=!1,l=!1;c=d.split(",").filter(function(n){b.test(n)&&(l=!0);/^(hev|hvc)1\.2/.test(n)&&(h=!0);return!0});l&&(h=!1);f.codecs=c.join(",");h&&(f.eotf="smpte2084");for(var m in f)e+="; "+m+'\x3d"'+f[m]+'"';return cast.__platform__.canDisplayType(e)}};
At=function(){this.a=new muxjs.mp4.CaptionParser;this.g=[];this.f={}};_.Bt=function(){};Ct=function(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0,remux:!1});this.b=null;this.h=[];this.g=[];this.c=[];this.f=!1;this.a.on("data",this.j.bind(this));this.a.on("done",this.i.bind(this))};
Et=function(a,b){return!window.muxjs||"mp2t"!=a.split(";")[0].split("/")[1]&&"aac"!=a.split(";")[0].split("/")[1]?!1:b?MediaSource.isTypeSupported(Dt(b,a))||MediaSource.isTypeSupported(a.replace("aac",_.Wc)):MediaSource.isTypeSupported(Dt(_.Nb,a))||MediaSource.isTypeSupported(a.replace("aac",_.Wc))||MediaSource.isTypeSupported(Dt(_.Xd,a))};
Ft=function(a,b){var c=new Map;c.set(a,b);try{var d=b.match(/"(.*?)"/)[0].replace(/"/g,"").split(","),e=new Map;1<d.length&&d.forEach(function(f){f.startsWith("avc")?e.set(_.Xd,'video/mp4;codecs\x3d"'+f+'"'):f.startsWith("mp4a")&&e.set(_.Nb,'audio/mp4;codecs\x3d"'+f+'"')});return 0<e.size?e:c}catch(f){return c}};
Dt=function(a,b){var c=b.replace("mp2t",_.Wc);a==_.Nb&&(c=c.replace(_.Xd,_.Nb));var d=/avc1\.(66|77|100)\.(\d+)/.exec(c);if(d){var e="avc1.",f=d[1],g=Number(d[2]);e=("66"==f?e+"4200":"77"==f?e+"4d00":e+"6400")+(g>>4).toString(16);e+=(g&15).toString(16);c=c.replace(d[0],e)}return c};Gt=function(a,b){a.f=!0;a.b=new _.nj;a.h=[];a.g=[];a.c=[];var c=_.ef(b);a.a.push(c);a.a.flush();a.f&&a.b.reject(new _.J(_.K,3,3018));return a.b};
_.It=function(a,b,c,d,e){this.g=a;this.l=c;this.c={};this.B=!1;this.b=null;this.f={};this.i=new _.ii;this.A=!1;this.j={};this.u=b;this.m=d;this.D=void 0===e?1:e;this.w=new _.nj;this.o={};a=this.w;b=new MediaSource;this.i.one(b,"sourceopen",a.resolve);this.g.src=Ht(b);this.h=b;this.a=new _.H("clpp.mse.MediaSourceEngine")};Jt=function(a){var b=_.hg(a.mimeType,a.codecs),c=As(a);return _.lg(b)||MediaSource.isTypeSupported(c)||Et(b,a.type)};
Kt=function(a,b){b.forEach(function(c,d){var e=a.h.addSourceBuffer(c);a.i.on(e,_.Ac,a.dh.bind(a,d));a.i.on(e,"updateend",a.lc.bind(a,d));a.c[d]=e;a.f[d]=[];a.o[d]=!1});a.B=b.has(_.Nb)&&b.has(_.Xd)};Lt=function(a,b){a.b||(a.b=new _.jg(a.l));b!=_.Db&&(a.b.i=new _.kg[b])};Mt=function(a){return a.h?a.h.readyState==_.zc:!0};Ot=function(a){var b={};b.total=new _.Vi(a.g.buffered,"total");b.audio=Nt(a,_.Nb);b.video=Nt(a,_.Xd);var c=[];a.b&&(c=[{start:a.b.Sa(),end:a.b.ea()}]);b.text=Cs(c,_.k);return b};
Nt=function(a,b){try{return new _.Vi(a.c[b].buffered,b)}catch(c){return b in a.c&&a.a.error("failed to get buffered range for "+b,c),null}};
Qt=function(a,b,c,d,e,f,g,h){h=void 0===h?!1:h;var l=a.c[b],m=-1,n=0;l&&l.buffered&&(n=l.buffered.length);b===_.Xd&&null!==d&&null!==e&&h&&(m=0<n?l.buffered.end(n-1):-1);b==_.k?c=ss(a.b,c,d,e):a.j[b]?c=Gt(a.j[b],c).then(function(p){a.b||Lt(a,_.Kd);p.captions&&p.captions.length&&ts(a.b,p.captions,d,e,a.c.video.timestampOffset);var q=[];0<p.audio.byteLength&&a.c.audio&&q.push(Pt(a,_.Nb,a.Fd.bind(a,_.Nb,p.audio.buffer)));0<p.video.byteLength&&a.c.video&&q.push(Pt(a,_.Xd,a.Fd.bind(a,_.Xd,p.video.buffer)));
return Promise.all(q)}):(f&&window.muxjs&&(a.b||Lt(a,_.Kd),null==d&&null==e?a.u.init(c):a.u.c(c,function(p){p.length&&ts(a.b,p,d,e,a.c.video.timestampOffset)})),c=Pt(a,b,a.Fd.bind(a,b,c)));return c.then(function(){if(b===_.Xd&&null!==d&&null!==e&&!h)a.m.append(d,e,g);else if(b===_.Nb&&null!==d&&null!==e)Rs(a.m);else if(b===_.Xd&&null!==d&&null!==e&&h){var p=l.buffered.length,q=0<p?l.buffered.end(p-1):-1;0>m&&0<p&&(m=l.buffered.start(0));0<=m&&0<q&&a.m.append(m,q,g)}if(!a.o[b]&&l&&1===l.buffered.length){p=
l.buffered.start(0);var t=d-p;if(Math.abs(t)>a.D&&0===l.timestampOffset)return a.a.warn("Detected a delta of "+t+" between media times and segment times for "+(b+". The segment start time is ")+(d+" and the media start time is ")+(p+". Adjusting timestampOffset.")),p=Pt(a,b,function(){a.Qf(b,t)}),q=Pt(a,b,a.df.bind(a,b,!1)),Promise.all([p,q])}null!==d&&null!==e&&(a.o[b]=!0)})["catch"](function(p){throw p;})};
St=function(a,b,c,d,e){if(b==_.k)return a.b.l=c,a=a.b,a.f=d,a.g=e,Promise.resolve();b=Rt(a,b,c,d,e);a.B&&(b=b.concat(Rt(a,_.Nb,c,d,e)));return Promise.all(b)};Rt=function(a,b,c,d,e){return[Pt(a,b,a.Wf.bind(a,b)),Pt(a,b,a.Qf.bind(a,b,c)),Pt(a,b,a.xj.bind(a,b,d,e))]};Pt=function(a,b,c){if(a.A)return Promise.reject();c={start:c,p:new _.nj};a.f[b].push(c);1===a.f[b].length&&Tt(a,b);return c.p};
Tt=function(a,b){var c=a.f[b][0];if(c)try{a.a.debug("Starting next operation for "+b),c.start()}catch(d){"QuotaExceededError"==d.name?c.p.reject(new _.J(_.K,3,3017,{type:b})):c.p.reject(new _.J(_.K,3,3015,{mediaError:d})),Ut(a,b)}else a.a.debug("No more scheduled operations for "+b)};
Vt=function(a,b){if(a.A)return Promise.reject();var c=[],d;for(d in a.c){var e=new _.nj,f={start:function(g){g.resolve()}.bind(null,e),p:e};a.f[d].push(f);c.push(e);1==a.f[d].length&&f.start()}return Promise.all(c).then(function(){try{b()}catch(l){var g=Promise.reject(new _.J(_.K,3,3015,{mediaError:l}))}for(var h in a.c)Ut(a,h);return g},function(){return Promise.reject()})};Ut=function(a,b){a.f[b].shift();Tt(a,b)};
Wt=function(a,b,c){function d(f,g,h){return f>=g&&f<=h}var e=a.video;return e&&e.width&&e.height&&!(d(e.width,b.minWidth,Math.min(b.maxWidth,c.width))&&d(e.height,b.minHeight,Math.min(b.maxHeight,c.height))&&d(e.width*e.height,b.minPixels,b.maxPixels))||!d(a.bandwidth,b.minBandwidth,b.maxBandwidth)?!1:!0};Xt=function(a,b,c){var d=!1;a.forEach(function(e){var f=e.allowedByApplication;e.allowedByApplication=Wt(e,b,c);f!=e.allowedByApplication&&(d=!0)});return d};
$t=function(a,b,c,d){var e=!1;d.variants=d.variants.filter(function(h){if(a&&a.T&&!ws(a,h))return _.I("Dropping variant - not compatible with key system",h),!1;var l=h.audio,m=h.video;if(l&&!Jt(l)){var n=l.codecs;0<=l.codecs.indexOf("ec-3")?(_.I("Trying to use AC-3 for EC-3"),l.codecs=l.codecs.replace("ec-3","ac-3"),Jt(l)?_.bf("Using AC-3 instead of EC-3 for",Yt(l)):(l.codecs=n,_.bf(fs,Yt(l)),h.audio=null,e=!0,l=null)):(_.bf(fs,Yt(l)),h.audio=null,e=!0,l=null)}return m&&!Jt(m)?(_.bf("Dropping variant - video not compatible with platform",
Yt(m)),!1):l&&b&&!Zt(l,b)?(_.bf("Dropping variant - not compatible with active audio","active audio",Yt(b),"variant.audio",Yt(l)),!1):m&&c&&!Zt(m,c)?(_.bf("Dropping variant - not compatible with active video","active video",Yt(c),"variant.video",Yt(m)),!1):!0});if(e){var f=!1,g=!1;d.variants.forEach(function(h){!f&&h.video&&h.audio&&(f=!0);g||h.audio||!h.video||(g=!0)});f&&g&&(d.variants=d.variants.filter(function(h){return h.video&&!h.audio?(_.bf("Dropping variant - not compatible with video + audio",
"variant.video",Yt(h.video)),!1):!0}))}d.textStreams=d.textStreams.filter(function(h){var l=_.lg(_.hg(h.mimeType,h.codecs));l||_.I("Dropping text stream. Is not supported by the platform.",h);return l})};Zt=function(a,b){return a.mimeType!=b.mimeType||a.codecs.split(".")[0]!=b.codecs.split(".")[0]?!1:!0};
au=function(a){var b=a.audio,c=a.video,d=b?b.codecs:null,e=c?c.codecs:null,f=[];e&&f.push(e);d&&f.push(d);var g=c&&c.mimeType||null,h=b&&b.mimeType||null,l=[];b&&l.push(b.kind);c&&l.push(c.kind);l=l[0]||null;var m=new Set,n=new Set;b&&b.roles.forEach(function(p){return n.add(p)});c&&c.roles.forEach(function(p){return m.add(p)});a={id:a.id,active:!1,type:"variant",bandwidth:a.bandwidth,language:a.language,label:null,kind:l,width:null,height:null,frameRate:null,mimeType:g,audioMimeType:h,codecs:f.join(", "),
audioCodec:d,videoCodec:e,primary:a.primary,roles:Array.from(m),audioRoles:Array.from(n),videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null};c&&(a.videoId=c.id,a.originalVideoId=c.originalId,a.width=c.width||null,a.height=c.height||null,a.frameRate=c.frameRate||null,a.videoBandwidth=c.bandwidth||null);b&&(a.audioId=b.id,a.originalAudioId=b.originalId,a.channelsCount=b.channelsCount,a.audioBandwidth=b.bandwidth||
null,a.label=b.label,a.audioRoles=b.roles);return a};bu=function(a){return{id:a.id,active:!1,type:_.k,bandwidth:0,language:a.language,label:a.label,kind:a.kind||null,width:null,height:null,frameRate:null,mimeType:a.mimeType,audioMimeType:null,codecs:a.codecs||null,audioCodec:null,videoCodec:null,primary:a.primary,roles:a.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:a.originalId}};
cu=function(a){return a.allowedByApplication&&a.allowedByKeySystem};du=function(a,b){var c=a.filter(function(g){return g.audio&&g.audio.channelsCount}),d=new Map;c=_.u(c);for(var e=c.next();!e.done;e=c.next()){e=e.value;var f=e.audio.channelsCount;d.has(f)||d.set(f,[]);d.get(f).push(e)}c=Array.from(d.keys());if(0==c.length)return a;e=c.filter(function(g){return g<=b});return e.length?d.get(Math.max.apply(null,e)):d.get(Math.min.apply(null,c))};
_.fu=function(a,b,c){var d=a,e=a.filter(function(h){return h.primary});e.length&&(d=e);var f=d.length?d[0].language:"";d=d.filter(function(h){return h.language==f});if(b){var g=Hs(_.dn(b),a.map(function(h){return h.language}));g&&(d=a.filter(function(h){return _.dn(h.language)==g}))}if(c){a=eu(d,c);if(a.length)return a;_.G("No exact match for the text role could be found.")}else if(a=d.filter(function(h){return 0==h.roles.length}),a.length)return a;a=d.map(function(h){return h.roles}).reduce(_.Lk.Hd,
[]);return a.length?eu(d,a[0]):d};eu=function(a,b){return a.filter(function(c){return c.roles.includes(b)})};gu=function(a,b,c){for(var d=0;d<c.length;d++)if(c[d].audio==a&&c[d].video==b)return c[d];return null};hu=function(a){var b=[];a.audio&&b.push(a.audio);a.video&&b.push(a.video);return b};
Yt=function(a){var b=As(a);return a.type==_.Nb?"type\x3daudio mimeType\x3d"+a.mimeType+" codecs\x3d"+a.codecs+" codecInfo\x3d"+b+" bandwidth\x3d"+a.bandwidth+" channelsCount\x3d"+a.channelsCount:a.type==_.Xd?"type\x3dvideo mimeType\x3d"+a.mimeType+" codecs\x3d"+a.codecs+" codecInfo\x3d"+b+" bandwidth\x3d"+a.bandwidth+" frameRate\x3d"+a.frameRate+" width\x3d"+a.width+" height\x3d"+a.height:"unexpected stream type"};
iu=function(a,b){var c=String(_.Ci++);c=new _.wi(c,a);c.mimeType=_.yi(b.mimeType);if(a===_.P||a===_.Q)c.label=_.yi(b.label),c.language=_.yi(b.language);a===_.zi?(c.frameRate=b.frameRate,c.roles=b.roles):a===_.Q?(c.channelsCount=b.channelsCount,c.roles=b.audioRoles||[],c.mimeType=_.yi(b.audioMimeType)):(c.kind=_.yi(b.kind),c.roles=b.roles);return c};
ju=function(a,b,c){var d=new _.xi(a===_.zi?""+b.videoId:a===_.Q?""+b.audioId:""+b.id,c);switch(a){case _.zi:d.codec=_.yi(b.videoCodec);d.bandwidth=b.videoBandwidth||b.bandwidth;d.width=b.width;d.height=b.height;d.originalId=b.originalVideoId;break;case _.Q:d.codec=_.yi(b.audioCodec);d.bandwidth=b.audioBandwidth||b.bandwidth;d.originalId=b.originalAudioId;break;default:d.codec=_.yi(b.codecs),d.originalId=b.originalTextId}(a=c.renditions.find(function(e){return _.C.ya(e,d,null,["id","track"])}))||c.renditions.push(d);
return a||d};ku=function(a,b){var c=a.reduce(function(d,e){b===_.zi?null===e.videoId||d[e.videoId]&&!e.active||(d[e.videoId]=e):b===_.Q&&(null===e.audioId||d[e.audioId]&&!e.active||(d[e.audioId]=e));return d},{});return Object.values(c).sort(function(d,e){return d.id-e.id})};lu=function(a,b){if(void 0!==b&&null!==b){var c=a.filter(function(d){return d.audio&&d.audio.id===b});if(0<c.length)return c}return a};
mu=function(){this.f=new _.H("clpp.mse.TrackManager");this.a=null;this.g=[];this.b=new Map;this.c=new Map};nu=function(a,b){return a.g.filter(function(c){return c.type===b})};ou=function(a,b){var c=a.b.get(b)||null;return c&&c.track};qu=function(a,b,c){c&&ou(a,c.type)===c||pu(a,b,c&&c.renditions[0])};ru=function(a,b){a.b.set(b.track.type,b);b===(a.c.get(b.track.type)||null)&&a.c.set(b.track.type,null)};
pu=function(a,b,c,d){d=void 0===d?!1:d;if(a.a&&(a.b.get(b)||null)!==c){var e=a.a;if(c){if(0>a.g.indexOf(c.track))throw Error("Unknown rendition with ID "+c.id);if(b!==c.track.type)throw Error("Types mismatch");a.f.debug("Activate rendition type\n          "+b+" with ID: "+c.id);if(b===_.P){var f=e.Y().find(function(n){return n.id==c.id});f&&(a.c.set(b,c),ru(a,c),e.trigger(new _.O(_.Pi)),su(e,!0).then(function(){tu(e,f)})["catch"](function(n){a.f.warn("Error while activating track",n)}))}else if(b===
_.Q)a.c.set(b,c),uu(e,parseInt(c.id,10));else if(b===_.zi){var g=a.b.get(_.Q)||null;if(g){var h=vu(e).filter(function(n){return n.videoId==c.id});var l=h.find(function(n){return n.audioId==g.id});if(!l){a.f.debug("Unable to find exact variant. Searching for equivalent");var m=g.track.renditions.map(function(n){return n.id}).filter(function(n){return n!==g.id});l=h.find(function(n){return m.find(function(p){return p==n.audioId})})}}else l=vu(e).find(function(n){return n.videoId==c.id});l?(a.c.set(b,
c),wu(e,l,d)):a.f.warn(Yr)}}else a.f.debug(_.sa+b),ou(a,b)&&(b===_.P?su(e,!1).then(function(){a.b.set(b,null);e.trigger(new _.O(_.Pi))})["catch"](function(n){a.f.warn("Error while de-activating text tracks",n)}):b===_.Q?a.f.info("Enabling ABR for audio is not supported"):wu(e,null,d))}};
Au=function(a){if(a.a){a.f.debug("Track list change detected, updating track list");for(var b=[],c=_.u(Object.values(_.ro)),d=c.next();!d.done;d=c.next())d=d.value,a.b.set(d,null),a.c.set(d,null);a.a.Y().forEach(function(e){var f=iu(_.P,e),g=b.find(function(l){return xu(l,f)});f=g||f;var h=ju(_.P,e,f);e.active&&a.b.set(_.P,h);g||b.push(f)});yu(a.a)||a.b.set(_.P,null);c=vu(a.a);zu(a,b,c,_.zi);zu(a,b,c,_.Q);a.g=b}};
zu=function(a,b,c,d){ku(c,d).forEach(function(e){var f=iu(d,e),g=b.find(function(l){return xu(l,f)});f=g||f;var h=ju(d,e,f);e.active&&a.b.set(d,h);g||b.push(f)})};xu=function(a,b){return a.type===b.type&&a.channelsCount===b.channelsCount&&a.frameRate===b.frameRate&&a.kind===b.kind&&a.label===b.label&&a.language===b.language&&a.mimeType===b.mimeType&&Es(a.roles,b.roles)};
Bu=function(a,b,c){if(b){a.g.length||Au(a);for(var d=b.type,e=a.b.get(d)||null,f,g=_.u(nu(a,d)),h=g.next();!h.done&&!(f=h.value.renditions.find(function(l){return l.id==b.id}));h=g.next());f&&e!==f&&(ru(a,f),d===_.Q?a.a.trigger(new _.O(_.Oi)):d===_.zi&&a.a.trigger(new _.O(_.ae,{details:{width:f.width||0,height:f.height||0,bandwidth:f.bandwidth,track:f.track,abrSelection:c}})))}};Cu=function(){this.b=new _.hn(2);this.c=new _.hn(5);this.a=0};Du=function(a,b){return 128E3>a.a?b:Math.min(_.kn(a.b),_.kn(a.c))};
_.Eu=function(){this.b=new _.H("clpp.abr");this.i=null;this.g=!1;this.c=new Cu;this.h=[];this.j=!1;this.a=this.f=null};Fu=function(a,b){a&&(b=b.filter(function(c){return Wt(c,a,{width:Infinity,height:Infinity})}));return b.sort(function(c,d){return c.bandwidth-d.bandwidth})};Gu=function(){this.a=new Map};Iu=function(a,b){a.a.has(b)||a.a.set(b,new Hu);return a.a.get(b)};Hu=function(){this.text=this.variant=null};
Ju=function(a,b){this.b=a;this.a=new Set([a]);b=b||[];for(var c=_.u(b),d=c.next();!d.done;d=c.next())this.add(d.value)};Mu=function(a,b){var c;if(!(c=!!a.audio!=!!b.audio||!!a.video!=!!b.video||a.language!=b.language)&&(c=a.audio&&b.audio)){c=a.audio;var d=b.audio;c=!(c.channelsCount==d.channelsCount&&Ku(c,d)&&Lu(c.roles,d.roles))}!c&&(c=a.video&&b.video)&&(c=a.video,d=b.video,c=!(Ku(c,d)&&Lu(c.roles,d.roles)));return c?!1:!0};
Ku=function(a,b){if(a.mimeType!=b.mimeType)return!1;var c=a.codecs.split(",").map(function(f){return _.ig(f)[0]}),d=b.codecs.split(",").map(function(f){return _.ig(f)[0]});if(c.length!=d.length)return!1;c.sort();d.sort();for(var e=0;e<c.length;e++)if(c[e]!=d[e])return!1;return!0};Lu=function(a,b){var c=new Set(a),d=new Set(b);c["delete"]("main");d["delete"]("main");if(c.size!=d.size)return!1;c=_.u(c);for(var e=c.next();!e.done;e=c.next())if(!d.has(e.value))return!1;return!0};
Ou=function(a){this.a=a;this.b=new Nu(a.language,"",a.audio&&a.audio.channelsCount?a.audio.channelsCount:0)};Nu=function(a,b,c){this.c=a;this.b=b;this.a=c};Pu=function(a,b){var c=_.dn(b),d=Hs(c,a.map(function(e){return Gs(e)}));return d?a.filter(function(e){return d==Gs(e)}):[]};Qu=function(a,b){return a.filter(function(c){var d=c.audio;c=c.video;return d&&0<=d.roles.indexOf(b)||c&&0<=c.roles.indexOf(b)})};Tu=function(a,b){this.a=Ru;this.b=(new Map).set(Ru,b).set(Su,a)};
Uu=function(a){this.c=a;this.a=null;this.b=function(){}};Vu=function(a,b){a.b=b};Wu=function(a){var b=this;this.a=a;this.f=!1;this.c=this.a.Rd();this.b=new _.Hf(function(){b.a.oi(.25*b.c)})};Xu=function(a){a.b.stop();var b=a.f?0:a.c;0<=b?a.a.Rd()!=b&&a.a.Pf(b):(a.b.Ga(.25),0!=a.a.Rd()&&a.a.Pf(0))};Zu=function(a,b){this.c=a;this.g=Yu(a);this.b=a.a.currentTime;this.f=Date.now()/1E3;this.h=b;this.a=function(){}};$u=function(a,b){a.a=b};av=function(a){this.a=a};
Yu=function(a){if(a.a.paused||0==a.a.playbackRate||0===a.a.buffered.length)var b=!1;else a:{b=a.a.buffered;a=a.a.currentTime;for(var c=0;c<b.length;c++){var d=b.start(c),e=b.end(c);if(!(a<d||a>e-.5)){b=!0;break a}}b=!1}return b};cv=function(a,b,c,d,e){var f=this;this.a=a;this.o=b;this.l=c;this.m=e;this.c=new _.ii;this.j=!1;this.w=a.readyState;this.f=!1;this.b=d;this.g=this.u=this.i=!1;this.c.on(a,_.ce,function(){return bv(f)});this.h=(new _.Hf(function(){bv(f)})).Ga(.25)};
bv=function(a){if(0!=a.a.readyState){if(a.a.seeking){if(!a.j)return}else a.j=!1;if(!a.a.paused&&!a.g){a.a.readyState!=a.w&&(a.f=!1,a.w=a.a.readyState);var b=a.l.smallGapLimit,c=a.a.currentTime,d=a.a.buffered;a:{var e=new _.Vi(d);if(e.length&&!(1===e.length&&1E-6>e.end(0)-e.start(0)))for(var f=_.Dh("Edge/")||_.Dh("Edg/")||_.Dh("Trident/")||_.Eh()||_.Dh("CrKey")?.5:.1,g=0;g<e.length;g++)if(e.start(g)>c&&(0===g||e.end(g-1)-c<=f)){e=g;break a}e=null}if(null==e){if(a.b){a=a.b;d=a.c;c=Yu(d);d=d.a.currentTime;
b=Date.now()/1E3;if(a.b!=d||a.g!=c)a.f=b,a.b=d,a.g=c;d=b-a.f;d>=a.h&&c&&a.a(a.b,d)}}else if((0!=e||a.i)&&a.u&&(f=d.start(e),g=xs(a.o),!(f>=g))){g=f-c;b=g<=b;var h=!1;if(!(.001>g)){if(!b&&!a.f){a.f=!0;var l=new _.O("largegap",{detail:{currentTime:c,gapSize:g}});l.cancelable=!0;a.m(l);a.l.jumpLargeGaps&&!l.defaultPrevented?h=!0:_.bf("Ignoring large gap at",c,"size",g)}if(b||h)0==e?_.bf(Zr,g,"seconds because of gap before start time of",f):_.bf(Zr,g,"seconds because of gap starting at",d.end(e-1),"and ending at",
f),a.a.currentTime=f}}}}};gv=function(a,b,c,d){this.a=a;this.h=b;this.f=d;this.i=c;this.b=new _.ii;this.c=new dv(a);this.g=!1;0<a.readyState?ev(this,c):fv(this,c)};hv=function(a){return 0<a.a.readyState?a.a.currentTime:a.i};jv=function(a,b){0<a.a.readyState?iv(a.c,b):fv(a,b)};fv=function(a,b){a.i=b;a.b.off(a.a,_.Qc);a.b.one(a.a,_.Qc,function(){ev(a,b)})};
ev=function(a,b){a.g||(a.g=!0,a.f&&a.f());.001>Math.abs(a.a.currentTime-b)?kv(a):(a.b.one(a.a,_.wd,function(){kv(a)}),iv(a.c,0==a.a.currentTime?b:a.a.currentTime))};kv=function(a){a.b.on(a.a,_.wd,function(){return a.h()})};dv=function(a){var b=this;this.b=a;this.h=10;this.g=this.c=this.f=0;this.a=new _.Hf(function(){0>=b.f?(_.G(["Failed to move playhead from",b.c,"to",b.g].join(" ")),b.a.stop()):b.b.currentTime!=b.c?b.a.stop():(b.b.currentTime=b.g,b.f--)})};
iv=function(a,b){a.c=a.b.currentTime;a.g=b;a.f=a.h;a.b.currentTime=b;a.a.Ga(.1)};
ov=function(a,b,c,d,e,f){var g=this;this.c=a;this.a=b.presentationTimeline;this.m=b.minBufferTime||0;this.h=c;this.l=e;this.j=null;this.g=new cv(a,b.presentationTimeline,c,lv(this,a,c),f);this.f=new gv(a,function(){a:{var h=g.g;h.j=!0;h.i=!1;h.f=!1;h=hv(g.f);var l=mv(g,h);if(.001<Math.abs(l-h)){var m=(new Date).getTime()/1E3;if(!g.j||g.j<m-1){g.j=m;jv(g.f,l);h=void 0;break a}}g.b.debug("Seek to "+h);g.l();h=void 0}return h},nv(this,d),function(){g.g.u=!0});this.i=(new _.Hf(function(){if(0!=g.c.readyState&&
!g.c.paused){var h=g.c.currentTime,l=ys(g.a,0),m=xs(g.a);3>m-l&&(l=m-3);h<l&&(l=mv(g,h),g.b.info("Jumping forward "+(l-h)+" seconds to catch up with the seek range."),g.c.currentTime=l)}})).Ga(.25);this.b=new _.H("clpp.mse.Playhead")};qv=function(a){var b=hv(a.f);return 0<a.c.readyState&&!a.c.paused?pv(a,b):b};nv=function(a,b){null==b?b=Infinity>a.a.getDuration()?ys(a.a,0):xs(a.a):0>b&&(b=xs(a.a)+b);return rv(a,pv(a,b))};rv=function(a,b){var c=a.a.getDuration();return b>=c?c-a.h.durationBackoff:b};
mv=function(a,b){var c=new _.Vi(a.c.buffered);c=c.Kb.bind(c);var d=Math.max(a.m,a.h.rebufferingGoal),e=a.h.safeSeekOffset,f=ys(a.a,0),g=xs(a.a),h=a.a.getDuration();3>g-f&&(f=g-3);var l=ys(a.a,d),m=ys(a.a,e);d=ys(a.a,d+e);if(b>=h)return a.b.debug("Playhead past duration."),rv(a,b);if(b>g)return a.b.debug("Playhead past end."),g;if(b<f){if(c(m))return a.b.debug("Playhead before start \x26 start is buffered"),m;a.b.debug("Playhead before start \x26 start is unbuffered");return d}if(b>=l||c(b))return a.b.debug("Playhead in safe region or in buffered region."),
b;a.b.debug("Playhead outside safe region \x26 in unbuffered region.");return d};pv=function(a,b){var c=ys(a.a,0);if(b<c)return c;c=xs(a.a);return b>c?c:b};lv=function(a,b,c){if(!c.stallEnabled)return null;var d=c.stallSkip;c=new Zu(new av(b),c.stallThreshold);$u(c,function(e,f){a.b.warn(["Stall detected at",e,"for",f,"seconds. Seeking forward",d,"seconds."].join(" "));b.currentTime+=d});return c};
_.sv=function(a,b){this.b=b;this.c=a;this.h=null;this.l=1;this.w=Promise.resolve();this.i=[];this.j=new Map;this.f=new Map;this.B=this.g=this.m=this.o=!1;this.A=0;this.a=new _.H("clpp.mse.Streaming");this.u=!1};uv=function(a){var b=a.f.get(_.Xd);return b?a.c.periods[b.fb]:(b=a.f.get(_.Nb))?a.c.periods[b.fb]:null};wv=function(a){return _.vv(a,_.Nb)};xv=function(a){return _.vv(a,_.Xd)};_.vv=function(a,b){var c=a.f.get(b);return c?c.rd||c.stream:null};
Cv=function(a,b){var c,d,e,f,g,h,l,m,n,p;return _.A(function(q){switch(q.a){case 1:return c=_.al,_.x(q,a.b.N.clear(c.TEXT),2);case 2:return a.A++,a.B=!1,d=a.A,e=a.b.N,f=new Map,g=new Set,f.set(c.TEXT,b),g.add(b),_.x(q,e.init(f,!1),3);case 3:return a.g?q["return"]():_.x(q,yv(a,g),4);case 4:if(a.g)return q["return"]();l=(h=e.getTextDisplayer().isTextVisible())||a.h.alwaysStreamText;a.A!=d||a.f.has(c.TEXT)||a.B||!l||(m=a.b.Ya(),n=zv(a,m),p=Av(b,n,0),a.f.set(c.TEXT,p),Bv(a,p,0));_.y(q)}})};
Ev=function(a,b,c,d){b.video&&_.Dv(a,b.video,c,d);b.audio&&_.Dv(a,b.audio,c,d)};
_.Dv=function(a,b,c,d){var e=a.f.get(b.type);if(!e&&b.type==_.k&&a.h.ignoreTextStreamFailures)Cv(a,b);else if(e){var f=Fv(a,b);if(c&&f!=e.fb)a.a.debug("switch: switching to stream in another Period; clearing buffer and changing Periods"),a.f.forEach(function(l){Gv(a,l)});else{e.rd&&(a.a.debug("switch during trick play mode",b),b.trickModeVideo?(e.rd=b,b=b.trickModeVideo,a.a.debug("switch found trick play stream",b)):(e.rd=null,a.a.debug("switch found no special trick play stream")));var g=a.i[f];
if(g&&g.nc&&(g=a.j.get(b.id))&&g.nc)if(e.stream!=b){g=a.c.presentationTimeline.getDuration();var h=a.b.Ya();h=Hv(a,e,h);!c&&(e.endOfStream||h>=g)?a.a.debug(qs+Iv(e)+" already buffered to the end. Not switching."):(b.type==_.k&&Lt(a.b.N,_.hg(b.mimeType,b.codecs)),e.stream=b,e.hd=!0,a.a.debug("switch: switching to Stream "+Iv(e)),Jv(a,e,f)&&(a.a.info("Aborting current segment request to switch."),e.Fc.abort()),c&&(e.Db?e.ud=!0:e.ub?(e.Bb=!0,e.Vc=d,e.ud=!0):(Kv(e),Lv(a,e,!0,d))))}else a.a.debug(qs+Iv(e)+
" already active")}}};Jv=function(a,b,c){if(!b.Fc)return!1;var d=a.b.Ya(),e=a.b.N.ea(b.type);c=(c=Mv(a,b,d,e,c))?c.ha?c.ha-c.ua:null:null;if(null==c)return!1;var f=b.stream.initSegmentReference;f&&(c+=(f.ha?f.ha-f.ua:null)||0);f=a.b.Od().getBandwidthEstimate();if(8*c/f<(null===e?0:e-d)-Math.max(a.c.minBufferTime||0,a.h.rebufferingGoal))return!0;a=b.Fc;a=a.f?a.f.bytesRemaining:-1;return 0>a||a>c?!0:!1};
Nv=function(a){function b(l){return a.b.N.Kb(l,c,d)}var c=a.b.Ya(),d=a.h.smallGapLimit,e=!1,f=zv(a,c);if(_.ek(a.f.values(),function(l){return l.fb==f}))for(var g=_.u(a.f.keys()),h=g.next();!h.done;h=g.next())h=h.value,b(h)||(Gv(a,a.f.get(h)),e=!0);else _.ek(a.f.keys(),b)||(a.a.debug("(all): seeked: unbuffered seek: clearing all buffers"),a.f.forEach(function(l){Gv(a,l)}),e=!0);e||a.a.debug("(all): seeked: buffered seek: presentationTime\x3d"+c)};
Gv=function(a,b){var c=Iv(b);b.Db?a.a.debug(c,"clear: already clearing the buffer"):b.Bb?a.a.debug(c,"clear: already waiting"):b.ub?(a.a.debug(c,"clear: currently updating"),b.Bb=!0,b.Vc=0):null==a.b.N.Sa(b.type)?(a.a.debug(c,"clear: nothing buffered"),null==b.jb&&Bv(a,b,0)):(a.a.debug(c,"clear: handling right now"),Kv(b),Lv(a,b,!1,0))};
Pv=function(a,b,c,d,e){var f,g,h,l,m,n,p;return _.A(function(q){if(1==q.a)return f=a.b.Ya(),g=zv(a,f),h=_.al,l=new Map,m=new Set,b&&(l.set(h.AUDIO,b),m.add(b)),c&&(l.set(h.VIDEO,c),m.add(c)),d&&(l.set(h.TEXT,d),m.add(d)),n=a.b.N,p=a.h.forceNativeTS,_.x(q,n.init(l,p),2);if(3!=q.a){if(a.g)return q["return"]();Ov(a);return _.x(q,yv(a,m),3)}if(a.g)return q["return"]();l.forEach(function(t,v){if(!a.f.has(v)){var z=Av(t,g,e);a.f.set(v,z);Bv(a,z,0)}});_.y(q)})};
Av=function(a,b,c){return{stream:a,type:a.type,kc:null,cb:null,rd:null,hd:!0,fb:b,endOfStream:!1,ub:!1,jb:null,Bb:!1,Vc:0,ud:!1,Db:!1,le:!1,jc:!1,Of:c||0,Fc:null,$c:!1}};
Qv=function(a,b){var c=a.i[b];if(c)return a.a.debug("(all) Period "+b+Xr),c.promise;a.a.debug("(all) setting up Period "+b);c={promise:new _.nj,nc:!1};a.i[b]=c;for(var d=new Set,e=_.u(a.c.periods[b].variants),f=e.next();!f.done;f=e.next())f=f.value,f.video&&d.add(f.video),f.video&&f.video.trickModeVideo&&d.add(f.video.trickModeVideo),f.audio&&d.add(f.audio);e=_.u(a.c.periods[b].textStreams);for(f=e.next();!f.done;f=e.next())d.add(f.value);a.w=a.w.then(function(){return a.g?null:yv(a,d)}).then(function(){a.g||
(a.i[b].promise.resolve(),a.i[b].nc=!0,a.a.debug("(all) setup Period "+b))})["catch"](function(g){a.g||(a.i[b].promise["catch"](function(){}),a.i[b].promise.reject(),delete a.i[b],a.a.warn("(all) failed to setup Period "+b),a.b.onError(g))});return c.promise};
yv=function(a,b){var c,d,e,f,g,h,l,m,n,p,q;return _.A(function(t){switch(t.a){case 1:c=[];d=_.u(b);for(e=d.next();!e.done;e=d.next())f=e.value,(g=a.j.get(f.id))?(a.a.debug("(all) Stream "+f.id+Xr),c.push(g.promise)):(a.a.debug("(all) setting up Stream "+f.id),a.j.set(f.id,{promise:new _.nj,nc:!1}),c.push(f.createSegmentIndex()));_.Ce(t,2);return _.x(t,Promise.all(c),4);case 4:if(a.g)return t["return"]();_.De(t,3);break;case 2:h=_.Ee(t);if(a.g)return t["return"]();l=_.u(b);for(e=l.next();!e.done;e=
l.next())m=e.value,a.j.get(m.id).promise["catch"](function(){}),a.j.get(m.id).promise.reject(),a.j["delete"](m.id);throw h;case 3:n=_.u(b);for(e=n.next();!e.done;e=n.next())p=e.value,q=a.j.get(p.id),q.nc||(q.promise.resolve(),q.nc=!0,a.a.debug("(all) setup Stream "+p.id));_.y(t)}})};Ov=function(a){var b=a.c.presentationTimeline.getDuration();Infinity>b?a.b.N.Ab(b):a.b.N.Ab(Math.pow(2,32))};
Uv=function(a,b){if(!a.g){var c=Iv(b);if(!b.ub&&null!=b.jb&&!b.Db)if(b.jb=null,b.Bb)a.a.debug(c,"skipping update and clearing the buffer"),Lv(a,b,b.ud,b.Vc);else{try{var d=Rv(a,b);null!=d&&(Bv(a,b,d),b.jc=!1)}catch(e){Sv(a,e);return}d=Array.from(a.f.values());Tv(a,b);a.o&&d.every(function(e){return e.endOfStream})&&(a.a.debug(c,"calling endOfStream()..."),a.b.N.endOfStream().then(function(){if(!a.g&&!a.c.presentationTimeline.Nb()){var e=a.b.N.getDuration();e<a.c.presentationTimeline.getDuration()&&
a.c.presentationTimeline.Ab(e)}}).then(function(){a.b.xf()}))}}};
Rv=function(a,b){function c(q){return q.type==_.k&&q.stream.mimeType==_.Db}if(c(b))return a.b.N.sd(b.stream.originalId||""),null;var d=Iv(b),e=a.b.Ya(),f=Hv(a,b,e);a.a.debug(d,"timeNeeded\x3d"+f);var g=Fv(a,b.stream),h=zv(a,f),l=a.b.N.ra(b.type,e);a.a.debug(d,"update_:",ns+e,"bufferedAhead\x3d"+l);var m=Math.max(a.c.minBufferTime||0,a.h.rebufferingGoal,a.h.bufferingGoal)*a.l,n=a.c.presentationTimeline.Nb()?_.Sn(a.c.presentationTimeline):a.c.presentationTimeline.getDuration();if(f>=n&&!b.$c)return Vv(a,
b),null;b.endOfStream=!1;b.fb=h;if(h!=g)return a.a.debug(d,"need Period "+h,ns+e,"timeNeeded\x3d"+f,"currentPeriodIndex\x3d"+g),null;if(l>=m)return a.a.debug(d,"buffering goal met"),a.h.bufferLimitUpdateInterval||.5;h=a.b.N.ea(b.type);h=Mv(a,b,e,h,g);if(!h)return a.c.presentationTimeline.isLive()||b.type===_.k?a.h.bufferLimitUpdateInterval||1:(a.a.debug("Media state "+d+": no next segment found. Assuming EOS."),Vv(a,b),null);var p=Infinity;Array.from(a.f.values()).forEach(function(q){c(q)||(q=Hv(a,
q,e),p=Math.min(p,q))});if(f>=p+a.c.presentationTimeline.a)return a.h.bufferLimitUpdateInterval||1;b.Of=0;Wv(a,b,e,g,h);return null};Vv=function(a,b){a.a.debug(Iv(b),"buffered to end of presentation");b.endOfStream=!0;if(b.type==_.Xd){var c=a.f.get(_.k);c&&c.stream.mimeType==_.Db&&(c.endOfStream=!0)}};Hv=function(a,b,c){if(!b.kc||!b.cb)return Math.max(c,b.Of);c=Fv(a,b.kc);return a.c.periods[c].startTime+b.cb.endTime};
Mv=function(a,b,c,d,e){var f=Iv(b);if(b.cb&&b.stream==b.kc)return d=b.cb.position+1,a.a.debug(f,"next position known:","position\x3d"+d),Xv(a,b,e,d);b.cb?(a.a.debug(f,"next position unknown: another Stream buffered"),f=Fv(a,b.kc),f=Yv(a,b,a.c.periods[f].startTime+b.cb.endTime,e)):(a.a.debug(f,"next position unknown: nothing buffered"),f=Yv(a,b,d||c,e));if(null==f)return null;c=null;null==d&&(c=Xv(a,b,e,Math.max(0,f-1)));return c||Xv(a,b,e,f)};
Yv=function(a,b,c,d){var e=Iv(b);d=a.c.periods[d];a.a.debug(e,"looking up segment:",ns+c,ks+d.startTime);c=Math.max(0,c-d.startTime);b=b.stream.findSegmentPosition(c);null==b&&a.a.warn(e,"cannot find segment:",ks+d.startTime,"lookupTime\x3d"+c);return b};
Xv=function(a,b,c,d){var e=Iv(b);c=a.c.periods[c];var f=b.stream.getSegmentReference(d);if(!f)return a.a.debug(e,"segment does not exist:",ks+c.startTime,"position\x3d"+d),null;var g=a.c.presentationTimeline;d=_.Tn(g);g=_.Sn(g);return!b.$c&&(c.startTime+f.endTime<d||c.startTime+f.startTime>g)?(a.a.debug(e,"segment is not available:",ks+c.startTime,ps+f.startTime,os+f.endTime,"availabilityStart\x3d"+d,"availabilityEnd\x3d"+g),null):f};
Wv=function(a,b,c,d,e){function f(q,t){if(a.g||a.m)return null;p=!0;return Zv(a,b,c,h,l,e,q,t)}var g=Iv(b),h=a.c.periods[d];a.a.debug(g,"fetchAndAppend_:",ns+c,ks+h.startTime,"reference.position\x3d"+e.position,ps+e.startTime,os+e.endTime);var l=b.stream,m=a.c.presentationTimeline.getDuration(),n=a.c.periods[d+1];d=$v(a,b,d,Math.max(0,h.startTime-.1),n?n.startTime+.01:m);b.ub=!0;b.hd=!1;a.a.debug(g,"fetching segment");var p=!1;d.then(function(){return a.g||a.m?null:aw(a,b,e,!1,function(q){return f(q.data,
!0)})}).then(function(q){return p||a.g||a.m||null===q?null:f(q,!1)}).then(function(){a.g||a.m||(b.ub=!1,b.le=!1,b.Bb||a.b.kd(),Bv(a,b,0),bw(a,b,l),a.a.debug(g,"finished fetch and append"))})["catch"](function(q){if(!a.g&&!a.m)if(q,b.ub=!1,b.type==_.k&&a.h.ignoreTextStreamFailures)1001==q.code?a.a.warn(g,"Text stream failed to download. Proceeding without it."):a.a.warn(g,"Text stream failed to parse. Proceeding without it."),a.f["delete"](_.k);else if(7001==q.code)b.ub=!1,b.jb=null,Bv(a,b,0);else if(3017==
q.code)cw(a,b,q);else if(b.type===_.k)q instanceof _.J&&q.b(1),Kv(b),a.b.onError(new _.J(1,2,2010,q));else if(1001<=q.code&&1003>=q.code){var t=!0;1001===q.code&&500<=q.data.status||(t=typeof a.b.Ae===_.Dc&&!a.b.Ae(b.stream));t&&(b.jc=!0,q.b(_.K),Sv(a,q))}else a.a.error(g,"failed fetch and append: code\x3d"+q.code),b.jc=!0,q instanceof _.J&&q.b(_.K),Sv(a,q)})};
cw=function(a,b,c){var d=Iv(b);if(Array.from(a.f.values()).some(function(f){return f!=b&&f.le}))a.a.debug(d,$r,"waiting for another stream to recover...");else{var e=Math.round(100*a.l);if(20<e)a.l-=.2;else if(4<e)a.l-=.04;else{a.a.error(d,"MediaSource threw QuotaExceededError too many times");b.jc=!0;a.m=!0;a.b.onError(c);return}a.a.warn(d,$r,"reducing buffering goals by "+(100-Math.round(100*a.l))+"%");b.le=!0}Bv(a,b,4)};
$v=function(a,b,c,d,e){if(!b.hd)return Promise.resolve();var f=Iv(b);c=a.c.periods[c].startTime-(b.stream.presentationTimeOffset||0);a.a.debug(f,"setting timestamp offset to "+c);a.a.debug(f,"setting append window start to "+d);a.a.debug(f,"setting append window end to "+e);d=St(a.b.N,b.type,c,d,e);if(!b.stream.initSegmentReference)return d;a.a.debug(f,"fetching init segment");e=aw(a,b,b.stream.initSegmentReference,!0).then(function(g){if(a.g)return null;a.a.debug(f,"appending init segment");return Qt(a.b.N,
b.type,g,null,null,b.stream.closedCaptions&&0<b.stream.closedCaptions.size)})["catch"](function(g){b.hd=!0;return Promise.reject(g)});return Promise.all([d,e])};
Zv=function(a,b,c,d,e,f,g,h){h=void 0===h?!1:h;var l=Iv(b),m=e.closedCaptions&&0<e.closedCaptions.size;null!=e.emsgSchemeIdUris&&0<e.emsgSchemeIdUris.length&&(new _.jh).X("emsg",a.D.bind(a,d,f,e.emsgSchemeIdUris)).parse(g);var n=0;return dw(a,b,c).then(function(){if(a.g)return null;a.a.debug(l,"appending media segment");var p=f.startTime+d.startTime,q=f.endTime+d.startTime;n=a.b.N.ea(b.type)||0;return Qt(a.b.N,b.type,g,p,q,m,e.id,h)}).then(function(){if(!a.g){a.a.debug(l,"appended media segment");
if(!a.c.presentationTimeline.isLive()&&b.type!==_.k){var p=(a.b.N.ea(b.type)||0)-n;a.a.debug(l,"real segment duration",p);var q=f.endTime-f.startTime;p-=q;Math.abs(p)>=Math.min(.01,q)&&Math.abs(p)<=Math.min(1,q)&&(b.$c=!0,e.adjustSegmentDurations(f.position,p))}b.kc=e;b.cb=f}})};
dw=function(a,b,c){if(a.g)return Promise.resolve();var d=Iv(b);a.a.debug(d,"checking buffer length");var e=Math.max(a.h.bufferBehind,a.c.presentationTimeline.a),f=a.b.N.Sa(b.type);if(null==f)return a.a.debug(d,"buffer behind okay because nothing buffered:",ns+c,gs+e),Promise.resolve();var g=c-f,h=g-e;if(0>=h)return a.a.debug(d,"buffer behind okay:",ns+c,hs+g,gs+e,"underflow\x3d"+-h),Promise.resolve();a.a.debug(d,"buffer behind too large:",ns+c,hs+g,gs+e,"overflow\x3d"+h);return a.b.N.remove(b.type,
f,f+h).then(function(){a.g||a.a.debug(d,"evicted "+h+" seconds")})};bw=function(a,b,c){if(!a.o){var d=Iv(b);b=Array.from(a.f.values());1!=b.length||b[0].type!=_.k?a.o=b.every(function(e){return e.type==_.k||a.u?!0:!e.Bb&&!e.Db&&e.cb}):a.u&&(a.o=!0);if(a.o){a.a.debug(d,"startup complete");c=Fv(a,c);a.i[c]||Qv(a,c).then(function(){a.g||(a.a.debug(d,is),a.b.de())})["catch"](_.Lk.Ec);for(c=0;c<a.c.periods.length;++c)Qv(a,c)["catch"](_.Lk.Ec);a.b.ej&&(a.a.debug(d,"calling onStartupComplete()..."),a.b.ej())}}};
Tv=function(a,b){var c=Iv(b),d=Fv(a,b.stream);if(b.fb!=d){var e=b.fb,f=Array.from(a.f.values());f.every(function(g){return g.fb==e})?f.every(ew)?(a.a.debug(c,"all need Period "+e),Qv(a,e).then(function(){if(!a.g)if(f.every(function(n){var p=ew(n),q=Fv(a,n.stream);return p&&n.fb==e&&q!=e})){var g=a.c.periods[e];a.a.debug(c,"calling onChooseStreams()...");var h=a.b.ee(g);a.u=!h.variant&&!!h.text;var l=new Map;h.variant&&h.variant.video&&l.set(_.Xd,h.variant.video);h.variant&&h.variant.audio&&l.set(_.Nb,
h.variant.audio);h.text&&l.set(_.k,h.text);var m=_.u(a.f.keys());for(h=m.next();!h.done;h=m.next())if(h=h.value,!l.has(h)&&h!=_.k){a.a.error(c,"invalid Streams chosen: missing "+h+" Stream");a.b.onError(new _.J(_.K,5,5005));return}m=_.u(Array.from(l.keys()));for(h=m.next();!h.done;h=m.next())if(h=h.value,!a.f.has(h))if(h==_.k)Pv(a,null,null,l.get(_.k),g.startTime),l["delete"](h);else{a.a.error(c,"invalid Streams chosen: unusable "+h+" Stream");a.b.onError(new _.J(_.K,5,5005));return}g=_.u(Array.from(a.f.keys()));
for(h=g.next();!h.done;h=g.next())h=h.value,(m=l.get(h))?(_.Dv(a,m,!1,0),Bv(a,a.f.get(h),0)):a.f["delete"](h);a.a.debug(c,is);a.b.de()}else a.a.debug(c,"ignoring transition to Period",e,"since another is happening")})["catch"](_.Lk.Ec)):a.a.debug(c,"all MediaStates need Period "+e+", but not all MediaStates are idle"):a.a.debug(c,"not all MediaStates need Period "+e)}};zv=function(a,b){var c=Ds(a.c.periods,b+_.Bo);return c?a.c.periods.indexOf(c):0};
Fv=function(a,b){for(var c=a.c.periods,d=0;d<c.length;d++){for(var e=c[d],f=new Set,g=_.u(e.variants),h=g.next();!h.done;h=g.next())h=h.value,h.audio&&f.add(h.audio),h.video&&f.add(h.video),h.video&&h.video.trickModeVideo&&f.add(h.video.trickModeVideo);e=_.u(e.textStreams);for(g=e.next();!g.done;g=e.next())f.add(g.value);if(f.has(b))return d}return-1};
aw=function(a,b,c,d,e){d=void 0===d?!1:d;e=void 0===e?null:e;var f=_.en(c.Ba(),c.ua,c.ha,a.h.attemptParameters,c.startTime,c.endTime,b.type,c.timescale);f.type=_.to;f.onFragment=c.fc?null:e;if(e=c.a())f.keyInfo=e,f.onFragment=null;d&&b.type===_.Xd&&a.h.overridePasp&&f.responseModifiers.push(a.G.bind(a));a.a.debug("fetching: reference\x3d",c);c=a.b.Pb.fetch(f);b.Fc=c;return c.promise.then(function(g){var h=a.b.Od(),l=g.timeMs,m=g.data.byteLength;l&&m&&!d&&h.segmentDownloaded(l,m);b.Fc=null;return g.data})};
Lv=function(a,b,c,d){var e,f,g,h;_.A(function(l){if(1==l.a)return e=Iv(b),b.Bb=!1,b.ud=!1,b.Vc=0,b.Db=!0,a.a.debug(e,"clearing buffer"),d?(g=a.b.Ya(),h=a.b.N.getDuration(),f=a.b.N.remove(b.type,g+d,h)):f=a.b.N.clear(b.type).then(function(){return!a.g&&c?a.b.N.flush(b.type):null}),_.x(l,f,2);if(a.g)return l["return"]();a.a.debug(e,"cleared buffer");b.kc=null;b.cb=null;b.Db=!1;b.endOfStream=!1;b.$c=!1;Bv(a,b,0);_.y(l)})};
Bv=function(a,b,c){a.a.debug(Iv(b),"updating in "+c+" seconds");b.jb=(new _.Gf(function(){Uv(a,b)})).R(c)};Kv=function(a){null!=a.jb&&(a.jb.stop(),a.jb=null)};Sv=function(a,b){a.g||(a.b.onError(b),typeof a.h.failureCallback!==_.Dc||a.h.failureCallback(b))};Iv=function(a){return"("+a.type+":"+a.stream.id+")"};ew=function(a){return!a.ub&&null==a.jb&&!a.Bb&&!a.Db};
hw=function(a){_.Nj.call(this,js);var b=this;this.m=fw;this.f=null;this.Ld=0;this.hf=2;this.tc=null;this.qc=!1;this.h=new _.ii;this.Oc=this.rc=this.Ra=this.i=this.u=this.g=null;this.sc=!1;this.c=this.a=this.o=this.b=this.va=this.B=null;this.rf=1E9;this.Rc=new Set;this.D=!0;this.S=null;this.pf=!1;this.kf=0;this.L=null;this.G=new Gu;this.qf={width:Infinity,height:Infinity};this.w=null;this.V=_.yn;this.Qa=new Nu(this.configuration.preferredAudioLanguage,this.configuration.preferredAudioRole,this.configuration.preferredAudioChannelCount);
this.qa=this.configuration.preferredTextLanguage;this.$=this.Lc=null;this.ac=[];this.T=null;this.pc=this.configuration.preferredTextRole;a&&a(this);this.Jd=null;this.h.on(window,"online",function(){if(b.m==gw){var c=b.b;if(c.g)c.a.error("Unable to retry after StreamingEngine is destroyed!");else if(c.m)c.a.error("Unable to retry after StreamingEngine encountered a fatal error!");else for(var d=_.u(c.f.values()),e=d.next();!e.done;e=d.next()){e=e.value;var f=Iv(e);e.jc&&(c.a.info(f,"Retrying after failure..."),
e.jc=!1,Bv(c,e,.1))}}})};iw=function(a){return new _.Ps(function(b){if(void 0===b||null===b)return null;var c=a.getTrackManager(),d=[];c&&c.getVideoTracks().forEach(function(e){return d.push.apply(d,_.pe(e.renditions))});return d.find(function(e){return e.id==b})||null})};
kw=function(a,b){if(a.V!==b)if(a.V===_.dl&&b!==_.yn){var c=zs(b,_.Gn);a.log.info(_.ds+c)}else{c=a.Ld;c=0===c?0:Date.now()-c;var d=a.V;a.V=b;a.Ld=Date.now();a.w&&_.Pk(a.w.a,a.V);b===_.Cn&&(a.hf=a.Cd?1:2);var e=a.hf,f={currentState:a.V,previousState:d,timeSinceLastStateChangeMS:c,reason:b===_.Cn||d===_.Cn?e:void 0},g=zs(d,_.Gn),h=zs(b,_.Gn),l=b!==_.Cn?"":"["+zs(e,_.Fn)+"]";a.log.info(_.Ja+g+" -\x3e "+(h+l));a.trigger(new _.O(_.Dd,{detail:f}));b===_.Cn?a.trigger(new _.O(_.Wb,{detail:{bufferedTimeMS:-1,
reason:e}})):d===_.Cn&&a.trigger(new _.O(_.Vb,{detail:{bufferedTimeMS:c,reason:e}}))}};qw=function(a){var b=!1;b=void 0===b?!0:b;var c;return _.A(function(d){switch(d.a){case 1:return a.m==lw?d["return"](Promise.reject(new _.J(_.K,7,7E3))):_.x(d,mw(a),2);case 2:return _.x(d,nw(a),3);case 3:if(!b){d.C(0);break}c=a.getSurface().H();return _.x(d,ow(a,c),5);case 5:return _.x(d,pw(a,c),0)}})};
ow=function(a,b){a.f||(a.h.on(b,_.Ac,function(){if(a.f.error){var c=a.f.error.code;if(1==c)c=null;else{var d=a.f.error.msExtendedCode;d&&(0>d&&(d+=Math.pow(2,32)),d=d.toString(16));c=new _.J(_.K,3,3016,{code:c,extendedError:d,message:a.f.error.message})}}else c=null;if(c)a.onError(c)}),a.f=b);return Promise.resolve()};nw=function(a){a.f&&(a.h.off(a.f,_.Ac),a.f=null);return Promise.resolve()};
mw=function(a){var b;return _.A(function(c){switch(c.a){case 1:a.m!=lw&&(a.m=fw);if(b=a.f)a.h.off(b,_.Pc),a.h.off(b,_.kd),a.h.off(b,_.gd),a.h.off(b,_.zc),a.h.off(b,_.od),a.h.off(b,_.nd);a.Ra&&(a.Ra.release(),a.Ra=null);a.Oc&&(a.Oc.stop(),a.Oc=null);if(!a.o){c.C(2);break}return _.x(c,a.o.stop(),3);case 3:a.o=null;case 2:if(!a.c){c.C(4);break}return _.x(c,a.c.stop(),4);case 4:if(!a.b){c.C(6);break}return _.x(c,a.b.destroy(),7);case 7:a.b=null;case 6:a.i&&(a.i.release(),a.i=null);if(!a.u){c.C(8);break}return _.x(c,
a.u.destroy(),9);case 9:a.u=null;case 8:b&&b.src&&(b.removeAttribute("src"),b.load());if(!a.g){c.C(10);break}return _.x(c,a.g.destroy(),11);case 11:a.g=null;case 10:a.G.clear(),a.B=null,a.Rc.clear(),a.a=null,a.w=null,a.D=!0,a.ac=[],a.sc=!1,rw(a),_.y(c)}})};
pw=function(a,b){var c,d,e;return _.A(function(f){if(1==f.a)return c=window.muxjs?new At:new _.Bt,d=_.Sf(a.configuration,["html",_.Ad]),a.K=d.create(a),a.tc=iw(a),a.tc.track(a),e=new _.It(b,c,a.K,a.tc,a.configuration.streaming.maxSegmentToMediaOffset),_.x(f,e.w,2);a.u=e;_.y(f)})};
sw=function(a,b){var c,d;return _.A(function(e){if(1==e.a)return c=a.getNetworkEngine(),d=a,_.x(e,_.Do.create(b.url,c,a.configuration.manifest.attemptParameters,b.type),2);d.o=e.b;a.o.configure(a.configuration.manifest);_.y(e)})};
ww=function(a,b){var c,d,e;return _.A(function(f){c=a.getNetworkEngine();a.va=new Is;Js(a.va,function(g){tw(a,_.ti,g)});d={networkingEngine:c,filterNewPeriod:function(g){return a.Md(g)},filterAllPeriods:function(g){return uw(a,g)},onTimelineCueAdded:function(g){var h=a.va;a:{var l=_.u(h.a);for(var m=l.next();!m.done;m=l.next())if(m=m.value,m.schemeIdUri===g.schemeIdUri&&m.startTime===g.startTime&&m.endTime===g.endTime){l=m;break a}l=null}null==l&&(h.a.add(g),h.b(g))},onEvent:function(g){return a.Ed(g)},
onError:function(g){return a.onError(g)}};e=new _.fl(Promise.resolve().then(function(){var g;return _.A(function(h){if(1==h.a)return g=a,_.x(h,a.o.start(b.url,d),2);g.a=h.b;!a.a.presentationTimeline||_.C.I(a.configuration.suggestedPresentationDelay)||isNaN(a.configuration.suggestedPresentationDelay)||(a.log.info("Apply suggested presentation delay of: "+a.configuration.suggestedPresentationDelay),a.a.presentationTimeline.u=a.configuration.suggestedPresentationDelay);a.a.presentationTimeline&&(a.a.presentationTimeline.o=
!!a.configuration.lowLatencyMode);if(0==a.a.periods.length)throw new _.J(_.K,4,4014);vw(a.a.periods);_.y(h)})}),function(){a.log.info("Aborting parser step...");return a.o.stop()});return _.x(f,e.promise,0)})};
yw=function(a){var b,c,d,e,f;return _.A(function(g){switch(g.a){case 1:a.g=new _.jk({Pb:a.getNetworkEngine(),onError:function(h){return a.onError(h)},fe:function(h){return xw(a,h)},onExpirationUpdated:function(h,l){if(a.o&&a.o.onExpirationUpdated)a.o.onExpirationUpdated(h,l);a.trigger(new _.O(_.rc,{expirationTime:l}))},onEvent:function(h){return a.Ed(h)},getConfiguration:function(){return a.getConfiguration()}});a.g.f=_.bl(a.configuration.drm);c=(b=a.configuration.drm)?b.offlineId||"":"";d=[];e=_.Lm(a.a.periods);
if(!c){g.C(2);break}f=_.jl(_.ec);if(!f){g.C(2);break}return _.x(g,f.kj(b,e,a.getNetworkEngine()),4);case 4:return _.x(g,f.$h(c),5);case 5:d=g.b;case 2:return _.x(g,_.ok(a.g,e,d),6);case 6:uw(a,a.a.periods),_.y(g)}})};
Mw=function(a){var b,c,d,e,f,g,h,l;return _.A(function(m){if(1==m.a)return b=a.f,c=function(n){a.f&&a.B&&(n.type===_.wd&&a.Sc?(a.B.a=Su,rw(a)):zw(a));Aw(a)},d=function(){if(a.f){var n=a.f.playbackRate;0!=n&&a.rc.set(n)}},a.h.on(b,_.kd,c),a.h.on(b,_.gd,c),a.h.on(b,_.zc,c),a.h.on(b,_.wd,c),a.h.on(b,_.vd,c),a.h.on(b,_.nd,c),a.h.on(b,_.od,d),a.c||(a.c=new _.Eu,a.c.configure(a.configuration.abr)),Bw(a,a.a.periods),a.Qa=new Nu(a.configuration.preferredAudioLanguage,a.configuration.preferredAudioRole,a.configuration.preferredAudioChannelCount),
a.qa=a.configuration.preferredTextLanguage,a.pc=a.configuration.preferredTextRole,_.x(m,_.zk(a.g,b),2);if(3!=m.a)return a.c.init(function(n,p,q){!a.D&&Cw(a,n,p,q)}),a.i=Dw(a,a.configuration.startTime),a.Ra=Ew(a),a.rc=new Wu({Rd:function(){return b.playbackRate},Pf:function(n){b.playbackRate=n},oi:function(n){b.currentTime+=n}}),e=Math.max(1E-4,a.configuration.streaming.rebufferingGoal),Fw(a,e),a.b=Gw(a),a.b.h=a.configuration.streaming,Hw(a),a.m=gw,_.x(m,a.b.start(),3);a.configuration.streaming.startAtSegmentBoundary&&
(f=qv(a.i),g=Iw(a,f),jv(a.i.f,g));a.a.periods.forEach(a.Md.bind(a));Jw(a);h=Kw(a);l=h.variants.some(function(n){return n.primary});a.configuration.preferredAudioLanguage||l||a.log.warn("No preferred audio language set.  We will choose an arbitrary language initially");Lw(a,h.variants);a.h.one(b,_.Pc,function(){a.w.i=Date.now()/1E3-(null===a.Jd?0:a.Jd)});_.y(m)})};
vw=function(a){function b(c){return c.video&&c.audio||c.video&&c.video.codecs.includes(",")}a.some(function(c){return c.variants.some(b)})&&(_.I("Found variant with audio and video content, so filtering out audio-only content in all periods."),a.forEach(function(c){c.variants=c.variants.filter(b)}))};
Hw=function(a){function b(p){var q="";p.video&&(q=_.ig(p.video.codecs)[0]);var t="";p.audio&&(t=_.ig(p.audio.codecs)[0]);return q+"-"+t}var c=a.a.periods.reduce(function(p,q){return p.concat(q.variants)},[]);c=du(c,a.configuration.preferredAudioChannelCount);if(1<a.a.periods.length){var d=function(p){p=p.split(".");var q=p[0];1<p.length&&(q+="."+p[1]);return q.toLowerCase()},e=[];a.a.periods.forEach(function(p){var q=new Set;p.variants.forEach(function(t){q.add(d(t.audio.codecs))});e.push(q)});for(var f=
e[0],g={},h=1;h<e.length;g={vd:g.vd},h++)g.vd=e[h],f=new Set(_.pe(f).concat().filter(function(p){return function(q){return p.vd.has(q)}}(g)));c=c.filter(function(p){return f.has(d(p.audio.codecs))})}var l=new _.fi;c.forEach(function(p){var q=b(p);l.push(q,p)});var m=null,n=Infinity;l.forEach(function(p,q){var t=0,v=0;q.forEach(function(F){t+=F.bandwidth||0;++v});var z=t/v;a.log.debug(_.ic,p,"avg bandwidth",z);z<n&&(m=p,n=z)});a.a.periods.forEach(function(p){p.variants=p.variants.filter(function(q){if(b(q)==
m)return!0;a.log.debug("Dropping Variant (better codec available)",q);return!1})})};Dw=function(a,b){return new ov(a.f,a.a,a.configuration.streaming,b,function(){a.Ra&&Ms(a.Ra,!0);a.b&&Nv(a.b)},function(c){return a.dispatchEvent(c)})};Ew=function(a){var b=new Uu(a.a);Vu(b,function(){Jw(a)});var c=new Ks(a.va);Ls(c,function(e){tw(a,_.ui,e)},function(e){tw(a,_.vi,e)},function(e,f){f||(tw(a,_.ui,e),tw(a,_.vi,e))});var d=new Ns(a.f);d.a.add(b);d.a.add(c);return d};
Fw=function(a,b){a.B=new Tu(b,Math.min(.5,b/2));a.B.a=Su;rw(a);a.Oc=(new _.Hf(function(){zw(a)})).Ga(.25)};
zw=function(a){switch(a.m){case gw:a:if(a.f.ended||Mt(a.u))var b=!0;else{if(a.a.presentationTimeline.isLive()){b=_.Sn(a.a.presentationTimeline);var c=a.getBufferInfo();if(null!==c&&(c=c.ea(),null!==c&&c>=b)){b=!0;break a}}b=!1}break;default:b=!1}var d=0;if(a.u){var e=Ot(a.u);c=e.video;e=e.audio;var f=a.f.currentTime;if(c||e)d=c&&e?Math.min(c.ra(f),e.ra(f)):c?c.ra(f):e.ra(f)}c=a.B;e=d;f=b;var g=c.b.get(c.a);d=c.a;e=f||e>=g?Ru:Su;c.a=e;c=d!=e;d=Nw(a);a.log.debug("Buffering state change",c,"is buffering",
d,"buffered to end",b,"state",a.getState());c||a.getState()===_.Cn&&!d?rw(a):a.sc&&Aw(a)};Gw=function(a){var b={Ya:function(){return qv(a.i)},N:a.u,Pb:a.getNetworkEngine(),ee:a.ah.bind(a),de:a.$g.bind(a),onError:a.onError.bind(a),xf:a.Mi.bind(a),onEvent:a.Ed.bind(a),Cf:a.bh.bind(a),kd:a.Zi.bind(a),Od:function(){return a.c},Ae:a.lg.bind(a)};return new _.sv(a.a,b)};vu=function(a){if(a.a&&a.i){var b=Ow(a),c=[];a=_.u(Pw(a));for(var d=a.next();!d.done;d=a.next()){d=d.value;var e=au(d);e.active=d==b;c.push(e)}return c}return[]};
tu=function(a,b){if(a.a&&a.b){var c=Kw(a),d=c.textStreams.find(function(e){return e.id==b.id});d?(Qw(a,c,d,!1),Rw(a,d),a.qa=d.language):a.log.error(_.as,b.id)}};
wu=function(a,b,c){var d=void 0===d?0:d;if(a.a&&a.b){var e=Kw(a);if(a.configuration.abr.enabled&&b)a.log.info("Disable ABR and enable manual track selection to select "+(b.width+"x"+b.height+"@"+b.bandwidth)),a.configuration.abr.enabled=!1,a.c.disable();else if(!a.configuration.abr.enabled&&!b){a.log.info("Enable ABR Selection");a.configuration.abr.enabled=!0;a.c.enable();a.$=null;c=Lw(a,e.variants);null!=a.T&&(a.Qa=a.T,a.T=null);null==c||a.D||Cw(a,c);return}if(b){a.$=b.id;var f=e.variants.find(function(g){return g.id==
b.id});f?(a.$=f.video.id,cu(f)?(Sw(a,e,f,!1),Tw(a,f,c,d),null==a.T&&(a.T=a.Qa),a.Qa=new Ou(f),Lw(a,e.variants)):a.log.error("Unable to switch to restricted track",b.id)):a.log.error("No variant with id",b.id)}else a.$=null,null!=a.T&&(a.Qa=a.T,a.T=null),c=Lw(a,e.variants),null==c||a.D||Cw(a,c)}};
uu=function(a,b){if(a.b){var c=xv(a.b),d=wv(a.b),e=Ds(a.a.periods,qv(a.i));e=a.a.periods[e?a.a.periods.indexOf(e):0].variants.filter(function(l){return l.audio.id==b});var f=e.find(function(l){return l.video.id==c.id});if(!f){a.log.debug("Cannot find exact variant, looking for anything else that matches with given audioId");var g=a.getTrackManager().ka();if(g){var h=g.renditions.map(function(l){return l.id});f=e.find(function(l){return h.find(function(m){return m==l.video.id})})}}if(f){if(d.codecs.split(".")[0]===
f.audio.codecs.split(".")[0]){a.Lc=b;Uw(a,Kw(a));Promise.resolve();return}a.log.warn(Yr)}}Promise.reject()};yu=function(a){var b=a.qc;return a.a?a.u.getTextDisplayer().isTextVisible():b};
su=function(a,b){var c,d,e,f;return _.A(function(g){c=a.qc;d=b;if(c==d)return g["return"]();a.qc=d;if(a.m!=gw)return g.C(0);a.u.getTextDisplayer().setTextVisibility(b);if(a.configuration.streaming.alwaysStreamText)return g.C(0);if(!b){var h=a.b;h.B=!0;var l=h.f.get(_.k);l&&(Kv(l),h.f["delete"](_.k));return g.C(0)}e=Kw(a);f=_.fu(e.textStreams,a.qa,a.pc);return 0<f.length?_.x(g,Cv(a.b,f[0]),0):g.C(0)})};
Sw=function(a,b,c,d){var e=a.getTrackManager();if(e){var f=a.w.j;if(c.video){Bu(e,c.video,d);var g=e.Z();f.f!==g&&(f.f=g,f.a.push({timestamp:Date.now()/1E3,id:g.id,trackId:g.track.id,type:g.track.type,fromAdaptation:d,width:g.width,height:g.height,bandwidth:g.bandwidth}))}c.audio&&(Bu(e,c.audio,d),e=e.sa(),f.b!==e&&(f.b=e,f.a.push({timestamp:Date.now()/1E3,id:e.id,trackId:e.track.id,type:e.track.type,fromAdaptation:d,width:null,height:null,bandwidth:e.bandwidth})))}Iu(a.G,b).variant=c};
Qw=function(a,b,c,d){Iu(a.G,b).text=c;if(b=a.getTrackManager())Bu(b,c,d),c=b.ja(),a=a.w.j,a.c!==c&&(a.c=c,a.a.push({timestamp:Date.now()/1E3,id:c.id,trackId:c.track.id,type:c.track.type,fromAdaptation:d,width:null,height:null,bandwidth:null}))};
Bw=function(a,b){for(var c=0;c<b.length;c++){for(var d=b[c],e=new Map,f=_.u(d.variants),g=f.next();!g.done;g=f.next())if(g=g.value,g.video&&g.video.closedCaptions){g=g.video;for(var h=_.u(g.closedCaptions.keys()),l=h.next();!l.done;l=h.next())if(l=l.value,!e.has(l)){var m={id:a.rf++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:_.Db,codecs:"",
kind:"caption",encrypted:!1,keyId:null,language:g.closedCaptions.get(l),label:null,type:_.k,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:g.roles,channelsCount:null,closedCaptions:null};e.set(l,m)}}e=_.u(e.values());for(f=e.next();!f.done;f=e.next())d.textStreams.push(f.value)}};
uw=function(a,b){var c=a.b?wv(a.b):null,d=a.b?xv(a.b):null;b.forEach($t.bind(null,a.g,c,d));c=Bs(b,function(e){return e.variants.some(cu)});if(0==c)throw new _.J(_.K,4,4032);if(c<b.length)throw new _.J(_.K,4,4011);b.forEach(function(e){Xt(e.variants,a.configuration.restrictions,a.qf)&&a.b&&Kw(a)==e&&Jw(a);Vw(a,e.variants)})};Tw=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?0:d;a.D?(a.S=b,a.pf=c,a.kf=d):Ev(a.b,b,c,d)};Rw=function(a,b){a.D?a.L=b:_.Dv(a.b,b,!0,0)};
Iw=function(a,b){function c(g,h){if(!g)return null;var l=g.findSegmentPosition(h-f.startTime);return null==l?null:(l=g.getSegmentReference(l))?l.startTime+f.startTime:null}var d=wv(a.b),e=xv(a.b),f=Kw(a);d=c(d,b);e=c(e,b);return null!=e&&null!=d?Math.max(e,d):null!=e?e:null!=d?d:b};Nw=function(a){return a.g&&a.g.o?!0:a.B?a.B.getState()===Su:!1};rw=function(a){var b=Nw(a);if(a.w&&a.B&&a.i){var c=a.rc;c.f=b;Xu(c);a.i.g.g=b;Aw(a)}};
Aw=function(a){var b=a.getDuration(),c=a.getPosition();a.f&&a.f.ended||a.sc&&0<c&&b<=c?kw(a,_.En):Nw(a)||a.Sc?kw(a,_.Cn):a.f&&a.f.paused?kw(a,_.Kn):kw(a,_.ln)};
Lw=function(a,b){try{Vw(a,b)}catch(e){return a.onError(e),null}var c=b.filter(function(e){return cu(e)});c=lu(c,a.Lc);var d=a.Qa.create(c);a.c.setVariants(Array.from(d.values()));if(a.configuration.abr.enabled||null===a.$)return a.c.chooseVariant();c=c.find(function(e){return null!==e.video&&e.video.id===a.$});return c?c:(a.log.warn("Selected video track not found. Falling back to ABR selection"),a.c.chooseVariant())};
Uw=function(a,b){var c=Lw(a,b.variants);a.Lc=c&&c.audio&&c.audio.id;c&&(Sw(a,b,c,!0),Tw(a,c,!0));(c=_.fu(b.textStreams,a.qa,a.pc)[0]||null)&&(a.configuration.streaming.alwaysStreamText||yu(a))&&(Qw(a,b,c,!0),Rw(a,c))};
Yw=function(a,b){a.D=!0;a.c.disable();a.log.debug("Choosing new streams after period changed");var c=Lw(a,b.variants),d=_.fu(b.textStreams,a.qa,a.pc)[0]||null;a.S&&(b.variants.includes(a.S)&&(c=a.S),a.S=null);a.L&&(b.textStreams.includes(a.L)&&(d=a.L),a.L=null);c&&a.ac.push(function(){return Sw(a,b,c,!0)});d&&a.ac.push(function(){return Qw(a,b,d,!0)});b===Kw(a)&&Ww(a);!uv(a.b)&&d&&(Xw(a,d)&&(a.qc=!0),a.qc&&a.u.getTextDisplayer().setTextVisibility(!0));return a.configuration.streaming.alwaysStreamText||
yu(a)?{variant:c,text:d}:{variant:c,text:null}};Xw=function(a,b){var c=_.dn(a.configuration.preferredTextLanguage),d=_.dn(b.language);d=_.dn(d);c=_.dn(c);return d.split("-")[0]==c.split("-")[0]};Cw=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?0:d;if(a.configuration.abr.enabled){a.log.debug("switch_");var e=Zw(a,b);a.ac.push(function(){return Sw(a,e,b,!0)});e===Kw(a)&&Ww(a);a.b&&Ev(a.b,b,c,d)}};Jw=function(a){var b=a.getTrackManager();b&&a.m!=lw&&(b.a&&(Au(b),b.a.trigger(new _.O(_.so))),Ww(a))};
Ww=function(a){for(;a.ac.length;)a.ac.shift()()};tw=function(a,b,c){a.trigger(new _.O(b,{detail:{schemeIdUri:c.schemeIdUri,value:c.value,startTime:c.startTime,endTime:c.endTime,id:c.id,eventElement:c.eventElement}}))};
xw=function(a,b){if(a.b){var c=Kw(a),d=!1,e=Object.keys(b);0==e.length&&a.log.warn("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var f=1==e.length&&"00"==e[0];f&&a.log.warn("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");e.length&&c.variants.forEach(function(h){hu(h).forEach(function(l){var m=
h.allowedByKeySystem;l.keyId&&(l=b[f?"00":l.keyId],h.allowedByKeySystem=!!l&&!$w.includes(l));m!=h.allowedByKeySystem&&(d=!0)})});e=wv(a.b);var g=xv(a.b);(e=gu(e,g,c.variants))&&!e.allowedByKeySystem&&(a.log.debug("Choosing new streams after key status changed"),Uw(a,c));d&&(Jw(a),Lw(a,c.variants))}};
Vw=function(a,b){var c=a.g?_.C.xe(a.g.$):{},d=Object.keys(c);d=d.length&&"00"==d[0];for(var e=!1,f=!1,g=[],h=[],l=_.u(b),m=l.next();!m.done;m=l.next()){m=m.value;var n=[];m.audio&&n.push(m.audio);m.video&&n.push(m.video);n=_.u(n);for(var p=n.next();!p.done;p=n.next())if(p=p.value,p.keyId){var q=c[d?"00":p.keyId];q?$w.includes(q)&&(h.includes(q)||h.push(q)):g.includes(p.keyId)||g.push(p.keyId)}m.allowedByApplication?m.allowedByKeySystem&&(e=!0):f=!0}if(!e)throw new _.J(_.K,4,4012,{hasAppRestrictions:f,
missingKeys:g,restrictedKeyStatuses:h});};Pw=function(a){a=Kw(a);return null==a?[]:a.variants.filter(function(b){return cu(b)})};ax=function(a){var b=Kw(a);return null==b?[]:b.textStreams.filter(function(c){return!a.Rc.has(c)})};Kw=function(a){var b=qv(a.i),c=null;a=_.u(a.a.periods);for(var d=a.next();!d.done;d=a.next())d=d.value,d.startTime<=b&&(c=d);return c};Ow=function(a){var b=Kw(a);return Iu(a.G,b).variant};
Zw=function(a,b){for(var c=_.u(a.a.periods),d=c.next();!d.done;d=c.next())if(d=d.value,d.variants.includes(b))return d;return null};bx=function(){this.name=js};Is.prototype.release=function(){this.b=function(){};this.a.clear()};Ks.prototype.release=function(){this.g=null;this.f.clear();this.a=function(){};this.b=function(){};this.c=function(){}};
Ks.prototype.h=function(a,b){for(var c={},d=_.u(this.g.a),e=d.next();!e.done;c={xd:c.xd,Mc:c.Mc},e=d.next()){e=e.value;c.xd=this.f.get(e)||null;c.Mc=a<e.startTime?1:a>e.endTime?3:2;this.f.set(e,c.Mc);var f=this.i.find(function(g){return function(h){return h.Yb===g.xd&&h.Xb===g.Mc}}(c));f&&f.Ib(e,b)}};Ns.prototype.release=function(){this.c.stop();for(var a=_.u(this.a),b=a.next();!b.done;b=a.next())b.value.release();this.a.clear()};
_.Ps.prototype.track=function(a){null!=this.a&&(this.a&&(this.a.off(_.td,this.c),this.f&&this.a.off(_.Nd,this.c)),this.a=null);a&&(this.a=a,this.a.on(_.td,this.c,this))};
_.Ps.prototype.append=function(a,b,c){var d=this.h?this.h(c):null;d||this.log.debug("Unable to resolve rendition for id",c);c={start:a,end:b,rendition:d,width:d?d.width:0,height:d?d.height:0,bandwidth:d?d.bandwidth:0};var e=this.b.find(function(f){return f.start>=a&&f.end<=b});e?(e.rendition=d,e.width=c.width,e.height=c.height,e.bandwidth=c.bandwidth,e.start=c.start,e.end=c.end):(this.b.forEach(function(f){a>=f.start&&a<f.end?f.end=a:b>=f.start&&b<f.end&&(f.start=b)}),this.b.push(c),this.b.sort(Os));
Ss(this);this.c();this.a&&this.a.trigger(new _.O(_.$d))};_.Ps.prototype.clear=function(){this.b=[];Ss(this);this.a&&(this.a.trigger(new _.O(_.$d)),this.a.trigger(new _.O(_.Rb)))};
_.Ps.prototype.c=function(){if(this.a){var a=this.a.getPosition();if(0<=a){a:{for(var b=this.b.length,c=Number.MAX_SAFE_INTEGER,d=0;d<b;d++){var e=this.b[d];c=Math.min(e.start,c);if(e.start<=a&&e.end>a){a=.1>e.end-a&&d<b-1?this.b[d+1].rendition:e.rendition;break a}if(e.start>a)break}a=0<b&&c>a&&.25>c-a?this.b[0].rendition:null}if(a&&this.g!==a&&(this.g=a,this.a)){c=b=-1;if(a)b=a.width||-1,c=a.height||-1;else if(d=this.a.getSurface().H())b=d.videoWidth,c=d.videoHeight;this.a.trigger(new _.O(_.Tb,{detail:{width:b,
height:c,bandwidth:a?a.bandwidth:null,rendition:a}}))}}}};_.w(Us,_.Nf);_.r=Us.prototype;_.r.append=function(a){for(var b=this,c=[],d=0;d<a.length;d++){var e=Vs(a[d]);e&&c.push(e)}c.slice().sort(function(f,g){return f.startTime!==g.startTime?f.startTime-g.startTime:f.endTime!==g.endTime?f.endTime-g.startTime:c.indexOf(g)-c.indexOf(f)}).forEach(function(f){b.a.addCue(f)})};_.r.remove=function(a,b){if(!this.a)return!1;Ws(this.a,function(c){return c.startTime<b&&c.endTime>a});return!0};
_.r.isTextVisible=function(){return this.a.mode==_.zd};_.r.setTextVisibility=function(a){null!==this.a&&(this.a.mode=a?_.zd:_.Fc)};_.r.destroy=function(){this.a&&Ws(this.a,function(){return!0});this.a=null;return Promise.resolve()};Xs.prototype.O=function(){return!0};Xs.prototype.create=function(a){return new Us(a)};Xs.prototype.create=Xs.prototype.create;Xs.prototype.isSupported=Xs.prototype.O;_.Rf(_.Ad,new Xs);Ys.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)};Ys.prototype.stopImmediatePropagation=function(){this.a=!0};Ys.prototype.stopPropagation=function(){};Zs.prototype.addEventListener=function(a,b){this.h.push(a,b)};Zs.prototype.removeEventListener=function(a,b){this.h.remove(a,b)};Zs.prototype.dispatchEvent=function(a){for(var b=this.h.get(a.type)||[],c=0;c<b.length;++c){a.target=this.j;a.currentTarget=this.j;var d=b[c];try{d.handleEvent?d.handleEvent(a):d.call(this,a)}catch(e){_.cf("Uncaught exception in event handler",e,e?e.message:null,e?e.stack:null)}if(a.a)break}return a.defaultPrevented};$s.prototype.createMediaKeys=function(){_.I("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var a=new dt(this.keySystem);return Promise.resolve(a)};$s.prototype.getConfiguration=function(){_.I("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration");return this.a};dt.prototype.createSession=function(a){_.I("PatchedMediaKeysMs.MediaKeys.createSession");a=a||_.Jd;if(a!=_.Jd)throw new TypeError(_.Ra+a+_.ba);return new gt(this.a,a)};
dt.prototype.setServerCertificate=function(){_.I("PatchedMediaKeysMs.MediaKeys.setServerCertificate");return Promise.resolve(!1)};_.Ne(gt,Zs);_.r=gt.prototype;_.r.generateRequest=function(a,b){_.I("PatchedMediaKeysMs.MediaKeySession.generateRequest");this.a=new _.nj;try{this.c=this.g.createSession(_.Zd,_.ef(b),null),this.f.on(this.c,"mskeymessage",this.Vi.bind(this)),this.f.on(this.c,"mskeyadded",this.Ti.bind(this)),this.f.on(this.c,"mskeyerror",this.Ui.bind(this)),it(this,_.Ed)}catch(c){this.a.reject(c)}return this.a};
_.r.load=function(){_.I("PatchedMediaKeysMs.MediaKeySession.load");return Promise.reject(Error(_.Ba))};_.r.update=function(a){_.I("PatchedMediaKeysMs.MediaKeySession.update");this.b=new _.nj;try{this.c.update(_.ef(a))}catch(b){this.b.reject(b)}return this.b};_.r.close=function(){_.I("PatchedMediaKeysMs.MediaKeySession.close");try{this.c.close(),this.closed.resolve(),_.li(this.f)}catch(a){this.closed.reject(a)}return this.closed};
_.r.remove=function(){_.I("PatchedMediaKeysMs.MediaKeySession.remove");return Promise.reject(Error(_.Ca))};_.r.Vi=function(a){_.I("PatchedMediaKeysMs.onMsKeyMessage_",a);this.a&&(this.a.resolve(),this.a=null);this.dispatchEvent(new Ys(_.Tc,{messageType:void 0==this.keyStatuses.a?_.Lc:_.Kc,message:a.message.buffer}))};
_.r.Ti=function(a){_.I("PatchedMediaKeysMs.onMsKeyAdded_",a);this.a?(_.I("Simulating completion for a PR persistent license."),it(this,_.Rd),this.a.resolve(),this.a=null):this.b&&(it(this,_.Rd),this.b.resolve(),this.b=null)};
_.r.Ui=function(a){_.I("PatchedMediaKeysMs.onMsKeyError_",a);a=Error("EME PatchedMediaKeysMs key error");a.errorCode=this.c.error;if(null!=this.a)this.a.reject(a),this.a=null;else if(null!=this.b)this.b.reject(a),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:it(this,_.dd);break;default:it(this,_.Ic)}};var cx;_.r=ft.prototype;_.r.forEach=function(a){this.a&&a(this.a,cx)};_.r.get=function(a){if(this.has(a))return this.a};
_.r.has=function(a){var b=cx;return this.a&&_.Zj(_.ef(a),_.ef(b))?!0:!1};_.r.entries=function(){};_.r.keys=function(){};_.r.values=function(){};
_.Cl(function(){!window.HTMLVideoElement||!window.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(_.bf("Using ms-prefixed EME v20140218"),cx=(new Uint8Array([0])).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=ct,window.MediaKeys=dt,window.MediaKeySystemAccess=$s,navigator.requestMediaKeySystemAccess=at)});var jt="";lt.prototype.createMediaKeys=function(){_.I("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var a=new pt(this.a);return Promise.resolve(a)};lt.prototype.getConfiguration=function(){_.I("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration");return this.b};_.r=pt.prototype;
_.r.createSession=function(a){_.I("PatchedMediaKeysWebkit.MediaKeys.createSession");a=a||_.Jd;if(a!==_.Jd&&a!==_.hd)throw new TypeError(_.Ra+a+_.ba);var b=this.b||document.createElement(_.Xd);b.src||(b.src="about:blank");a=new st(b,this.g,a);this.c.push(a);return a};_.r.setServerCertificate=function(){_.I("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate");return Promise.resolve(!1)};
_.r.hj=function(a){_.I("PatchedMediaKeysWebkit.onWebkitNeedKey_",a);var b=document.createEvent("CustomEvent");b.initCustomEvent(_.xc,!1,!1,null);b.initDataType=_.ie;b.initData=a.initData;this.b.dispatchEvent(b)};
_.r.gh=function(a){_.I("PatchedMediaKeysWebkit.onWebkitKeyMessage_",a);var b=qt(this,a.sessionId);b?(a=new Ys(_.Tc,{messageType:void 0===b.keyStatuses.a?"licenserequest":"licenserenewal",message:a.message}),_.I("PatchedMediaKeysWebkit.MediaKeySession.generated"),b.b&&(b.b.resolve(),b.b=null),b.dispatchEvent(a)):_.cf("Session not found",a.sessionId)};
_.r.eh=function(a){_.I("PatchedMediaKeysWebkit.onWebkitKeyAdded_",a);if(a=qt(this,a.sessionId))_.I("PatchedMediaKeysWebkit.MediaKeySession.ready"),ut(a,_.Rd),a.a&&a.a.resolve(),a.a=null};
_.r.fh=function(a){_.I("PatchedMediaKeysWebkit.onWebkitKeyError_",a);var b=qt(this,a.sessionId);if(b){_.I("PatchedMediaKeysWebkit.MediaKeySession.handleError",a);var c=Error("EME v0.1b key error");c.errorCode=a.errorCode;c.errorCode.systemCode=a.systemCode;!a.sessionId&&b.b?(c.method="generateRequest",45===a.systemCode&&(c.message="Unsupported session type."),b.b.reject(c),b.b=null):a.sessionId&&b.a?(c.method="update",b.a.reject(c),b.a=null):(c=a.systemCode,a.errorCode.code===MediaKeyError.MEDIA_KEYERR_OUTPUT?
ut(b,ms):1===c?ut(b,"expired"):ut(b,_.Ic))}};_.Ne(st,Zs);_.r=st.prototype;_.r.Gd=function(a,b){if(this.a)this.a.then(this.Gd.bind(this,a,b))["catch"](this.Gd.bind(this,a,b));else{this.a=a;if(this.c===rs){var c=_.hf(b);var d=JSON.parse(c);"oct"!==d.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null);c=_.Wj(d.keys[0].k);d=_.Wj(d.keys[0].kid)}else c=_.ef(b),d=null;var e=kt("addKey");try{this.f[e](this.c,c,d,this.sessionId)}catch(f){this.a.reject(f),this.a=null}}};
_.r.generateRequest=function(a,b){_.I("PatchedMediaKeysWebkit.MediaKeySession.generateRequest");return tt(this,b,null)};_.r.load=function(a){_.I("PatchedMediaKeysWebkit.MediaKeySession.load");return this.g===_.hd?tt(this,null,a):Promise.reject(Error(bs))};_.r.update=function(a){_.I("PatchedMediaKeysWebkit.MediaKeySession.update",a);var b=new _.nj;this.Gd(b,a);return b};
_.r.close=function(){_.I("PatchedMediaKeysWebkit.MediaKeySession.close");if(this.g!==_.hd){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var a=kt("cancelKeyRequest");try{this.f[a](this.c,this.sessionId)}catch(b){}}this.closed.resolve();return this.closed};_.r.remove=function(){_.I("PatchedMediaKeysWebkit.MediaKeySession.remove");return this.g!==_.hd?Promise.reject(Error(bs)):this.close()};var dx;_.r=rt.prototype;
_.r.forEach=function(a){this.a&&a(this.a,dx)};_.r.get=function(a){if(this.has(a))return this.a};_.r.has=function(a){var b=dx;return this.a&&_.Zj(_.ef(a),_.ef(b))?!0:!1};_.r.entries=function(){};_.r.keys=function(){};_.r.values=function(){};
_.Cl(function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)_.bf("Using webkit-prefixed EME v0.1b"),jt="webkit";else if(HTMLMediaElement.prototype.generateKeyRequest)_.bf("Using nonprefixed EME v0.1b");else return;dx=(new Uint8Array([0])).buffer;navigator.requestMediaKeySystemAccess=mt;delete HTMLMediaElement.prototype.mediaKeys;HTMLMediaElement.prototype.mediaKeys=null;
HTMLMediaElement.prototype.setMediaKeys=ot;window.MediaKeys=pt;window.MediaKeySystemAccess=lt}});_.Cl(function(){_.I("MediaSource.install");if(window.MediaSource)if(window.cast&&cast.__platform__&&cast.__platform__.canDisplayType)_.bf("Patching Chromecast MSE bugs."),zt();else if(_.Fh()){var a=navigator.appVersion;a=0<=a.indexOf("Version")?parseInt(a.match(/Version\/(\d+)/)[1],10):13;xt();10>=a?(_.bf("Blacklisting MSE on Safari \x3c\x3d 10."),window.MediaSource=null):12>=a?(_.bf("Patching Safari 11 \x26 12 MSE bugs."),vt(),wt()):(_.bf("Patching Safari 13 MSE bugs."),vt())}else _.Eh(2)||_.Eh(3)||
_.Eh(4)?yt():_.bf("Using native MSE as-is.");else _.bf("No MSE implementation available.")});At.prototype.init=function(a){var b=muxjs.mp4.probe;a=_.ef(a);this.g=b.videoTrackIds(a);this.f=b.timescale(a);this.a.init()};At.prototype.c=function(a,b){var c=_.ef(a);(c=this.a.parse(c,this.g,this.f))&&c.captions&&b(c.captions);this.a.clearParsedCaptions()};At.prototype.b=function(){this.a.resetCaptionStream()};_.Bt.prototype.init=function(){};_.Bt.prototype.c=function(){};_.Bt.prototype.b=function(){};Ct.prototype.destroy=function(){this.a&&(this.a.dispose(),this.a=null);return Promise.resolve()};Ct.prototype.j=function(a){this.c=a.captions;var b=new Uint8Array(a.data.byteLength+a.initSegment.byteLength);b.set(a.initSegment,0);b.set(a.data,a.initSegment.byteLength);a.type===_.Xd?this.h.push(b):a.type===_.Nb&&this.g.push(b)};Ct.prototype.i=function(){var a={video:_.ak.apply(null,this.h),captions:this.c,audio:_.ak.apply(null,this.g)};this.b.resolve(a);this.f=!1};_.r=_.It.prototype;
_.r.destroy=function(){var a=this;this.A=!0;var b=[],c;for(c in this.f){var d=this.f[c],e=d[0];this.f[c]=d.slice(0,1);e&&b.push(e.p["catch"](_.Lk.Ec));for(e=1;e<d.length;++e)d[e].p["catch"](_.Lk.Ec),d[e].p.reject()}this.b&&b.push(this.b.destroy());this.l&&b.push(this.l.destroy());for(var f in this.j)b.push(this.j[f].destroy());return Promise.all(b).then(function(){a.i&&(a.i.release(),a.i=null);a.g&&(a.g.removeAttribute("src"),a.g.load(),a.g=null);a.h=null;a.b=null;a.l=null;a.c={};a.j={};a.o={};a.u=
null;a.B=!1;a.f={}})};_.r.init=function(a,b){var c=this,d;return _.A(function(e){if(1==e.a)return d=_.al,_.x(e,c.w,2);a.forEach(function(f,g){var h=_.hg(f.mimeType,f.codecs);if(g==d.TEXT)Lt(c,h);else{var l=new Map;l.set(g,h);MediaSource.isTypeSupported(h)&&b&&!f.keyInfo||!Et(h,g)||(c.j[g]=new Ct,h="aac"==h.split(";")[0].split("/")[1]?h.replace("aac",_.Wc):Dt(g,h),l=Ft(g,h));Kt(c,l)}});_.y(e)})};_.r.Sa=function(a){return a===_.k?this.b.Sa():(a=Nt(this,a))?a.Sa():null};
_.r.ea=function(a){return a===_.k?this.b.ea():(a=Nt(this,a))?a.ea():null};_.r.Kb=function(a,b,c){return a===_.k?this.b.Kb(b):(a=Nt(this,a))?a.Kb(b,!0,c):!1};_.r.ra=function(a,b){if(a===_.k)return this.b.ra(b);var c=Nt(this,a);return c?c.ra(b):0};_.r.sd=function(a){var b=this.ea(_.Xd)||0;this.b.sd(a,b)};
_.r.remove=function(a,b,c){var d=this;return a===_.k?this.b.remove(b,c):Pt(this,a,this.Nf.bind(this,a,b,c)).then(function(){if(a===_.Xd){var e=d.Sa(a),f=d.ea(a);null!==e&&null!==f&&Ts(d.m,e,f)}else a===_.Nb&&(e=d.m,e.a&&e.a.trigger(new _.O(_.Rb)))})};_.r.clear=function(a){if(a==_.k){if(!this.b)return Promise.resolve();this.u.b();return this.b.remove(0,Infinity)}return Pt(this,a,this.Nf.bind(this,a,0,this.h.duration))};
_.r.flush=function(a){return a==_.k?Promise.resolve():Pt(this,a,this.df.bind(this,a))};_.r.endOfStream=function(a){var b=this;return Vt(this,function(){Mt(b)||(a?b.h.endOfStream(a):b.h.endOfStream())})};_.r.Ab=function(a){var b=this;Vt(this,function(){b.h.duration=a})};_.r.getDuration=function(){return this.h.duration};
_.r.Fd=function(a,b){this.a.debug("Appending data to "+a+Wr);try{this.c[a].appendBuffer(b)}catch(c){throw this.a.warn("Failed to append data for "+a,c),c;}this.a.debug("Done Appending data to "+a+Wr)};_.r.Nf=function(a,b,c){if(c<=b)this.lc(a);else{this.a.debug("Removing data from "+a+" range:",b,c);try{this.c[a].remove(b,c)}catch(d){throw this.a.warn("Failed to remove data from "+a+" buffer. Range:",b,c,d),d;}this.a.debug("Done Removing data from "+a+" range:",b,c)}};
_.r.Wf=function(a){try{this.a.debug("Aborting operations for "+a+Wr);var b=this.c[a].appendWindowStart,c=this.c[a].appendWindowEnd;this.c[a].abort();this.c[a].appendWindowStart=b;this.c[a].appendWindowEnd=c}catch(d){throw this.a.warn("Failed to abort operations for "+a+Wr,d),d;}this.a.debug("Done Aborting operations for "+a+Wr);this.lc(a)};
_.r.df=function(a){try{this.g.readyState>HTMLMediaElement.HAVE_NOTHING?(this.a.debug("Flushing buffer for "+a),this.g.currentTime-=.001):this.a.warn("Skip buffer flush for "+a+" with element state: "+this.g.readyState)}catch(b){throw this.a.warn("Failed to flush buffer for "+a,b),b;}this.a.debug("Done Flushing buffer for "+a);this.lc(a)};
_.r.Qf=function(a,b){0>b&&(b+=.001);try{this.a.debug("Setting timestamp offset for "+a,b),this.c[a].timestampOffset=b}catch(c){throw this.a.warn("Failed to set timestamp offset for "+a,b,c),c;}this.a.debug("Done Setting timestamp offset for "+a,b);this.lc(a)};
_.r.xj=function(a,b,c){try{this.a.debug("Setting append window for "+a,b,c),this.c[a].appendWindowStart=0,this.c[a].appendWindowEnd=c,this.c[a].appendWindowStart=b}catch(d){throw this.a.warn("Failed to set append window for "+a,b,c,d),d;}this.a.debug("Done Setting append window for "+a,b,c);this.lc(a)};_.r.dh=function(a){this.f[a][0].p.reject(new _.J(_.K,3,3014,{mediaError:this.g.error?this.g.error.code:0}))};
_.r.lc=function(a){var b=this.f[a][0];b&&(b.p.resolve(),this.a.debug("Update-End received for "+a),Ut(this,a))};_.r.getTextDisplayer=function(){return this.l};var Ht=window.URL.createObjectURL;_.w(mu,_.S);_.r=mu.prototype;_.r.mb=function(a){this.a=a};_.r.release=function(){this.g=[];this.b.clear();this.c.clear()};_.r.load=function(){};_.r.destroy=function(){this.release();this.a=null};_.r.getVideoTracks=function(){return nu(this,_.zi)};_.r.getAudioTracks=function(){return nu(this,_.Q)};_.r.Y=function(){return nu(this,_.P)};_.r.Z=function(){return this.b.get(_.zi)||null};_.r.sa=function(){return this.b.get(_.Q)||null};_.r.ja=function(){return this.b.get(_.P)||null};
_.r.za=function(){return this.c.get(_.zi)||null};_.r.Ha=function(){return this.c.get(_.Q)||null};_.r.Ia=function(){return this.c.get(_.P)||null};_.r.ka=function(){return ou(this,_.zi)};_.r.fa=function(){return ou(this,_.Q)};_.r.ca=function(){return ou(this,_.P)};_.r.Fa=function(a){qu(this,_.zi,a)};_.r.na=function(a){qu(this,_.Q,a)};_.r.oa=function(a){qu(this,_.P,a)};_.r.Ea=function(a,b){pu(this,_.zi,a,void 0===b?!1:b)};_.r.La=function(a,b){pu(this,_.Q,a,void 0===b?!1:b)};
_.r.Ma=function(a,b){pu(this,_.P,a,void 0===b?!1:b)};_.r.addTextTrack=function(a){var b=this;return _.A(function(c){return b.a?_.x(c,b.a.addTextTrack(a.url,a.language,a.kind,a.mimeType,a.codec,a.label),0):c.C(0)})};_.r.la=function(){return!!this.a&&this.a.la()};mu.prototype.isAbrEnabled=mu.prototype.la;mu.prototype.addTextTrack=mu.prototype.addTextTrack;mu.prototype.setTextRendition=mu.prototype.Ma;mu.prototype.setAudioRendition=mu.prototype.La;mu.prototype.setVideoRendition=mu.prototype.Ea;
mu.prototype.setTextTrack=mu.prototype.oa;mu.prototype.setAudioTrack=mu.prototype.na;mu.prototype.setVideoTrack=mu.prototype.Fa;mu.prototype.getTextTrack=mu.prototype.ca;mu.prototype.getAudioTrack=mu.prototype.fa;mu.prototype.getVideoTrack=mu.prototype.ka;mu.prototype.getLoadingTextRendition=mu.prototype.Ia;mu.prototype.getLoadingAudioRendition=mu.prototype.Ha;mu.prototype.getLoadingVideoRendition=mu.prototype.za;mu.prototype.getTextRendition=mu.prototype.ja;mu.prototype.getAudioRendition=mu.prototype.sa;
mu.prototype.getVideoRendition=mu.prototype.Z;mu.prototype.getTextTracks=mu.prototype.Y;mu.prototype.getAudioTracks=mu.prototype.getAudioTracks;mu.prototype.getVideoTracks=mu.prototype.getVideoTracks;_.r=_.Eu.prototype;_.r.stop=function(){this.i=null;this.g=!1;this.h=[];this.f=null};_.r.init=function(a){this.i=a};
_.r.chooseVariant=function(){var a=Fu(this.a.restrictions,this.h),b=Du(this.c,this.a.defaultBandwidthEstimate);this.h.length&&!a.length&&(this.b.warn("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),a=Fu(null,this.h),a=[a[0]]);for(var c=a[0]||null,d=0;d<a.length;++d){var e=a[d],f=e.bandwidth/this.a.bandwidthDowngradeTarget,g=(a[d+1]||{bandwidth:Infinity}).bandwidth/this.a.bandwidthUpgradeTarget;this.b.debug("Bandwidth ranges:",(e.bandwidth/1E6).toFixed(3),(f/1E6).toFixed(3),
(g/1E6).toFixed(3));b>=f&&b<=g&&(c=e)}this.f=Date.now();return c};_.r.enable=function(){this.g=!0};_.r.disable=function(){this.g=!1};
_.r.segmentDownloaded=function(a,b){this.b.debug("Segment downloaded:","deltaTimeMs\x3d"+a,"numBytes\x3d"+b,"lastTimeChosenMs\x3d"+this.f,"enabled\x3d"+this.g);var c=this.c;if(!(16E3>b)){var d=8E3*b/a,e=a/1E3;c.a+=b;_.jn(c.b,e,d);_.jn(c.c,e,d)}if(null!=this.f&&this.g)a:{this.b.debug("Suggesting Streams...");if(!this.j){if(!(128E3<=this.c.a)){this.b.debug("Still waiting for a good estimate...");break a}this.j=!0;if(this.a.useSwitchIntervalForInitialSwitch&&Date.now()-this.f<1E3*this.a.switchInterval){this.b.debug("Skipping initial estimation switch due to switch interval...");
break a}}else if(Date.now()-this.f<1E3*this.a.switchInterval){this.b.debug("Still within switch interval...");break a}c=this.chooseVariant();this.b.debug("Calling switch_(), bandwidth\x3d"+Math.round(Du(this.c,this.a.defaultBandwidthEstimate)/1E3)+" kbps");this.i(c)}};_.r.getBandwidthEstimate=function(){return Du(this.c,this.a.defaultBandwidthEstimate)};_.r.setVariants=function(a){this.h=a};_.r.configure=function(a){this.a=a};
_.r.reset=function(){this.j=!1;this.c=new Cu;var a=this.chooseVariant();a&&this.i(a)};Gu.prototype.clear=function(){this.a.clear()};Ju.prototype.add=function(a){if(Mu(this.b,a))return this.a.add(a),!0;_.G("Rejecting variant - not compatible with root.");return!1};Ju.prototype.values=function(){return this.a.values()};Ou.prototype.create=function(a){var b=this,c=a.filter(function(d){return Mu(b.a,d)});return c.length?new Ju(c[0],c):this.b.create(a)};
Nu.prototype.create=function(a){var b=[];b=Pu(a,this.c);var c=a.filter(function(d){return d.primary});b=b.length?b:c.length?c:a;this.b&&(a=Qu(b,this.b),a.length?b=a:_.G("No exact match for variant role could be found."));this.a&&(a=du(b,this.a),a.length?b=a:_.G("No exact match for the channel count could be found."));a=new Ju(b[0]);b=_.u(b);for(c=b.next();!c.done;c=b.next())c=c.value,Mu(a.b,c)&&a.add(c);return a};Tu.prototype.getState=function(){return this.a};var Su=0,Ru=1;Uu.prototype.release=function(){this.a=this.c=null;this.b=function(){}};Uu.prototype.h=function(a){var b=this.a,c=this.c.periods;a=Ds(c,a)||c[0];b!=a&&this.b(a);this.a=a};Wu.prototype.release=function(){this.b&&(this.b.stop(),this.b=null);this.a=null};Wu.prototype.set=function(a){this.c=a;Xu(this)};Zu.prototype.release=function(){this.c=null;this.a=function(){}};cv.prototype.release=function(){this.c&&(this.c.release(),this.c=null);null!=this.h&&(this.h.stop(),this.h=null);this.b&&(this.b.release(),this.b=null);this.a=this.o=this.m=null;this.g=!1};cv.prototype.kd=function(){this.i=!0;bv(this)};gv.prototype.release=function(){this.b&&(this.b.release(),this.b=null);null!=this.c&&(this.c.release(),this.c=null);this.h=function(){};this.a=null;this.f=function(){};this.g=!1};dv.prototype.release=function(){this.a&&(this.a.stop(),this.a=null);this.b=null};ov.prototype.release=function(){this.f&&(this.f.release(),this.f=null);this.g&&(this.g.release(),this.g=null);this.i&&(this.i.stop(),this.i=null);this.c=this.f=this.a=this.h=null;this.l=function(){}};_.sv.prototype.destroy=function(){for(var a=_.u(this.f.values()),b=a.next();!b.done;b=a.next())Kv(b.value);this.f.clear();this.j.clear();this.h=this.i=this.w=this.c=this.b=null;this.g=!0;return Promise.resolve()};
_.sv.prototype.start=function(){var a=this,b,c,d;return _.A(function(e){if(1==e.a){b=a.b.Ya();c=zv(a,b);d=a.b.ee(a.c.periods[c]);if(!d.variant&&!d.text)throw a.a.error("init: no Streams chosen"),new _.J(_.K,5,5005);a.u=!d.variant&&!!d.text;return _.x(e,Pv(a,d.variant?d.variant.audio:null,d.variant?d.variant.video:null,d.text,b),2)}if(a.g)return e["return"]();a.a.debug("init: completed initial Stream setup");a.b&&a.b.Oi&&(a.a.debug("init: calling onInitialStreamsSetup()..."),a.b.Oi());_.y(e)})};
_.sv.prototype.D=function(a,b,c,d){var e=us(d.v),f=us(d.v),g=_.eh(d.v),h=_.eh(d.v),l=_.eh(d.v),m=_.eh(d.v);d=_.hh(d.v,d.v.ia()-d.v.getPosition());a=a.startTime+b.startTime+h/g;if(c.includes(e))if("urn:mpeg:dash:event:2012"==e)this.b.Cf();else this.b.onEvent(new Ys("emsg",{detail:{startTime:a,endTime:a+l/g,schemeIdUri:e,value:f,timescale:g,presentationTimeDelta:h,eventDuration:l,id:m,messageData:d}}))};
_.sv.prototype.G=function(a){var b=this,c=!1,d=0;(new _.jh).J("moov",_.kh).J("trak",_.kh).J("mdia",_.kh).J("minf",_.kh).J("stbl",_.kh).X("stsd",_.lh).J("encv",function(e){e.v.skip(78);_.kh(e)}).J("pasp",function(e){d=e.start+e.Td;var f=_.eh(e.v),g=_.eh(e.v);c=f!==g;b.a.debug("hSpacing\x3d"+f+", vSpacing\x3d"+g+", updatePASP\x3d"+c);e.hb.stop()}).parse(a.data);c&&(a=new _.Xg(new DataView(a.data)),a.seek(d),_.N(a,1),_.N(a,1))};_.w(hw,_.Nj);_.r=hw.prototype;_.r.init=function(a,b){var c=a.H();_.Nj.prototype.init.call(this,a,b);ow(this,c)};_.r.namespace=function(){return js};_.r.Ve=function(){return new mu};_.r.getState=function(){return this.V};_.r.getDrmInfo=function(){return this.g?this.g.getDrmInfo():null};
_.r.unload=function(){var a=this;su(this,!1);this.sc=!1;if(this.j){var b=this.getTrackManager();b&&b.release();return this.m==lw?Promise.resolve():qw(this).then(function(){a.log.debug(_.Na,a.j);a.j=null;a.Ld=0;a.Lc=null;a.$=null})}return Promise.resolve()};_.r.release=function(){var a=this;return _.Nj.prototype.release.call(this).then(function(){return a.unload()}).then(function(){return kw(a,_.yn)})};
_.r.getBufferInfo=function(a){if(this.u){var b=Ot(this.u),c=new _.Vi(void 0,a);switch(a){case _.zi:return b.video?b.video:c;case _.Q:return b.audio?b.audio:c;case _.P:return b.text?b.text:c}return b.total?b.total:c}return this.tc?(b=Qs(this.tc),Cs(b,a)):_.Nj.prototype.getBufferInfo.call(this,a)};_.r.getPosition=function(){return this.i?qv(this.i):_.Nj.prototype.getPosition.call(this)};_.r.getPresentationStartTime=function(){return this.a?this.a.presentationTimeline.getPresentationStartTime()||0:0};
_.r.getDuration=function(){return this.a?this.a.presentationTimeline.getDuration():Infinity};_.r.destroy=function(){var a=this;return _.A(function(b){if(1==b.a)return _.x(b,_.Nj.prototype.destroy.call(a),2);if(3!=b.a){if(a.m==lw)return b["return"]();a.log.debug("Destroying player...");a.m=lw;return _.x(b,nw(a),3)}a.h&&(a.h.release(),a.h=null);a.c=null;_.y(b)})};
_.r.load=function(a){var b=this,c,d,e,f;return _.A(function(g){switch(g.a){case 1:if(b.m==lw)return g["return"](Promise.reject(new _.J(_.K,7,7E3)));b.w=new _.Uk;b.Jd=Date.now()/1E3;kw(b,_.Jn);b.j=_.yl(a);_.Mj(a)&&(b.configuration=_.Lj(b.Pc,a));b.log.info(_.ya,b.configuration);b.log.info(_.Ia,b.j);(c=b.getTrackManager())&&c.load();d=b.getSurface().H();d.loop=!!b.configuration.loop;_.C.I(b.configuration.volume)||b.setVolume(b.configuration.volume);_.C.I(b.configuration.muted)||b.setMuted(b.configuration.muted);
b.o&&b.o.configure(b.configuration.manifest);b.g&&(b.g.f=_.bl(b.configuration.drm));if(b.b){b.b.h=b.configuration.streaming;try{b.a.periods.forEach(b.Md.bind(b))}catch(n){b.onError(n)}var h=wv(b.b),l=xv(b.b),m=Kw(b);h=gu(h,l,m.variants);b.c&&h&&h.allowedByApplication&&h.allowedByKeySystem?Lw(b,m.variants):(b.log.debug("Choosing new streams after changing configuration"),Uw(b,m))}b.c&&(b.c.configure(b.configuration.abr),b.configuration.abr.enabled&&!b.D?b.c.enable():b.c.disable());e=b.j[b.getSourceIndex()];
_.Ce(g,2);return _.x(g,ow(b,d),4);case 4:return _.x(g,pw(b,d),5);case 5:return _.x(g,sw(b,e),6);case 6:return _.x(g,ww(b,e),7);case 7:return _.x(g,yw(b),8);case 8:return _.x(g,Mw(b),9);case 9:_.De(g,0);break;case 2:throw f=_.Ee(g),b.onError(f),f;}})};_.r.isLive=function(){return this.a?this.a.presentationTimeline.isLive():!1};_.r.Hf=function(){this.log.debug("User seeking finished");zw(this);Aw(this)};
_.r.getSeekRange=function(){if(this.a){var a=this.a.presentationTimeline;return{start:ys(a,0),end:xs(a)}}return{start:0,end:0}};_.r.getPlaybackRate=function(){if(this.rc){var a=this.rc;a=a.f?0:a.c}else a=0;return a};
_.r.Y=function(){if(this.a&&this.i){var a=Kw(this);if(null==a)a=null;else{if(!Iu(this.G,a).text){var b=_.fu(a.textStreams,this.qa,this.pc);b.length&&(b=b[0],Iu(this.G,a).text=b)}a=Iu(this.G,a).text}b=[];for(var c=_.u(ax(this)),d=c.next();!d.done;d=c.next()){d=d.value;var e=bu(d);e.active=d==a;b.push(e)}return b}return[]};_.r.getThumbnailStreams=function(){if(this.a&&this.i){var a=Kw(this);return a?a.thumbStreams:[]}return[]};
_.r.getStats=function(){if(this.m!=gw)return _.Vk();Aw(this);var a=this.f;if(a.getVideoPlaybackQuality){a=a.getVideoPlaybackQuality();var b=this.w,c=Number(a.totalVideoFrames);b.g=Number(a.droppedVideoFrames);b.f=c}if(this.m==gw){if(a=Ow(this))this.w.l=a.bandwidth;a&&a.video&&(b=this.w,c=a.video.height||NaN,b.c=a.video.width||NaN,b.b=c);a=this.c.getBandwidthEstimate();this.w.h=a}return this.w.getStats()};_.r.getTimelineCues=function(){return this.va?Array.from(this.va.a):[]};
_.r.resetAbr=function(){this.c&&this.c.reset()};
_.r.addTextTrack=function(a,b,c,d,e,f){var g=this,h,l,m,n,p,q,t,v,z;return _.A(function(F){if(1==F.a){if(g.m!=gw)throw g.log.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");h=Kw(g);l=_.al;m=g.a.periods.indexOf(h);n=m+1;p=n>=g.a.periods.length?g.a.presentationTimeline.getDuration():g.a.periods[n].startTime;q=p-h.startTime;if(Infinity==q)throw new _.J(1,4,4040);t=new _.Nn(1,0,q,function(){return[a]},0,null);v={id:g.rf++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),
findSegmentPosition:function(){return 1},getSegmentReference:function(E){return 1==E?t:null},adjustSegmentDurations:function(){},getDuration:function(){return q},initSegmentReference:null,presentationTimeOffset:0,mimeType:d,codecs:e||"",kind:c,encrypted:!1,keyId:null,language:b,label:f||null,type:l.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null};g.Rc.add(v);h.textStreams.push(v);return _.x(F,Cv(g.b,v),2)}if(z=_.vv(g.b,_.k))Iu(g.G,h).text=
z;g.Rc["delete"](v);g.log.debug("Choosing new streams after adding a text stream");Uw(g,h);Jw(g);return F["return"](bu(v))})};
_.r.Md=function(a){var b=this.b?wv(this.b):null,c=this.b?xv(this.b):null;$t(this.g,b,c,a);b=a.variants;if(!b.some(cu))throw new _.J(_.K,4,4011);Vw(this,a.variants);Xt(b,this.configuration.restrictions,this.qf)&&this.b&&Kw(this)==a&&Jw(this);if(a=this.g?this.g.getDrmInfo():null)for(b=_.u(b),c=b.next();!c.done;c=b.next()){c=_.u(c.value.drmInfos);for(var d=c.next();!d.done;d=c.next())if(d=d.value,d.keySystem==a.keySystem){d=_.u(d.initData||[]);for(var e=d.next();!e.done;e=d.next())e=e.value,_.yk(this.g,
e.initDataType,e.initData)}}};_.r.ah=function(a){this.log.debug(_.ls,a);try{this.log.debug("onChooseStreams_, choosing variant from ",a.variants);this.log.debug("onChooseStreams_, choosing text from ",a.textStreams);var b=Yw(this,a);this.log.debug("onChooseStreams_, chose variant ",b.variant);this.log.debug("onChooseStreams_, chose text ",b.text);return b}catch(c){return this.onError(c),{variant:null,text:null}}};
_.r.$g=function(){this.log.debug("canSwitch_");this.D=!1;this.configuration.abr.enabled&&this.c.enable();this.S&&(Ev(this.b,this.S,this.pf,this.kf),this.S=null);this.L&&(_.Dv(this.b,this.L,!0,0),this.L=null)};_.r.bh=function(){this.o&&this.o.update&&this.o.update()};_.r.Zi=function(){this.i&&this.i.g.kd()};
_.r.lg=function(a){var b=Kw(this),c=b.variants.some(function(g){return(g=g[a.type])&&g.id!==a.id})&&this.la();if(c){for(var d=_.u(b.variants),e=d.next();!e.done;e=d.next()){e=e.value;var f=e[a.type];f&&f.id===a.id&&(e.allowedByApplication=!1)}Jw(this);Uw(this,b)}return c};_.r.Mi=function(){this.log.debug("endOfStream called by streaming engine");this.sc=!0};_.r.onError=function(a){if(this.m!==lw){var b=new _.O(_.Ac,{detail:a});a.a===_.K&&kw(this,_.dl);this.trigger(b);b.defaultPrevented&&(b.b=!0)}};
_.r.Ed=function(a){a.type===_.uc?this.dispatchEvent(new _.O(_.uc,{keySystem:this.g.keySystem(),Lh:_.Dk(this.g)})):"largegap"!==a.type&&(a.type===_.de?rw(this):"emsg"!==a.type&&(a instanceof _.O?this.dispatchEvent(a):this.log.debug("Unhandled/ignored event",a.type)))};_.r.la=function(){return this.configuration.abr.enabled};var lw=0,fw=1,gw=2,$w=[ms,_.Ic];
bx.prototype.canPlay=function(a){if(_.Dh("CrKey"))return!1;var b=a.type||"",c=typeof a.gc!==_.Ub||a.gc;if(b===_.ul&&c&&_.Fh())return!1;c=_.Ah();a=_.Do.O(a.url,b);return c&&a?!0:!1};bx.prototype.create=function(){return new hw};bx.prototype.create=bx.prototype.create;bx.prototype.canPlay=bx.prototype.canPlay;_.ei(new bx);};f.call(g, window);