(function(){var g={}; var _ = _ || {};
var f=function(window){/*

 Copyright 2016 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var Tq,Uq,Vq,Wq,Xq,Zq,$q,br,cr,dr,er,fr,gr,ir,jr,kr,lr,mr,nr,or,pr,qr,rr,sr,tr,ur,vr,wr,xr,yr,Ar,Br,Dr,Cr,Er,Fr,Gr,Hr,Ir,Jr,Kr,Lr,Mr,Or,Nr,Pr,Qr,Rr,Tr,Vr,Wr,Ur,Xr,$r,as,bs,ds,cs,fs,hs,gs,es,is,ks,js,ls,ms,ps,os,qs,rs,ss,ts,us,ws,xs,ns,ys,zs,As,Bs,Cs,Ds,Es,Fs,Gs,Hs,Js,Ks,Ls,Ms,Os,Ps,Ns,Ys,Xs,Vs,Zs,$s,bt,at,ct,ft,dt,et,ht,gt,it,jt,mt,nt,ot,pt,qt,st,tt,ut,rt,wt,vt,At,Bt,Dt,zt,yt,Et,xt,Ct,It,Kt,Ht,Lt,Gt,Jt,Ft,Nt,Pt,Qt,Vt,Xt,bu,fu,Zt,hu,Tt,iu,Rt,gu,mu,ju,nu,$t,eu,qu,pu,ou,vu,su,ru,wu,uu,lu,St,Yt,tu,du,
Ut,cu,ku,au,xu,yu,zu,Au,Du,Eu,Fu,Lu,Ju,Hu,Iu,Ku,Nu,Ru,Tu,jv,Qu,dv,$u,av,bv,Uu,cv,Ts,Rs,Us,Ss,Ws,Qs,ov,mv,Wu,Pu,pv,nv,ev,Mu,Vu,iv,qv,uv,tv,Zu,gv,fv,sv,Ou,Su,rv,lv,wv,hv,kv,xv,yv,zv,Av,Bv,Cv,Ev,Gv,Iv,Fv,Jv,Hv,Kv,Mv,Nv,Ov,Lv,Qv,Pv,Sv,Tv,Rv,Wv,Uv,Xv,Yv,Vv;Tq=" buffer";Uq=" is being or has been set up";Vq="Cannot find matching variant";Wq="Jumping forward";Xq="MediaSource threw QuotaExceededError:";_.Yq="No stream with id";Zq="Not a persistent session.";$q="PatchedMediaKeysWebkit.MediaKeys.findSession_";
_.ar="Player is in ERROR state and can not switch to ";br="Shaka Player TextTrack";cr="bufferBehind\x3d";dr="bufferedBehind\x3d";er="calling onCanSwitch()...";fr="clpp.mse.Player";gr="currentPeriod.startTime\x3d";_.hr="onChooseStreams_";ir="output-restricted";jr="presentationTime\x3d";kr="reference.endTime\x3d";lr="reference.startTime\x3d";mr="switch: Stream ";nr="webkit-org.w3.clearkey";or=function(a){for(var b=a.a;_.Uh(a)&&0!==a.b.getUint8(a.a);)a.a+=1;b=a.b.buffer.slice(b,a.a);a.a+=1;return _.mf(b)};
pr=function(a,b){return _.mg("Edge/")||_.mg("Edg/")?!0:a.w.has(b)};qr=function(a,b){var c=b.audio,d=b.video;if(c&&c.encrypted&&!pr(a,_.pi(c.mimeType,c.codecs))||d&&d.encrypted&&!pr(a,_.pi(d.mimeType,d.codecs)))return!1;var e=a.keySystem();return 0==b.drmInfos.length||b.drmInfos.some(function(f){return f.keySystem==e})};
rr=function(a,b,c,d){return Promise.resolve().then(function(){if(a.i&&a.c)if(null==c||null==d)a.i.parseInit(_.N(b));else{var e={periodStart:a.l,segmentStart:c,segmentEnd:d};e=a.i.parseMedia(_.N(b),e).filter(function(f){return f.startTime>=a.f&&f.startTime<a.g});a.c.append(e);null==a.a&&(a.a=Math.max(c,a.f));a.b=Math.min(d,a.g)}})};
sr=function(a,b,c,d,e){var f=c+" "+d,g=new Map;b=_.v(b);for(var h=b.next();!h.done;h=b.next()){var l=h.value;h=l.stream;g.has(h)||g.set(h,new Map);g.get(h).has(f)||g.get(h).set(f,[]);l.startTime+=e;l.endTime+=e;l.startTime>=a.f&&l.startTime<a.g&&(l=new _.Hl(l.startTime,l.endTime,l.text),g.get(h).get(f).push(l),h==a.j&&a.c.append([l]))}e=_.v(g.keys());for(f=e.next();!f.done;f=e.next())for(f=f.value,a.h.has(f)||a.h.set(f,new Map),b=_.v(g.get(f).keys()),h=b.next();!h.done;h=b.next())h=h.value,l=g.get(f).get(h),
a.h.get(f).set(h,l);a.a=null==a.a?Math.max(c,a.f):Math.min(a.a,Math.max(c,a.f));a.b=Math.max(a.b,Math.min(d,a.g))};tr=function(a){var b=a.isLive()||Infinity!=a.c&&!a.b?a.Xd:0;return Math.max(0,_.rn(a)-b)};ur=function(a,b){var c=Math.max(a.g,0);if(Infinity==a.Fb)return c;var d=_.rn(a)-a.Fb;d=Math.min(d+b,tr(a));return Math.max(c,d)};vr=function(a,b){for(var c in b)if(b.hasOwnProperty(c)&&b[c]===a)return c;return""};
wr=function(a,b){var c=new _.Le(void 0,void 0===b?"total":b);a.forEach(function(d){c.a.push(d)});c.length=a.length;return c};xr=function(a){var b=[a.mimeType];_.Jn.forEach(function(c,d){var e=a[d];e&&b.push(c+'\x3d"'+e+'"')});return b.join(";")};yr=function(a,b){return a.start-b.start};_.zr=function(a){this.h=a;this.log=new _.E("clpp.renditions");this.b=[];this.g=this.a=null;this.f=!1};
Ar=function(a){var b=[];a.b.forEach(function(c){b.push({start:c.start,end:c.end,width:c.width,height:c.height,bandwidth:c.bandwidth,rendition:c.rendition})});return b};Br=function(a){a.a&&a.a.trigger(new _.I(_.Kb))};
Dr=function(a,b,c,d){var e=a.h?a.h(d):null;e||a.log.debug("Unable to resolve rendition for id",d);d={start:b,end:c,rendition:e,width:e?e.width:0,height:e?e.height:0,bandwidth:e?e.bandwidth:0};var f=a.b.find(function(g){return g.start===b&&g.end===c});f?f.rendition=e:(a.b.forEach(function(g){b>=g.start&&b<g.end?g.end=b:c>=g.start&&c<g.end&&(g.start=c)}),a.b.push(d),a.b.sort(yr));Cr(a);a.c();a.a&&a.a.trigger(new _.I(_.$d))};
Cr=function(a){if(a.a){for(var b=!1,c={},d=0;d<a.b.length;d++){var e=a.b[d],f=e.width+"x"+e.height,g=c[f];if(g&&g!==e.bandwidth){b=!0;break}c[f]=e.bandwidth}b&&!a.f?(a.log.debug("Tracking timeupdates"),a.a.on(_.Md,a.c,a),a.f=!0):!b&&a.f&&(a.log.debug("Stop tracking timeupdates"),a.a.off(_.Md,a.c),a.f=!1)}};Er=function(a,b,c){a.b=a.b.filter(function(d){if(d.end<=b||d.start>=c)return!1;d.start=Math.max(d.start,b);d.end=Math.min(d.end,c);return!0});a.a&&a.a.trigger(new _.I(_.$d))};
Fr=function(a,b){if(a===b)return!0;if(!a||!b||a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0};Gr=function(a,b){var c=0;a.forEach(function(d){c+=b(d)?1:0});return c};Hr=function(a,b){a=_.vl(a);b=_.vl(b);var c=a.split("-"),d=b.split("-");return c[0]==d[0]&&1==c.length&&2==d.length};Ir=function(a,b){a=_.vl(a);b=_.vl(b);return a.split("-")[0]==b.split("-")[0]};
Jr=function(a){return a.language?_.vl(a.language):a.audio&&a.audio.language?_.vl(a.audio.language):a.video&&a.video.language?_.vl(a.video.language):_.Od};
Kr=function(a,b){for(var c=_.vl(a),d=new Set,e=_.v(b),f=e.next();!f.done;f=e.next())d.add(_.vl(f.value));e=_.v(d);for(f=e.next();!f.done;f=e.next())if(f=f.value,f==c)return f;e=_.v(d);for(f=e.next();!f.done;f=e.next())if(f=f.value,Hr(f,c))return f;e=_.v(d);for(f=e.next();!f.done;f=e.next()){var g=f=f.value,h=c;g=_.vl(g);h=_.vl(h);g=g.split("-");h=h.split("-");if(2==g.length&&2==h.length&&g[0]==h[0])return f}d=_.v(d);for(f=d.next();!f.done;f=d.next())if(e=f.value,Hr(c,e))return e;return null};
Lr=function(){this.b=function(){};this.a=new Set};Mr=function(a,b){a.b=b};Or=function(a){var b=this;this.b=a;this.a=new Set;this.c=(new _.sg(function(){Nr(b,!1)})).za(.25)};Nr=function(a,b){for(var c=_.v(a.a),d=c.next();!d.done;d=c.next())d.value.h(a.b.currentTime,b)};
Pr=function(a){var b=this;this.g=a;this.f=new Map;this.a=function(){};this.b=function(){};this.c=function(){};this.i=[{Lb:null,Kb:2,vb:function(c,d){return b.a(c,d)}},{Lb:1,Kb:2,vb:function(c,d){return b.a(c,d)}},{Lb:3,Kb:2,vb:function(c,d){return b.a(c,d)}},{Lb:2,Kb:1,vb:function(c,d){return b.b(c,d)}},{Lb:2,Kb:3,vb:function(c,d){return b.b(c,d)}},{Lb:1,Kb:3,vb:function(c,d){return b.c(c,d)}},{Lb:3,Kb:1,vb:function(c,d){return b.c(c,d)}}]};Qr=function(a,b,c,d){a.a=b;a.b=c;a.c=d};
Rr=function(){this.a=new muxjs.mp4.CaptionParser;this.g=[];this.f={}};_.Sr=function(){};Tr=function(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0,remux:!1});this.b=null;this.h=[];this.g=[];this.c=[];this.f=!1;this.a.on("data",this.j.bind(this));this.a.on("done",this.i.bind(this))};
Vr=function(a,b){return!window.muxjs||"mp2t"!=a.split(";")[0].split("/")[1]&&"aac"!=a.split(";")[0].split("/")[1]?!1:b?MediaSource.isTypeSupported(Ur(b,a))||MediaSource.isTypeSupported(a.replace("aac",_.Vc)):MediaSource.isTypeSupported(Ur(_.Ib,a))||MediaSource.isTypeSupported(a.replace("aac",_.Vc))||MediaSource.isTypeSupported(Ur(_.Xd,a))};
Wr=function(a){try{var b=a.match(/"(.*?)"/)[0].replace(/"/g,"").split(","),c=[];1<b.length&&b.forEach(function(d){d.startsWith("avc")?c.push('video/mp4;codecs\x3d"'+d+'"'):d.startsWith("mp4a")&&c.push('audio/mp4;codecs\x3d"'+d+'"')});return 0<c.length?c:[a]}catch(d){return[a]}};
Ur=function(a,b){var c=b.replace("mp2t",_.Vc);a==_.Ib&&(c=c.replace(_.Xd,_.Ib));var d=/avc1\.(66|77|100)\.(\d+)/.exec(c);if(d){var e="avc1.",f=d[1],g=Number(d[2]);e=("66"==f?e+"4200":"77"==f?e+"4d00":e+"6400")+(g>>4).toString(16);e+=(g&15).toString(16);c=c.replace(d[0],e)}return c};Xr=function(a,b){a.f=!0;a.b=new _.Of;a.h=[];a.g=[];a.c=[];var c=_.N(b);a.a.push(c);a.a.flush();a.f&&a.b.reject(new _.K(_.M,3,3018));return a.b};
_.Zr=function(a,b,c,d,e){this.g=a;this.h=c;this.c={};this.A=!1;this.b=null;this.f={};this.j=new _.Xe;this.w=!1;this.l={};this.u=b;this.m=d;this.C=void 0===e?1:e;this.v=new _.Of;this.o={};a=this.v;b=new MediaSource;this.j.one(b,"sourceopen",a.resolve);this.g.src=Yr(b);this.i=b;this.a=new _.E("clpp.mse.MediaSourceEngine")};$r=function(a){var b=_.pi(a.mimeType,a.codecs),c=xr(a);return _.Ml(b)||MediaSource.isTypeSupported(c)||Vr(b,a.type)};
as=function(a,b){var c=!1,d=!1;b.forEach(function(e){var f=e.split(";")[0].split("/")[0];f=f===_.Ib?_.Ib:f===_.k?_.k:_.Xd;f===_.Ib?c=!0:f===_.Xd&&(d=!0);e=a.i.addSourceBuffer(e);a.j.on(e,_.zc,a.Lg.bind(a,f));a.j.on(e,"updateend",a.$b.bind(a,f));a.c[f]=e;a.f[f]=[];a.o[f]=!1});a.A=c&&d};bs=function(a,b){a.b||(a.b=new _.Kl(a.h));b!=_.Ab&&(a.b.i=new _.Ll[b])};
ds=function(a){var b={};b.total=new _.Le(a.g.buffered,"total");b.audio=cs(a,_.Ib);b.video=cs(a,_.Xd);var c=[];a.b&&(c=[{start:a.b.Ja(),end:a.b.aa()}]);b.text=wr(c,_.k);return b};cs=function(a,b){try{return new _.Le(a.c[b].buffered,b)}catch(c){return b in a.c&&a.a.error("failed to get buffered range for "+b,c),null}};
fs=function(a,b,c,d,e,f,g,h){h=void 0===h?!1:h;var l=a.c[b],m=-1,n=0;l&&l.buffered&&(n=l.buffered.length);b===_.Xd&&null!==d&&null!==e&&h&&(m=0<n?l.buffered.end(n-1):-1);b==_.k?c=rr(a.b,c,d,e):a.l[b]?c=Xr(a.l[b],c).then(function(p){a.b||bs(a,_.Fd);p.captions&&sr(a.b,p.captions,d,e,a.c.video.timestampOffset);var q=[];0<p.audio.byteLength&&a.c.audio&&q.push(es(a,_.Ib,a.ud.bind(a,_.Ib,p.audio.buffer)));0<p.video.byteLength&&a.c.video&&q.push(es(a,_.Xd,a.ud.bind(a,_.Xd,p.video.buffer)));return Promise.all(q)}):
(f&&window.muxjs&&(a.b||bs(a,_.Fd),null==d&&null==e?a.u.init(c):a.u.c(c,function(p){p.length&&sr(a.b,p,d,e,a.c.video.timestampOffset)})),c=es(a,b,a.ud.bind(a,b,c)));return c.then(function(){if(b===_.Xd&&null!==d&&null!==e&&!h)Dr(a.m,d,e,g);else if(b===_.Ib&&null!==d&&null!==e)Br(a.m);else if(b===_.Xd&&null!==d&&null!==e&&h){var p=l.buffered.length,q=0<p?l.buffered.end(p-1):-1;0>m&&0<p&&(m=l.buffered.start(0));0<=m&&0<q&&Dr(a.m,m,q,g)}if(!a.o[b]&&l&&1===l.buffered.length){p=l.buffered.start(0);var t=
d-p;if(Math.abs(t)>a.C&&0===l.timestampOffset)return a.a.warn("Detected a delta of "+t+" between media times and segment times for "+(b+". The segment start time is ")+(d+" and the media start time is ")+(p+". Adjusting timestampOffset.")),p=es(a,b,function(){a.yf(b,t)}),q=es(a,b,a.Te.bind(a,b,!1)),Promise.all([p,q])}null!==d&&null!==e&&(a.o[b]=!0)})["catch"](function(p){throw p;})};
hs=function(a,b,c,d,e){if(b==_.k)return a.b.l=c,a=a.b,a.f=d,a.g=e,Promise.resolve();b=gs(a,b,c,d,e);a.A&&(b=b.concat(gs(a,_.Ib,c,d,e)));return Promise.all(b)};gs=function(a,b,c,d,e){return[es(a,b,a.Ef.bind(a,b)),es(a,b,a.yf.bind(a,b,c)),es(a,b,a.Pi.bind(a,b,d,e))]};es=function(a,b,c){if(a.w)return Promise.reject();c={start:c,p:new _.Of};a.f[b].push(c);1===a.f[b].length&&is(a,b);return c.p};
is=function(a,b){var c=a.f[b][0];if(c)try{a.a.debug("Starting next operation for "+b),c.start()}catch(d){"QuotaExceededError"==d.name?c.p.reject(new _.K(_.M,3,3017,{type:b})):c.p.reject(new _.K(_.M,3,3015,{mediaError:d})),js(a,b)}else a.a.debug("No more scheduled operations for "+b)};
ks=function(a,b){if(a.w)return Promise.reject();var c=[],d;for(d in a.c){var e=new _.Of,f={start:function(g){g.resolve()}.bind(null,e),p:e};a.f[d].push(f);c.push(e);1==a.f[d].length&&f.start()}return Promise.all(c).then(function(){try{b()}catch(l){var g=Promise.reject(new _.K(_.M,3,3015,{mediaError:l}))}for(var h in a.c)js(a,h);return g},function(){return Promise.reject()})};js=function(a,b){a.f[b].shift();is(a,b)};
ls=function(a,b,c){function d(f,g,h){return f>=g&&f<=h}var e=a.video;return e&&e.width&&e.height&&!(d(e.width,b.minWidth,Math.min(b.maxWidth,c.width))&&d(e.height,b.minHeight,Math.min(b.maxHeight,c.height))&&d(e.width*e.height,b.minPixels,b.maxPixels))||!d(a.bandwidth,b.minBandwidth,b.maxBandwidth)?!1:!0};ms=function(a,b,c){var d=!1;a.forEach(function(e){var f=e.allowedByApplication;e.allowedByApplication=ls(e,b,c);f!=e.allowedByApplication&&(d=!0)});return d};
ps=function(a,b,c,d){d.variants=d.variants.filter(function(e){if(a&&a.M&&!qr(a,e))return _.F("Dropping variant - not compatible with key system",e),!1;var f=e.audio;e=e.video;return f&&!$r(f)?(_.F("Dropping variant - audio not compatible with platform",ns(f)),!1):e&&!$r(e)?(_.F("Dropping variant - video not compatible with platform",ns(e)),!1):f&&b&&!os(f,b)?(_.F("Droping variant - not compatible with active audio","active audio",ns(b),"variant.audio",ns(f)),!1):e&&c&&!os(e,c)?(_.F("Droping variant - not compatible with active video",
"active video",ns(c),"variant.video",ns(e)),!1):!0});d.textStreams=d.textStreams.filter(function(e){var f=_.Ml(_.pi(e.mimeType,e.codecs));f||_.F("Dropping text stream. Is not supported by the platform.",e);return f})};os=function(a,b){return a.mimeType!=b.mimeType||a.codecs.split(".")[0]!=b.codecs.split(".")[0]?!1:!0};
qs=function(a){var b=a.audio,c=a.video,d=b?b.codecs:null,e=c?c.codecs:null,f=[];e&&f.push(e);d&&f.push(d);var g=c&&c.mimeType||null,h=b&&b.mimeType||null,l=[];b&&l.push(b.kind);c&&l.push(c.kind);l=l[0]||null;var m=new Set;b&&b.roles.forEach(function(n){return m.add(n)});c&&c.roles.forEach(function(n){return m.add(n)});a={id:a.id,active:!1,type:"variant",bandwidth:a.bandwidth,language:a.language,label:null,kind:l,width:null,height:null,frameRate:null,mimeType:g,audioMimeType:h,codecs:f.join(", "),
audioCodec:d,videoCodec:e,primary:a.primary,roles:Array.from(m),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null};c&&(a.videoId=c.id,a.originalVideoId=c.originalId,a.width=c.width||null,a.height=c.height||null,a.frameRate=c.frameRate||null,a.videoBandwidth=c.bandwidth||null);b&&(a.audioId=b.id,a.originalAudioId=b.originalId,a.channelsCount=b.channelsCount,a.audioBandwidth=b.bandwidth||
null,a.label=b.label,a.audioRoles=b.roles);return a};rs=function(a){return{id:a.id,active:!1,type:_.k,bandwidth:0,language:a.language,label:a.label,kind:a.kind||null,width:null,height:null,frameRate:null,mimeType:a.mimeType,audioMimeType:null,codecs:a.codecs||null,audioCodec:null,videoCodec:null,primary:a.primary,roles:a.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:a.originalId}};
ss=function(a){return a.allowedByApplication&&a.allowedByKeySystem};ts=function(a,b){var c=a.filter(function(g){return g.audio&&g.audio.channelsCount}),d=new Map;c=_.v(c);for(var e=c.next();!e.done;e=c.next()){e=e.value;var f=e.audio.channelsCount;d.has(f)||d.set(f,[]);d.get(f).push(e)}c=Array.from(d.keys());if(0==c.length)return a;e=c.filter(function(g){return g<=b});return e.length?d.get(Math.max.apply(null,e)):d.get(Math.min.apply(null,c))};
_.vs=function(a,b,c){var d=a,e=a.filter(function(h){return h.primary});e.length&&(d=e);var f=d.length?d[0].language:"";d=d.filter(function(h){return h.language==f});if(b){var g=Kr(_.vl(b),a.map(function(h){return h.language}));g&&(d=a.filter(function(h){return _.vl(h.language)==g}))}if(c){a=us(d,c);if(a.length)return a;_.C("No exact match for the text role could be found.")}else if(a=d.filter(function(h){return 0==h.roles.length}),a.length)return a;a=d.map(function(h){return h.roles}).reduce(_.mi.wd,
[]);return a.length?us(d,a[0]):d};us=function(a,b){return a.filter(function(c){return c.roles.includes(b)})};ws=function(a,b,c){for(var d=0;d<c.length;d++)if(c[d].audio==a&&c[d].video==b)return c[d];return null};xs=function(a){var b=[];a.audio&&b.push(a.audio);a.video&&b.push(a.video);return b};
ns=function(a){return a.type==_.Ib?"type\x3daudio codecs\x3d"+a.codecs+" bandwidth\x3d"+a.bandwidth+" channelsCount\x3d"+a.channelsCount:a.type==_.Xd?"type\x3dvideo codecs\x3d"+a.codecs+" bandwidth\x3d"+a.bandwidth+" frameRate\x3d"+a.frameRate+" width\x3d"+a.width+" height\x3d"+a.height:"unexpected stream type"};
ys=function(a,b){var c=String(_.tj++);c=new _.nj(c,a);c.mimeType=_.pj(b.mimeType);if(a===_.R||a===_.S)c.label=_.pj(b.label),c.language=_.pj(b.language);a===_.qj?(c.frameRate=b.frameRate,c.roles=b.roles):a===_.S?(c.channelsCount=b.channelsCount,c.roles=b.audioRoles||[],c.mimeType=_.pj(b.audioMimeType)):(c.kind=_.pj(b.kind),c.roles=b.roles);return c};
zs=function(a,b,c){var d=new _.oj(a===_.qj?""+b.videoId:a===_.S?""+b.audioId:""+b.id,c);switch(a){case _.qj:d.codec=_.pj(b.videoCodec);d.bandwidth=b.videoBandwidth||b.bandwidth;d.width=b.width;d.height=b.height;d.originalId=b.originalVideoId;break;case _.S:d.codec=_.pj(b.audioCodec);d.bandwidth=b.audioBandwidth||b.bandwidth;d.originalId=b.originalAudioId;break;default:d.codec=_.pj(b.codecs),d.originalId=b.originalTextId}(a=c.renditions.find(function(e){return _.J.ua(e,d,null,["id","track"])}))||c.renditions.push(d);
return a||d};As=function(a,b){var c=a.reduce(function(d,e){b===_.qj?null===e.videoId||d[e.videoId]&&!e.active||(d[e.videoId]=e):b===_.S&&(null===e.audioId||d[e.audioId]&&!e.active||(d[e.audioId]=e));return d},{});return Object.values(c).sort(function(d,e){return d.id-e.id})};Bs=function(a,b){if(void 0!==b&&null!==b){var c=a.filter(function(d){return d.audio&&d.audio.id===b});if(0<c.length)return c}return a};
Cs=function(a,b){b=void 0===b?{}:b;for(var c in b)this[c]=b[c];this.defaultPrevented=this.cancelable=this.bubbles=!1;this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now();this.type=a;this.isTrusted=!1;this.target=this.currentTarget=null;this.a=!1};Ds=function(){this.h=new _.Ue;this.j=this};Es=function(a){var b=[];a=_.v(a);for(var c=a.next();!c.done;c=a.next()){c=_.v(c.value.variants);for(var d=c.next();!d.done;d=c.next())b.push(d.value)}return b};
Fs=function(a,b){for(var c=null,d=_.v(a),e=d.next();!e.done;e=d.next())e=e.value,b>=e.startTime&&(c=e);return c};Gs=function(){this.b=new _.rl(2);this.c=new _.rl(5);this.a=0};Hs=function(a,b){return 128E3>a.a?b:Math.min(_.tl(a.b),_.tl(a.c))};_.Is=function(){this.b=new _.E("clpp.abr");this.i=null;this.f=!1;this.c=new Gs;this.g=[];this.j=!1;this.a=this.h=null};
Js=function(a,b){a&&(b=b.filter(function(c){return ls(c,a,{width:Infinity,height:Infinity})}));return b.sort(function(c,d){return c.bandwidth-d.bandwidth})};Ks=function(){this.f=new _.E("clpp.mse.TrackManager");this.a=null;this.g=[];this.b=new Map;this.c=new Map};Ls=function(a,b){return a.g.filter(function(c){return c.type===b})};Ms=function(a,b){var c=a.b.get(b)||null;return c&&c.track};Os=function(a,b,c){c&&Ms(a,c.type)===c||Ns(a,b,c&&c.renditions[0])};
Ps=function(a,b){a.b.set(b.track.type,b);b===(a.c.get(b.track.type)||null)&&a.c.set(b.track.type,null)};
Ns=function(a,b,c,d){d=void 0===d?!1:d;if(a.a&&(a.b.get(b)||null)!==c){var e=a.a;if(c){if(0>a.g.indexOf(c.track))throw Error("Unknown rendition with ID "+c.id);if(b!==c.track.type)throw Error("Types mismatch");a.f.debug("Activate rendition type\n          "+b+" with ID: "+c.id);if(b===_.R){var f=e.U().find(function(n){return n.id==c.id});f&&(a.c.set(b,c),Ps(a,c),e.trigger(new _.I(_.Id)),Qs(e,!0).then(function(){Rs(e,f)})["catch"](function(n){a.f.warn("Error while activating track",n)}))}else if(b===
_.S)a.c.set(b,c),Ss(e,parseInt(c.id,10));else if(b===_.qj){var g=a.b.get(_.S)||null;if(g){var h=Ts(e).filter(function(n){return n.videoId==c.id});var l=h.find(function(n){return n.audioId==g.id});if(!l){a.f.debug("Unable to find exact variant. Searching for equivalent");var m=g.track.renditions.map(function(n){return n.id}).filter(function(n){return n!==g.id});l=h.find(function(n){return m.find(function(p){return p==n.audioId})})}}else l=Ts(e).find(function(n){return n.videoId==c.id});if(l)a.c.set(b,
c),Us(e,l,d);else{a.f.warn(Vq);return}}}else a.f.debug(_.qa+b),Ms(a,b)&&(b===_.R?Qs(e,!1).then(function(){a.b.set(b,null);e.trigger(new _.I(_.Id))})["catch"](function(n){a.f.warn("Error while de-activating text tracks",n)}):b===_.S?a.f.info("Enabling ABR for audio is not supported"):Us(e,null,d));b===_.S?e.trigger(new _.I(_.Ob)):b===_.qj&&c&&e.trigger(new _.I(_.ae,{details:{width:c.width||0,height:c.height||0,bandwidth:c.bandwidth,track:c.track,abrSelection:!1}}))}};
Ys=function(a){if(a.a){a.f.debug("Track list change detected, updating track list");var b=[];a.a.U().forEach(function(d){var e=ys(_.R,d),f=b.find(function(h){return Vs(h,e)});e=f||e;var g=zs(_.R,d,e);d.active&&a.b.set(_.R,g);f||b.push(e)});Ws(a.a)||a.b.set(_.R,null);var c=Ts(a.a);Xs(a,b,c,_.qj);Xs(a,b,c,_.S);a.g=b}};Xs=function(a,b,c,d){As(c,d).forEach(function(e){var f=ys(d,e),g=b.find(function(l){return Vs(l,f)});f=g||f;var h=zs(d,e,f);e.active&&a.b.set(d,h);g||b.push(f)})};
Vs=function(a,b){return a.type===b.type&&a.channelsCount===b.channelsCount&&a.frameRate===b.frameRate&&a.kind===b.kind&&a.label===b.label&&a.language===b.language&&a.mimeType===b.mimeType&&Fr(a.roles,b.roles)};Zs=function(a,b){if(b){a.g.length||Ys(a);var c=b.type,d=a.b.get(c)||null,e;c=_.v(Ls(a,c));for(var f=c.next();!f.done&&!(e=f.value.renditions.find(function(g){return g.id==b.id}));f=c.next());e&&d!==e&&Ps(a,e)}};$s=function(){this.a=new Map};bt=function(a,b){a.a.has(b)||a.a.set(b,new at);return a.a.get(b)};
at=function(){this.text=this.variant=null};ct=function(a,b){this.b=a;this.a=new Set([a]);b=b||[];for(var c=_.v(b),d=c.next();!d.done;d=c.next())this.add(d.value)};ft=function(a,b){var c;if(!(c=!!a.audio!=!!b.audio||!!a.video!=!!b.video||a.language!=b.language)&&(c=a.audio&&b.audio)){c=a.audio;var d=b.audio;c=!(c.channelsCount==d.channelsCount&&dt(c,d)&&et(c.roles,d.roles))}!c&&(c=a.video&&b.video)&&(c=a.video,d=b.video,c=!(dt(c,d)&&et(c.roles,d.roles)));return c?!1:!0};
dt=function(a,b){if(a.mimeType!=b.mimeType)return!1;var c=a.codecs.split(",").map(function(f){return _.qi(f)[0]}),d=b.codecs.split(",").map(function(f){return _.qi(f)[0]});if(c.length!=d.length)return!1;c.sort();d.sort();for(var e=0;e<c.length;e++)if(c[e]!=d[e])return!1;return!0};et=function(a,b){var c=new Set(a),d=new Set(b);c["delete"]("main");d["delete"]("main");if(c.size!=d.size)return!1;c=_.v(c);for(var e=c.next();!e.done;e=c.next())if(!d.has(e.value))return!1;return!0};
ht=function(a){this.a=a;this.b=new gt(a.language,"",a.audio&&a.audio.channelsCount?a.audio.channelsCount:0)};gt=function(a,b,c){this.c=a;this.b=b;this.a=c};it=function(a,b){var c=_.vl(b),d=Kr(c,a.map(function(e){return Jr(e)}));return d?a.filter(function(e){return d==Jr(e)}):[]};jt=function(a,b){return a.filter(function(c){var d=c.audio;c=c.video;return d&&0<=d.roles.indexOf(b)||c&&0<=c.roles.indexOf(b)})};mt=function(a,b){this.a=kt;this.b=(new Map).set(kt,b).set(lt,a)};
nt=function(a){this.c=a;this.a=null;this.b=function(){}};ot=function(a,b){a.b=b};pt=function(a){var b=this;this.a=a;this.f=!1;this.c=this.a.Cd();this.b=new _.sg(function(){b.a.Sh(.25*b.c)})};qt=function(a){a.b.stop();var b=a.f?0:a.c;0<=b?a.a.Cd()!=b&&a.a.xf(b):(a.b.za(.25),0!=a.a.Cd()&&a.a.xf(0))};st=function(a,b){this.c=a;this.g=rt(a);this.b=a.a.currentTime;this.f=Date.now()/1E3;this.h=b;this.a=function(){}};tt=function(a,b){a.a=b};ut=function(a){this.a=a};
rt=function(a){if(a.a.paused||0==a.a.playbackRate||null==a.a.buffered)var b=!1;else a:{b=a.a.buffered;a=a.a.currentTime;for(var c=0;c<b.length;c++){var d=b.start(c),e=b.end(c);if(!(a<d||a>e-.5)){b=!0;break a}}b=!1}return b};wt=function(a,b,c,d,e){var f=this;this.a=a;this.m=b;this.j=c;this.l=e;this.c=new _.Xe;this.i=!1;this.o=a.readyState;this.f=!1;this.b=d;this.h=!1;this.c.on(a,_.be,function(){return vt(f)});this.g=(new _.sg(function(){vt(f)})).za(.25)};
vt=function(a){if(0!=a.a.readyState){if(a.a.seeking){if(!a.i)return}else a.i=!1;if(!a.a.paused){a.a.readyState!=a.o&&(a.f=!1,a.o=a.a.readyState);var b=a.j.smallGapLimit,c=a.a.currentTime,d=a.a.buffered;a:{var e=new _.Le(d);if(e.length&&!(1===e.length&&1E-6>e.end(0)-e.start(0)))for(var f=_.mg("Edge/")||_.mg("Edg/")||_.mg("Trident/")||_.ng()||_.mg("CrKey")?.5:.1,g=0;g<e.length;g++)if(e.start(g)>c&&(0===g||e.end(g-1)-c<=f)){e=g;break a}e=null}if(null==e){if(a.b){a=a.b;d=a.c;c=rt(d);d=d.a.currentTime;
b=Date.now()/1E3;if(a.b!=d||a.g!=c)a.f=b,a.b=d,a.g=c;d=b-a.f;d>=a.h&&c&&a.a(a.b,d)}}else if(0!=e||a.h)if(f=d.start(e),g=tr(a.m),!(f>=g)){g=f-c;b=g<=b;var h=!1;if(!(.001>g)){if(!b&&!a.f){a.f=!0;var l=new _.I("largegap",{detail:{currentTime:c,gapSize:g}});l.cancelable=!0;a.l(l);a.j.jumpLargeGaps&&!l.defaultPrevented?h=!0:_.Se("Ignoring large gap at",c,"size",g)}if(b||h)0==e?_.Se(Wq,g,"seconds because of gap before start time of",f):_.Se(Wq,g,"seconds because of gap starting at",d.end(e-1),"and ending at",
f),a.a.currentTime=f}}}}};At=function(a,b,c){this.a=a;this.f=b;this.g=c;this.b=new _.Xe;this.c=new xt(a);0<a.readyState?yt(this,c):zt(this,c)};Bt=function(a){return 0<a.a.readyState?a.a.currentTime:a.g};Dt=function(a,b){0<a.a.readyState?Ct(a.c,b):zt(a,b)};zt=function(a,b){a.g=b;a.b.off(a.a,_.Pc);a.b.one(a.a,_.Pc,function(){yt(a,b)})};yt=function(a,b){.001>Math.abs(a.a.currentTime-b)?Et(a):(a.b.one(a.a,_.vd,function(){Et(a)}),Ct(a.c,0==a.a.currentTime?b:a.a.currentTime))};
Et=function(a){a.b.on(a.a,_.vd,function(){return a.f()})};xt=function(a){var b=this;this.b=a;this.h=10;this.g=this.c=this.f=0;this.a=new _.sg(function(){0>=b.f?(_.C(["Failed to move playhead from",b.c,"to",b.g].join(" ")),b.a.stop()):b.b.currentTime!=b.c?b.a.stop():(b.b.currentTime=b.g,b.f--)})};Ct=function(a,b){a.c=a.b.currentTime;a.g=b;a.f=a.h;a.b.currentTime=b;a.a.za(.1)};
It=function(a,b,c,d,e,f){var g=this;this.c=a;this.a=b.presentationTimeline;this.m=b.minBufferTime||0;this.h=c;this.l=e;this.j=null;this.g=new wt(a,b.presentationTimeline,c,Ft(this,a,c),f);this.f=new At(a,function(){a:{var h=g.g;h.i=!0;h.h=!1;h.f=!1;h=Bt(g.f);var l=Gt(g,h);if(.001<Math.abs(l-h)){var m=(new Date).getTime()/1E3;if(!g.j||g.j<m-1){g.j=m;Dt(g.f,l);h=void 0;break a}}g.b.debug("Seek to "+h);g.l();h=void 0}return h},Ht(this,d));this.i=(new _.sg(function(){if(0!=g.c.readyState&&!g.c.paused){var h=
g.c.currentTime,l=ur(g.a,0),m=tr(g.a);3>m-l&&(l=m-3);h<l&&(l=Gt(g,h),g.b.info("Jumping forward "+(l-h)+" seconds to catch up with the seek range."),g.c.currentTime=l)}})).za(.25);this.b=new _.E("clpp.mse.Playhead")};Kt=function(a){var b=Bt(a.f);return 0<a.c.readyState&&!a.c.paused?Jt(a,b):b};Ht=function(a,b){null==b?b=Infinity>a.a.getDuration()?ur(a.a,0):tr(a.a):0>b&&(b=tr(a.a)+b);return Lt(a,Jt(a,b))};Lt=function(a,b){var c=a.a.getDuration();return b>=c?c-a.h.durationBackoff:b};
Gt=function(a,b){var c=new _.Le(a.c.buffered);c=c.xb.bind(c);var d=Math.max(a.m,a.h.rebufferingGoal),e=a.h.safeSeekOffset,f=ur(a.a,0),g=tr(a.a),h=a.a.getDuration();3>g-f&&(f=g-3);var l=ur(a.a,d),m=ur(a.a,e);d=ur(a.a,d+e);if(b>=h)return a.b.debug("Playhead past duration."),Lt(a,b);if(b>g)return a.b.debug("Playhead past end."),g;if(b<f){if(c(m))return a.b.debug("Playhead before start \x26 start is buffered"),m;a.b.debug("Playhead before start \x26 start is unbuffered");return d}if(b>=l||c(b))return a.b.debug("Playhead in safe region or in buffered region."),
b;a.b.debug("Playhead outside safe region \x26 in unbuffered region.");return d};Jt=function(a,b){var c=ur(a.a,0);if(b<c)return c;c=tr(a.a);return b>c?c:b};Ft=function(a,b,c){if(!c.stallEnabled)return null;var d=c.stallSkip;c=new st(new ut(b),c.stallThreshold);tt(c,function(e,f){a.b.debug(["Stall detected at",e,"for",f,"seconds. Seeking forward",d,"seconds."].join(" "));b.currentTime+=d});return c};
_.Mt=function(a,b){this.b=b;this.c=a;this.h=null;this.l=1;this.v=Promise.resolve();this.i=[];this.j=new Map;this.f=new Map;this.A=this.g=this.m=this.o=!1;this.w=0;this.a=new _.E("clpp.mse.Streaming");this.u=!1};Nt=function(a){var b=a.f.get(_.Xd);return b?a.c.periods[b.Na]:(b=a.f.get(_.Ib))?a.c.periods[b.Na]:null};Pt=function(a){return _.Ot(a,_.Ib)};Qt=function(a){return _.Ot(a,_.Xd)};_.Ot=function(a,b){var c=a.f.get(b);return c?c.gd||c.stream:null};
Vt=function(a,b){var c,d,e,f,g,h,l,m,n,p;return _.z(function(q){switch(q.a){case 1:return c=_.ok,_.x(q,a.b.K.clear(c.TEXT),2);case 2:return a.w++,a.A=!1,d=a.w,e=a.b.K,f=new Map,g=new Set,f.set(c.TEXT,b),g.add(b),_.x(q,e.init(f,!1),3);case 3:return a.g?q["return"]():_.x(q,Rt(a,g),4);case 4:if(a.g)return q["return"]();l=(h=e.h.isTextVisible())||a.h.alwaysStreamText;a.w!=d||a.f.has(c.TEXT)||a.A||!l||(m=a.b.Ka(),n=St(a,m),p=Tt(b,n,0),a.f.set(c.TEXT,p),Ut(a,p,0));_.y(q)}})};
Xt=function(a,b,c,d){b.video&&_.Wt(a,b.video,c,d);b.audio&&_.Wt(a,b.audio,c,d)};
_.Wt=function(a,b,c,d){var e=a.f.get(b.type);if(!e&&b.type==_.k&&a.h.ignoreTextStreamFailures)Vt(a,b);else if(e){var f=Yt(a,b);if(c&&f!=e.Na)a.a.debug("switch: switching to stream in another Period; clearing buffer and changing Periods"),a.f.forEach(function(l){Zt(a,l)});else{e.gd&&(a.a.debug("switch during trick play mode",b),b.trickModeVideo?(e.gd=b,b=b.trickModeVideo,a.a.debug("switch found trick play stream",b)):(e.gd=null,a.a.debug("switch found no special trick play stream")));var g=a.i[f];
if(g&&g.cc&&(g=a.j.get(b.id))&&g.cc)if(e.stream!=b){g=a.c.presentationTimeline.getDuration();var h=a.b.Ka();h=$t(a,e,h);!c&&(e.endOfStream||h>=g)?a.a.debug(mr+au(e)+" already buffered to the end. Not switching."):(b.type==_.k&&bs(a.b.K,_.pi(b.mimeType,b.codecs)),e.stream=b,e.Xc=!0,a.a.debug("switch: switching to Stream "+au(e)),bu(a,e,f)&&(a.a.info("Aborting current segment request to switch."),e.yc.abort()),c&&(e.gb?e.kd=!0:e.Xa?(e.eb=!0,e.Oc=d,e.kd=!0):(cu(e),du(a,e,!0,d))))}else a.a.debug(mr+au(e)+
" already active")}}};bu=function(a,b,c){if(!b.yc)return!1;var d=a.b.Ka(),e=a.b.K.aa(b.type);c=(c=eu(a,b,d,e,c))?c.a?c.a-c.b:null:null;if(null==c)return!1;var f=b.stream.initSegmentReference;f&&(c+=(f.a?f.a-f.b:null)||0);f=a.b.zd().getBandwidthEstimate();if(8*c/f<(null===e?0:e-d)-Math.max(a.c.minBufferTime||0,a.h.rebufferingGoal))return!0;a=b.yc;a=a.f?a.f.bytesRemaining:-1;return 0>a||a>c?!0:!1};
fu=function(a){function b(l){return a.b.K.xb(l,c,d)}var c=a.b.Ka(),d=a.h.smallGapLimit,e=!1,f=St(a,c);if(_.li(a.f.values(),function(l){return l.Na==f}))for(var g=_.v(a.f.keys()),h=g.next();!h.done;h=g.next())h=h.value,b(h)||(Zt(a,a.f.get(h)),e=!0);else _.li(a.f.keys(),b)||(a.a.debug("(all): seeked: unbuffered seek: clearing all buffers"),a.f.forEach(function(l){Zt(a,l)}),e=!0);e||a.a.debug("(all): seeked: buffered seek: presentationTime\x3d"+c)};
Zt=function(a,b){var c=au(b);b.gb?a.a.debug(c,"clear: already clearing the buffer"):b.eb?a.a.debug(c,"clear: already waiting"):b.Xa?(a.a.debug(c,"clear: currently updating"),b.eb=!0,b.Oc=0):null==a.b.K.Ja(b.type)?(a.a.debug(c,"clear: nothing buffered"),null==b.Qa&&Ut(a,b,0)):(a.a.debug(c,"clear: handling right now"),cu(b),du(a,b,!1,0))};
hu=function(a,b,c,d,e){var f,g,h,l,m,n,p;return _.z(function(q){if(1==q.a)return f=a.b.Ka(),g=St(a,f),h=_.ok,l=new Map,m=new Set,b&&(l.set(h.AUDIO,b),m.add(b)),c&&(l.set(h.VIDEO,c),m.add(c)),d&&(l.set(h.TEXT,d),m.add(d)),n=a.b.K,p=a.h.forceTransmuxTS,_.x(q,n.init(l,p),2);if(3!=q.a){if(a.g)return q["return"]();gu(a);return _.x(q,Rt(a,m),3)}if(a.g)return q["return"]();l.forEach(function(t,u){if(!a.f.has(u)){var A=Tt(t,g,e);a.f.set(u,A);Ut(a,A,0)}});_.y(q)})};
Tt=function(a,b,c){return{stream:a,type:a.type,Zb:null,Ma:null,gd:null,Xc:!0,Na:b,endOfStream:!1,Xa:!1,Qa:null,eb:!1,Oc:0,kd:!1,gb:!1,Yd:!1,rc:!1,wf:c||0,yc:null,nc:!1}};
iu=function(a,b){var c=a.i[b];if(c)return a.a.debug("(all) Period "+b+Uq),c.promise;a.a.debug("(all) setting up Period "+b);c={promise:new _.Of,cc:!1};a.i[b]=c;for(var d=new Set,e=_.v(a.c.periods[b].variants),f=e.next();!f.done;f=e.next())f=f.value,f.video&&d.add(f.video),f.video&&f.video.trickModeVideo&&d.add(f.video.trickModeVideo),f.audio&&d.add(f.audio);e=_.v(a.c.periods[b].textStreams);for(f=e.next();!f.done;f=e.next())d.add(f.value);a.v=a.v.then(function(){return a.g?null:Rt(a,d)}).then(function(){a.g||
(a.i[b].promise.resolve(),a.i[b].cc=!0,a.a.debug("(all) setup Period "+b))})["catch"](function(g){a.g||(a.i[b].promise["catch"](function(){}),a.i[b].promise.reject(),delete a.i[b],a.a.warn("(all) failed to setup Period "+b),a.b.onError(g))});return c.promise};
Rt=function(a,b){var c,d,e,f,g,h,l,m,n,p,q;return _.z(function(t){switch(t.a){case 1:c=[];d=_.v(b);for(e=d.next();!e.done;e=d.next())f=e.value,(g=a.j.get(f.id))?(a.a.debug("(all) Stream "+f.id+Uq),c.push(g.promise)):(a.a.debug("(all) setting up Stream "+f.id),a.j.set(f.id,{promise:new _.Of,cc:!1}),c.push(f.createSegmentIndex()));t.c=2;return _.x(t,Promise.all(c),4);case 4:if(a.g)return t["return"]();_.Be(t,3);break;case 2:h=_.Ce(t);if(a.g)return t["return"]();l=_.v(b);for(e=l.next();!e.done;e=l.next())m=
e.value,a.j.get(m.id).promise["catch"](function(){}),a.j.get(m.id).promise.reject(),a.j["delete"](m.id);throw h;case 3:n=_.v(b);for(e=n.next();!e.done;e=n.next())p=e.value,q=a.j.get(p.id),q.cc||(q.promise.resolve(),q.cc=!0,a.a.debug("(all) setup Stream "+p.id));_.y(t)}})};gu=function(a){var b=a.c.presentationTimeline.getDuration();Infinity>b?a.b.K.bb(b):a.b.K.bb(Math.pow(2,32))};
mu=function(a,b){if(!a.g){var c=au(b);if(!b.Xa&&null!=b.Qa&&!b.gb)if(b.Qa=null,b.eb)a.a.debug(c,"skipping update and clearing the buffer"),du(a,b,b.kd,b.Oc);else{try{var d=ju(a,b);null!=d&&(Ut(a,b,d),b.rc=!1)}catch(e){ku(a,e);return}d=Array.from(a.f.values());lu(a,b);a.o&&d.every(function(e){return e.endOfStream})&&(a.a.debug(c,"calling endOfStream()..."),a.b.K.endOfStream().then(function(){if(!a.g){var e=a.b.K.getDuration();e<a.c.presentationTimeline.getDuration()&&a.c.presentationTimeline.bb(e)}}))}}};
ju=function(a,b){function c(q){return q.type==_.k&&q.stream.mimeType==_.Ab}if(c(b))return a.b.K.hd(b.stream.originalId||""),null;var d=au(b),e=a.b.Ka(),f=$t(a,b,e);a.a.debug(d,"timeNeeded\x3d"+f);var g=Yt(a,b.stream),h=St(a,f),l=a.b.K.sa(b.type,e);a.a.debug(d,"update_:",jr+e,"bufferedAhead\x3d"+l);var m=Math.max(a.c.minBufferTime||0,a.h.rebufferingGoal,a.h.bufferingGoal)*a.l,n=a.c.presentationTimeline.getDuration();if(f>=n&&!b.nc)return nu(a,b),null;b.endOfStream=!1;b.Na=h;if(h!=g)return a.a.debug(d,
"need Period "+h,jr+e,"timeNeeded\x3d"+f,"currentPeriodIndex\x3d"+g),null;if(l>=m)return a.a.debug(d,"buffering goal met"),a.h.bufferLimitUpdateInterval||.5;h=a.b.K.aa(b.type);h=eu(a,b,e,h,g);if(!h)return!a.c.presentationTimeline.isLive()&&b.nc?(a.a.debug("Media state "+d+" marked for duration drift and no next segment found. Assuming EOS."),nu(a,b),null):a.h.bufferLimitUpdateInterval||1;var p=Infinity;Array.from(a.f.values()).forEach(function(q){c(q)||(q=$t(a,q,e),p=Math.min(p,q))});if(f>=p+a.c.presentationTimeline.a)return a.h.bufferLimitUpdateInterval||
1;b.wf=0;ou(a,b,e,g,h);return null};nu=function(a,b){a.a.debug(au(b),"buffered to end of presentation");b.endOfStream=!0;if(b.type==_.Xd){var c=a.f.get(_.k);c&&c.stream.mimeType==_.Ab&&(c.endOfStream=!0)}};$t=function(a,b,c){if(!b.Zb||!b.Ma)return Math.max(c,b.wf);c=Yt(a,b.Zb);return a.c.periods[c].startTime+b.Ma.endTime};
eu=function(a,b,c,d,e){var f=au(b);if(b.Ma&&b.stream==b.Zb)return d=b.Ma.position+1,a.a.debug(f,"next position known:","position\x3d"+d),pu(a,b,e,d);b.Ma?(a.a.debug(f,"next position unknown: another Stream buffered"),f=Yt(a,b.Zb),f=qu(a,b,a.c.periods[f].startTime+b.Ma.endTime,e)):(a.a.debug(f,"next position unknown: nothing buffered"),f=qu(a,b,d||c,e));if(null==f)return null;c=null;null==d&&(c=pu(a,b,e,Math.max(0,f-1)));return c||pu(a,b,e,f)};
qu=function(a,b,c,d){var e=au(b);d=a.c.periods[d];a.a.debug(e,"looking up segment:",jr+c,gr+d.startTime);c=Math.max(0,c-d.startTime);b=b.stream.findSegmentPosition(c);null==b&&a.a.warn(e,"cannot find segment:",gr+d.startTime,"lookupTime\x3d"+c);return b};
pu=function(a,b,c,d){var e=au(b);c=a.c.periods[c];var f=b.stream.getSegmentReference(d);if(!f)return a.a.debug(e,"segment does not exist:",gr+c.startTime,"position\x3d"+d),null;var g=a.c.presentationTimeline;d=_.sn(g);g=_.rn(g);return!b.nc&&(c.startTime+f.endTime<d||c.startTime+f.startTime>g)?(a.a.debug(e,"segment is not available:",gr+c.startTime,lr+f.startTime,kr+f.endTime,"availabilityStart\x3d"+d,"availabilityEnd\x3d"+g),null):f};
ou=function(a,b,c,d,e){function f(q,t){if(a.g||a.m)return null;p=!0;return ru(a,b,c,h,l,e,q,t)}var g=au(b),h=a.c.periods[d];a.a.debug(g,"fetchAndAppend_:",jr+c,gr+h.startTime,"reference.position\x3d"+e.position,lr+e.startTime,kr+e.endTime);var l=b.stream,m=a.c.presentationTimeline.getDuration(),n=a.c.periods[d+1];d=su(a,b,d,Math.max(0,h.startTime-.1),n?n.startTime+.01:m);b.Xa=!0;b.Xc=!1;a.a.debug(g,"fetching segment");var p=!1;d.then(function(){return a.g||a.m?null:tu(a,b,e,!1,function(q){return f(q.data,
!0)})}).then(function(q){return p||a.g||a.m||null===q?null:f(q,!1)}).then(function(){a.g||a.m||(b.Xa=!1,b.Yd=!1,b.eb||a.b.Zc(),Ut(a,b,0),uu(a,b,l),a.a.debug(g,"finished fetch and append"))})["catch"](function(q){a.g||a.m||(q,b.Xa=!1,b.type==_.k&&a.h.ignoreTextStreamFailures?(1001==q.code?a.a.warn(g,"Text stream failed to download. Proceeding without it."):a.a.warn(g,"Text stream failed to parse. Proceeding without it."),a.f["delete"](_.k)):7001==q.code?(b.Xa=!1,b.Qa=null,Ut(a,b,0)):3017==q.code?vu(a,
b,q):b.type===_.k?(q instanceof _.K&&_.jf(q,1),cu(b),a.b.onError(new _.K(1,2,2010,q))):(a.a.error(g,"failed fetch and append: code\x3d"+q.code),b.rc=!0,q instanceof _.K&&_.jf(q,_.M),ku(a,q)))})};
vu=function(a,b,c){var d=au(b);if(Array.from(a.f.values()).some(function(f){return f!=b&&f.Yd}))a.a.debug(d,Xq,"waiting for another stream to recover...");else{var e=Math.round(100*a.l);if(20<e)a.l-=.2;else if(4<e)a.l-=.04;else{a.a.error(d,"MediaSource threw QuotaExceededError too many times");b.rc=!0;a.m=!0;a.b.onError(c);return}a.a.warn(d,Xq,"reducing buffering goals by "+(100-Math.round(100*a.l))+"%");b.Yd=!0}Ut(a,b,4)};
su=function(a,b,c,d,e){if(!b.Xc)return Promise.resolve();var f=au(b);c=a.c.periods[c].startTime-(b.stream.presentationTimeOffset||0);a.a.debug(f,"setting timestamp offset to "+c);a.a.debug(f,"setting append window start to "+d);a.a.debug(f,"setting append window end to "+e);d=hs(a.b.K,b.type,c,d,e);if(!b.stream.initSegmentReference)return d;a.a.debug(f,"fetching init segment");e=tu(a,b,b.stream.initSegmentReference,!0).then(function(g){if(a.g)return null;a.a.debug(f,"appending init segment");return fs(a.b.K,
b.type,g,null,null,b.stream.closedCaptions&&0<b.stream.closedCaptions.size)})["catch"](function(g){b.Xc=!0;return Promise.reject(g)});return Promise.all([d,e])};
ru=function(a,b,c,d,e,f,g,h){h=void 0===h?!1:h;var l=au(b),m=e.closedCaptions&&0<e.closedCaptions.size;null!=e.emsgSchemeIdUris&&0<e.emsgSchemeIdUris.length&&(new _.ri).T("emsg",a.C.bind(a,d,f,e.emsgSchemeIdUris)).parse(g);var n=0;return wu(a,b,c).then(function(){if(a.g)return null;a.a.debug(l,"appending media segment");var p=f.startTime+d.startTime,q=f.endTime+d.startTime;n=a.b.K.aa(b.type)||0;return fs(a.b.K,b.type,g,p,q,m,e.id,h)}).then(function(){if(!a.g){a.a.debug(l,"appended media segment");
if(!a.c.presentationTimeline.isLive()&&b.type!==_.k){var p=(a.b.K.aa(b.type)||0)-n;a.a.debug(l,"real segment duration",p);var q=f.endTime-f.startTime;p-=q;Math.abs(p)>=Math.min(.01,q)&&Math.abs(p)<=Math.min(1,q)&&(b.nc=!0,e.adjustSegmentDurations(f.position,p))}b.Zb=e;b.Ma=f}})};
wu=function(a,b,c){if(a.g)return Promise.resolve();var d=au(b);a.a.debug(d,"checking buffer length");var e=Math.max(a.h.bufferBehind,a.c.presentationTimeline.a),f=a.b.K.Ja(b.type);if(null==f)return a.a.debug(d,"buffer behind okay because nothing buffered:",jr+c,cr+e),Promise.resolve();var g=c-f,h=g-e;if(0>=h)return a.a.debug(d,"buffer behind okay:",jr+c,dr+g,cr+e,"underflow\x3d"+-h),Promise.resolve();a.a.debug(d,"buffer behind too large:",jr+c,dr+g,cr+e,"overflow\x3d"+h);return a.b.K.remove(b.type,
f,f+h).then(function(){a.g||a.a.debug(d,"evicted "+h+" seconds")})};uu=function(a,b,c){if(!a.o){var d=au(b);b=Array.from(a.f.values());1!=b.length||b[0].type!=_.k?a.o=b.every(function(e){return e.type==_.k||a.u?!0:!e.eb&&!e.gb&&e.Ma}):a.u&&(a.o=!0);if(a.o){a.a.debug(d,"startup complete");c=Yt(a,c);a.i[c]||iu(a,c).then(function(){a.g||(a.a.debug(d,er),a.b.Qd())})["catch"](_.mi.xc);for(c=0;c<a.c.periods.length;++c)iu(a,c)["catch"](_.mi.xc);a.b.Ai&&(a.a.debug(d,"calling onStartupComplete()..."),a.b.Ai())}}};
lu=function(a,b){var c=au(b),d=Yt(a,b.stream);if(b.Na!=d){var e=b.Na,f=Array.from(a.f.values());f.every(function(g){return g.Na==e})?f.every(xu)?(a.a.debug(c,"all need Period "+e),iu(a,e).then(function(){if(!a.g)if(f.every(function(n){var p=xu(n),q=Yt(a,n.stream);return p&&n.Na==e&&q!=e})){var g=a.c.periods[e];a.a.debug(c,"calling onChooseStreams()...");var h=a.b.Rd(g);a.u=!h.variant&&!!h.text;var l=new Map;h.variant&&h.variant.video&&l.set(_.Xd,h.variant.video);h.variant&&h.variant.audio&&l.set(_.Ib,
h.variant.audio);h.text&&l.set(_.k,h.text);var m=_.v(a.f.keys());for(h=m.next();!h.done;h=m.next())if(h=h.value,!l.has(h)&&h!=_.k){a.a.error(c,"invalid Streams chosen: missing "+h+" Stream");a.b.onError(new _.K(_.M,5,5005));return}m=_.v(Array.from(l.keys()));for(h=m.next();!h.done;h=m.next())if(h=h.value,!a.f.has(h))if(h==_.k)hu(a,null,null,l.get(_.k),g.startTime),l["delete"](h);else{a.a.error(c,"invalid Streams chosen: unusable "+h+" Stream");a.b.onError(new _.K(_.M,5,5005));return}g=_.v(Array.from(a.f.keys()));
for(h=g.next();!h.done;h=g.next())h=h.value,(m=l.get(h))?(_.Wt(a,m,!1,0),Ut(a,a.f.get(h),0)):a.f["delete"](h);a.a.debug(c,er);a.b.Qd()}else a.a.debug(c,"ignoring transition to Period",e,"since another is happening")})["catch"](_.mi.xc)):a.a.debug(c,"all MediaStates need Period "+e+", but not all MediaStates are idle"):a.a.debug(c,"not all MediaStates need Period "+e)}};St=function(a,b){var c=Fs(a.c.periods,b+_.In);return c?a.c.periods.indexOf(c):0};
Yt=function(a,b){for(var c=a.c.periods,d=0;d<c.length;d++){for(var e=c[d],f=new Set,g=_.v(e.variants),h=g.next();!h.done;h=g.next())h=h.value,h.audio&&f.add(h.audio),h.video&&f.add(h.video),h.video&&h.video.trickModeVideo&&f.add(h.video.trickModeVideo);e=_.v(e.textStreams);for(g=e.next();!g.done;g=e.next())f.add(g.value);if(f.has(b))return d}return-1};
tu=function(a,b,c,d,e){d=void 0===d?!1:d;e=void 0===e?null:e;var f=_.pl(c.c(),c.b,c.a,a.h.attemptParameters,c.startTime,c.endTime,b.type);f.type=_.Bn;f.onFragment=c.g?null:e;if(e=c.f())f.keyInfo=e,f.onFragment=null;d&&b.type===_.Xd&&a.h.overridePasp&&f.responseModifiers.push(a.F.bind(a));a.a.debug("fetching: reference\x3d",c);c=a.b.Ab.fetch(f);b.yc=c;return c.promise.then(function(g){var h=a.b.zd(),l=g.timeMs,m=g.data.byteLength;l&&m&&!d&&h.segmentDownloaded(l,m);b.yc=null;return g.data})};
du=function(a,b,c,d){var e,f,g,h;_.z(function(l){if(1==l.a)return e=au(b),b.eb=!1,b.kd=!1,b.Oc=0,b.gb=!0,a.a.debug(e,"clearing buffer"),d?(g=a.b.Ka(),h=a.b.K.getDuration(),f=a.b.K.remove(b.type,g+d,h)):f=a.b.K.clear(b.type).then(function(){return!a.g&&c?a.b.K.flush(b.type):null}),_.x(l,f,2);if(a.g)return l["return"]();a.a.debug(e,"cleared buffer");b.Zb=null;b.Ma=null;b.gb=!1;b.endOfStream=!1;b.nc=!1;Ut(a,b,0);_.y(l)})};
Ut=function(a,b,c){a.a.debug(au(b),"updating in "+c+" seconds");b.Qa=(new _.yi(function(){mu(a,b)})).P(c)};cu=function(a){null!=a.Qa&&(a.Qa.stop(),a.Qa=null)};ku=function(a,b){a.g||(a.b.onError(b),typeof a.h.failureCallback!==_.Cc||a.h.failureCallback(b))};au=function(a){return"("+a.type+":"+a.stream.id+")"};xu=function(a){return!a.Xa&&null==a.Qa&&!a.eb&&!a.gb};
yu=function(a){this.a=null;for(var b=0;b<a.textTracks.length;++b){var c=a.textTracks[b];c.mode=_.qc;c.label==br&&(this.a=c)}this.a||(this.a=a.addTextTrack(_.Dd,br));this.a.mode=_.Ec};
zu=function(a){if(a.startTime>=a.endTime)return _.C("Invalid cue times: "+a.startTime+" - "+a.endTime),null;var b=new VTTCue(a.startTime,a.endTime,a.payload);b.lineAlign=a.lineAlign;b.positionAlign=a.positionAlign;b.size=a.size;try{b.align=a.textAlign}catch(c){}a.textAlign==_.$b&&b.align!=_.$b&&(b.align="middle");a.writingMode==_.Vd?b.vertical="lr":a.writingMode==_.Wd&&(b.vertical="rl");1==a.lineInterpretation&&(b.snapToLines=!1);null!=a.line&&(b.line=a.line);null!=a.position&&(b.position=a.position);
return b};Au=function(a,b){var c=a.mode;a.mode=c==_.wd?_.wd:_.Ec;for(var d=a.cues,e=d.length-1;0<=e;e--){var f=d[e];f&&b(f)&&a.removeCue(f)}a.mode=c};
Du=function(a){_.Pg.call(this,fr);var b=this;this.o=Bu;this.f=null;this.od=0;this.Je=2;this.Pe=this.Kg.bind(this);this.Ne=this.Jg.bind(this);this.jc=null;this.gc=!1;this.i=new _.Xe;this.g=this.c=this.u=this.b=this.qa=this.A=this.Gc=this.hc=this.Ob=this.m=this.v=this.h=null;this.af=1E9;this.Kc=new Set;this.C=!0;this.M=null;this.Xe=!1;this.Ve=0;this.I=null;this.F=new $s;this.Ye={width:Infinity,height:Infinity};this.w=null;this.R=_.ym;this.Ia=new gt(this.a.preferredAudioLanguage,this.a.preferredAudioRole,
this.a.preferredAudioChannelCount);this.la=this.a.preferredTextLanguage;this.S=this.Jc=null;this.ic=[];this.N=null;this.fc=this.a.preferredTextRole;a&&a(this);this.ld=null;this.i.on(window,"online",function(){if(b.o==Cu){var c=b.b;if(c.g)c.a.error("Unable to retry after StreamingEngine is destroyed!");else if(c.m)c.a.error("Unable to retry after StreamingEngine encountered a fatal error!");else for(var d=_.v(c.f.values()),e=d.next();!e.done;e=d.next()){e=e.value;var f=au(e);e.rc&&(c.a.info(f,"Retrying after failure..."),
e.rc=!1,Ut(c,e,.1))}}})};Eu=function(a){return new _.zr(function(b){if(void 0===b||null===b)return null;var c=a.getTrackManager(),d=[];c&&c.getVideoTracks().forEach(function(e){return d.push.apply(d,_.ne(e.renditions))});return d.find(function(e){return e.id==b})||null})};
Fu=function(a,b){if(a.R!==b)if(a.R===_.qk&&b!==_.ym){var c=vr(b,_.Gm);a.log.info(_.ar+c)}else{c=a.od;c=0===c?0:Date.now()-c;var d=a.R;a.R=b;a.od=Date.now();a.w&&_.ck(a.w.a,a.R);b===_.Cm&&(a.Je=a.ec?1:2);var e=a.Je,f={currentState:a.R,previousState:d,timeSinceLastStateChangeMS:c,reason:b===_.Cm||d===_.Cm?e:void 0},g=vr(d,_.Gm),h=vr(b,_.Gm),l=b!==_.Cm?"":"["+vr(e,_.Fm)+"]";a.log.info(_.Ha+g+" -\x3e "+(h+l));a.trigger(new _.I(_.zd,{detail:f}));b===_.Cm?a.trigger(new _.I(_.Ub,{detail:{bufferedTimeMS:-1,
reason:e}})):d===_.Cm&&a.trigger(new _.I(_.Tb,{detail:{bufferedTimeMS:c,reason:e}}))}};Lu=function(a){var b=!1;b=void 0===b?!0:b;var c;return _.z(function(d){switch(d.a){case 1:return a.o==Gu?d["return"](Promise.reject(new _.K(_.M,7,7E3))):_.x(d,Hu(a),2);case 2:return _.x(d,Iu(a),3);case 3:if(!b){d.a=0;break}c=a.getSurface().D();return _.x(d,Ju(a,c),5);case 5:return _.x(d,Ku(a,c),0)}})};
Ju=function(a,b){a.f||(a.i.on(b,_.zc,function(){if(a.f.error){var c=a.f.error.code;if(1==c)c=null;else{var d=a.f.error.msExtendedCode;d&&(0>d&&(d+=Math.pow(2,32)),d=d.toString(16));c=new _.K(_.M,3,3016,{code:c,extendedError:d,message:a.f.error.message})}}else c=null;if(c)a.onError(c)}),a.f=b);return Promise.resolve()};Hu=function(a){a.f&&(a.i.off(a.f,_.zc),a.f=null);return Promise.resolve()};
Iu=function(a){var b;return _.z(function(c){switch(c.a){case 1:a.o!=Gu&&(a.o=Bu);if(b=a.f)a.i.off(b,_.Oc),a.i.off(b,_.ld),a.i.off(b,_.hd),a.i.off(b,_.yc),a.i.off(b,_.nd);a.Ob&&(a.Ob.release(),a.Ob=null);a.Gc&&(a.Gc.stop(),a.Gc=null);if(!a.u){c.a=2;break}return _.x(c,a.u.stop(),3);case 3:a.u=null;case 2:if(!a.g){c.a=4;break}return _.x(c,a.g.stop(),4);case 4:if(!a.b){c.a=6;break}return _.x(c,a.b.destroy(),7);case 7:a.b=null;case 6:a.m&&(a.m.release(),a.m=null);if(!a.v){c.a=8;break}return _.x(c,a.v.destroy(),
9);case 9:a.v=null;case 8:b&&b.src&&(b.removeAttribute("src"),b.load());if(!a.h){c.a=10;break}return _.x(c,a.h.destroy(),11);case 11:a.h=null;case 10:a.F.clear(),a.A=null,a.Kc.clear(),a.c=null,a.w=null,a.C=!0,a.ic=[],Mu(a),_.y(c)}})};Ku=function(a,b){var c,d,e;return _.z(function(f){if(1==f.a)return c=window.muxjs?new Rr:new _.Sr,d=new yu(a.f),a.jc=Eu(a),a.jc.track(a),e=new _.Zr(b,c,d,a.jc,a.a.streaming.maxSegmentToMediaOffset),_.x(f,e.v,2);a.v=e;_.y(f)})};
Nu=function(a,b){var c,d;return _.z(function(e){if(1==e.a)return c=a.getNetworkEngine(),d=a,_.x(e,_.Sn.create(b.url,c,a.a.manifest.attemptParameters,b.type),2);d.u=e.b;a.u.configure(a.a.manifest);_.y(e)})};
Ru=function(a,b){var c,d,e;return _.z(function(f){c=a.getNetworkEngine();a.qa=new Lr;Mr(a.qa,function(g){Ou(a,_.Jd,g)});d={networkingEngine:c,filterNewPeriod:function(g){return a.xd(g)},filterAllPeriods:function(g){return Pu(a,g)},onTimelineCueAdded:function(g){var h=a.qa;a:{var l=_.v(h.a);for(var m=l.next();!m.done;m=l.next())if(m=m.value,m.schemeIdUri===g.schemeIdUri&&m.startTime===g.startTime&&m.endTime===g.endTime){l=m;break a}l=null}null==l&&(h.a.add(g),h.b(g))},onEvent:function(g){return a.td(g)},
onError:function(g){return a.onError(g)}};e=new _.vj(Promise.resolve().then(function(){var g;return _.z(function(h){if(1==h.a)return g=a,_.x(h,a.u.start(b.url,d),2);g.c=h.b;!a.c.presentationTimeline||_.J.H(a.a.suggestedPresentationDelay)||isNaN(a.a.suggestedPresentationDelay)||(a.log.info("Apply suggested presentation delay of: "+a.a.suggestedPresentationDelay),a.c.presentationTimeline.Xd=a.a.suggestedPresentationDelay);a.c.presentationTimeline&&(a.c.presentationTimeline.m=!!a.a.lowLatencyMode);if(0==
a.c.periods.length)throw new _.K(_.M,4,4014);Qu(a.c.periods);_.y(h)})}),function(){a.log.info("Aborting parser step...");return a.u.stop()});return _.x(f,e.promise,0)})};
Tu=function(a){var b,c,d,e;return _.z(function(f){switch(f.a){case 1:a.h=new _.Ci({Ab:a.getNetworkEngine(),onError:function(g){return a.onError(g)},Sd:function(g){return Su(a,g)},onExpirationUpdated:function(g,h){if(a.u&&a.u.onExpirationUpdated)a.u.onExpirationUpdated(g,h);a.trigger(new _.I(_.rc,{expirationTime:h}))},onEvent:function(g){return a.td(g)},getConfiguration:function(){return a.getConfiguration()}});a.h.c=_.rh(a.a.drm);c=(b=a.a.drm)?b.offlineId||"":"";d=[];if(!c){f.a=2;break}e=_.wk.get(_.cc)||
null;if(!e){f.a=2;break}return _.x(f,e.Fh(c),4);case 4:d=f.b;case 2:return _.x(f,_.Hi(a.h,Es(a.c.periods),d),5);case 5:Pu(a,a.c.periods),_.y(f)}})};
jv=function(a){var b,c,d,e,f,g,h,l;return _.z(function(m){if(1==m.a)return b=a.f,c=function(){a.f&&a.A&&Uu(a);Vu(a)},d=function(){if(a.f){var n=a.f.playbackRate;0!=n&&a.hc.set(n)}},a.i.on(b,_.ld,c),a.i.on(b,_.hd,c),a.i.on(b,_.yc,c),a.i.on(b,_.nd,c),a.i.on(b,_.vd,c),a.i.on(b,_.ud,c),a.i.on(b,_.nd,d),a.g||(a.g=new _.Is,a.g.configure(a.a.abr)),Wu(a,a.c.periods),a.Ia=new gt(a.a.preferredAudioLanguage,a.a.preferredAudioRole,a.a.preferredAudioChannelCount),a.la=a.a.preferredTextLanguage,a.fc=a.a.preferredTextRole,
_.x(m,_.Ri(a.h,b),2);if(3!=m.a)return a.g.init(function(n,p,q){!a.C&&Zu(a,n,p,q)}),a.m=$u(a,a.a.startTime),a.Ob=av(a),a.hc=new pt({Cd:function(){return b.playbackRate},xf:function(n){b.playbackRate=n},Sh:function(n){b.currentTime+=n}}),e=Math.max(1E-4,a.a.streaming.rebufferingGoal),bv(a,e),a.b=cv(a),a.b.h=a.a.streaming,dv(a),a.o=Cu,_.x(m,a.b.start(),3);a.a.streaming.startAtSegmentBoundary&&(f=Kt(a.m),g=ev(a,f),Dt(a.m.f,g));a.c.periods.forEach(a.xd.bind(a));fv(a);gv(a);h=hv(a);l=h.variants.some(function(n){return n.primary});
a.a.preferredAudioLanguage||l||a.log.warn("No preferred audio language set.  We will choose an arbitrary language initially");iv(a,h.variants);a.i.one(b,_.Oc,function(){a.w.i=Date.now()/1E3-(null===a.ld?0:a.ld)});_.y(m)})};Qu=function(a){function b(c){return c.video&&c.audio||c.video&&c.video.codecs.includes(",")}a.some(function(c){return c.variants.some(b)})&&(_.F("Found variant with audio and video content, so filtering out audio-only content in all periods."),a.forEach(function(c){c.variants=c.variants.filter(b)}))};
dv=function(a){function b(g){var h="";g.video&&(h=_.qi(g.video.codecs)[0]);var l="";g.audio&&(l=_.qi(g.audio.codecs)[0]);return h+"-"+l}var c=a.c.periods.reduce(function(g,h){return g.concat(h.variants)},[]);c=ts(c,a.a.preferredAudioChannelCount);var d=new _.Ue;c.forEach(function(g){var h=b(g);d.push(h,g)});var e=null,f=Infinity;d.forEach(function(g,h){var l=0,m=0;h.forEach(function(p){l+=p.bandwidth||0;++m});var n=l/m;a.log.debug(_.hc,g,"avg bandwidth",n);n<f&&(e=g,f=n)});a.c.periods.forEach(function(g){g.variants=
g.variants.filter(function(h){if(b(h)==e)return!0;a.log.debug("Dropping Variant (better codec available)",h);return!1})})};$u=function(a,b){return new It(a.f,a.c,a.a.streaming,b,function(){a.Ob&&Nr(a.Ob,!0);a.b&&fu(a.b)},function(c){return a.dispatchEvent(c)})};av=function(a){var b=new nt(a.c);ot(b,function(){fv(a)});var c=new Pr(a.qa);Qr(c,function(e){Ou(a,_.Kd,e)},function(e){Ou(a,_.Ld,e)},function(e,f){f||(Ou(a,_.Kd,e),Ou(a,_.Ld,e))});var d=new Or(a.f);d.a.add(b);d.a.add(c);return d};
bv=function(a,b){a.A=new mt(b,Math.min(.5,b/2));a.A.a=lt;Mu(a);a.Gc=(new _.sg(function(){Uu(a)})).za(.25)};
Uu=function(a){var b;switch(a.o){case Cu:a:if((b=a.f.ended)||(b=a.v,b=b.i?b.i.readyState==_.yc:!0),b)b=!0;else{if(a.c.presentationTimeline.isLive()){b=_.rn(a.c.presentationTimeline);var c=a.getBufferInfo();if(null!==c&&(c=c.aa(),null!==c&&c>=b)){b=!0;break a}}b=!1}break;default:b=!1}var d=0;if(a.v){var e=ds(a.v);c=e.video;e=e.audio;var f=a.f.currentTime;if(c||e)d=c&&e?Math.min(c.sa(f),e.sa(f)):c?c.sa(f):e.sa(f)}c=a.A;e=b;f=c.b.get(c.a);b=c.a;d=e||d>=f?kt:lt;c.a=d;b!=d&&Mu(a)};
cv=function(a){var b={Ka:function(){return Kt(a.m)},K:a.v,Ab:a.getNetworkEngine(),Rd:a.Hg.bind(a),Qd:a.Gg.bind(a),onError:a.onError.bind(a),onEvent:a.td.bind(a),jf:a.Ig.bind(a),Zc:a.wi.bind(a),zd:function(){return a.g}};return new _.Mt(a.c,b)};Ts=function(a){if(a.c&&a.m){var b=kv(a),c=[];a=_.v(lv(a));for(var d=a.next();!d.done;d=a.next()){d=d.value;var e=qs(d);e.active=d==b;c.push(e)}return c}return[]};
Rs=function(a,b){if(a.c&&a.b){var c=hv(a),d=c.textStreams.find(function(e){return e.id==b.id});d?(mv(a,c,d,!1),nv(a,d),a.la=d.language):a.log.error(_.Yq,b.id)}};
Us=function(a,b,c){var d=void 0===d?0:d;if(a.c&&a.b){var e=hv(a);if(a.a.abr.enabled&&b)a.log.info("Disable ABR and enable manual track selection to select "+(b.width+"x"+b.height+"@"+b.bandwidth)),a.a.abr.enabled=!1,a.g.disable();else if(!a.a.abr.enabled&&!b){a.log.info("Enable ABR Selection");a.a.abr.enabled=!0;a.g.enable();a.S=null;c=iv(a,e.variants);null!=a.N&&(a.Ia=a.N,a.N=null);null==c||a.C||Zu(a,c);return}if(b){a.S=b.id;var f=e.variants.find(function(g){return g.id==b.id});f?(a.S=f.video.id,
ss(f)?(ov(a,e,f,!1),pv(a,f,c,d),null==a.N&&(a.N=a.Ia),a.Ia=new ht(f),iv(a,e.variants)):a.log.error("Unable to switch to restricted track",b.id)):a.log.error("No variant with id",b.id)}else a.S=null,null!=a.N&&(a.Ia=a.N,a.N=null),c=iv(a,e.variants),null==c||a.C||Zu(a,c)}};
Ss=function(a,b){if(a.b){var c=Qt(a.b),d=Pt(a.b),e=Fs(a.c.periods,Kt(a.m));e=a.c.periods[e?a.c.periods.indexOf(e):0].variants.filter(function(l){return l.audio.id==b});var f=e.find(function(l){return l.video.id==c.id});if(!f){a.log.debug("Cannot find exact variant, looking for anything else that matches with given audioId");var g=a.getTrackManager().ga();if(g){var h=g.renditions.map(function(l){return l.id});f=e.find(function(l){return h.find(function(m){return m==l.video.id})})}}if(f){if(d.codecs.split(".")[0]===
f.audio.codecs.split(".")[0]){a.Jc=b;qv(a,hv(a));Promise.resolve();return}a.log.warn(Vq)}}Promise.reject()};Ws=function(a){var b=a.gc;return a.c?a.v.h.isTextVisible():b};
Qs=function(a,b){var c,d,e,f;return _.z(function(g){c=a.gc;d=b;if(c==d)return g["return"]();a.gc=d;if(a.o==Cu&&(a.v.h.setTextVisibility(b),!a.a.streaming.alwaysStreamText)){if(b)return e=hv(a),f=_.vs(e.textStreams,a.la,a.fc),0<f.length?g=_.x(g,Vt(a.b,f[0]),0):(g.a=0,g=void 0),g;var h=a.b;h.A=!0;var l=h.f.get(_.k);l&&(cu(l),h.f["delete"](_.k))}g.a=0})};
ov=function(a,b,c,d){var e=a.getTrackManager();if(e){var f=a.w.j;if(c.video){Zs(e,c.video);var g=e.V();f.f!==g&&(f.f=g,f.a.push({timestamp:Date.now()/1E3,id:g.id,trackId:g.track.id,type:g.track.type,fromAdaptation:d,width:g.width,height:g.height,bandwidth:g.bandwidth}))}c.audio&&(Zs(e,c.audio),e=e.ma(),f.b!==e&&(f.b=e,f.a.push({timestamp:Date.now()/1E3,id:e.id,trackId:e.track.id,type:e.track.type,fromAdaptation:d,width:null,height:null,bandwidth:e.bandwidth})))}bt(a.F,b).variant=c};
mv=function(a,b,c,d){bt(a.F,b).text=c;if(b=a.getTrackManager())Zs(b,c),c=b.fa(),a=a.w.j,a.c!==c&&(a.c=c,a.a.push({timestamp:Date.now()/1E3,id:c.id,trackId:c.track.id,type:c.track.type,fromAdaptation:d,width:null,height:null,bandwidth:null}))};
Wu=function(a,b){for(var c=0;c<b.length;c++){for(var d=b[c],e=new Map,f=_.v(d.variants),g=f.next();!g.done;g=f.next())if(g=g.value,g.video&&g.video.closedCaptions){g=g.video;for(var h=_.v(g.closedCaptions.keys()),l=h.next();!l.done;l=h.next())if(l=l.value,!e.has(l)){var m={id:a.af++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:_.Ab,codecs:"",
kind:"caption",encrypted:!1,keyId:null,language:g.closedCaptions.get(l),label:null,type:_.k,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:g.roles,channelsCount:null,closedCaptions:null};e.set(l,m)}}e=_.v(e.values());for(f=e.next();!f.done;f=e.next())d.textStreams.push(f.value)}};
Pu=function(a,b){var c=a.b?Pt(a.b):null,d=a.b?Qt(a.b):null;b.forEach(ps.bind(null,a.h,c,d));c=Gr(b,function(e){return e.variants.some(ss)});if(0==c)throw new _.K(_.M,4,4032);if(c<b.length)throw new _.K(_.M,4,4011);b.forEach(function(e){ms(e.variants,a.a.restrictions,a.Ye)&&a.b&&hv(a)==e&&fv(a);rv(a,e.variants)})};pv=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?0:d;a.C?(a.M=b,a.Xe=c,a.Ve=d):Xt(a.b,b,c,d)};nv=function(a,b){a.C?a.I=b:_.Wt(a.b,b,!0,0)};
ev=function(a,b){function c(g,h){if(!g)return null;var l=g.findSegmentPosition(h-f.startTime);return null==l?null:(l=g.getSegmentReference(l))?l.startTime+f.startTime:null}var d=Pt(a.b),e=Qt(a.b),f=hv(a);d=c(d,b);e=c(e,b);return null!=e&&null!=d?Math.max(e,d):null!=e?e:null!=d?d:b};Mu=function(a){var b=a.A?a.A.getState()===lt:!1;if(a.w&&a.A&&a.m){var c=a.hc;c.f=b;qt(c);Vu(a)}};Vu=function(a){a.f&&a.f.ended?Fu(a,_.Em):a.A&&a.A.getState()===lt?Fu(a,_.Cm):a.f&&a.f.paused?Fu(a,_.Jm):Fu(a,_.el)};
iv=function(a,b){try{rv(a,b)}catch(e){return a.onError(e),null}var c=b.filter(function(e){return ss(e)});c=Bs(c,a.Jc);var d=a.Ia.create(c);a.g.setVariants(Array.from(d.values()));if(a.a.abr.enabled||null===a.S)return a.g.chooseVariant();c=c.find(function(e){return null!==e.video&&e.video.id===a.S});return c?c:(a.log.warn("Selected video track not found. Falling back to ABR selection"),a.g.chooseVariant())};
qv=function(a,b){var c=iv(a,b.variants);a.Jc=c&&c.audio&&c.audio.id;c&&(ov(a,b,c,!0),pv(a,c,!0));(c=_.vs(b.textStreams,a.la,a.fc)[0]||null)&&(a.a.streaming.alwaysStreamText||Ws(a))&&(mv(a,b,c,!0),nv(a,c));gv(a)};
uv=function(a,b){a.C=!0;a.g.disable();a.log.debug("Choosing new streams after period changed");var c=iv(a,b.variants),d=_.vs(b.textStreams,a.la,a.fc)[0]||null;a.M&&(b.variants.includes(a.M)&&(c=a.M),a.M=null);a.I&&(b.textStreams.includes(a.I)&&(d=a.I),a.I=null);c&&a.ic.push(function(){return ov(a,b,c,!0)});d&&a.ic.push(function(){return mv(a,b,d,!0)});b===hv(a)&&sv(a);var e=!Nt(a.b),f=c?c.audio:null;e&&d&&(f&&tv(a,f,d)&&(a.gc=!0),a.gc&&a.v.h.setTextVisibility(!0));return a.a.streaming.alwaysStreamText||
Ws(a)?{variant:c,text:d}:{variant:c,text:null}};tv=function(a,b,c){a=_.vl(a.a.preferredTextLanguage);b=_.vl(b.language);c=_.vl(c.language);return Ir(c,a)&&!Ir(b,c)};Zu=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?0:d;if(a.a.abr.enabled){a.log.debug("switch_");a:{var e=_.v(a.c.periods);for(var f=e.next();!f.done;f=e.next())if(f=f.value,f.variants.includes(b)){e=f;break a}e=null}ov(a,e,b,!0);a.b&&(Xt(a.b,b,c,d),gv(a))}};
gv=function(a){var b=a.getTrackManager();b=b&&b.V();a.trigger(new _.I(_.ae,{details:{width:b&&b.width||0,height:b&&b.height||0,bandwidth:b&&b.bandwidth,track:b&&b.track,abrSelection:!0}}))};fv=function(a){var b=a.getTrackManager();b&&a.o!=Gu&&(b.a&&(Ys(b),b.a.trigger(new _.I(_.Nd))),sv(a))};sv=function(a){for(;a.ic.length;)a.ic.shift()()};Ou=function(a,b,c){a.trigger(new _.I(b,{detail:{schemeIdUri:c.schemeIdUri,value:c.value,startTime:c.startTime,endTime:c.endTime,id:c.id,eventElement:c.eventElement}}))};
Su=function(a,b){if(a.b){var c=hv(a),d=!1,e=Object.keys(b);0==e.length&&a.log.warn("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var f=1==e.length&&"00"==e[0];f&&a.log.warn("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");e.length&&c.variants.forEach(function(h){xs(h).forEach(function(l){var m=
h.allowedByKeySystem;l.keyId&&(l=b[f?"00":l.keyId],h.allowedByKeySystem=!!l&&!vv.includes(l));m!=h.allowedByKeySystem&&(d=!0)})});e=Pt(a.b);var g=Qt(a.b);(e=ws(e,g,c.variants))&&!e.allowedByKeySystem&&(a.log.debug("Choosing new streams after key status changed"),qv(a,c));d&&(fv(a),iv(a,c.variants))}};
rv=function(a,b){var c=a.h?_.J.he(a.h.S):{},d=Object.keys(c);d=d.length&&"00"==d[0];for(var e=!1,f=!1,g=[],h=[],l=_.v(b),m=l.next();!m.done;m=l.next()){m=m.value;var n=[];m.audio&&n.push(m.audio);m.video&&n.push(m.video);n=_.v(n);for(var p=n.next();!p.done;p=n.next())if(p=p.value,p.keyId){var q=c[d?"00":p.keyId];q?vv.includes(q)&&(h.includes(q)||h.push(q)):g.includes(p.keyId)||g.push(p.keyId)}m.allowedByApplication?m.allowedByKeySystem&&(e=!0):f=!0}if(!e)throw new _.K(_.M,4,4012,{hasAppRestrictions:f,
missingKeys:g,restrictedKeyStatuses:h});};lv=function(a){a=hv(a);return null==a?[]:a.variants.filter(function(b){return ss(b)})};wv=function(a){var b=hv(a);return null==b?[]:b.textStreams.filter(function(c){return!a.Kc.has(c)})};hv=function(a){var b=Kt(a.m),c=null;a=_.v(a.c.periods);for(var d=a.next();!d.done;d=a.next())d=d.value,d.startTime<=b&&(c=d);return c};kv=function(a){var b=hv(a);return bt(a.F,b).variant};xv=function(){this.name=fr};
yv=function(){var a=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];c=a.apply(this,c);c.abort=function(){};return c}};zv=function(){var a=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(b,c){return a.call(this,b,c-.001)}};Av=function(){var a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(b){return"mp2t"==b.split(/ *; */)[0].split("/")[1].toLowerCase()?!1:a(b)}};
Bv=function(){var a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(b){return"opus"!=_.qi(b)[0]&&a(b)}};
Cv=function(){var a=MediaSource.isTypeSupported,b=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(c){var d=c.split(/ *; */),e=d.shift(),f={};d=_.v(d);for(var g=d.next();!g.done;g=d.next())g=g.value.split("\x3d"),f[g[0]]=g[1].replace(/"(.*)"/,"$1");d=f.codecs;if(!d)return a(c);var h=!1,l=!1;c=d.split(",").filter(function(n){b.test(n)&&(l=!0);/^(hev|hvc)1\.2/.test(n)&&(h=!0);return!0});l&&(h=!1);f.codecs=c.join(",");h&&(f.eotf="smpte2084");for(var m in f)e+="; "+m+'\x3d"'+f[m]+'"';return cast.__platform__.canDisplayType(e)}};
Ev=function(a){var b=Dv;return b?b+a.charAt(0).toUpperCase()+a.slice(1):a};Gv=function(a,b){_.F("PatchedMediaKeysWebkit.requestMediaKeySystemAccess");try{var c=new Fv(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}};Iv=function(a){_.F("PatchedMediaKeysWebkit.setMediaKeys");var b=this.mediaKeys;b&&b!==a&&Hv(b,null);delete this.mediaKeys;(this.mediaKeys=a)&&Hv(a,this);return Promise.resolve()};
Fv=function(a,b){_.F("PatchedMediaKeysWebkit.MediaKeySystemAccess");this.a=this.keySystem=a;var c=!1;a===_.dd&&(this.a=nr,c=!1);var d=!1;var e=document.getElementsByTagName(_.Xd);e=e.length?e[0]:document.createElement(_.Xd);for(var f=0;f<b.length;++f){var g=b[f],h={audioCapabilities:[],videoCapabilities:[],persistentState:_.cd,distinctiveIdentifier:_.cd,initDataTypes:g.initDataTypes,sessionTypes:[_.Ed],label:g.label},l=!1;if(g.audioCapabilities)for(var m=0;m<g.audioCapabilities.length;++m){var n=
g.audioCapabilities[m];n.contentType&&(l=!0,e.canPlayType(n.contentType.split(";")[0],this.a)&&(h.audioCapabilities.push(n),d=!0))}if(g.videoCapabilities)for(m=0;m<g.videoCapabilities.length;++m)n=g.videoCapabilities[m],n.contentType&&(l=!0,e.canPlayType(n.contentType,this.a)&&(h.videoCapabilities.push(n),d=!0));l||(d=e.canPlayType(_.Zd,this.a)||e.canPlayType("video/webm",this.a));g.persistentState===_.rd&&(c?(h.persistentState=_.rd,h.sessionTypes=[_.id]):d=!1);if(d){this.b=h;return}}c=_.Xa;if(a===
_.dd||a===_.lc)c="None of the requested configurations were supported.";c=Error(c);c.name=_.Fa;c.code=DOMException.NOT_SUPPORTED_ERR;throw c;};Jv=function(a){_.F("PatchedMediaKeysWebkit.MediaKeys");this.g=a;this.b=null;this.a=new _.Xe;this.c=[];this.f={}};Hv=function(a,b){a.b=b;_.$e(a.a);var c=Dv;b&&(a.a.on(b,c+"needkey",a.Ci.bind(a)),a.a.on(b,c+"keymessage",a.Og.bind(a)),a.a.on(b,c+"keyadded",a.Mg.bind(a)),a.a.on(b,c+"keyerror",a.Ng.bind(a)))};
Kv=function(a,b){var c=a.f[b];return c?(_.F($q,c),c):(c=a.c.shift())?(c.sessionId=b,a.f[b]=c,_.F($q,c),c):null};Mv=function(a,b,c){_.F("PatchedMediaKeysWebkit.MediaKeySession");Ds.call(this);this.f=a;this.i=!1;this.a=this.b=null;this.c=b;this.g=c;this.sessionId="";this.expiration=NaN;this.closed=new _.Of;this.keyStatuses=new Lv};
Nv=function(a,b,c){if(a.i)return Promise.reject(Error("The session is already initialized."));a.i=!0;try{if(a.g===_.id)if(c)var d=_.uf("LOAD_SESSION|"+c);else{var e=_.uf("PERSISTENT|"),f=new Uint8Array(e.byteLength+b.byteLength);f.set(e,0);f.set(_.N(b),e.byteLength);d=f}else d=_.N(b)}catch(h){return Promise.reject(h)}a.b=new _.Of;var g=Ev("generateKeyRequest");try{a.f[g](a.c,d)}catch(h){if("InvalidStateError"!==h.name)return a.b=null,Promise.reject(h);(new _.sg(function(){try{a.f[g](a.c,d)}catch(l){a.b.reject(l),
a.b=null}})).P(.01)}return a.b};Ov=function(a,b){var c=a.keyStatuses;c.size=void 0===b?0:1;c.a=b;a.dispatchEvent(new Cs(_.Ic))};Lv=function(){this.size=0;this.a=void 0};Qv=function(a,b){_.F("PatchedMediaKeysMs.requestMediaKeySystemAccess");try{var c=new Pv(a,b);return Promise.resolve(c)}catch(d){return Promise.reject(d)}};
Pv=function(a,b){_.F("PatchedMediaKeysMs.MediaKeySystemAccess");this.keySystem=a;for(var c=!1,d=0;d<b.length;++d){var e=b[d],f={audioCapabilities:[],videoCapabilities:[],persistentState:_.cd,distinctiveIdentifier:_.cd,initDataTypes:e.initDataTypes,sessionTypes:[_.Ed],label:e.label},g=!1;if(e.audioCapabilities)for(var h=0;h<e.audioCapabilities.length;++h){var l=e.audioCapabilities[h];l.contentType&&(g=!0,MSMediaKeys.isTypeSupported(this.keySystem,l.contentType.split(";")[0])&&(f.audioCapabilities.push(l),
c=!0))}if(e.videoCapabilities)for(h=0;h<e.videoCapabilities.length;++h)l=e.videoCapabilities[h],l.contentType&&(g=!0,MSMediaKeys.isTypeSupported(this.keySystem,l.contentType.split(";")[0])&&(f.videoCapabilities.push(l),c=!0));g||(c=MSMediaKeys.isTypeSupported(this.keySystem,_.Zd));e.persistentState==_.rd&&(c=!1);if(c){this.a=f;return}}c=Error(_.Xa);c.name=_.Fa;c.code=DOMException.NOT_SUPPORTED_ERR;throw c;};
Sv=function(a){_.F("PatchedMediaKeysMs.setMediaKeys");var b=this.mediaKeys;b&&b!=a&&Rv(b,null);delete this.mediaKeys;return(this.mediaKeys=a)?Rv(a,this):Promise.resolve()};Tv=function(a){_.F("PatchedMediaKeysMs.MediaKeys");this.a=new MSMediaKeys(a);this.b=new _.Xe};Rv=function(a,b){function c(){b.msSetMediaKeys(d.a);b.removeEventListener(_.Pc,c)}_.$e(a.b);if(!b)return Promise.resolve();a.b.on(b,"msneedkey",Uv);var d=a;try{return 1<=b.readyState?b.msSetMediaKeys(a.a):b.addEventListener(_.Pc,c),Promise.resolve()}catch(e){return Promise.reject(e)}};
Wv=function(a){_.F("PatchedMediaKeysMs.MediaKeySession");Ds.call(this);this.c=null;this.g=a;this.b=this.a=null;this.f=new _.Xe;this.sessionId="";this.expiration=NaN;this.closed=new _.Of;this.keyStatuses=new Vv};Uv=function(a){_.F("PatchedMediaKeysMs.onMsNeedKey_",a);if(a.initData){var b=document.createEvent("CustomEvent");b.initCustomEvent(_.wc,!1,!1,null);b.initDataType=_.Zb;b.initData=Xv(a.initData);this.dispatchEvent(b)}};
Xv=function(a){if(!a)return a;var b=new _.xi(a);if(1>=b.a.length)return a;for(var c=[],d=0;d<b.a.length;d++)c.push(a.subarray(b.a[d].start,b.a[d].end+1));a=[];b={};d=_.v(c);for(c=d.next();!c.done;b={Fc:b.Fc},c=d.next())b.Fc=c.value,a.some(function(e){return function(f){return _.gi(f,e.Fc)}}(b))||a.push(b.Fc);b=0;d=_.v(a);for(c=d.next();!c.done;c=d.next())b+=c.value.length;b=new Uint8Array(+b);d=0;a=_.v(a);for(c=a.next();!c.done;c=a.next())c=c.value,b.set(c,d),d+=c.length;return b};
Yv=function(a,b){var c=a.keyStatuses;c.size=void 0==b?0:1;c.a=b;a.dispatchEvent(new Cs(_.Ic))};Vv=function(){this.size=0;this.a=void 0};_.zr.prototype.track=function(a){null!=this.a&&(this.a&&(this.a.off(_.sd,this.c),this.f&&this.a.off(_.Md,this.c)),this.a=null);a&&(this.a=a,this.a.on(_.sd,this.c,this))};_.zr.prototype.clear=function(){this.b=[];Cr(this);this.a&&(this.a.trigger(new _.I(_.$d)),this.a.trigger(new _.I(_.Kb)))};
_.zr.prototype.c=function(){if(this.a){var a=this.a.getPosition();if(0<=a){a:{for(var b=this.b.length,c=Number.MAX_SAFE_INTEGER,d=0;d<b;d++){var e=this.b[d];c=Math.min(e.start,c);if(e.start<=a&&e.end>a){a=.1>e.end-a&&d<b-1?this.b[d+1].rendition:e.rendition;break a}if(e.start>a)break}a=0<b&&c>a&&.25>c-a?this.b[0].rendition:null}if(a&&this.g!==a&&(this.g=a,this.a)){c=b=-1;if(a)b=a.width||-1,c=a.height||-1;else if(d=this.a.getSurface().D())b=d.videoWidth,c=d.videoHeight;this.a.trigger(new _.I(_.Rb,{detail:{width:b,
height:c,bandwidth:a?a.bandwidth:null,rendition:a}}))}}}};Lr.prototype.release=function(){this.b=function(){};this.a.clear()};Or.prototype.release=function(){this.c.stop();for(var a=_.v(this.a),b=a.next();!b.done;b=a.next())b.value.release();this.a.clear()};Pr.prototype.release=function(){this.g=null;this.f.clear();this.a=function(){};this.b=function(){};this.c=function(){}};
Pr.prototype.h=function(a,b){for(var c={},d=_.v(this.g.a),e=d.next();!e.done;c={nd:c.nd,Ec:c.Ec},e=d.next()){e=e.value;c.nd=this.f.get(e)||null;c.Ec=a<e.startTime?1:a>e.endTime?3:2;this.f.set(e,c.Ec);var f=this.i.find(function(g){return function(h){return h.Lb===g.nd&&h.Kb===g.Ec}}(c));f&&f.vb(e,b)}};Rr.prototype.init=function(a){var b=muxjs.mp4.probe;a=_.N(a);this.g=b.videoTrackIds(a);this.f=b.timescale(a);this.a.init()};
Rr.prototype.c=function(a,b){var c=_.N(a);(c=this.a.parse(c,this.g,this.f))&&c.captions&&b(c.captions);this.a.clearParsedCaptions()};Rr.prototype.b=function(){this.a.resetCaptionStream()};_.Sr.prototype.init=function(){};_.Sr.prototype.c=function(){};_.Sr.prototype.b=function(){};Tr.prototype.destroy=function(){this.a.dispose();this.a=null;return Promise.resolve()};Tr.prototype.j=function(a){this.c=a.captions;var b=new Uint8Array(a.data.byteLength+a.initSegment.byteLength);b.set(a.initSegment,0);b.set(a.data,a.initSegment.byteLength);a.type===_.Xd?this.h.push(b):a.type===_.Ib&&this.g.push(b)};Tr.prototype.i=function(){var a={video:_.hi.apply(null,this.h),captions:this.c,audio:_.hi.apply(null,this.g)};this.b.resolve(a);this.f=!1};_.r=_.Zr.prototype;
_.r.destroy=function(){var a=this;this.w=!0;var b=[],c;for(c in this.f){var d=this.f[c],e=d[0];this.f[c]=d.slice(0,1);e&&b.push(e.p["catch"](_.mi.xc));for(e=1;e<d.length;++e)d[e].p["catch"](_.mi.xc),d[e].p.reject()}this.b&&b.push(this.b.destroy());this.h&&b.push(this.h.destroy());for(var f in this.l)b.push(this.l[f].destroy());return Promise.all(b).then(function(){a.j&&(a.j.release(),a.j=null);a.g&&(a.g.removeAttribute("src"),a.g.load(),a.g=null);a.i=null;a.b=null;a.h=null;a.c={};a.l={};a.o={};a.u=
null;a.A=!1;a.f={}})};_.r.init=function(a,b){var c=this,d;return _.z(function(e){if(1==e.a)return d=_.ok,_.x(e,c.v,2);a.forEach(function(f,g){var h=_.pi(f.mimeType,f.codecs);if(g==d.TEXT)bs(c,h);else{var l=[h];!b&&MediaSource.isTypeSupported(h)||!Vr(h,g)||(c.l[g]=new Tr,h="aac"==h.split(";")[0].split("/")[1]?h.replace("aac",_.Vc):Ur(g,h),l=Wr(h));as(c,l)}});_.y(e)})};_.r.Ja=function(a){return a===_.k?this.b.Ja():(a=cs(this,a))?a.Ja():null};
_.r.aa=function(a){return a===_.k?this.b.aa():(a=cs(this,a))?a.aa():null};_.r.xb=function(a,b,c){return a===_.k?this.b.xb(b):(a=cs(this,a))?a.xb(b,!0,c):!1};_.r.sa=function(a,b){if(a===_.k)return this.b.sa(b);var c=cs(this,a);return c?c.sa(b):0};_.r.hd=function(a){var b=this.aa(_.Xd)||0;this.b.hd(a,b)};
_.r.remove=function(a,b,c){var d=this;return a===_.k?this.b.remove(b,c):es(this,a,this.vf.bind(this,a,b,c)).then(function(){if(a===_.Xd){var e=d.Ja(a),f=d.aa(a);null!==e&&null!==f&&Er(d.m,e,f)}else a===_.Ib&&(e=d.m,e.a&&e.a.trigger(new _.I(_.Kb)))})};_.r.clear=function(a){if(a==_.k){if(!this.b)return Promise.resolve();this.u.b();return this.b.remove(0,Infinity)}return es(this,a,this.vf.bind(this,a,0,this.i.duration))};
_.r.flush=function(a){return a==_.k?Promise.resolve():es(this,a,this.Te.bind(this,a))};_.r.endOfStream=function(a){var b=this;return ks(this,function(){a?b.i.endOfStream(a):b.i.endOfStream()})};_.r.bb=function(a){var b=this;ks(this,function(){b.i.duration=a})};_.r.getDuration=function(){return this.i.duration};
_.r.ud=function(a,b){this.a.debug("Appending data to "+a+Tq);try{this.c[a].appendBuffer(b)}catch(c){throw this.a.warn("Failed to append data for "+a,c),c;}this.a.debug("Done Appending data to "+a+Tq)};_.r.vf=function(a,b,c){if(c<=b)this.$b(a);else{this.a.debug("Removing data from "+a+" range:",b,c);try{this.c[a].remove(b,c)}catch(d){throw this.a.warn("Failed to remove data from "+a+" buffer. Range:",b,c,d),d;}this.a.debug("Done Removing data from "+a+" range:",b,c)}};
_.r.Ef=function(a){try{this.a.debug("Aborting operations for "+a+Tq);var b=this.c[a].appendWindowStart,c=this.c[a].appendWindowEnd;this.c[a].abort();this.c[a].appendWindowStart=b;this.c[a].appendWindowEnd=c}catch(d){throw this.a.warn("Failed to abort operations for "+a+Tq,d),d;}this.a.debug("Done Aborting operations for "+a+Tq);this.$b(a)};
_.r.Te=function(a){try{this.g.readyState>HTMLMediaElement.HAVE_NOTHING?(this.a.debug("Flushing buffer for "+a),this.g.currentTime-=.001):this.a.warn("Skip buffer flush for "+a+" with element state: "+this.g.readyState)}catch(b){throw this.a.warn("Failed to flush buffer for "+a,b),b;}this.a.debug("Done Flushing buffer for "+a);this.$b(a)};
_.r.yf=function(a,b){0>b&&(b+=.001);try{this.a.debug("Setting timestamp offset for "+a,b),this.c[a].timestampOffset=b}catch(c){throw this.a.warn("Failed to set timestamp offset for "+a,b,c),c;}this.a.debug("Done Setting timestamp offset for "+a,b);this.$b(a)};
_.r.Pi=function(a,b,c){try{this.a.debug("Setting append window for "+a,b,c),this.c[a].appendWindowStart=0,this.c[a].appendWindowEnd=c,this.c[a].appendWindowStart=b}catch(d){throw this.a.warn("Failed to set append window for "+a,b,c,d),d;}this.a.debug("Done Setting append window for "+a,b,c);this.$b(a)};_.r.Lg=function(a){this.f[a][0].p.reject(new _.K(_.M,3,3014,{mediaError:this.g.error?this.g.error.code:0}))};
_.r.$b=function(a){var b=this.f[a][0];b&&(b.p.resolve(),this.a.debug("Update-End received for "+a),js(this,a))};var Yr=window.URL.createObjectURL;Cs.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)};Cs.prototype.stopImmediatePropagation=function(){this.a=!0};Cs.prototype.stopPropagation=function(){};Ds.prototype.addEventListener=function(a,b){this.h.push(a,b)};Ds.prototype.removeEventListener=function(a,b){this.h.remove(a,b)};Ds.prototype.dispatchEvent=function(a){for(var b=this.h.get(a.type)||[],c=0;c<b.length;++c){a.target=this.j;a.currentTarget=this.j;var d=b[c];try{d.handleEvent?d.handleEvent(a):d.call(this,a)}catch(e){_.Te("Uncaught exception in event handler",e,e?e.message:null,e?e.stack:null)}if(a.a)break}return a.defaultPrevented};_.r=_.Is.prototype;_.r.stop=function(){this.i=null;this.f=!1;this.g=[];this.h=null};_.r.init=function(a){this.i=a};
_.r.chooseVariant=function(){var a=Js(this.a.restrictions,this.g),b=Hs(this.c,this.a.defaultBandwidthEstimate);this.g.length&&!a.length&&(this.b.warn("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),a=Js(null,this.g),a=[a[0]]);for(var c=a[0]||null,d=0;d<a.length;++d){var e=a[d],f=e.bandwidth/this.a.bandwidthDowngradeTarget,g=(a[d+1]||{bandwidth:Infinity}).bandwidth/this.a.bandwidthUpgradeTarget;this.b.debug("Bandwidth ranges:",(e.bandwidth/1E6).toFixed(3),(f/1E6).toFixed(3),
(g/1E6).toFixed(3));b>=f&&b<=g&&(c=e)}this.h=Date.now();return c};_.r.enable=function(){this.f=!0};_.r.disable=function(){this.f=!1};
_.r.segmentDownloaded=function(a,b){this.b.debug("Segment downloaded:","deltaTimeMs\x3d"+a,"numBytes\x3d"+b,"lastTimeChosenMs\x3d"+this.h,"enabled\x3d"+this.f);var c=this.c;if(!(16E3>b)){var d=8E3*b/a,e=a/1E3;c.a+=b;_.sl(c.b,e,d);_.sl(c.c,e,d)}if(null!=this.h&&this.f)a:{this.b.debug("Suggesting Streams...");if(!this.j){if(!(128E3<=this.c.a)){this.b.debug("Still waiting for a good estimate...");break a}this.j=!0}else if(Date.now()-this.h<1E3*this.a.switchInterval){this.b.debug("Still within switch interval...");
break a}c=this.chooseVariant();this.b.debug("Calling switch_(), bandwidth\x3d"+Math.round(Hs(this.c,this.a.defaultBandwidthEstimate)/1E3)+" kbps");this.i(c)}};_.r.getBandwidthEstimate=function(){return Hs(this.c,this.a.defaultBandwidthEstimate)};_.r.setVariants=function(a){this.g=a};_.r.configure=function(a){this.a=a};_.w(Ks,_.U);_.r=Ks.prototype;_.r.Sa=function(a){this.a=a};_.r.release=function(){this.g=[];this.b.clear();this.c.clear()};_.r.load=function(){};_.r.destroy=function(){this.release();this.a=null};_.r.getVideoTracks=function(){return Ls(this,_.qj)};_.r.getAudioTracks=function(){return Ls(this,_.S)};_.r.U=function(){return Ls(this,_.R)};_.r.V=function(){return this.b.get(_.qj)||null};_.r.ma=function(){return this.b.get(_.S)||null};_.r.fa=function(){return this.b.get(_.R)||null};
_.r.Ca=function(){return this.c.get(_.qj)||null};_.r.Aa=function(){return this.c.get(_.S)||null};_.r.Ba=function(){return this.c.get(_.R)||null};_.r.ga=function(){return Ms(this,_.qj)};_.r.ba=function(){return Ms(this,_.S)};_.r.ca=function(){return Ms(this,_.R)};_.r.ya=function(a){Os(this,_.qj,a)};_.r.ia=function(a){Os(this,_.S,a)};_.r.ja=function(a){Os(this,_.R,a)};_.r.xa=function(a,b){Ns(this,_.qj,a,void 0===b?!1:b)};_.r.Ea=function(a,b){Ns(this,_.S,a,void 0===b?!1:b)};
_.r.Fa=function(a,b){Ns(this,_.R,a,void 0===b?!1:b)};_.r.addTextTrack=function(a){var b=this;return _.z(function(c){b.a?c=_.x(c,b.a.addTextTrack(a.url,a.language,a.kind,a.mimeType,a.codec,a.label),0):(c.a=0,c=void 0);return c})};_.r.na=function(){return!!this.a&&this.a.na()};Ks.prototype.isAbrEnabled=Ks.prototype.na;Ks.prototype.addTextTrack=Ks.prototype.addTextTrack;Ks.prototype.setTextRendition=Ks.prototype.Fa;Ks.prototype.setAudioRendition=Ks.prototype.Ea;Ks.prototype.setVideoRendition=Ks.prototype.xa;
Ks.prototype.setTextTrack=Ks.prototype.ja;Ks.prototype.setAudioTrack=Ks.prototype.ia;Ks.prototype.setVideoTrack=Ks.prototype.ya;Ks.prototype.getTextTrack=Ks.prototype.ca;Ks.prototype.getAudioTrack=Ks.prototype.ba;Ks.prototype.getVideoTrack=Ks.prototype.ga;Ks.prototype.getLoadingTextRendition=Ks.prototype.Ba;Ks.prototype.getLoadingAudioRendition=Ks.prototype.Aa;Ks.prototype.getLoadingVideoRendition=Ks.prototype.Ca;Ks.prototype.getTextRendition=Ks.prototype.fa;Ks.prototype.getAudioRendition=Ks.prototype.ma;
Ks.prototype.getVideoRendition=Ks.prototype.V;Ks.prototype.getTextTracks=Ks.prototype.U;Ks.prototype.getAudioTracks=Ks.prototype.getAudioTracks;Ks.prototype.getVideoTracks=Ks.prototype.getVideoTracks;$s.prototype.clear=function(){this.a.clear()};ct.prototype.add=function(a){if(ft(this.b,a))return this.a.add(a),!0;_.C("Rejecting variant - not compatible with root.");return!1};ct.prototype.values=function(){return this.a.values()};ht.prototype.create=function(a){var b=this,c=a.filter(function(d){return ft(b.a,d)});return c.length?new ct(c[0],c):this.b.create(a)};
gt.prototype.create=function(a){var b=[];b=it(a,this.c);var c=a.filter(function(d){return d.primary});b=b.length?b:c.length?c:a;this.b&&(a=jt(b,this.b),a.length?b=a:_.C("No exact match for variant role could be found."));this.a&&(a=ts(b,this.a),a.length?b=a:_.C("No exact match for the channel count could be found."));a=new ct(b[0]);b=_.v(b);for(c=b.next();!c.done;c=b.next())c=c.value,ft(a.b,c)&&a.add(c);return a};mt.prototype.getState=function(){return this.a};var lt=0,kt=1;nt.prototype.release=function(){this.a=this.c=null;this.b=function(){}};nt.prototype.h=function(a){var b=this.a,c=this.c.periods;a=Fs(c,a)||c[0];b!=a&&this.b(a);this.a=a};pt.prototype.release=function(){this.b&&(this.b.stop(),this.b=null);this.a=null};pt.prototype.set=function(a){this.c=a;qt(this)};st.prototype.release=function(){this.c=null;this.a=function(){}};wt.prototype.release=function(){this.c&&(this.c.release(),this.c=null);null!=this.g&&(this.g.stop(),this.g=null);this.b&&(this.b.release(),this.b=null);this.a=this.m=this.l=null};wt.prototype.Zc=function(){this.h=!0;vt(this)};At.prototype.release=function(){this.b&&(this.b.release(),this.b=null);null!=this.c&&(this.c.release(),this.c=null);this.f=function(){};this.a=null};xt.prototype.release=function(){this.a&&(this.a.stop(),this.a=null);this.b=null};It.prototype.release=function(){this.f&&(this.f.release(),this.f=null);this.g&&(this.g.release(),this.g=null);this.i&&(this.i.stop(),this.i=null);this.c=this.f=this.a=this.h=null;this.l=function(){}};_.Mt.prototype.destroy=function(){for(var a=_.v(this.f.values()),b=a.next();!b.done;b=a.next())cu(b.value);this.f.clear();this.j.clear();this.h=this.i=this.v=this.c=this.b=null;this.g=!0;return Promise.resolve()};
_.Mt.prototype.start=function(){var a=this,b,c,d;return _.z(function(e){if(1==e.a){b=a.b.Ka();c=St(a,b);d=a.b.Rd(a.c.periods[c]);if(!d.variant&&!d.text)throw a.a.error("init: no Streams chosen"),new _.K(_.M,5,5005);a.u=!d.variant&&!!d.text;return _.x(e,hu(a,d.variant?d.variant.audio:null,d.variant?d.variant.video:null,d.text,b),2)}if(a.g)return e["return"]();a.a.debug("init: completed initial Stream setup");a.b&&a.b.ni&&(a.a.debug("init: calling onInitialStreamsSetup()..."),a.b.ni());_.y(e)})};
_.Mt.prototype.C=function(a,b,c,d){var e=or(d.s),f=or(d.s),g=_.Yh(d.s),h=_.Yh(d.s),l=_.Yh(d.s),m=_.Yh(d.s);d=_.ai(d.s,d.s.ea()-d.s.getPosition());a=a.startTime+b.startTime+h/g;if(c.includes(e))if("urn:mpeg:dash:event:2012"==e)this.b.jf();else this.b.onEvent(new Cs("emsg",{detail:{startTime:a,endTime:a+l/g,schemeIdUri:e,value:f,timescale:g,presentationTimeDelta:h,eventDuration:l,id:m,messageData:d}}))};
_.Mt.prototype.F=function(a){var b=this,c=!1,d=0;(new _.ri).G("moov",_.si).G("trak",_.si).G("mdia",_.si).G("minf",_.si).G("stbl",_.si).T("stsd",_.ti).G("encv",function(e){e.s.skip(78);_.si(e)}).G("pasp",function(e){d=e.start+e.Ed;var f=_.Yh(e.s),g=_.Yh(e.s);c=f!==g;b.a.debug("hSpacing\x3d"+f+", vSpacing\x3d"+g+", updatePASP\x3d"+c);e.Pa.stop()}).parse(a.data);c&&(a=new _.Qh(new DataView(a.data)),a.seek(d),_.P(a,1),_.P(a,1))};_.r=yu.prototype;_.r.remove=function(a,b){if(!this.a)return!1;Au(this.a,function(c){return c.startTime<b&&c.endTime>a});return!0};_.r.append=function(a){for(var b=this,c=[],d=0;d<a.length;d++){var e=zu(a[d]);e&&c.push(e)}c.slice().sort(function(f,g){return f.startTime!=g.startTime?f.startTime-g.startTime:f.endTime!=g.endTime?f.endTime-g.startTime:c.indexOf(g)-c.indexOf(f)}).forEach(function(f){b.a.addCue(f)})};_.r.destroy=function(){this.a&&Au(this.a,function(){return!0});this.a=null;return Promise.resolve()};
_.r.isTextVisible=function(){return this.a.mode==_.wd};_.r.setTextVisibility=function(a){this.a.mode=a?_.wd:_.Ec};_.w(Du,_.Pg);_.r=Du.prototype;_.r.init=function(a,b){var c=a.D();_.Pg.prototype.init.call(this,a,b);Ju(this,c)};_.r.namespace=function(){return fr};_.r.Ie=function(){return new Ks};_.r.getState=function(){return this.R};_.r.getDrmInfo=function(){return this.h?this.h.getDrmInfo():null};
_.r.unload=function(){var a=this;if(this.j){var b=this.getTrackManager();b&&b.release();if(this.o==Gu)return Promise.resolve();b=this.getSurface().D();b.removeEventListener(_.vd,this.Pe);b.removeEventListener(_.ud,this.Ne);return Lu(this).then(function(){a.log.debug(_.Na,a.j);a.j=null;a.od=0;a.Jc=null;a.S=null})}return Promise.resolve()};_.r.release=function(){var a=this;return this.unload().then(function(){return Fu(a,_.ym)})};
_.r.getBufferInfo=function(a){if(this.v){var b=ds(this.v),c=new _.Le(void 0,a);switch(a){case _.qj:return b.video?b.video:c;case _.S:return b.audio?b.audio:c;case _.R:return b.text?b.text:c}return b.total?b.total:c}return this.jc?(b=Ar(this.jc),wr(b,a)):_.Pg.prototype.getBufferInfo.call(this,a)};_.r.getPosition=function(){return this.m?Kt(this.m):_.Pg.prototype.getPosition.call(this)};_.r.getPresentationStartTime=function(){return this.c?this.c.presentationTimeline.getPresentationStartTime()||0:0};
_.r.getDuration=function(){return this.c?this.c.presentationTimeline.getDuration():Infinity};_.r.destroy=function(){var a=this;return _.z(function(b){if(1==b.a)return _.x(b,_.Pg.prototype.destroy.call(a),2);if(3!=b.a){if(a.o==Gu)return b["return"]();a.log.debug("Destroying player...");a.o=Gu;return _.x(b,Hu(a),3)}a.i&&(a.i.release(),a.i=null);a.g=null;_.y(b)})};
_.r.load=function(a){var b=this,c,d,e,f;return _.z(function(g){switch(g.a){case 1:if(b.o==Gu)return g["return"](Promise.reject(new _.K(_.M,7,7E3)));b.w=new _.hk;b.ld=Date.now()/1E3;Fu(b,_.Mn);b.j=_.Gk(a);_.Og(a)&&(b.a=_.Ng(b.Hc,a));b.log.info(_.va,b.a);b.log.info(_.Ga,b.j);(c=b.getTrackManager())&&c.load();d=b.getSurface().D();d.loop=!!b.a.loop;d.addEventListener(_.vd,b.Pe);d.addEventListener(_.ud,b.Ne);_.J.H(b.a.volume)||b.setVolume(b.a.volume);_.J.H(b.a.muted)||b.setMuted(b.a.muted);b.u&&b.u.configure(b.a.manifest);
b.h&&(b.h.c=_.rh(b.a.drm));if(b.b){b.b.h=b.a.streaming;try{b.c.periods.forEach(b.xd.bind(b))}catch(n){b.onError(n)}var h=Pt(b.b),l=Qt(b.b),m=hv(b);h=ws(h,l,m.variants);b.g&&h&&h.allowedByApplication&&h.allowedByKeySystem?iv(b,m.variants):(b.log.debug("Choosing new streams after changing configuration"),qv(b,m))}b.g&&(b.g.configure(b.a.abr),b.a.abr.enabled&&!b.C?b.g.enable():b.g.disable());e=b.j[b.getSourceIndex()];g.c=2;return _.x(g,Ju(b,d),4);case 4:return _.x(g,Ku(b,d),5);case 5:return _.x(g,Nu(b,
e),6);case 6:return _.x(g,Ru(b,e),7);case 7:return _.x(g,Tu(b),8);case 8:return _.x(g,jv(b),9);case 9:_.Be(g,0);break;case 2:f=_.Ce(g),b.onError(f),_.y(g)}})};_.r.isLive=function(){return this.c?this.c.presentationTimeline.isLive():!1};_.r.getSeekRange=function(){if(this.c){var a=this.c.presentationTimeline;return{start:ur(a,0),end:tr(a)}}return{start:0,end:0}};_.r.getPlaybackRate=function(){if(this.hc){var a=this.hc;a=a.f?0:a.c}else a=0;return a};
_.r.U=function(){if(this.c&&this.m){var a=hv(this);if(null==a)a=null;else{if(!bt(this.F,a).text){var b=_.vs(a.textStreams,this.la,this.fc);b.length&&(b=b[0],bt(this.F,a).text=b)}a=bt(this.F,a).text}b=[];for(var c=_.v(wv(this)),d=c.next();!d.done;d=c.next()){d=d.value;var e=rs(d);e.active=d==a;b.push(e)}return b}return[]};_.r.getThumbnailStreams=function(){if(this.c&&this.m){var a=hv(this);return a?a.thumbStreams:[]}return[]};
_.r.getStats=function(){if(this.o!=Cu)return _.ik();Vu(this);var a=this.f;if(a.getVideoPlaybackQuality){a=a.getVideoPlaybackQuality();var b=this.w,c=Number(a.totalVideoFrames);b.g=Number(a.droppedVideoFrames);b.f=c}if(this.o==Cu){if(a=kv(this))this.w.l=a.bandwidth;a&&a.video&&(b=this.w,c=a.video.height||NaN,b.c=a.video.width||NaN,b.b=c);a=this.g.getBandwidthEstimate();this.w.h=a}return this.w.getStats()};_.r.getTimelineCues=function(){return this.qa?Array.from(this.qa.a):[]};
_.r.addTextTrack=function(a,b,c,d,e,f){var g=this,h,l,m,n,p,q,t,u,A;return _.z(function(D){if(1==D.a){if(g.o!=Cu)throw g.log.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");h=hv(g);l=_.ok;m=g.c.periods.indexOf(h);n=m+1;p=n>=g.c.periods.length?g.c.presentationTimeline.getDuration():g.c.periods[n].startTime;q=p-h.startTime;if(Infinity==q)throw new _.K(1,4,4040);t=new _.kn(1,0,q,function(){return[a]},0,null);u={id:g.af++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),
findSegmentPosition:function(){return 1},getSegmentReference:function(G){return 1==G?t:null},adjustSegmentDurations:function(){},getDuration:function(){return q},initSegmentReference:null,presentationTimeOffset:0,mimeType:d,codecs:e||"",kind:c,encrypted:!1,keyId:null,language:b,label:f||null,type:l.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null};g.Kc.add(u);h.textStreams.push(u);return _.x(D,Vt(g.b,u),2)}if(A=_.Ot(g.b,_.k))bt(g.F,h).text=
A;g.Kc["delete"](u);g.log.debug("Choosing new streams after adding a text stream");qv(g,h);fv(g);return D["return"](rs(u))})};
_.r.xd=function(a){var b=this.b?Pt(this.b):null,c=this.b?Qt(this.b):null;ps(this.h,b,c,a);b=a.variants;if(!b.some(ss))throw new _.K(_.M,4,4011);rv(this,a.variants);ms(b,this.a.restrictions,this.Ye)&&this.b&&hv(this)==a&&fv(this);if(a=this.h?this.h.getDrmInfo():null)for(b=_.v(b),c=b.next();!c.done;c=b.next()){c=_.v(c.value.drmInfos);for(var d=c.next();!d.done;d=c.next())if(d=d.value,d.keySystem==a.keySystem){d=_.v(d.initData||[]);for(var e=d.next();!e.done;e=d.next())e=e.value,_.Qi(this.h,e.initDataType,
e.initData)}}};_.r.Kg=function(){this.ec=!0};_.r.Jg=function(){this.ec=!1};_.r.Hg=function(a){this.log.debug(_.hr,a);try{this.log.debug("onChooseStreams_, choosing variant from ",a.variants);this.log.debug("onChooseStreams_, choosing text from ",a.textStreams);var b=uv(this,a);this.log.debug("onChooseStreams_, chose variant ",b.variant);this.log.debug("onChooseStreams_, chose text ",b.text);return b}catch(c){return this.onError(c),{variant:null,text:null}}};
_.r.Gg=function(){this.log.debug("canSwitch_");this.C=!1;this.a.abr.enabled&&this.g.enable();this.M&&(Xt(this.b,this.M,this.Xe,this.Ve),this.M=null);this.I&&(_.Wt(this.b,this.I,!0,0),this.I=null)};_.r.Ig=function(){this.u&&this.u.update&&this.u.update()};_.r.wi=function(){this.m&&this.m.g.Zc()};_.r.onError=function(a){if(this.o!==Gu){var b=new _.I(_.zc,{detail:a});a.a===_.M&&Fu(this,_.qk);this.trigger(b);b.defaultPrevented&&(b.b=!0)}};
_.r.td=function(a){a.type===_.uc?this.dispatchEvent(new _.I(_.uc,{keySystem:this.h.keySystem(),qh:_.Ui(this.h)})):"largegap"!==a.type&&"emsg"!==a.type&&this.log.debug("Unhandled/ignored event",a.type)};_.r.na=function(){return this.a.abr.enabled};var Gu=0,Bu=1,Cu=2,vv=[ir,_.Hc];xv.prototype.canPlay=function(a){if(_.mg("CrKey"))return!1;var b=a.type||"",c=typeof a.Tb!==_.Sb||a.Tb;if(b===_.Ck&&c&&_.og())return!1;c=_.jg();a=_.Sn.da(a.url,b);return c&&a?!0:!1};xv.prototype.create=function(){return new Du};
xv.prototype.create=xv.prototype.create;xv.prototype.canPlay=xv.prototype.canPlay;_.gf(new xv);_.Ak(function(){_.F("MediaSource.install");if(window.MediaSource)if(window.cast&&cast.__platform__&&cast.__platform__.canDisplayType)_.Se("Patching Chromecast MSE bugs."),Cv();else if(_.og()){var a=navigator.appVersion;a=0<=a.indexOf("Version")?parseInt(a.match(/Version\/(\d+)/)[1],10):13;Av();10>=a?(_.Se("Blacklisting MSE on Safari \x3c\x3d 10."),window.MediaSource=null):12>=a?(_.Se("Patching Safari 11 \x26 12 MSE bugs."),yv(),zv()):(_.Se("Patching Safari 13 MSE bugs."),yv())}else _.ng(2)||_.ng(3)||
_.ng(4)?Bv():_.Se("Using native MSE as-is.");else _.Se("No MSE implementation available.")});var Dv="";Fv.prototype.createMediaKeys=function(){_.F("PatchedMediaKeysWebkit.MediaKeySystemAccess.createMediaKeys");var a=new Jv(this.a);return Promise.resolve(a)};Fv.prototype.getConfiguration=function(){_.F("PatchedMediaKeysWebkit.MediaKeySystemAccess.getConfiguration");return this.b};_.r=Jv.prototype;
_.r.createSession=function(a){_.F("PatchedMediaKeysWebkit.MediaKeys.createSession");a=a||_.Ed;if(a!==_.Ed&&a!==_.id)throw new TypeError(_.Sa+a+_.ba);var b=this.b||document.createElement(_.Xd);b.src||(b.src="about:blank");a=new Mv(b,this.g,a);this.c.push(a);return a};_.r.setServerCertificate=function(){_.F("PatchedMediaKeysWebkit.MediaKeys.setServerCertificate");return Promise.resolve(!1)};
_.r.Ci=function(a){_.F("PatchedMediaKeysWebkit.onWebkitNeedKey_",a);var b=document.createEvent("CustomEvent");b.initCustomEvent(_.wc,!1,!1,null);b.initDataType=_.ge;b.initData=a.initData;this.b.dispatchEvent(b)};
_.r.Og=function(a){_.F("PatchedMediaKeysWebkit.onWebkitKeyMessage_",a);var b=Kv(this,a.sessionId);b?(a=new Cs(_.Sc,{messageType:void 0===b.keyStatuses.a?"licenserequest":"licenserenewal",message:a.message}),_.F("PatchedMediaKeysWebkit.MediaKeySession.generated"),b.b&&(b.b.resolve(),b.b=null),b.dispatchEvent(a)):_.Te("Session not found",a.sessionId)};
_.r.Mg=function(a){_.F("PatchedMediaKeysWebkit.onWebkitKeyAdded_",a);if(a=Kv(this,a.sessionId))_.F("PatchedMediaKeysWebkit.MediaKeySession.ready"),Ov(a,_.Rd),a.a&&a.a.resolve(),a.a=null};
_.r.Ng=function(a){_.F("PatchedMediaKeysWebkit.onWebkitKeyError_",a);var b=Kv(this,a.sessionId);if(b){_.F("PatchedMediaKeysWebkit.MediaKeySession.handleError",a);var c=Error("EME v0.1b key error");c.errorCode=a.errorCode;c.errorCode.systemCode=a.systemCode;!a.sessionId&&b.b?(c.method="generateRequest",45===a.systemCode&&(c.message="Unsupported session type."),b.b.reject(c),b.b=null):a.sessionId&&b.a?(c.method="update",b.a.reject(c),b.a=null):(c=a.systemCode,a.errorCode.code===MediaKeyError.MEDIA_KEYERR_OUTPUT?
Ov(b,ir):1===c?Ov(b,"expired"):Ov(b,_.Hc))}};_.Ke(Mv,Ds);_.r=Mv.prototype;_.r.vd=function(a,b){if(this.a)this.a.then(this.vd.bind(this,a,b))["catch"](this.vd.bind(this,a,b));else{this.a=a;if(this.c===nr){var c=_.mf(b);var d=JSON.parse(c);"oct"!==d.keys[0].kty&&(this.a.reject(Error("Response is not a valid JSON Web Key Set.")),this.a=null);c=_.di(d.keys[0].k);d=_.di(d.keys[0].kid)}else c=_.N(b),d=null;var e=Ev("addKey");try{this.f[e](this.c,c,d,this.sessionId)}catch(f){this.a.reject(f),this.a=null}}};
_.r.generateRequest=function(a,b){_.F("PatchedMediaKeysWebkit.MediaKeySession.generateRequest");return Nv(this,b,null)};_.r.load=function(a){_.F("PatchedMediaKeysWebkit.MediaKeySession.load");return this.g===_.id?Nv(this,null,a):Promise.reject(Error(Zq))};_.r.update=function(a){_.F("PatchedMediaKeysWebkit.MediaKeySession.update",a);var b=new _.Of;this.vd(b,a);return b};
_.r.close=function(){_.F("PatchedMediaKeysWebkit.MediaKeySession.close");if(this.g!==_.id){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var a=Ev("cancelKeyRequest");try{this.f[a](this.c,this.sessionId)}catch(b){}}this.closed.resolve();return this.closed};_.r.remove=function(){_.F("PatchedMediaKeysWebkit.MediaKeySession.remove");return this.g!==_.id?Promise.reject(Error(Zq)):this.close()};var Zv;_.r=Lv.prototype;
_.r.forEach=function(a){this.a&&a(this.a,Zv)};_.r.get=function(a){if(this.has(a))return this.a};_.r.has=function(a){var b=Zv;return this.a&&_.gi(_.N(a),_.N(b))?!0:!1};_.r.entries=function(){};_.r.keys=function(){};_.r.values=function(){};
_.Ak(function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)_.Se("Using webkit-prefixed EME v0.1b"),Dv="webkit";else if(HTMLMediaElement.prototype.generateKeyRequest)_.Se("Using nonprefixed EME v0.1b");else return;Zv=(new Uint8Array([0])).buffer;navigator.requestMediaKeySystemAccess=Gv;delete HTMLMediaElement.prototype.mediaKeys;HTMLMediaElement.prototype.mediaKeys=null;
HTMLMediaElement.prototype.setMediaKeys=Iv;window.MediaKeys=Jv;window.MediaKeySystemAccess=Fv}});Pv.prototype.createMediaKeys=function(){_.F("PatchedMediaKeysMs.MediaKeySystemAccess.createMediaKeys");var a=new Tv(this.keySystem);return Promise.resolve(a)};Pv.prototype.getConfiguration=function(){_.F("PatchedMediaKeysMs.MediaKeySystemAccess.getConfiguration");return this.a};Tv.prototype.createSession=function(a){_.F("PatchedMediaKeysMs.MediaKeys.createSession");a=a||_.Ed;if(a!=_.Ed)throw new TypeError(_.Sa+a+_.ba);return new Wv(this.a,a)};
Tv.prototype.setServerCertificate=function(){_.F("PatchedMediaKeysMs.MediaKeys.setServerCertificate");return Promise.resolve(!1)};_.Ke(Wv,Ds);_.r=Wv.prototype;_.r.generateRequest=function(a,b){_.F("PatchedMediaKeysMs.MediaKeySession.generateRequest");this.a=new _.Of;try{this.c=this.g.createSession(_.Zd,_.N(b),null),this.f.on(this.c,"mskeymessage",this.ui.bind(this)),this.f.on(this.c,"mskeyadded",this.si.bind(this)),this.f.on(this.c,"mskeyerror",this.ti.bind(this)),Yv(this,_.Ad)}catch(c){this.a.reject(c)}return this.a};
_.r.load=function(){_.F("PatchedMediaKeysMs.MediaKeySession.load");return Promise.reject(Error(_.za))};_.r.update=function(a){_.F("PatchedMediaKeysMs.MediaKeySession.update");this.b=new _.Of;try{this.c.update(_.N(a))}catch(b){this.b.reject(b)}return this.b};_.r.close=function(){_.F("PatchedMediaKeysMs.MediaKeySession.close");try{this.c.close(),this.closed.resolve(),_.$e(this.f)}catch(a){this.closed.reject(a)}return this.closed};
_.r.remove=function(){_.F("PatchedMediaKeysMs.MediaKeySession.remove");return Promise.reject(Error(_.Aa))};_.r.ui=function(a){_.F("PatchedMediaKeysMs.onMsKeyMessage_",a);this.a&&(this.a.resolve(),this.a=null);this.dispatchEvent(new Cs(_.Sc,{messageType:void 0==this.keyStatuses.a?_.Kc:_.Jc,message:a.message.buffer}))};
_.r.si=function(a){_.F("PatchedMediaKeysMs.onMsKeyAdded_",a);this.a?(_.F("Simulating completion for a PR persistent license."),Yv(this,_.Rd),this.a.resolve(),this.a=null):this.b&&(Yv(this,_.Rd),this.b.resolve(),this.b=null)};
_.r.ti=function(a){_.F("PatchedMediaKeysMs.onMsKeyError_",a);a=Error("EME PatchedMediaKeysMs key error");a.errorCode=this.c.error;if(null!=this.a)this.a.reject(a),this.a=null;else if(null!=this.b)this.b.reject(a),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:Yv(this,_.ed);break;default:Yv(this,_.Hc)}};var $v;_.r=Vv.prototype;_.r.forEach=function(a){this.a&&a(this.a,$v)};_.r.get=function(a){if(this.has(a))return this.a};
_.r.has=function(a){var b=$v;return this.a&&_.gi(_.N(a),_.N(b))?!0:!1};_.r.entries=function(){};_.r.keys=function(){};_.r.values=function(){};
_.Ak(function(){!window.HTMLVideoElement||!window.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(_.Se("Using ms-prefixed EME v20140218"),$v=(new Uint8Array([0])).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Sv,window.MediaKeys=Tv,window.MediaKeySystemAccess=Pv,navigator.requestMediaKeySystemAccess=Qv)});};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.min.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core.min"], function(c){x=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();
