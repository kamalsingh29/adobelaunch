(function(){var g={}; var _ = _ || {};
var f=function(window){var KA="Ad Error",LA="Already destroyed. No-op",MA="Already released. No-op",NA="clpp.plugin.conviva",OA="onAdBreakStarted()",PA="onAdBreakStopped()",QA=function(){var a=_.Ig(),b=Conviva.Constants.DeviceType.DESKTOP,c=Conviva.Constants.DeviceCategory.WEB,d=a.os;a=a.osVersion.name;_.pg()&&(b=Conviva.Constants.DeviceType.MOBILE);var e={};e[Conviva.Constants.DeviceMetadata.TYPE]=b;e[Conviva.Constants.DeviceMetadata.OS_NAME]=d;e[Conviva.Constants.DeviceMetadata.OS_VERSION]=a;e[Conviva.Constants.DeviceMetadata.CATEGORY]=
c;return e},RA=function(a){return 0===a?"Pre-roll":-1===a?"Post-roll":"Mid-roll"},TA=function(a,b){var c={};c[Conviva.Constants.PLAYER_NAME]=_.la;c[Conviva.Constants.VIEWER_ID]=b;c[Conviva.Constants.IS_LIVE]=Conviva.Constants.StreamType.VOD;c[Conviva.Constants.ASSET_NAME]=KA;if(a){c[Conviva.Constants.ASSET_NAME]=a.getTitle();c[Conviva.Constants.STREAM_URL]=a.getMediaUrl();c[Conviva.Constants.DURATION]=a.getDuration();c["c3.ad.id"]=SA(a.nb());c["c3.ad.creativeId"]=SA(a.getCreativeId());c["c3.ad.system"]=
SA(a.getAdSystem());c["c3.ad.mediaFileApiFramework"]=SA(a.getApiFramework());c["c3.ad.advertiser"]=SA(a.getAdvertiserName());c["c3.ad.position"]=RA(a.getPodIndex());c["c3.ad.technology"]=0===a.sb()?Conviva.Constants.AdType.CLIENT_SIDE:Conviva.Constants.AdType.SERVER_SIDE;c["c3.ad.adManagerName"]=SA(a.jb());c["c3.ad.adManagerVersion"]=SA(a.kb());c["c3.ad.advertiserCategory"]=SA(null);c["c3.ad.advertiserId"]=SA(null);c["c3.ad.breakId"]=SA(null);c["c3.ad.campaignName"]=SA(null);c["c3.ad.category"]=SA(null);
c["c3.ad.classification"]=SA(null);c["c3.ad.creativeName"]=SA(null);c["c3.ad.sequence"]=SA(a.Xb());c["c3.ad.sessionStartEvent"]=SA(null);c["c3.ad.unitName"]=SA(null);c["c3.ad.dayPart"]=SA(null);var d=a.getWrapperAdIds().slice(-1)[0]||a.nb(),e=a.getWrapperAdSystems().slice(-1)[0]||a.getAdSystem(),f=a.getWrapperCreativeIds().slice(-1)[0]||a.getCreativeId();c["c3.ad.firstAdId"]=SA(d);c["c3.ad.firstAdSystem"]=SA(e);c["c3.ad.firstCreativeId"]=SA(f)}return c},SA=function(a){return a?""+a:"NA"},UA=function(a,
b){this.b=a;this.m=b;this.l="";this.c=new _.E("clpp.conviva.ad");this.f=new _.Xe;this.a=null;this.h=this.i=this.j=this.g=!1},WA=function(a,b){a.c.debug("Initialize Ad Insights");a.j=!1;a.h=!1;a.l=b.viewerId;VA(a)},XA=function(a,b){if(!a.i){a.h=!1;try{if(a.a=Conviva.Analytics.buildAdAnalytics(a.m()),b){var c=TA(b,a.l),d=String(b.kb()),e={};e[Conviva.Constants.FRAMEWORK_NAME]=b.jb();e[Conviva.Constants.FRAMEWORK_VERSION]=d;a.a.setAdPlayerInfo(e);a.a.reportAdStarted(c)}}catch(f){a.c.error("Could not create ad analytics session",
f)}}},$A=function(a,b,c){c=void 0===c?KA:c;if(a.a){a.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.STOPPED);switch(b){case YA:a.a.reportAdFailed(c,TA(null,a.l));break;case ZA:a.a.reportAdSkipped();break;default:a.a.reportAdEnded()}a.a.release();a.a=null;a.g=!1}},VA=function(a){a.f.on(a.b,_.bb,a.jg.bind(a));a.f.on(a.b,_.cb,a.kg.bind(a));a.f.on(a.b,_.qb,a.qg.bind(a));a.f.on(a.b,_.nb,a.Yc.bind(a));a.f.on(a.b,_.mb,a.Yc.bind(a));a.f.on(a.b,_.ob,a.Yc.bind(a));a.f.on(a.b,
_.db,a.Yc.bind(a));a.f.on(a.b,_.rb,a.rg.bind(a));a.f.on(a.b,_.pb,a.pg.bind(a));a.f.on(a.b,_.eb,a.lg.bind(a));a.f.on(a.b,_.hb,a.ng.bind(a));a.f.on(a.b,_.ib,a.og.bind(a));a.f.on(a.b,_.gb,a.mg.bind(a));a.f.on(a.b,_.jb,a.Xh.bind(a));a.f.on(a.b,_.sb,a.sg.bind(a));a.f.on(a.b,_.zc,function(b){var c=b.detail;if(10003===c.code&&(a.c.debug("onAdError()"),!a.h)){b=Conviva.Constants.ErrorSeverity;switch(c.data.errorType){case 0:var d="Ad Load Error";break;case 1:d="Ad Play Error";break;default:d=KA}null===a.a&&
XA(a,null);c=c.a===_.M?b.FATAL:b.WARNING;a.a.reportAdError(d,c);c===b.FATAL&&(a.h=!0,a.c.debug("Ad Playback Failure"),$A(a,YA,d))}})},aB=function(a,b){this.c=a;this.f=new _.Xe;this.b=null;this.j=!1;this.w=!0;this.o=this.g=this.m=this.u=this.h=!1;this.M=0;this.F=!1;this.l=null;this.C=!1;this.a=b;this.I=this.v=null;this.i=[];this.A=0},eB=function(a,b,c,d){a.h||(a.a.debug("Initialize conviva"),a.w=!1,a.v=_.J.hb(c),a.I=d,a.c=b,bB(a,a.v),a.f.on(a.c,_.kd,a.vi.bind(a)),a.f.on(a.c,_.zd,a.yg.bind(a)),a.f.on(a.c,
_.Rb,a.vg.bind(a)),a.f.on(a.c,_.Td,a.xg.bind(a)),a.f.on(a.c,_.Sd,a.wg.bind(a)),a.f.on(a.c,_.bb,a.tg.bind(a)),a.f.on(a.c,_.cb,a.ug.bind(a)),a.f.on(a.c,_.vb,a.ci.bind(a)),a.f.on(a.c,_.Qb,a.di.bind(a)),a.f.on(a.c,_.zc,a.kf.bind(a)),cB(a)&&(a.a.debug("Start a new session: A new video starts in autoplay."),dB(a)))},fB=function(a){if(!a.h&&a.b){var b=a.c.isLive()?Conviva.Constants.StreamType.LIVE:Conviva.Constants.StreamType.VOD;var c={};c[Conviva.Constants.IS_LIVE]=b;c[Conviva.Constants.DURATION]=a.c.getDuration();
a.b.setContentInfo(c)}},gB=function(a){return null!==a.b&&a.u},cB=function(a){return a.c.getConfiguration().autoplay||!1},bB=function(a,b){var c={};b.serviceUrl&&(a.a.warn("Touchstone URL is set. Do not set this in production!"),c[Conviva.Constants.GATEWAY_URL]=b.serviceUrl.replace(/\/$/,""));Conviva.Analytics.init(b.customerKey,null,c);Conviva.Analytics.setDeviceMetadata(QA());a.b=Conviva.Analytics.buildVideoAnalytics();a.j=!1;c={};c[Conviva.Constants.FRAMEWORK_NAME]=_.la;c[Conviva.Constants.FRAMEWORK_VERSION]=
_.fa;a.b.setPlayerInfo(c)},dB=function(a){if(!a.h)if(a.u)a.a.warn("Current session still active. No-op.");else{var b=a.c.getLoadedSource()||a.I,c=a.c.getConfiguration().conviva||null,d=c&&c.viewerId||"N/A",e=c&&c.defaultResource||"N/A";a.a.debug(a.c.getConfiguration().source);var f={};b&&(f[Conviva.Constants.ASSET_NAME]=b.name||"N/A",f[Conviva.Constants.STREAM_URL]=b.url);f[Conviva.Constants.PLAYER_NAME]=_.la;f[Conviva.Constants.VIEWER_ID]=d;f[Conviva.Constants.DEFAULT_RESOURCE]=e;if(c&&!_.J.H(c.customTags))for(var g in c.customTags)f[g]=
c.customTags[g];a.b.reportPlaybackRequested(f);a.b.setCallback(function(){a.a.debug("reportMiscellaneousMetrics()");if(gB(a)){var h=1E3*a.c.getPosition();a.b.reportPlaybackMetric(Conviva.Constants.Playback.PLAY_HEAD_TIME,h);if(h=a.c.getStats()){h=h.decodedFrames;var l=h-a.A;a.A=h;isFinite(l)&&(a.a.debug("Current FPS",l),a.b.reportPlaybackMetric(Conviva.Constants.Playback.RENDERED_FRAMERATE,l))}}});a.u=!0;a.g=!0;a.C=!1;0<a.i.length&&(a.a.debug("Report deferred events"),a.i.forEach(function(h){h.yh(h.Rf)}));
a.i=[]}},hB=function(a){a.a.debug("terminateSession()");a.b&&(a.b.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.STOPPED),a.b.reportPlaybackEnded(),a.b.release(),Conviva.Analytics.release(),a.j=!0,a.u=!1,a.m=!1,a.g=!1,a.l=null,a.o=!1,a.M=0,a.F=!1,a.i=[],a.A=0)},iB=function(){this.b=this.a=null;this.c=!1;this.f=new _.E("clpp.conviva")},jB=function(a){var b=[];typeof a===_.Xc&&(a.customerKey||b.push("customerKey"),a.viewerId||b.push("viewerId"));if(0<b.length)throw new _.K(1,
9,9001,{missingKeys:b});},lB=function(a,b){var c=b.getConfiguration();a.c=!_.J.H(c.conviva)&&typeof c.conviva===_.Xc;a.c?"undefined"===typeof window.Conviva&&(a.f.warn("Conviva SDK is not loaded. Will do nothing."),a.c=!1,c=new _.K(1,9,9E3),kB(b,c)):a.f.warn("Conviva plugin is loaded but not configured. Will do nothing.")},kB=function(a,b){a.trigger(new _.I(_.zc,{detail:b}))},mB=function(){};_.r=UA.prototype;_.r.release=function(){this.c.debug("Release Ad Indights");this.j?this.c.debug(MA):(_.$e(this.f),this.a&&$A(this,nB),this.f.release(),this.j=!0,this.g=this.h=!1)};_.r.destroy=function(){this.c.debug("destroy()");this.i?this.c.debug(LA):this.i=!0};_.r.jg=function(){this.c.debug(OA)};_.r.kg=function(){this.c.debug(PA)};
_.r.qg=function(a){this.c.debug("onAdStarted()");a=a.ad;this.g||(this.c.warn("Ad load event was not triggered. This will have incidence on VSF"),XA(this,a));this.g=!1;this.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PLAYING);this.a.reportAdMetric(Conviva.Constants.Playback.RESOLUTION,a.pb(),a.ob());this.a.reportAdMetric(Conviva.Constants.Playback.BITRATE,a.Ta())};
_.r.Yc=function(a){var b=this;this.c.debug("onAdStateChanged()");if(this.a){var c=function(d){b.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,d)};switch(a.type){case _.nb:case _.ob:c(Conviva.Constants.PlayerState.PLAYING);break;case _.mb:c(Conviva.Constants.PlayerState.PAUSED);break;case _.db:c(Conviva.Constants.PlayerState.BUFFERING)}}};_.r.rg=function(){this.c.debug("onAdStopped()");this.a&&!this.h&&$A(this,nB)};_.r.pg=function(){this.c.debug("onAdSkipped()");this.a&&$A(this,ZA)};
_.r.lg=function(){this.c.debug("onAdClicked()");this.a&&this.a.reportAdPlayerEvent("AdClicked")};_.r.ng=function(){this.c.debug("onAdImpression()");if(this.a){var a=Conviva.Constants.Events;this.a.reportAdPlayerEvent(a.AD_IMPRESSION_START);this.a.reportAdPlayerEvent(a.AD_IMPRESSION_END)}};
_.r.og=function(a){var b=this;this.c.debug("onAdLoaded()");var c=a.ad;if(-1!==c.getPodIndex()||this.b.getPosition()>=this.b.getDuration()-5)b.g=!0,XA(b,c);else this.f.on(this.b,_.Md,function(){b.b.getPosition()>=b.b.getDuration()-5&&(b.f.off(b.b,_.Md),b.g=!0,XA(b,c))})};_.r.mg=function(){this.c.debug("onAdFirstQuartile()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_FIRST_QUARTILE)};_.r.Xh=function(){this.c.debug("onAdMidPoint()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_MID_QUARTILE)};
_.r.sg=function(){this.c.debug("onAdThirdQuartile()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_THIRD_QUARTILE)};var ZA=0,nB=1,YA=2;_.r=aB.prototype;_.r.release=function(){this.a.debug("Release conviva");this.w?this.a.debug(MA):(_.$e(this.f),gB(this)||this.j||this.b&&this.b.reportPlaybackFailed("Exit Before Video Start"),gB(this)&&hB(this),this.b=null,this.w=!0)};_.r.destroy=function(){this.a.debug("destroy()");this.h?this.a.debug(LA):this.h=!0};_.r.reportAppEvent=function(a,b){var c=!1;try{Conviva.Analytics.reportAppEvent(a,b),c=!0}catch(d){this.a.debug("Report app event error",d),c=!1}return c};
_.r.vi=function(){this.a.debug("onPlayRequest()");gB(this)||cB(this)?gB(this)&&this.m&&!this.g&&(this.a.debug("Resuming VST monitoring ..."),gB(this)&&!this.g&&(this.b.reportPlaybackEvent(Conviva.Constants.Events.USER_WAIT_ENDED),this.g=!0),this.m=!1):(this.a.debug("Creating conviva session. On Play Requested / No autplay"),dB(this))};
_.r.yg=function(a){function b(d){c.j&&(c.a.debug("Creating conviva session (On Seek / Replay)"),bB(c,c.v),dB(c),fB(c));gB(c)&&c.b.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,d)}var c=this;this.a.debug("onStateChanged()");switch(a.detail.currentState){case _.el:b(Conviva.Constants.PlayerState.PLAYING);break;case _.Jm:b(Conviva.Constants.PlayerState.PAUSED);break;case _.Cm:b(Conviva.Constants.PlayerState.BUFFERING);break;case _.Em:this.a.debug("onVideoEnded()"),gB(this)&&(this.l&&this.l.tb()?
(this.a.debug("Waiting for postroll Ad before terminating session"),this.F=!0):hB(this))}};_.r.vg=function(a){this.a.debug("onBitrateChanged()");if(gB(this)&&(a=a.detail,this.b.reportPlaybackMetric(Conviva.Constants.Playback.RESOLUTION,a.width,a.height),a.bandwidth&&this.b.reportPlaybackMetric(Conviva.Constants.Playback.BITRATE,a.bandwidth/1E3),(a=a.rendition)&&a.track&&(a=a.track)&&a.frameRate)){var b={};b[Conviva.Constants.ENCODED_FRAMERATE]=a.frameRate;this.b.setContentInfo(b)}};
_.r.xg=function(){this.a.debug("onBufferingStarted()");gB(this)&&this.b.reportPlaybackMetric(Conviva.Constants.Playback.SEEK_STARTED)};_.r.wg=function(){this.a.debug("onBufferingEnded()");gB(this)&&this.b.reportPlaybackMetric(Conviva.Constants.Playback.SEEK_ENDED)};_.r.ci=function(a){this.a.debug("onAdsTimelineChanged()");if(a=a.adsTimeline)this.l=a};
_.r.tg=function(a){this.a.debug(OA);a=a.ad;var b=0===a.qb(),c=RA(a.getPodIndex());gB(this)||cB(this)||!b||dB(this);if(gB(this)){b=0===a.sb()?Conviva.Constants.AdType.CLIENT_SIDE:Conviva.Constants.AdType.SERVER_SIDE;var d=0,e={};1===a.rb()&&(d=a.getDuration());e[Conviva.Constants.POD_DURATION]=d;e[Conviva.Constants.POD_INDEX]=++this.M;e[Conviva.Constants.POD_POSITION]=c;a=Conviva.Constants.AdPlayer;this.b.reportAdBreakStarted(b,b===Conviva.Constants.AdType.CLIENT_SIDE?a.SEPARATE:a.CONTENT,e);this.o=
!0}else this.a.debug("Bug: should already have a valid session")};_.r.ug=function(){this.a.debug(PA);gB(this)&&this.o&&(this.b.reportAdBreakEnded(),this.o=!1,this.F&&hB(this))};
_.r.kf=function(a){this.a.debug("onPlayerError()");if(this.j&&this.C)this.a.debug("Session ended in VPF; ignoring subsequent errors");else{var b=a.detail||null,c=b&&b.message||"Player error",d=Conviva.Constants.ErrorSeverity.WARNING;b&&b.a&&b.a===_.M&&(d=Conviva.Constants.ErrorSeverity.FATAL,gB(this)||dB(this));gB(this)?(this.a.debug("Report error",c,d),this.b.reportPlaybackError(c,d),d===Conviva.Constants.ErrorSeverity.FATAL&&(this.a.debug("Video Playback Failure"),this.C=!0,hB(this))):this.i.push({yh:this.kf.bind(this),
Rf:a})}};_.r.di=function(){this.a.debug("onAutoPlayBlocked()");gB(this)&&(this.a.debug("Auto-play blocked. Pausing VST monitoring."),this.m=!0,gB(this)&&this.g&&(this.b.reportPlaybackEvent(Conviva.Constants.Events.USER_WAIT_STARTED),this.g=!1))};_.r=iB.prototype;_.r.onPlayerCreated=function(a){this.a=new aB(a,this.f)};_.r.onContentWillLoad=function(a,b){var c=this;lB(this,a);if(this.c){var d=a.getConfiguration();d=_.J.hb(d.conviva||{});try{jB(d);var e=d.enableAdInsights||!1;eB(this.a,a,d,b);e&&(this.b=new UA(a,function(){return c.a.b}),WA(this.b,d))}catch(f){f instanceof _.K?kB(a,f):kB(a,new _.K(1,9,9002,f,f))}}};_.r.onContentLoaded=function(a,b){for(var c=1;c<arguments.length;++c);this.c&&fB(this.a)};
_.r.onPlayerWillDestroy=function(){this.c&&(this.a.destroy(),this.a=null,this.b&&(this.b.destroy(),this.b=null))};_.r.onPlayerWillRelease=function(){this.c&&(this.a.release(),this.b&&this.b.release())};_.r.id=function(){return NA};_.r.reportAppEvent=function(a,b){return this.a?this.a.reportAppEvent(a,b):!1};_.B("clpp.conviva.ConvivaPlugin",iB);iB.prototype.reportAppEvent=iB.prototype.reportAppEvent;iB.Id=NA;mB.prototype.create=function(){return new iB};_.hl(new mB);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.min.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core.min"], function(c){x=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();
