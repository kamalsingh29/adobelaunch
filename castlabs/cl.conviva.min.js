(function(){var g={}; var _ = _ || {};
var f=function(window){var XB="Ad Error",YB="Already destroyed. No-op",ZB="Already released. No-op",$B="clpp.plugin.conviva",aC="onAdBreakStarted()",bC="onAdBreakStopped()",cC=function(){var a=_.Zh(),b=Conviva.Constants.DeviceType.DESKTOP,c=Conviva.Constants.DeviceCategory.WEB,d=a.os;a=a.osVersion.name;_.Gh()&&(b=Conviva.Constants.DeviceType.MOBILE);var e={};e[Conviva.Constants.DeviceMetadata.TYPE]=b;e[Conviva.Constants.DeviceMetadata.OS_NAME]=d;e[Conviva.Constants.DeviceMetadata.OS_VERSION]=a;e[Conviva.Constants.DeviceMetadata.CATEGORY]=
c;return e},dC=function(a){return a?Conviva.Constants.StreamType.LIVE:Conviva.Constants.StreamType.VOD},eC=function(a){return 0===a?"Pre-roll":-1===a?"Post-roll":"Mid-roll"},gC=function(a,b,c){var d={};d[Conviva.Constants.PLAYER_NAME]=_.ka;d[Conviva.Constants.VIEWER_ID]=b;d[Conviva.Constants.IS_LIVE]=dC(!!c);d[Conviva.Constants.ASSET_NAME]=XB;a&&(d[Conviva.Constants.ASSET_NAME]=a.getTitle(),d[Conviva.Constants.STREAM_URL]=a.getMediaUrl(),d[Conviva.Constants.DURATION]=a.getDuration(),d["c3.ad.id"]=
fC(a.Va()),d["c3.ad.creativeId"]=fC(a.getCreativeId()),d["c3.ad.system"]=fC(a.getAdSystem()),d["c3.ad.mediaFileApiFramework"]=fC(a.getApiFramework()),d["c3.ad.advertiser"]=fC(a.getAdvertiserName()),d["c3.ad.position"]=eC(a.getPodIndex()),d["c3.ad.technology"]=0===a.$a()?Conviva.Constants.AdType.CLIENT_SIDE:Conviva.Constants.AdType.SERVER_SIDE,d["c3.ad.adManagerName"]=fC(a.Ta()),d["c3.ad.adManagerVersion"]=fC(a.Ua()),d["c3.ad.advertiserCategory"]=fC(null),d["c3.ad.advertiserId"]=fC(null),d["c3.ad.breakId"]=
fC(null),d["c3.ad.campaignName"]=fC(null),d["c3.ad.category"]=fC(null),d["c3.ad.classification"]=fC(null),d["c3.ad.creativeName"]=fC(null),d["c3.ad.sequence"]=fC(a.pb()),d["c3.ad.sessionStartEvent"]=fC(null),d["c3.ad.unitName"]=fC(null),d["c3.ad.dayPart"]=fC(null),b=a.getWrapperAdIds().slice(-1)[0]||a.Va(),c=a.getWrapperAdSystems().slice(-1)[0]||a.getAdSystem(),a=a.getWrapperCreativeIds().slice(-1)[0]||a.getCreativeId(),d["c3.ad.firstAdId"]=fC(b),d["c3.ad.firstAdSystem"]=fC(c),d["c3.ad.firstCreativeId"]=
fC(a));return d},fC=function(a){return a?""+a:"NA"},hC=function(a,b){this.b=a;this.m=b;this.l="";this.c=new _.H("clpp.conviva.ad");this.f=new _.ii;this.a=null;this.h=this.i=this.j=this.g=!1},jC=function(a,b){a.c.debug("Initialize Ad Insights");a.j=!1;a.h=!1;a.l=b.viewerId;iC(a)},kC=function(a,b){if(!a.i){a.h=!1;try{if(a.a=Conviva.Analytics.buildAdAnalytics(a.m()),b){var c=gC(b,a.l,a.b.isLive()),d=String(b.Ua()),e={};e[Conviva.Constants.FRAMEWORK_NAME]=b.Ta();e[Conviva.Constants.FRAMEWORK_VERSION]=
d;a.a.setAdPlayerInfo(e);a.a.reportAdStarted(c)}}catch(f){a.c.error("Could not create ad analytics session",f)}}},nC=function(a,b,c){c=void 0===c?XB:c;if(a.a){a.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.STOPPED);switch(b){case lC:a.a.reportAdFailed(c,gC(null,a.l));break;case mC:a.a.reportAdSkipped();break;default:a.a.reportAdEnded()}a.a.release();a.a=null;a.g=!1}},iC=function(a){a.f.on(a.b,_.db,a.Cg.bind(a));a.f.on(a.b,_.eb,a.Dg.bind(a));a.f.on(a.b,_.tb,
a.Jg.bind(a));a.f.on(a.b,_.pb,a.jd.bind(a));a.f.on(a.b,_.ob,a.jd.bind(a));a.f.on(a.b,_.qb,a.jd.bind(a));a.f.on(a.b,_.fb,a.jd.bind(a));a.f.on(a.b,_.ub,a.Kg.bind(a));a.f.on(a.b,_.sb,a.Ig.bind(a));a.f.on(a.b,_.gb,a.Eg.bind(a));a.f.on(a.b,_.lb,a.Gg.bind(a));a.f.on(a.b,_.mb,a.Hg.bind(a));a.f.on(a.b,_.jb,a.Fg.bind(a));a.f.on(a.b,_.nb,a.wi.bind(a));a.f.on(a.b,_.vb,a.Lg.bind(a));a.f.on(a.b,_.Ac,function(b){var c=b.detail;if(10003===c.code&&(a.c.debug("onAdError()"),!a.h)){b=Conviva.Constants.ErrorSeverity;
switch(c.data.errorType){case 0:c="Ad Load Error";break;case 1:c="Ad Play Error";break;default:c=XB}null===a.a&&kC(a,null);a.a.reportAdError(c,b.FATAL);a.h=!0;a.c.debug("Ad Playback Failure");nC(a,lC,c)}})},oC=function(a,b){this.c=a;this.f=new _.ii;this.b=null;this.j=!1;this.A=!0;this.o=this.g=this.m=this.u=this.h=!1;this.L=0;this.G=!1;this.l=null;this.D=!1;this.a=b;this.K=this.w=null;this.i=[];this.B=0},sC=function(a,b,c,d){a.h||(a.a.debug("Initialize conviva"),a.A=!1,a.w=_.C.lb(c),a.K=d,a.c=b,pC(a,
a.w),a.f.on(a.c,_.jd,a.Wi.bind(a)),a.f.on(a.c,_.Dd,a.Rg.bind(a)),a.f.on(a.c,_.Tb,a.Og.bind(a)),a.f.on(a.c,_.Td,a.Qg.bind(a)),a.f.on(a.c,_.Sd,a.Pg.bind(a)),a.f.on(a.c,_.db,a.Mg.bind(a)),a.f.on(a.c,_.eb,a.Ng.bind(a)),a.f.on(a.c,_.yb,a.Ci.bind(a)),a.f.on(a.c,_.Sb,a.Di.bind(a)),a.f.on(a.c,_.Ac,a.Df.bind(a)),qC(a)&&(a.a.debug("Start a new session: A new video starts in autoplay."),rC(a)))},tC=function(a){if(!a.h&&a.b){var b=dC(a.c.isLive()),c={};c[Conviva.Constants.IS_LIVE]=b;c[Conviva.Constants.DURATION]=
a.c.getDuration();a.b.setContentInfo(c)}},uC=function(a){return null!==a.b&&a.u},qC=function(a){return a.c.getConfiguration().autoplay||!1},pC=function(a,b){var c={};b.serviceUrl&&(a.a.warn("Touchstone URL is set. Do not set this in production!"),c[Conviva.Constants.GATEWAY_URL]=b.serviceUrl.replace(/\/$/,""));Conviva.Analytics.init(b.customerKey,null,c);Conviva.Analytics.setDeviceMetadata(cC());a.b=Conviva.Analytics.buildVideoAnalytics();a.j=!1;c={};c[Conviva.Constants.FRAMEWORK_NAME]=_.ka;c[Conviva.Constants.FRAMEWORK_VERSION]=
_.da;a.b.setPlayerInfo(c)},rC=function(a){if(!a.h)if(a.u)a.a.warn("Current session still active. No-op.");else{var b=a.c.getLoadedSource()||a.K,c=a.c.getConfiguration().conviva||null,d=c&&c.viewerId||"N/A",e=c&&c.defaultResource||"N/A";a.a.debug(a.c.getConfiguration().source);var f={},g=new _.Rj(b.url);b&&(f[Conviva.Constants.ASSET_NAME]=b.name||"N/A",f[Conviva.Constants.STREAM_URL]=_.Sj(g));f[Conviva.Constants.PLAYER_NAME]=_.ka;f[Conviva.Constants.VIEWER_ID]=d;f[Conviva.Constants.DEFAULT_RESOURCE]=
e;if(c&&!_.C.I(c.customTags))for(var h in c.customTags)f[h]=c.customTags[h];a.b.reportPlaybackRequested(f);a.b.setCallback(function(){a.a.debug("reportMiscellaneousMetrics()");if(uC(a)){var l=1E3*a.c.getPosition();a.b.reportPlaybackMetric(Conviva.Constants.Playback.PLAY_HEAD_TIME,l);if(l=a.c.getStats()){l=l.decodedFrames;var m=l-a.B;a.B=l;isFinite(m)&&(a.a.debug("Current FPS",m),a.b.reportPlaybackMetric(Conviva.Constants.Playback.RENDERED_FRAMERATE,m))}}});a.u=!0;a.g=!0;a.D=!1;0<a.i.length&&(a.a.debug("Report deferred events"),
a.i.forEach(function(l){l.Th(l.jg)}));a.i=[]}},vC=function(a){a.a.debug("terminateSession()");a.b&&(a.b.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.STOPPED),a.b.reportPlaybackEnded(),a.b.release(),Conviva.Analytics.release(),a.j=!0,a.u=!1,a.m=!1,a.g=!1,a.l=null,a.o=!1,a.L=0,a.G=!1,a.i=[],a.B=0)},wC=function(){this.b=this.a=null;this.c=!1;this.f=new _.H("clpp.conviva")},xC=function(a){var b=[];typeof a===_.$c&&(a.customerKey||b.push("customerKey"),a.viewerId||
b.push("viewerId"));if(0<b.length)throw new _.J(1,9,9001,{missingKeys:b});},zC=function(a,b){var c=b.getConfiguration();a.c=!_.C.I(c.conviva)&&typeof c.conviva===_.$c;a.c?"undefined"===typeof window.Conviva&&(a.f.warn("Conviva SDK is not loaded. Will do nothing."),a.c=!1,c=new _.J(1,9,9E3),yC(b,c)):a.f.warn("Conviva plugin is loaded but not configured. Will do nothing.")},yC=function(a,b){a.trigger(new _.O(_.Ac,{detail:b}))},AC=function(){};_.r=hC.prototype;_.r.release=function(){this.c.debug("Release Ad Indights");this.j?this.c.debug(ZB):(_.li(this.f),this.a&&nC(this,BC),this.f.release(),this.j=!0,this.g=this.h=!1)};_.r.destroy=function(){this.c.debug("destroy()");this.i?this.c.debug(YB):this.i=!0};_.r.Cg=function(){this.c.debug(aC)};_.r.Dg=function(){this.c.debug(bC)};
_.r.Jg=function(a){this.c.debug("onAdStarted()");a=a.ad;this.g||(this.c.warn("Ad load event was not triggered. This will have incidence on VSF"),kC(this,a));this.g=!1;this.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,Conviva.Constants.PlayerState.PLAYING);this.a.reportAdMetric(Conviva.Constants.Playback.RESOLUTION,a.Xa(),a.Wa());this.a.reportAdMetric(Conviva.Constants.Playback.BITRATE,a.Ja())};
_.r.jd=function(a){var b=this;this.c.debug("onAdStateChanged()");if(this.a){var c=function(d){b.a.reportAdMetric(Conviva.Constants.Playback.PLAYER_STATE,d)};switch(a.type){case _.pb:case _.qb:c(Conviva.Constants.PlayerState.PLAYING);break;case _.ob:c(Conviva.Constants.PlayerState.PAUSED);break;case _.fb:c(Conviva.Constants.PlayerState.BUFFERING)}}};_.r.Kg=function(){this.c.debug("onAdStopped()");this.a&&!this.h&&nC(this,BC)};_.r.Ig=function(){this.c.debug("onAdSkipped()");this.a&&nC(this,mC)};
_.r.Eg=function(){this.c.debug("onAdClicked()");this.a&&this.a.reportAdPlayerEvent("AdClicked")};_.r.Gg=function(){this.c.debug("onAdImpression()");if(this.a){var a=Conviva.Constants.Events;this.a.reportAdPlayerEvent(a.AD_IMPRESSION_START);this.a.reportAdPlayerEvent(a.AD_IMPRESSION_END)}};
_.r.Hg=function(a){var b=this;this.c.debug("onAdLoaded()");var c=a.ad;if(-1!==c.getPodIndex()||this.b.getPosition()>=this.b.getDuration()-5)b.g=!0,kC(b,c);else this.f.on(this.b,_.Nd,function(){b.b.getPosition()>=b.b.getDuration()-5&&(b.f.off(b.b,_.Nd),b.g=!0,kC(b,c))})};_.r.Fg=function(){this.c.debug("onAdFirstQuartile()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_FIRST_QUARTILE)};_.r.wi=function(){this.c.debug("onAdMidPoint()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_MID_QUARTILE)};
_.r.Lg=function(){this.c.debug("onAdThirdQuartile()");this.a&&this.a.reportAdPlayerEvent(Conviva.Constants.Events.AD_THIRD_QUARTILE)};var mC=0,BC=1,lC=2;_.r=oC.prototype;_.r.release=function(){this.a.debug("Release conviva");this.A?this.a.debug(ZB):(_.li(this.f),uC(this)||this.j||this.b&&this.b.reportPlaybackFailed("Exit Before Video Start"),uC(this)&&vC(this),this.b=null,this.A=!0)};_.r.destroy=function(){this.a.debug("destroy()");this.h?this.a.debug(YB):this.h=!0};_.r.reportAppEvent=function(a,b){var c=!1;try{Conviva.Analytics.reportAppEvent(a,b),c=!0}catch(d){this.a.debug("Report app event error",d),c=!1}return c};
_.r.Wi=function(){this.a.debug("onPlayRequest()");uC(this)||qC(this)?uC(this)&&this.m&&!this.g&&(this.a.debug("Resuming VST monitoring ..."),uC(this)&&!this.g&&(this.b.reportPlaybackEvent(Conviva.Constants.Events.USER_WAIT_ENDED),this.g=!0),this.m=!1):(this.a.debug("Creating conviva session. On Play Requested / No autplay"),rC(this))};
_.r.Rg=function(a){function b(d){if(c.j&&(c.a.debug("Creating conviva session (On Seek / Replay)"),pC(c,c.w),rC(c),tC(c),uC(c))){var e=c.c.getTrackManager();e=e.Z()||e.za();e.width&&e.height&&c.b.reportPlaybackMetric(Conviva.Constants.Playback.RESOLUTION,e.width,e.height);e.bandwidth&&c.b.reportPlaybackMetric(Conviva.Constants.Playback.BITRATE,e.bandwidth/1E3)}uC(c)&&c.b.reportPlaybackMetric(Conviva.Constants.Playback.PLAYER_STATE,d)}var c=this;this.a.debug("onStateChanged()");switch(a.detail.currentState){case _.ln:b(Conviva.Constants.PlayerState.PLAYING);
break;case _.Kn:b(Conviva.Constants.PlayerState.PAUSED);break;case _.Cn:b(Conviva.Constants.PlayerState.BUFFERING);break;case _.En:this.a.debug("onVideoEnded()"),uC(this)&&(this.l&&this.l.ab()?(this.a.debug("Waiting for postroll Ad before terminating session"),this.G=!0):vC(this))}};
_.r.Og=function(a){this.a.debug("onBitrateChanged()");if(uC(this)&&(a=a.detail,this.b.reportPlaybackMetric(Conviva.Constants.Playback.RESOLUTION,a.width,a.height),a.bandwidth&&this.b.reportPlaybackMetric(Conviva.Constants.Playback.BITRATE,a.bandwidth/1E3),(a=a.rendition)&&a.track&&(a=a.track)&&a.frameRate)){var b={};b[Conviva.Constants.ENCODED_FRAMERATE]=a.frameRate;this.b.setContentInfo(b)}};_.r.Qg=function(){this.a.debug("onBufferingStarted()");uC(this)&&this.b.reportPlaybackMetric(Conviva.Constants.Playback.SEEK_STARTED)};
_.r.Pg=function(){this.a.debug("onBufferingEnded()");uC(this)&&this.b.reportPlaybackMetric(Conviva.Constants.Playback.SEEK_ENDED)};_.r.Ci=function(a){this.a.debug("onAdsTimelineChanged()");if(a=a.adsTimeline)this.l=a};
_.r.Mg=function(a){this.a.debug(aC);a=a.ad;var b=0===a.Aa(),c=eC(a.getPodIndex());uC(this)||qC(this)||!b||rC(this);if(uC(this)){b=0===a.$a()?Conviva.Constants.AdType.CLIENT_SIDE:Conviva.Constants.AdType.SERVER_SIDE;var d=0,e={};1===a.Za()&&(d=a.getDuration());e[Conviva.Constants.POD_DURATION]=d;e[Conviva.Constants.POD_INDEX]=++this.L;e[Conviva.Constants.POD_POSITION]=c;a=Conviva.Constants.AdPlayer;this.b.reportAdBreakStarted(b,b===Conviva.Constants.AdType.CLIENT_SIDE?a.SEPARATE:a.CONTENT,e);this.o=
!0}else this.a.debug("Bug: should already have a valid session")};_.r.Ng=function(){this.a.debug(bC);uC(this)&&this.o&&(this.b.reportAdBreakEnded(),this.o=!1,this.G&&vC(this))};
_.r.Df=function(a){this.a.debug("onPlayerError()");if(this.j&&this.D)this.a.debug("Session ended in VPF; ignoring subsequent errors");else{var b=a.detail||null,c=b&&b.message||"Player error",d=Conviva.Constants.ErrorSeverity.WARNING;b&&b.a&&b.a===_.K&&(d=Conviva.Constants.ErrorSeverity.FATAL,uC(this)||rC(this));uC(this)?(this.a.debug("Report error",c,d),this.b.reportPlaybackError(c,d),d===Conviva.Constants.ErrorSeverity.FATAL&&(this.a.debug("Video Playback Failure"),this.D=!0,vC(this))):this.i.push({Th:this.Df.bind(this),
jg:a})}};_.r.Di=function(){this.a.debug("onAutoPlayBlocked()");uC(this)&&(this.a.debug("Auto-play blocked. Pausing VST monitoring."),this.m=!0,uC(this)&&this.g&&(this.b.reportPlaybackEvent(Conviva.Constants.Events.USER_WAIT_STARTED),this.g=!1))};_.r=wC.prototype;_.r.onPlayerCreated=function(a){this.a=new oC(a,this.f)};_.r.onContentWillLoad=function(a,b){var c=this;zC(this,a);if(this.c){var d=a.getConfiguration();d=_.C.lb(d.conviva||{});try{xC(d);var e=d.enableAdInsights||!1;sC(this.a,a,d,b);e&&(this.b=new hC(a,function(){return c.a.b}),jC(this.b,d))}catch(f){f instanceof _.J?yC(a,f):yC(a,new _.J(1,9,9002,f,f))}}};_.r.onContentLoaded=function(a,b){for(var c=1;c<arguments.length;++c);this.c&&tC(this.a)};
_.r.onPlayerWillDestroy=function(){this.c&&(this.a.destroy(),this.a=null,this.b&&(this.b.destroy(),this.b=null))};_.r.onPlayerWillRelease=function(){this.c&&(this.a.release(),this.b&&this.b.release())};_.r.id=function(){return $B};_.r.reportAppEvent=function(a,b){return this.a?this.a.reportAppEvent(a,b):!1};_.B("clpp.conviva.ConvivaPlugin",wC);wC.prototype.reportAppEvent=wC.prototype.reportAppEvent;wC.Id=$B;AC.prototype.create=function(){return new wC};_.xn(new AC);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.min.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core.min"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();
