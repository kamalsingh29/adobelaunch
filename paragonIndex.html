<html>
  <head>
    <script src="castlabs/cl.core.min.js"></script>
    <script src="castlabs/cl.mse.min.js"></script>
    <script src="castlabs/cl.dash.min.js"></script>
    <script src="castlabs/cl.hls.min.js"></script>
    <script src="castlabs/cl.crypto.min.js"></script>
    <script src="castlabs/cl.conviva.min.js"></script>


    <script src="https://assets.adobedtm.com/b115bc50b73a685b73a5ec23570f976910498851/satelliteLib-e77072e2e4da7eea0556fdc8c500cab830c90752.js"></script>
    <script src="https://assets.adobedtm.com/b115bc50b73a685b73a5ec23570f976910498851/scripts/satellite-572becbd64746d251d0005e8.js"></script>


  </head>
  <body>
    <video id="video" width="640" height="360" crossOrigin="anonymous"></video>
  </body>
<script>
// Instantiate a player
var player = new clpp.Player('video', { license: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ1cmxzIjpbImh0dHBzOi8va2FtYWxzaW5naDI5LmdpdGh1Yi5pby8iXSwidHlwZSI6IldlYiIsImtpZCI6MjY1MSwiaWx2IjpmYWxzZX0.NYSDD6UT1fflHpWVR4UGrFj9cSSmNMhw4uzGfLXpqw7yhE9cOKoaMpQcF2sdG53A0H4Ke66wmNcCr9pHUOLQ4Hg_qtcVkpYe-8jXSpZgZ4K-PJdRwvZ930hBKWyjPZyrnD6LnqOvxtuc82I6YwrVP5WDv6d7m_vuufyh9u_sZePDVHGKu8SjBo63cA32a5nTk7zrnV1Xb5A_DcL33mvld24CVsjnDLG-FjIxrPj_pv9CPllPmcLlpVDilhedhtRBKEm6X-H8kAlCY3kqP389XRYvbEEWU8dea8sHaVP9gcZCPGk1WtJ4GKGt_S_RYUvRtgtzUrA9tVwzHSkRyD7l8A'});

       player.use(clpp.dash.DashComponent);
       player.use(clpp.hls.HlsComponent);
       player.use(clpp.crypto.CryptoComponent);
       player.on(clpp.events.ERROR, event => {
            var error = event.detail;
            console.log(event.detail)

        });
// Add required component for MPEG-DASH playback
//player.use(clpp.dash.DashComponent);

// Uncomment next line to add Smooth Streaming playback capability
// player.use(clpp.smooth.SmoothComponent);

// Uncomment next line to add HLS playback capability (e.g. on Chrome)
// player.use(clpp.hls.HlsComponent);

// Uncomment next line to add AES-128 support
// player.use(clpp.crypto.CryptoComponent)

// Load configuration and start playback
    // Add DASH playback capabitlity
    //player.use(clpp.dash.DashComponent);

    player.load({
  
            autoplay: true,
  			muted: true,
  			controls: true,
        source: {
            url: 'https://demo.cf.castlabs.com/media/prestodash/Manifest.mpd',
            name: 'Tears of Steel' // Will be reported as asset name by the integration
        }/*,
        conviva: {
            customerKey: '2b7c637964bded3629e188dbd9a6be90803eefaa',
            serviceUrl: 'https://telstra-test.testonly.conviva.com',
            viewerId: 'KDS',
            enableAdInsights: false,
              customTags: {
              customerKey: '1234',
              serviceUrl: '4567',
              viewerId: 'KDS'
              }
            }*/
            

});

//conviva code

var ClientMeasureInterface=function(){this.getPHT=function(){},this.getBufferLength=function(){},this.getSignalStrength=function(){},this.getRenderedFrameRate=function(){}};!function(e,t){if("function"==typeof define&&define.amd?define(t):"object"==typeof exports&&(module.exports=t()),void 0!==e){if(void 0!==e.Conviva)return;if(e.ConvivaLoading)return;e.ConvivaLoading=!0,e.Conviva=t(),delete e.ConvivaLoading}}(this,function(){var e={};return function(){"use strict";var t={};!function(){var n=e.Client=function(t,o){var _=this;this.defaultGatewayURLError=!1,this._logger=null,this._sessionFactory=null,this._systemFactory=null,this._globalSessionKey=-1,this._settings=null,this._systemSettings=null,this._exceptionCatcher=null,this._config=null,this._id=-1,this._released=!1,function(e,t){if(!(e instanceof i))throw new Error("clientSettings parameter should be an instance of ClientSettings.");if(!(t instanceof r))throw new Error("systemFactory parameter should be an instance of SystemFactory.");e.gatewayUrl!=i._httpsProtocol+i.defaultProductionGatewayDNS&&e.gatewayUrl!=i._httpProtocol+i.defaultProductionGatewayDNS||(this.defaultGatewayURLError=!0),this._settings=e.clone(),this._systemFactory=t,this._systemFactory.configure("SDK",this._settings),this._exceptionCatcher=this._systemFactory.buildExceptionCatcher(),this._exceptionCatcher.runProtected("Client.init",function(){_._id=j.uinteger32(),_._logger=_._systemFactory.buildLogger(),_._logger.setModuleName("Client"),_.defaultGatewayURLError&&_._logger.info("Gateway URL should not be set to https://cws.conviva.com or http://cws.conviva.com, therefore this call is ignored"),_._logger.info("init(): url="+_._settings.gatewayUrl+" customerKey="+_._settings.customerKey),_._config=_._systemFactory.buildConfig(),_._config.load(),_._sessionFactory=_._systemFactory.buildSessionFactory(_,_._settings,_._config),_._logger.info("init(): done.")},function(e){throw new Error("Client constructor failed: "+e.message)})}.apply(this,arguments),this.release=function(){this._released||this._exceptionCatcher.runProtected("Client.release",function(){_._logger.info("release()"),_._sessionFactory.cleanup(),_._sessionFactory=null,_._globalSessionKey=-1,_._logger=null,_._id=-1,_._exceptionCatcher=null,_._settings=null,_._systemSettings=null,_._systemFactory=null,_._released=!0})},this.createSession=function(e){var t=n.NO_SESSION_KEY;return this._released||(null==e||e instanceof a?this._exceptionCatcher.runProtected("Client.createSession",function(){t=_._sessionFactory.makeVideoSession(e,K.SESSION_TYPE.VIDEO)}):_._logger.error("createSession(): expecting an instance of ContentMetadata for contentMetadata parameter")),t},this.createAdSession=function(e,t){var i=n.NO_SESSION_KEY;return this._released||(null==t||t instanceof a?this._exceptionCatcher.runProtected("Client.createAdSession",function(){var n=_._sessionFactory.getVideoSession(e);null!=n&&(null==t&&(t=new a),null!=t.applicationName&&null!=t.viewerId||(null==t.viewerId&&null!=n._contentMetadata.viewerId&&(t.viewerId=n._contentMetadata.viewerId),null==t.applicationName&&null!=n._contentMetadata.applicationName&&(t.applicationName=n._contentMetadata.applicationName)),t.custom["c3.csid"]=x.ToString(n._id)),i=_._sessionFactory.makeVideoSession(t,K.SESSION_TYPE.AD)}):_._logger.error("createAdSession(): expecting an instance of ContentMetadata for adMetadata parameter")),i},this.reportError=function(t,n,i){return this._released?void 0:x.isValidString(n)?i!==e.Client.ErrorSeverity.FATAL&&i!==e.Client.ErrorSeverity.WARNING?void this._logger.error("reportError(): invalid error severity: "+i):void this._exceptionCatcher.runProtected("Client.reportError",function(){var e=_._sessionFactory.getVideoSession(t);null!=e&&e.reportError(n,i)}):void this._logger.error("reportError(): invalid error message string: "+n)},this.updateContentMetadata=function(e,t){return this._released?void 0:t instanceof a?void this._exceptionCatcher.runProtected("Client.updateContentMetadata",function(){var n=_._sessionFactory.getVideoSession(e);if(null!=n){var i=t.clone();n.updateContentMetadata(i)}}):void _._logger.error("updateContentMetadata(): expecting an instance of ContentMetadata for contentMetadata parameter")},this.detachPlayer=function(e){this._released||this._exceptionCatcher.runProtected("Client.detachPlayer",function(){var t=_._sessionFactory.getVideoSession(e);null!=t&&t.detachPlayer()})},this.attachPlayer=function(e,t){return this._released?void 0:t instanceof s?void this._exceptionCatcher.runProtected("Client.attachPlayer",function(){var n=_._sessionFactory.getVideoSession(e);null!=n&&n.attachPlayer(t)}):void _._logger.error("attachPlayer(): expecting an instance of PlayerStateManager for playerStateManager parameter")},this.contentPreload=function(e){this._released||this._exceptionCatcher.runProtected("Client.contentPreload",function(){var t=_._sessionFactory.getVideoSession(e);null!=t&&t.contentPreload()})},this.contentStart=function(e){this._released||this._exceptionCatcher.runProtected("Client.contentStart",function(){var t=_._sessionFactory.getVideoSession(e);null!=t&&t.contentStart()})},this.sendCustomEvent=function(e,t,i){return this._released?void 0:x.isValidString(t)?void this._exceptionCatcher.runProtected("Client.sendCustomEvent",function(){if(e==n.NO_SESSION_KEY){if(_._globalSessionKey<0){var r=new a;_._globalSessionKey=_._sessionFactory.makeGlobalSession(r,null)}e=_._globalSessionKey}var o=x.sanitizeStringToStringObject(i),s=_._sessionFactory.getSession(e);null!=s&&s.sendCustomEvent(t,o)}):void _._logger.error("sendCustomEvent(): eventName parameter must be a valid string.")},this.adStart=function(e,t,i,a){return this._released?void 0:t!==n.AdStream.CONTENT&&t!==n.AdStream.SEPARATE?void this._logger.error("adStart(): ignored, invalid value for adStream parameter: "+t):i!==n.AdPlayer.CONTENT&&i!==n.AdPlayer.SEPARATE?void this._logger.error("adStart(): ignored, invalid value for adPlayer parameter: "+i):a!==n.AdPosition.BUMPER&&a!==n.AdPosition.PREROLL&&a!==n.AdPosition.MIDROLL&&a!==n.AdPosition.POSTROLL?void this._logger.error("adStart(): ignored, invalid value for adPosition parameter: "+a):void this._exceptionCatcher.runProtected("Client.adStart",function(){var n=_._sessionFactory.getVideoSession(e);null!=n&&n.adStart(t,i,a)})},this.adEnd=function(e){this._released||this._exceptionCatcher.runProtected("Client.adEnd",function(){var t=_._sessionFactory.getVideoSession(e);null!=t&&t.adEnd()})},this.cleanupSession=function(e){return this._released?void 0:e===n.NO_SESSION_KEY?void this._logger.warning("cleanupSession(): ignored, can't cleanup Client.NO_SESSION_KEY"):void this._exceptionCatcher.runProtected("Client.cleanupSession",function(){null!=_._sessionFactory.getVideoSession(e)&&_._sessionFactory.cleanupSession(e)})},this.getAttachedPlayer=function(e){var t=null;return this._released||(e===n.NO_SESSION_KEY?this._logger.warning("getAttachedPlayer(): ignored for Client.NO_SESSION_KEY"):this._exceptionCatcher.runProtected("Client.getAttachedPlayer",function(){var n=_._sessionFactory.getVideoSession(e);null!=n&&(t=n.getPlayerStateManager())})),t},this.isPlayerAttached=function(e){return!this._released&&null!==this.getAttachedPlayer(e)},this.getPlayerStateManager=function(){if(this._released)throw new Error("This instance of Conviva.Client has been released.");return new s(this._systemFactory)},this.releasePlayerStateManager=function(e){if(this._released)throw new Error("This instance of Conviva.Client has been released.");this._exceptionCatcher.runProtected("Client.releasePlayerStateManager",function(){e instanceof s&&e.release()})},this.getSettings=function(){return this._settings},this.getId=function(){return this._id}};n.version="2.151.0.36995",n.NO_SESSION_KEY=-2,n.AdPosition={BUMPER:"BUMPER",PREROLL:"PREROLL",MIDROLL:"MIDROLL",POSTROLL:"POSTROLL"},n.AdStream={CONTENT:"CONTENT",SEPARATE:"SEPARATE"},n.AdPlayer={CONTENT:"CONTENT",SEPARATE:"SEPARATE"},n.ErrorSeverity={FATAL:0,WARNING:1},n.DeviceType={DESKTOP:"DESKTOP",CONSOLE:"Console",SETTOP:"Settop",MOBILE:"Mobile",TABLET:"Tablet",SMARTTV:"SmartTV"},n.AdTechnology={CLIENT_SIDE:"Client Side",SERVER_SIDE:"Server Side"},n.AdType={BLACKOUT_SLATE:"Blackout slate",TECHNICAL_DIFFICULTIES_SLATE:"Technical Difficulties slate",COMMERCIAL_SLATE:"Commercial Break slate",OTHER_SLATE:"Other slate",VPAID:"VPAID",REGULAR:"Regular Ad"},n.AdServingType={INLINE:"Inline",WRAPPER:"Wrapper"},n.DeviceCategory={ANDROID_DEVICE:"AND",APPLE_DEVICE:"APL",CHROMECAST:"CHR",DESKTOP_APP:"DSKAPP",DEVICE_SIMULATOR:"SIMULATOR",LG_TV:"LGTV",NINTENDO:"NINTENDO",PLAYSTATION:"PS",ROKU:"RK",SAMSUNG_TV:"SAMSUNGTV",SMART_TV:"TV",SET_TOP_BOX:"STB",TIVO:"TIVO",WEB:"WEB",WINDOWS_DEVICE:"WIN",XBOX:"XB",KAIOS_DEVICE:"KAIOS"};var i=e.ClientSettings=function(e){var t=this;this._customerKey=null,x.defGet(this,"customerKey",function(){return this._customerKey}),x.defSet(this,"customerKey",function(e){x.isValidString(e)&&(this._customerKey=e)}),this._heartbeatInterval=i.defaultProductionHeartbeatInterval,x.defGet(this,"heartbeatInterval",function(){return this._heartbeatInterval}),x.defSet(this,"heartbeatInterval",function(e){if("number"==typeof e){var t=x.NumberToUnsignedInt(e);t===e&&(this._heartbeatInterval=t)}}),this._gatewayUrl=null,x.defGet(this,"gatewayUrl",function(){return this._gatewayUrl}),x.defSet(this,"gatewayUrl",function(e){x.isValidString(e)&&(this._gatewayUrl=e)}),function(e){if(!x.isValidString(e))throw new Error("customerKey must be valid");this.customerKey=e}.apply(this,arguments),this.equals=function(e){return this.customerKey===e.customerKey&&this.gatewayUrl===e.gatewayUrl&&this.heartbeatInterval===e.heartbeatInterval},this.clone=function(){var e=new i(this.customerKey);return e.gatewayUrl=function(e){if(x.isValidString(e)){var n=e.split("://");if("cws.conviva.com"!=n[1]&&("https"==n[0]||"http"==n[0]))return e}return"https://"+t.customerKey+"."+i.defaultProductionGatewayDNS}(this.gatewayUrl),e.heartbeatInterval=this.heartbeatInterval,e}};i.defaultDevelopmentGatewayUrl="https://conviva.testonly.conviva.com",i.defaultProductionGatewayUrl="https://cws.conviva.com",i.defaultProductionGatewayDNS="cws.conviva.com",i.defaultDevelopmentGatewayDNS="conviva.testonly.conviva.com",i._httpsProtocol="https://",i._httpProtocol="http://",i.defaultDevelopmentHeartbeatInterval=5,i.defaultProductionHeartbeatInterval=20;var a=e.ContentMetadata=function(){this._assetName=null,x.defGet(this,"assetName",function(){return this._assetName}),x.defSet(this,"assetName",function(e){"string"==typeof e&&(this._assetName=e)}),this._custom={},x.defGet(this,"custom",function(){return this._custom}),x.defSet(this,"custom",function(e){"object"==typeof e&&(this._custom=x.sanitizeStringToStringObject(e))}),this._defaultResource=null,x.defGet(this,"defaultResource",function(){return this._defaultResource}),x.defSet(this,"defaultResource",function(e){"string"==typeof e&&(this._defaultResource=e)}),this._viewerId=null,x.defGet(this,"viewerId",function(){return this._viewerId}),x.defSet(this,"viewerId",function(e){"string"==typeof e&&(this._viewerId=e)}),this._applicationName=null,x.defGet(this,"applicationName",function(){return this._applicationName}),x.defSet(this,"applicationName",function(e){"string"==typeof e&&(this._applicationName=e)}),this._streamUrl=null,x.defGet(this,"streamUrl",function(){return this._streamUrl}),x.defSet(this,"streamUrl",function(e){"string"==typeof e&&(this._streamUrl=e)}),this._streamType=a.StreamType.UNKNOWN,x.defGet(this,"streamType",function(){return this._streamType}),x.defSet(this,"streamType",function(e){e!==a.StreamType.UNKNOWN&&e!==a.StreamType.VOD&&e!==a.StreamType.LIVE||(this._streamType=e)}),this._duration=-1,x.defGet(this,"duration",function(){return this._duration}),x.defSet(this,"duration",function(e){this._duration=J.sanitizeSpecialIntegerValue(e)}),this._encodedFrameRate=-1,x.defGet(this,"encodedFrameRate",function(){return this._encodedFrameRate}),x.defSet(this,"encodedFrameRate",function(e){this._encodedFrameRate=J.sanitizeSpecialIntegerValue(e)}),function(){}.apply(this,arguments),this.clone=function(){var e=new a;for(var t in e.assetName=this.assetName,e.applicationName=this.applicationName,e.streamUrl=this.streamUrl,e.viewerId=this.viewerId,e.defaultResource=this.defaultResource,e.streamType=this.streamType,e.duration=this.duration,e.encodedFrameRate=this.encodedFrameRate,this.custom)e.custom[t]=this.custom[t];return e}};a.StreamType={UNKNOWN:"UNKNOWN",LIVE:"LIVE",VOD:"VOD"};var r=(e.ErrorType={ERROR_UNKNOWN:"ERROR_UNKNOWN",ERROR_IO:"ERROR_IO",ERROR_TIMEOUT:"ERROR_TIMEOUT",ERROR_NULL_ASSET:"ERROR_NULL_ASSET",ERROR_MISSING_PARAMETER:"ERROR_MISSING_PARAMETER",ERROR_NO_AD_AVAILABLE:"ERROR_NO_AD_AVAILABLE",ERROR_PARSE:"ERROR_PARSE",ERROR_INVALID_VALUE:"ERROR_INVALID_VALUE",ERROR_INVALID_SLOT:"ERROR_INVALID_SLOT",ERROR_3P_COMPONENT:"ERROR_3P_COMPONENT",ERROR_UNSUPPORTED_3P_FEATURE:"ERROR_UNSUPPORTED_3P_FEATURE",ERROR_DEVICE_LIMIT:"ERROR_DEVICE_LIMIT",ERROR_UNMATCHED_SLOT_SIZE:"ERROR_UNMATCHED_SLOT_SIZE"},e.Events={AD_REQUESTED:"Conviva.AdRequested",AD_RESPONSE:"Conviva.AdResponse",AD_SLOT_STARTED:"Conviva.SlotStarted",AD_ATTEMPTED:"Conviva.AdAttempted",AD_SLOT_ENDED:"Conviva.SlotEnded",AD_IMPRESSION_START:"Conviva.AdImpression",AD_START:"Conviva.AdStart",AD_FIRST_QUARTILE:"Conviva.AdFirstQuartile",AD_MID_QUARTILE:"Conviva.AdMidQuartile",AD_THIRD_QUARTILE:"Conviva.AdThirdQuartile",AD_COMPLETE:"Conviva.AdComplete",AD_END:"Conviva.AdEnd",AD_IMPRESSION_END:"Conviva.AdImpressionEnd",AD_SKIPPED:"Conviva.AdSkipped",AD_ERROR:"Conviva.AdError",AD_PROGRESS:"Conviva.AdProgress",AD_CLOSE:"Conviva.AdClose",CONTENT_PAUSED:"Conviva.PauseContent",CONTENT_RESUMED:"Conviva.ResumeContent",POD_START:"Conviva.PodStart",POD_END:"Conviva.PodEnd"},e.SystemFactory=function(e,t){var n=this;(function(e,t){if(!(e instanceof f))throw new Error("systemInterface parameter should be an instance of SystemInterface.");this._systemInterface=e,this._timeInterface=this._systemInterface._timeInterface,this._timerInterface=this._systemInterface._timerInterface,this._httpInterface=this._systemInterface._httpInterface,this._storageInterface=this._systemInterface._storageInterface,this._metadataInterface=this._systemInterface._metadataInterface,this._loggingInterface=this._systemInterface._loggingInterface,this._settings=t instanceof o?t.clone():new o}).apply(this,arguments),this.configure=function(e,t){this._packageName=e,this._clientSettings=t},this.release=function(){this._systemInterface.release(),this._systemInterface=null,this._packageName=null,this._settings=null,this._logBuffer=null};this.buildLogger=function(){return new X(n._loggingInterface,n._timeInterface,n.getSettings(),n._logBuffer,n._packageName)},this.buildSessionFactory=function(e,t,n){return new V(e,t,n,this)},this.buildPing=function(){return new q(this.buildLogger(),this.buildHttpClient(),this._clientSettings)},this.buildCallbackWithTimeout=function(){return new Q(this.buildTimer())},this.buildCallbackWithTimeoutNoPing=function(){var e=new H(this.buildLogger(),null,this.getSettings()),t=new te(this.buildLogger(),this._timerInterface,e);return new Q(t)},this.buildHttpClient=function(){return new z(this.buildLogger(),this._httpInterface,this.buildCallbackWithTimeoutNoPing(),this.getSettings())},this.buildExceptionCatcher=function(){return new H(this.buildLogger(),this.buildPing(),this.getSettings())},this.buildTime=function(){return new ee(this._timeInterface,this.buildLogger())},this.buildTimer=function(){return new te(this.buildLogger(),this._timerInterface,this.buildExceptionCatcher())},this.buildStorage=function(){return new Z(this.buildLogger(),this._storageInterface,this.buildCallbackWithTimeout(),this.getSettings())},this.buildConfig=function(){return new G(this.buildLogger(),this.buildStorage(),this.buildJsonInterface())},this.buildSystemMetadata=function(){return new $(this.buildLogger(),this._metadataInterface,this.buildExceptionCatcher())},this.buildCwsProtocol=function(){return new P},this.buildGatewayControl=function(e){return new k(e,this.buildLogger(),this.buildHttpClient(),this.buildJsonInterface())},this.buildCwsSession=function(e,t,n){var i=this.buildGatewayControl(t);return new K(this.buildEventQueue(),e,t,this.buildLogger(),this.buildExceptionCatcher(),this.buildTimer(),i,this.buildCwsProtocol(),this.buildTime(),this.getLogBuffer(),n)},this.buildSession=function(e,t,n,i,a,r){var o=this.buildExceptionCatcher(),s=this.buildLogger(),_=t.clone(),l=this.buildCwsSession(e,_,n);return new Y(i,a,r,n,this.buildSystemMetadata(),l,o,s)},this.buildEventQueue=function(){return new B},this.buildJsonInterface=function(){return new F},this.getLogBuffer=function(){return this._logBuffer},this.getSettings=function(){return this._settings},this._logBuffer=new W}),o=e.SystemSettings=function(){this._logLevel=o.defaultProductionLogLevel,x.defGet(this,"logLevel",function(){return this._logLevel}),x.defSet(this,"logLevel",function(e){if("number"==typeof e){var t=x.NumberToUnsignedInt(e);t===e&&t>=o.LogLevel.DEBUG&&t<=o.LogLevel.ERROR&&(this._logLevel=t)}}),this._allowUncaughtExceptions=o.defaultProductionAllowUncaughtExceptions,x.defGet(this,"allowUncaughtExceptions",function(){return this._allowUncaughtExceptions}),x.defSet(this,"allowUncaughtExceptions",function(e){x.isBoolean(e)&&(this._allowUncaughtExceptions=e)}),this._storageTimeout=o.defaultStorageTimeout,x.defGet(this,"storageTimeout",function(){return this._storageTimeout}),x.defSet(this,"storageTimeout",function(e){if("number"==typeof e){var t=x.NumberToUnsignedInt(e);t===e&&(this._storageTimeout=t)}}),this._httpTimeout=o.defaultHttpTimeout,x.defGet(this,"httpTimeout",function(){return this._httpTimeout}),x.defSet(this,"httpTimeout",function(e){if("number"==typeof e){var t=x.NumberToUnsignedInt(e);t===e&&(this._httpTimeout=t)}}),function(){}.apply(this,arguments),this.equals=function(e){return this.logLevel===e.logLevel&&this.allowUncaughtExceptions===e.allowUncaughtExceptions&&this.storageTimeout===e.storageTimeout&&this.httpTimeout===e.httpTimeout},this.clone=function(){var e=new o;return e.logLevel=this.logLevel,e.allowUncaughtExceptions=this.allowUncaughtExceptions,e.storageTimeout=this.storageTimeout,e.httpTimeout=this.httpTimeout,e}};o.LogLevel={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},o.defaultDevelopmentLogLevel=o.LogLevel.DEBUG,o.defaultProductionLogLevel=o.LogLevel.ERROR,o.defaultDevelopmentAllowUncaughtExceptions=!0,o.defaultProductionAllowUncaughtExceptions=!1,o.defaultStorageTimeout=10,o.defaultHttpTimeout=10;var s=e.PlayerStateManager=function(n){var i=this;i._monitorNotifier=null,i._bitrateKbps=-2,i._playerState=s.PlayerState.UNKNOWN,i._currentMetadata={},i._renderedFrameRate=-2,i._encodedFrameRate=-2,i._duration=-2,i._playerVersion=null,i._playerType=null,i._streamUrl=null,i._moduleName=null,i._moduleVersion=null,i._width=-1,i._height=-1,i._connectionType=null,i._linkEncryption=null,i._lastError=null,i._pendingErrors=[],i._released=!1,this.release=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.release",function(){null!=i._monitorNotifier&&i._monitorNotifier.onRelease(),i.removeMonitoringNotifier(),i._systemFactory=null,i._logger=null,i._exceptionCatcher=null,i._released=!0})},this.setPlayheadTime=function(e){},this.setBufferLength=function(e){},this.setRenderedFrameRate=function(e){},this.getEncodedFrameRate=function(){return i._encodedFrameRate},this.setEncodedFrameRate=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setEncodedFrameRate",function(){var t=J.sanitizeSpecialIntegerValue(e);-1<=t&&(i._encodedFrameRate=t,null!=i._monitorNotifier&&i._monitorNotifier.onEncodedFrameRateChange(i._encodedFrameRate))})},this.getDuration=function(){return i._duration},this.setClientMeasureInterface=function(t){x.validateInterface(t,new e.ClientMeasureInterface,"ClientMeasureInterface"),this._playerInterface=t},this.getPHT=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getPHT?this._playerInterface.getPHT():s.DEFAULT_PHT},this.getBufferLength=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getBufferLength?this._playerInterface.getBufferLength():s.DEFAULT_BUFFER_LENGTH},this.getSignalStrength=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getSignalStrength?this._playerInterface.getSignalStrength():s.DEFAULT_SIGNAL_STRENGTH},this.getRenderedFrameRate=function(){return this._playerInterface&&"function"==typeof this._playerInterface.getRenderedFrameRate?this._playerInterface.getRenderedFrameRate():s.DEFAULT_RENDERED_FRAME_RATE},this.setDuration=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setDuration",function(){var t=J.sanitizeSpecialIntegerValue(e);-1<=t&&(i._duration=t,null!=i._monitorNotifier&&i._monitorNotifier.onContentLengthChange(i._duration))})},this.getStreamUrl=function(){return i._streamUrl},this.setStreamUrl=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setStreamUrl",function(){null!=e&&(i._streamUrl=e,null!=i._monitorNotifier&&i._monitorNotifier.onStreamUrlChange(i._streamUrl))})},this.getModuleName=function(){return i._moduleName},this.getModuleVersion=function(){return i._moduleVersion},this.setModuleNameAndVersion=function(e,t){i._moduleName=e,i._moduleVersion=t},this.getPlayerType=function(){return i._playerType},this.setPlayerType=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerType",function(){i._playerType=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerTypeChange(i._playerType)})},this.getPlayerVersion=function(){return i._playerVersion},this.setPlayerVersion=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerVersion",function(){i._playerVersion=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerVersionChange(i._playerVersion)})},this.setMonitoringNotifier=function(e,t){return i._released?void 0:null==i._monitorNotifier&&(i._monitorNotifier=e,i._logger.setSessionId(t),!0)},this.removeMonitoringNotifier=function(){i._released||(i._monitorNotifier=null,i._logger.setSessionId(null))},this.pushCurrentState=function(){i.setPlayerState(i.getPlayerState()),i.setBitrateKbps(i.getBitrateKbps()),i.setDuration(i.getDuration()),i.setEncodedFrameRate(i.getEncodedFrameRate()),i.setStreamUrl(i.getStreamUrl()),i.setPlayerType(i.getPlayerType()),i.setPlayerVersion(i.getPlayerVersion());for(var e=0;e<i._pendingErrors.length;e++){var t=i._pendingErrors[e];i.setError(t)}i._pendingErrors=[]},this.getPlayerState=function(){return i._playerState},this.setPlayerState=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerState",function(){s.isValidPlayerState(e)?(i._playerState=e,null!=i._monitorNotifier&&i._monitorNotifier.onPlayerStateChange(i._playerState)):i._logger.error("PlayerStateManager.SetPlayerState(): invalid state: "+e)})},this.getBitrateKbps=function(){return i._bitrateKbps},this.setBitrateKbps=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setBitrateKbps",function(){var t=J.sanitizeSpecialIntegerValue(e);-1<=t&&(i._bitrateKbps=t,null!=i._monitorNotifier&&i._monitorNotifier.onBitrateChange(i._bitrateKbps))})},this.setPlayerSeekStart=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerSeekStart()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(s.SEEK_ACTIONS_TYPE.SEEK_START,e)})},this.setPlayerSeekEnd=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setPlayerSeekEnd()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(s.SEEK_ACTIONS_TYPE.SEEK_END,-1)})},this.setUserSeekButtonUp=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setUserSeekButtonUp()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(s.SEEK_ACTIONS_TYPE.BUTTON_UP,-1)})},this.setUserSeekButtonDown=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setUserSeekButtonDown()",function(){null!=i._monitorNotifier&&i._monitorNotifier.onSeekEvent(s.SEEK_ACTIONS_TYPE.BUTTON_DOWN,-1)})},this.setVideoResolutionWidth=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setVideoResolutionWidth()",function(){var t=J.sanitizeSpecialIntegerValue(e);0<t&&(i._width=t),null!=i._monitorNotifier&&i._monitorNotifier.onStreamResolutionWidthChange(i._width)})},this.setVideoResolutionHeight=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setVideoResolutionHeight()",function(){var t=J.sanitizeSpecialIntegerValue(e);0<t&&(i._height=t),null!=i._monitorNotifier&&i._monitorNotifier.onStreamResolutionHeightChange(i._height)})},this.setConnectionType=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setConnectionType()",function(){i._connectionType=e,null!=i._monitorNotifier&&i._monitorNotifier.onConnectionTypeChange(i._connectionType)})},this.setLinkEncryption=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setLinkEncryption()",function(){i._linkEncryption=e,null!=i._monitorNotifier&&i._monitorNotifier.onLinkEncryptionChange(i._linkEncryption)})},this.setSignalStrength=function(e){},this.setError=function(e){if(i._lastError=e,null!=i._monitorNotifier){var t=e.errorCode,n=e.severity;i._monitorNotifier.onError(t,n)}else i._pendingErrors.push(e)},this.sendError=function(e,n){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.sendError",function(){var a=new t.StreamerError(e,n);i.setError(a)})},this.reset=function(){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.reset",function(){i._bitrateKbps=-2,i._playerState=s.PlayerState.UNKNOWN,i._currentMetadata={},i._renderedFrameRate=-1,i._encodedFrameRate=-1,i._duration=-1,i._playerVersion=null,i._playerType=null,i._streamUrl=null,i._lastError=null,i._pendingErrors=[]})},this.setCDNServerIP=function(e){i._released||i._exceptionCatcher.runProtected("PlayerStateManager.setCDNServerIP",function(){null!=i._monitorNotifier&&i._monitorNotifier.onCDNServerIPChange(e)})},this.getError=function(){return i._lastError},function(e){i._systemFactory=e,i._logger=i._systemFactory.buildLogger(),i._logger.setModuleName("PlayerStateManager"),i._exceptionCatcher=i._systemFactory.buildExceptionCatcher()}.apply(i,arguments),s.DEFAULT_SIGNAL_STRENGTH=1e3,s.DEFAULT_RENDERED_FRAME_RATE=-1,s.DEFAULT_BUFFER_LENGTH=-1,s.DEFAULT_PHT=-1};s.PlayerState={STOPPED:"STOPPED",PLAYING:"PLAYING",BUFFERING:"BUFFERING",PAUSED:"PAUSED",UNKNOWN:"UNKNOWN",NOT_MONITORED:"NOT_MONITORED"},s.isValidPlayerState=function(e){return e===s.PlayerState.STOPPED||e===s.PlayerState.PLAYING||e===s.PlayerState.BUFFERING||e===s.PlayerState.PAUSED||e===s.PlayerState.UNKNOWN||e===s.PlayerState.NOT_MONITORED},s.SEEK_ACTIONS_TYPE={SEEK_START:"pss",SEEK_END:"pse",BUTTON_UP:"bu",BUTTON_DOWN:"bd"};var _,l,u,c,E,g=(e.ClientMeasureInterface=function(){this.getPHT=function(){},this.getBufferLength=function(){},this.getSignalStrength=function(){},this.getRenderedFrameRate=function(){}},e.HttpInterface=function(){this.makeRequest=function(e,t,n,i,a,r){},this.release=function(){}}),h=e.LoggingInterface=function(){this.consoleLog=function(e,t){},this.release=function(){}},S=e.MetadataInterface=function(){this.getBrowserName=function(){},this.getBrowserVersion=function(){},this.getDeviceBrand=function(){},this.getDeviceManufacturer=function(){},this.getDeviceModel=function(){},this.getDeviceType=function(){},this.getDeviceVersion=function(){},this.getFrameworkName=function(){},this.getFrameworkVersion=function(){},this.getOperatingSystemName=function(){},this.getOperatingSystemVersion=function(){},this.getDeviceCategory=function(){},this.release=function(){}},d=e.StorageInterface=function(){this.saveData=function(e,t,n,i){},this.loadData=function(e,t,n){},this.release=function(){}},f=e.SystemInterface=function(e,t,n,i,a,r){(function(e,t,n,i,a,r){x.validateInterface(e,new T,"TimeInterface"),x.validateInterface(t,new m,"TimerInterface"),x.validateInterface(n,new g,"HttpInterface"),x.validateInterface(i,new d,"StorageInterface"),x.validateInterface(a,new S,"MetadataInterface"),x.validateInterface(r,new h,"LoggingInterface"),this._timeInterface=e,this._timerInterface=t,this._httpInterface=n,this._storageInterface=i,this._metadataInterface=a,this._loggingInterface=r}).apply(this,arguments),this.release=function(){this._timeInterface.release(),this._timeInterface=null,this._timerInterface.release(),this._timerInterface=null,this._httpInterface.release(),this._httpInterface=null,this._storageInterface.release(),this._storageInterface=null,this._metadataInterface.release(),this._metadataInterface=null,this._loggingInterface.release(),this._loggingInterface=null}},T=e.TimeInterface=function(){this.getEpochTimeMs=function(){},this.release=function(){}},m=e.TimerInterface=function(){this.createTimer=function(e,t,n){},this.release=function(){}},R=t.JSON2={};function v(e){return e<10?"0"+e:e}function p(e){return _.lastIndex=0,_.test(e)?'"'+e.replace(_,function(e){var t=c[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+v(this.getUTCMonth()+1)+"-"+v(this.getUTCDate())+"T"+v(this.getUTCHours())+":"+v(this.getUTCMinutes())+":"+v(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}),"function"!=typeof R.stringify&&(_=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},R.stringify=function(e,t,n){var i;if(u=l="","number"==typeof n)for(i=0;i<n;i+=1)u+=" ";else"string"==typeof n&&(u=n);if((E=t)&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON2.stringify");return function e(t,n){var i,a,r,o,s,_=l,c=n[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof E&&(c=E.call(n,t,c)),typeof c){case"string":return p(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(l+=u,s=[],Object.prototype.toString.apply(c)===Object.prototype.toString.apply([])){for(o=c.length,i=0;i<o;i+=1)s[i]=e(i,c)||"null";return r=0===s.length?"[]":l?"[\n"+l+s.join(",\n"+l)+"\n"+_+"]":"["+s.join(",")+"]",l=_,r}if(E&&"object"==typeof E)for(o=E.length,i=0;i<o;i+=1)"string"==typeof E[i]&&(r=e(a=E[i],c))&&s.push(p(a)+(l?": ":":")+r);else for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(r=e(a,c))&&s.push(p(a)+(l?": ":":")+r);return r=0===s.length?"{}":l?"{\n"+l+s.join(",\n"+l)+"\n"+_+"}":"{"+s.join(",")+"}",l=_,r}}("",{"":e})});var y,N,A,C,I,M=t.JsonParse=(I={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},C=function(){switch(D(),N){case"{":return function(){var e,t={};if("{"===N){if(U("{"),D(),"}"===N)return U("}"),t;for(;N;){if(e=w(),D(),U(":"),Object.hasOwnProperty.call(t,e)&&O('Duplicate key "'+e+'"'),t[e]=C(),D(),"}"===N)return U("}"),t;U(","),D()}}O("Bad object")}();case"[":return function(){var e=[];if("["===N){if(U("["),D(),"]"===N)return U("]"),e;for(;N;){if(e.push(C()),D(),"]"===N)return U("]"),e;U(","),D()}}O("Bad array")}();case'"':return w();case"-":return b();default:return"0"<=N&&N<="9"?b():function(){switch(N){case"t":return U("t"),U("r"),U("u"),U("e"),!0;case"f":return U("f"),U("a"),U("l"),U("s"),U("e"),!1;case"n":return U("n"),U("u"),U("l"),U("l"),null}O("Unexpected '"+N+"'")}()}},function(e,t){var n;return A=e,y=0,N=" ",n=C(),D(),N&&O("Syntax error"),"function"==typeof t?function e(n,i){var a,r,o=n[i];if(o&&"object"==typeof o)for(a in o)Object.hasOwnProperty.call(o,a)&&(void 0!==(r=e(o,a))?o[a]=r:delete o[a]);return t.call(n,i,o)}({"":n},""):n}),P=t.CwsProtocol=function(){this.generateEvent=function(e,t,n,i){return i.seq=e,i.st=t,i.t=n,i},this.generateSessionEndEvent=function(e,t){var n=P.EVENT_TYPE_SESSION_END;return this.generateEvent(e,t,n,{})}};function O(e){throw{name:"SyntaxError",message:e,at:y,text:A}}function U(e){return e&&e!==N&&O("Expected '"+e+"' instead of '"+N+"'"),N=A.charAt(y),y+=1,N}function b(){var e,t="";for("-"===N&&U(t="-");"0"<=N&&N<="9";)t+=N,U();if("."===N)for(t+=".";U()&&"0"<=N&&N<="9";)t+=N;if("e"===N||"E"===N)for(t+=N,U(),"-"!==N&&"+"!==N||(t+=N,U());"0"<=N&&N<="9";)t+=N,U();return e=+t,isNaN(e)?void O("Bad number"):e}function w(){var e,t,n,i="";if('"'===N)for(;U();){if('"'===N)return U(),i;if("\\"===N)if(U(),"u"===N){for(t=n=0;t<4&&(e=parseInt(U(),16),isFinite(e));t+=1)n=16*n+e;i+=String.fromCharCode(n)}else{if("string"!=typeof I[N])break;i+=I[N]}else i+=N}O("Bad string")}function D(){for(;N&&N<=" ";)U()}P.version="2.4",P.gatewayPath="/0/wsg",P.DEFAULT_CLIENT_ID="0",P.DEFAULT_MAX_HEARTBEAT_INFOS=0,P.DEFAULT_PLAYHEAD_TIME=-1,P.DEFAULT_BUFFER_LENGTH=-1,P.DEFAULT_SIGNAL_STRENGTH=1e3,P.SDK_METADATA_SCHEMA="sdk.js.1",P.EVENT_TYPE_STATE_CHANGE="CwsStateChangeEvent",P.EVENT_TYPE_ERROR="CwsErrorEvent",P.EVENT_TYPE_SESSION_END="CwsSessionEndEvent",P.EVENT_TYPE_CUSTOM="CwsCustomEvent",P.EVENT_TYPE_SEEK="CwsSeekEvent",P.EVENT_TYPE_DATA_SAMPLE="CwsDataSamplesEvent",P.RESPONSE_STATUS_NO_ERRORS="ok",P.RESPONSE_KEY_STATUS="err",P.RESPONSE_KEY_CLIENT_ID="clid",P.RESPONSE_KEY_CONFIG="cfg",P.RESPONSE_KEY_EVENTS="evs",P.RESPONSE_CONFIG_KEY_MAX_HEARTBEAT_INFOS="maxhbinfos",P.RESPONSE_CONFIG_KEY_SEND_LOGS="slg",P.RESPONSE_CONFIG_KEY_HEARTBEAT_INTERVAL="hbi",P.RESPONSE_CONFIG_KEY_GATEWAY_URL="gw",P.MESSAGE_TYPE_SESSION_HEARTBEAT="CwsSessionHb",P.REQUEST_KEY_MESSAGE_TYPE="t",P.REQUEST_KEY_SESSION_TIME="st",P.REQUEST_KEY_SESSION_START_TIME="sst",P.REQUEST_KEY_IS_LIVE="lv",P.REQUEST_KEY_SEQUENCE_NUMBER="seq",P.REQUEST_KEY_CUSTOMER_KEY="cid",P.REQUEST_KEY_CLIENT_ID="clid",P.REQUEST_KEY_CLIENT_VERSION="clv",P.REQUEST_KEY_PROTOCOL_VERSION="pver",P.REQUEST_KEY_INSTANCE_ID="iid",P.REQUEST_KEY_SESSION_ID="sid",P.REQUEST_KEY_VIEWER_ID="vid",P.REQUEST_KEY_ASSET_NAME="an",P.REQUEST_KEY_PLAYER_NAME="pn",P.REQUEST_KEY_TAGS="tags",P.REQUEST_KEY_SESSION_FLAGS="sf",P.REQUEST_KEY_EVENTS="evs",P.REQUEST_KEY_LOGS="lg",P.REQUEST_KEY_HEARTBEAT_INFOS="hbinfos",P.REQUEST_KEY_IS_SDK_CLIENT="sdk",P.REQUEST_KEY_PAUSE_JOIN="pj",P.REQUEST_KEY_PLAYER_STATE="ps",P.REQUEST_KEY_BITRATE="br",P.REQUEST_KEY_CONTENT_LENGTH="cl",P.REQUEST_KEY_ENCODED_FRAME_RATE="efps",P.REQUEST_KEY_AVERAGE_FRAME_RATE="afps",P.REQUEST_KEY_RFPS_TOTAL="rfpstot",P.REQUEST_KEY_RFPS_COUNT="rfpscnt",P.REQUEST_KEY_RESOURCE="rs",P.REQUEST_KEY_PLAYHEAD_TIME="pht",P.REQUEST_KEY_BUFFER_LENGTH="bl",P.REQUEST_KEY_STREAM_URL="url",P.REQUEST_KEY_CAPABILITIES="caps",P.REQUEST_KEY_PLATFORM_METADATA="pm",P.REQUEST_KEY_VIDEO_WIDTH="w",P.REQUEST_KEY_VIDEO_HEIGHT="h",P.REQUEST_KEY_CONNECTION_TYPE="ct",P.REQUEST_KEY_LINK_ENCRYPTION="le",P.REQUEST_KEY_SIGNAL_STRENGTH="ss",P.REQUEST_KEY_STREAM_METADATA_CHANGE="strmetadata",P.REQUEST_PLATFORM_METADATA_KEY_SCHEMA="sch",P.REQUEST_PLATFORM_METADATA_KEY_BROWSER_NAME="br",P.REQUEST_PLATFORM_METADATA_KEY_BROWSER_VERSION="brv",P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_BRAND="dvb",P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MANUFACTURER="dvma",P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MODEL="dvm",P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_TYPE="dvt",P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_VERSION="dvv",P.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME="fw",P.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION="fwv",P.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION="cc",P.REQUEST_PLATFORM_METADATA_KEY_MODULE_NAME="mn",P.REQUEST_PLATFORM_METADATA_KEY_MODULE_VERSION="mv",P.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_NAME="os",P.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_VERSION="osv",P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_CATEGORY="cat",P.REQUEST_KEY_PROTOCOL_CAPP="caps",P.REQUEST_EVENT_KEY_TYPE="t",P.REQUEST_EVENT_KEY_SEQUENCE_NUMBER="seq",P.REQUEST_EVENT_KEY_SESSION_TIME="st",P.REQUEST_EVENT_KEY_SEEK_ACT_TYPE="act",P.REQUEST_EVENT_KEY_SEEK_TO_POS="skto",P.REQUEST_ERROR_EVENT_KEY_MESSAGE="err",P.REQUEST_ERROR_EVENT_KEY_FATAL="ft",P.REQUEST_STATE_CHANGE_EVENT_KEY_NEW="new",P.REQUEST_STATE_CHANGE_EVENT_KEY_OLD="old",P.REQUEST_CUSTOM_EVENT_KEY_NAME="name",P.REQUEST_CUSTOM_EVENT_KEY_ATTRIBUTES="attr",P.REQUEST_HEARTBEAT_INFO_KEY_SEQUENCE_NUMBER="seq",P.REQUEST_HEARTBEAT_INFO_KEY_STATUS="err",P.REQUEST_HEARTBEAT_INFO_KEY_ROUNDTRIP_TIME="rtt",P.REQUEST_KEY_IS_AD_SESSION="ad",P.REQUEST_CDN_SERVER_IP="csi",P.convertPlayerState=function(e){switch(e){case s.PlayerState.STOPPED:return P.eStopped;case s.PlayerState.PLAYING:return P.ePlaying;case s.PlayerState.BUFFERING:return P.eBuffering;case s.PlayerState.PAUSED:return P.ePaused;case s.PlayerState.NOT_MONITORED:return P.eNotMonitored;default:return P.eUnknown}},P.eStopped=1,P.ePlaying=3,P.eBuffering=6,P.ePaused=12,P.eNotMonitored=98,P.eUnknown=100,P.SessionFlags={GLOBAL:0,VIDEO:1,QUALITY_METRICS:2,BITRATE_METRICS:4},P.Capabilities={INSIGHTS:0};var F=(t.JSONInterface=function(){this.encode=function(e){},this.decode=function(e){}},t.LibJSONInterface=function(){this.encode=function(e){var t=null;try{t=R.stringify(e)}catch(e){}return t},this.decode=function(e){var t=null;try{t=M(e)}catch(e){}return x.isObject(t)||(t=null),t}}),L=t.CwsHeartbeat=function(){this._data={},function(){}.apply(this,arguments),this.get=function(){return this._data},this.setField=function(e,t){this._data[e]=t},this.setInnerField=function(e,t,n){this._data[e]||(this._data[e]={}),this._data[e][t]=n},this.setMessageType=function(e){this.setField(P.REQUEST_KEY_MESSAGE_TYPE,e)},this.setSessionTime=function(e){this.setField(P.REQUEST_KEY_SESSION_TIME,e)},this.setSessionStartTime=function(e){this.setField(P.REQUEST_KEY_SESSION_START_TIME,e)},this.setIsLive=function(e){this.setField(P.REQUEST_KEY_IS_LIVE,e)},this.setSequenceNumber=function(e){this.setField(P.REQUEST_KEY_SEQUENCE_NUMBER,e)},this.setCustomerKey=function(e){this.setField(P.REQUEST_KEY_CUSTOMER_KEY,e)},this.setClientId=function(e){this.setField(P.REQUEST_KEY_CLIENT_ID,e)},this.setClientVersion=function(e){this.setField(P.REQUEST_KEY_CLIENT_VERSION,e)},this.setProtocolVersion=function(e){this.setField(P.REQUEST_KEY_PROTOCOL_VERSION,e)},this.setCapfield=function(e){this.setField(P.REQUEST_KEY_PROTOCOL_CAPP,e)},this.setSessionId=function(e){this.setField(P.REQUEST_KEY_SESSION_ID,e)},this.setInstanceId=function(e){this.setField(P.REQUEST_KEY_INSTANCE_ID,e)},this.setViewerId=function(e){this.setField(P.REQUEST_KEY_VIEWER_ID,e)},this.setAssetName=function(e){this.setField(P.REQUEST_KEY_ASSET_NAME,e)},this.setPlayerName=function(e){this.setField(P.REQUEST_KEY_PLAYER_NAME,e)},this.setTags=function(e){this.setField(P.REQUEST_KEY_TAGS,e)},this.setSessionFlags=function(e){this.setField(P.REQUEST_KEY_SESSION_FLAGS,e)},this.setCapabilities=function(e){this.setField(P.REQUEST_KEY_CAPABILITIES,e)},this.setEvents=function(e){this.setField(P.REQUEST_KEY_EVENTS,e)},this.setIsSdkClient=function(e){this.setField(P.REQUEST_KEY_IS_SDK_CLIENT,e)},this.setLogs=function(e){this.setField(P.REQUEST_KEY_LOGS,e)},this.setHeartbeatInfos=function(e){this.setField(P.REQUEST_KEY_HEARTBEAT_INFOS,e)},this.setPlayerState=function(e){this.setField(P.REQUEST_KEY_PLAYER_STATE,e)},this.setPauseJoin=function(e){this.setField(P.REQUEST_KEY_PAUSE_JOIN,e)},this.setContentLength=function(e){this.setField(P.REQUEST_KEY_CONTENT_LENGTH,e)},this.setBitrate=function(e){this.setField(P.REQUEST_KEY_BITRATE,e)},this.setResource=function(e){this.setField(P.REQUEST_KEY_RESOURCE,e)},this.setEncodedFrameRate=function(e){this.setField(P.REQUEST_KEY_ENCODED_FRAME_RATE,e)},this.setAverageFrameRate=function(e){this.setField(P.REQUEST_KEY_AVERAGE_FRAME_RATE,e)},this.setRfpsObservationCount=function(e){this.setField(P.REQUEST_KEY_RFPS_COUNT,e)},this.setRfpsTotal=function(e){this.setField(P.REQUEST_KEY_RFPS_TOTAL,e)},this.setPlatformMetadataSchema=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_SCHEMA,e)},this.setBrowserName=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_BROWSER_NAME,e)},this.setBrowserVersion=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_BROWSER_VERSION,e)},this.setDeviceBrand=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_BRAND,e)},this.setDeviceManufacturer=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MANUFACTURER,e)},this.setDeviceModel=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_MODEL,e)},this.setDeviceType=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_TYPE,e)},this.setDeviceVersion=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_VERSION,e)},this.setFrameworkName=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME,e),this.setField(P.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_NAME,e)},this.setFrameworkVersion=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION,e),this.setField(P.REQUEST_PLATFORM_METADATA_KEY_FRAMEWORK_VERSION,e)},this.setOperatingSystemName=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_NAME,e.toUpperCase())},this.setOperatingSystemVersion=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_OPERATING_SYSTEM_VERSION,e)},this.setDeviceCategory=function(e){this.setInnerField(P.REQUEST_KEY_PLATFORM_METADATA,P.REQUEST_PLATFORM_METADATA_KEY_DEVICE_CATEGORY,e)},this.setPlayheadTime=function(e){this.setField(P.REQUEST_KEY_PLAYHEAD_TIME,e)},this.setBufferLength=function(e){this.setField(P.REQUEST_KEY_BUFFER_LENGTH,e)},this.setStreamUrl=function(e){this.setField(P.REQUEST_KEY_STREAM_URL,e)},this.setStreamWidth=function(e){this.setField(P.REQUEST_KEY_VIDEO_WIDTH,e)},this.setStreamHeight=function(e){this.setField(P.REQUEST_KEY_VIDEO_HEIGHT,e)},this.setConnectionType=function(e){this.setField(P.REQUEST_KEY_CONNECTION_TYPE,e)},this.setLinkEncryption=function(e){this.setField(P.REQUEST_KEY_LINK_ENCRYPTION,e)},this.setIsAdSession=function(){this.setField(P.REQUEST_KEY_IS_AD_SESSION,!0)},this.setSignalStrength=function(e){this.setField(P.REQUEST_KEY_SIGNAL_STRENGTH,e)},this.setModuleName=function(e){this.setInnerField(P.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION,P.REQUEST_PLATFORM_METADATA_KEY_MODULE_NAME,e)},this.setModuleVersion=function(e){this.setInnerField(P.REQUEST_PLATFORM_METADATA_KEY_CLIENT_CONFIGURATION,P.REQUEST_PLATFORM_METADATA_KEY_MODULE_VERSION,e)},this.setCDNServerIP=function(e){this.setField(P.REQUEST_CDN_SERVER_IP,e)}},K=t.CwsSession=function(e,t,i,a,r,o,_,l,u,c,E){var g=this;g._heartbeatTimerCancel=null,g._startTimeMs=0,g._heartbeatSequenceNumber=0,g._sessionFlags=P.SessionFlags.GLOBAL,g._capabilities=P.Capabilities.INSIGHTS,g._heartbeatInfos=[],g._lastRequestSentMs=-1,g._bitrateKbps=-2,g._resource=null,g._playerState=s.PlayerState.NOT_MONITORED,g._encodedFrameRate=-1,g._contentLengthSec=-1,g._streamUrl=null,g._width=-1,g._height=-1,g._playerStateManager=null,g._assetName=null,g._viewerId=null,g._playerName=null,g._isLive=null,g._tags={},g._browserName=null,g._browserVersion=null,g._deviceBrand=null,g._deviceManufacturer=null,g._deviceModel=null,g._deviceType=null,g._deviceVersion=null,g._frameworkName=null,g._frameworkVersion=null,g._operatingSystemName=null,g._operatingSystemVersion=null,g._deviceCategory=null,g._moduleName=null,g._moduleVersion=null,g._connectionType=null,g._linkEncryption=null,g._cdnServerIP=null,g._pauseJoin=!1,g._hasJoined=!1,g._cleanedUp=!1,g._willEndSoon=!1,g._rfpsTimerCancel=null,g._rfpsTimerInterval=1e3,g._playingFpsObservationCount=0,g._playingFpsTotal=0,function(e,t,n,i,a,r,o,s,_,l,u){this._eventQueue=e,this._client=t,this._clientSettings=n,this._logger=i,this._logger.setModuleName("CwsSession"),this._exceptionCatcher=a,this._timer=r,this._gatewayControl=o,this._cwsProtocol=s,this._time=_,this._logBuffer=l,this._clientConfig=u}.apply(this,arguments),this.cleanup=function(){this._clientConfig=null,this._logBuffer=null,this._systemSettings=null,this._time=null,this._cwsProtocol=null,this._gatewayControl=null,this._timer=null,this._exceptionCatcher=null,this._logger=null,this._clientSettings=null,this._client=null,this._eventQueue.flush(),this._eventQueue=null,this._cleanedUp=!0},this.start=function(e){this._session=e,this._global=this._session._global,this._logger.setSessionId(this._session._id),this._startTimeMs=this._time.current(),(this.isVideoSession()||this.isAdSession())&&(this._sessionFlags+=K.DEFAULT_VIDEO_SESSION_FLAGS)},this.willEndSoon=function(){this._willEndSoon=!0},this.initialize=function(){this._logger.debug("initialize()")},this.end=function(){(this.isVideoSession()||this.isAdSession())&&(this._logger.debug("end(): schedule the last hb before session cleanup"+g.sessionTypeTag()),this.enqueueSessionEndEvent()),this.cancelHeartbeatTimer(),this.sendHeartbeat()},this.startSendingHeartbeats=function(){this._willEndSoon||(this.sendHeartbeat(),this.resetHeartbeatTimer())},this.setBrowserName=function(e){g._logger.debug("setBrowserName(): "+e);var t=g._browserName;t!==e&&null!=e&&(g._logger.debug("Change browserName from "+t+" to "+e),g._browserName=e)},this.setBrowserVersion=function(e){g._logger.debug("setBrowserVersion(): "+e);var t=g._browserVersion;t!==e&&null!=e&&(g._logger.debug("Change browserVersion from "+t+" to "+e),g._browserVersion=e)},this.setDeviceBrand=function(e){g._logger.debug("setDeviceBrand(): "+e);var t=g._deviceBrand;t!==e&&null!=e&&(g._logger.debug("Change deviceBrand from "+t+" to "+e),g._deviceBrand=e)},this.setDeviceManufacturer=function(e){g._logger.debug("setDeviceManufacturer(): "+e);var t=g._deviceManufacturer;t!==e&&null!=e&&(g._logger.debug("Change deviceManufacturer from "+t+" to "+e),g._deviceManufacturer=e)},this.setDeviceModel=function(e){g._logger.debug("setDeviceModel(): "+e);var t=g._deviceModel;t!==e&&null!=e&&(g._logger.debug("Change deviceModel from "+t+" to "+e),g._deviceModel=e)},this.setDeviceType=function(e){g._logger.debug("setDeviceBrand(): "+e);var t=g._deviceType;t!==e&&null!=e&&(g._logger.debug("Change deviceType from "+t+" to "+e),g._deviceType=e)},this.setDeviceVersion=function(e){g._logger.debug("setDeviceVersion(): "+e);var t=g._deviceVersion;t!==e&&null!=e&&(g._logger.debug("Change deviceVersion from "+t+" to "+e),g._deviceVersion=e)},this.setOperatingSystemName=function(e){g._logger.debug("setOperatingSystemName(): "+e);var t=g._operatingSystemName;t!==e&&null!=e&&(g._logger.debug("Change operatingSystemName from "+t+" to "+e),g._operatingSystemName=e)},this.setOperatingSystemVersion=function(e){g._logger.debug("setOperatingSystemVersion(): "+e);var t=g._operatingSystemVersion;t!==e&&null!=e&&(g._logger.debug("Change operatingSystemVersion from "+t+" to "+e),g._operatingSystemVersion=e)},this.setDeviceCategory=function(e){g._logger.debug("setDeviceCategory(): "+e);var t=g._deviceCategory;t!==e&&null!=e&&(g._logger.debug("Change operatingSystemVersion from "+t+" to "+e),g._deviceCategory=e)},this.getFrameworkName=function(){return g._frameworkName},this.setFrameworkName=function(e){g._logger.debug("setFrameworkName(): "+e);var t=g._frameworkName;t!==e&&null!=e&&(g._logger.debug("Change frameworkName from "+t+" to "+e),g._frameworkName=e)},this.getFrameworkVersion=function(){return g._frameworkVersion},this.setFrameworkVersion=function(e){g._logger.debug("setFrameworkVersion(): "+e);var t=g._frameworkVersion;t!==e&&null!=e&&(g._logger.debug("Change frameworkVersion from "+t+" to "+e),g._frameworkVersion=e)},this.setStreamUrl=function(e){g._logger.debug("setStreamUrl(): "+e);var t=g._streamUrl;t!==e&&null!=e&&(g._logger.debug("Change stream url from "+t+" to "+e),g._streamUrl=e)},this.setBitrateKbps=function(e){g._logger.debug("setBitrateKbps(): "+e);var t=g._bitrateKbps;t!==e&&0<e&&(g._logger.info("Change bitrate from "+t+" to "+e),g.enqueueBitrateChangeEvent(t,e),g._bitrateKbps=e)},this.setResource=function(e){g._logger.debug("setResource(): "+e);var t=g._resource;t!==e&&null!=e&&(g._logger.info("Change resource from "+t+" to "+e),g._resource=e)},this.setAssetName=function(e){g._logger.debug("setAssetName(): "+e),g._assetName!==e&&null!=e&&(g._logger.info("Change assetName from "+g._assetName+" to "+e),g._assetName=e)},this.setIsLive=function(e){g._logger.debug("setIsLive(): "+e);var t=g._isLive;t!==e&&null!=e&&(g._logger.info("Change isLive from "+t+" to "+e),g._isLive=e)},this.setViewerId=function(e){g._logger.debug("setViewerId(): "+e);var t=g._viewerId;t!==e&&null!=e&&(g._logger.info("Change viewerId from "+t+" to "+e),g._viewerId=e)},this.setPlayerName=function(e){g._logger.debug("setPlayerName(): "+e);var t=g._playerName;t!==e&&null!=e&&(g._logger.info("Change playerName from "+t+" to "+e),g._playerName=e)},this.setTags=function(e){g._logger.debug("setTags()");var t=g._tags;x.ObjectShallowEquals(t,e)||null==e||(g._logger.info("Change tags from "+x.ObjectToString(t)+" to "+x.ObjectToString(e)),g._tags=e)},this.setEncodedFrameRate=function(e){g._logger.debug("setEncodedFrameRate(): "+e),g._encodedFrameRate=e},this.setContentLength=function(e){g._logger.debug("setContentLength(): "+e),g._contentLengthSec=e},this.setPlayerState=function(e){if(g._logger.debug("setPlayerState(): "+e),g._hasJoined||e!=s.PlayerState.PLAYING||(g.togglePauseJoin(!1),g._hasJoined=!0),g._playerState!==e){var t=g._playerState;g._logger.info("setPlayerState(): changing player state from "+t+" to "+e),g.enqueuePlayerStateChangeEvent(t,e),g._playerState=e}},this.setStreamResolutionWidth=function(e){g._logger.debug("setStreamResolutionWidth(): "+e);var t=g._width;t!==e&&0<e&&(g._logger.debug("Change stream resolution width from "+t+" to "+e),g.enqueueResolutionWidthChangeEvent(t,e),g._width=e)},this.setStreamResolutionHeight=function(e){g._logger.debug("setStreamResolutionHeight(): "+e);var t=g._height;t!==e&&0<e&&(g._logger.debug("Change stream resolution height from "+t+" to "+e),g.enqueueResolutionHeightChangeEvent(t,e),g._height=e)},this.setConnectionType=function(e){g._logger.debug("setConnectionType(): "+e);var t=g._connectionType;t!==e&&null!=e&&(g._logger.debug("Change network connection type from "+t+" to "+e),g.enqueueConnectionTypeChangeEvent(t,e),g._connectionType=e)},this.setLinkEncryption=function(e){g._logger.debug("setLinkEncryption(): "+e);var t=g._linkEncryption;t!==e&&null!=e&&(g._logger.debug("Change network link encryption from "+t+" to "+e),g.enqueueLinkEncryptionChangeEvent(t,e),g._linkEncryption=e)},this.setCDNServerIP=function(e){g._logger.debug("setCDNServerIP(): "+e);var t=g._cdnServerIP;t!==e&&x.isValidString(e)&&(g._logger.debug("Change CDN Server IP from "+t+" to "+e),g.enqueueCDNServerIPChangeEvent(t,e),g._cdnServerIP=e)},this.togglePauseJoin=function(e){if(g._logger.debug("togglePauseJoin()"),g._pauseJoin!==e){var t=g._pauseJoin,n=!g._pauseJoin;g.enqueuePauseJoinChangeEvent(t,n),g._pauseJoin=!g._pauseJoin}else g._logger.debug("togglePauseJoin(): same value, ignoring")},this.sendError=function(e,t){g.enqueueErrorEvent(e,t)},this.enqueueEvent=function(e,t){if(t[P.REQUEST_EVENT_KEY_TYPE]=e,t[P.REQUEST_EVENT_KEY_SESSION_TIME]=this.getSessionTime(),t[P.REQUEST_EVENT_KEY_SEQUENCE_NUMBER]=this._eventQueue.getNumber(),this._playerStateManager){var n=J.Integer(this._playerStateManager.getPHT(),0,null,-1),i=J.Integer(this._playerStateManager.getBufferLength(),0,null,-1);0<=n&&(t[P.REQUEST_KEY_PLAYHEAD_TIME]=n),0<i&&(t[P.REQUEST_KEY_BUFFER_LENGTH]=i)}this._eventQueue.enqueue(t)},this.setPlayerStateManager=function(e){g._playerStateManager=e,null!=g._playerStateManager?g.startRfpsTimer():g.cancelRfpsTimer()},this.enqueueSessionEndEvent=function(){var e=this.getSessionTime(),t=this.getNextEventNumber(),n=this._cwsProtocol.generateSessionEndEvent(t,e);this._eventQueue.enqueue(n)},this.enqueueErrorEvent=function(e,t){var n={};n[P.REQUEST_ERROR_EVENT_KEY_MESSAGE]=e,n[P.REQUEST_ERROR_EVENT_KEY_FATAL]=t,this.enqueueEvent(P.EVENT_TYPE_ERROR,n)},this.enqueueBitrateChangeEvent=function(e,t){var n={},i={};0<e&&(i[P.REQUEST_KEY_BITRATE]=e),n[P.REQUEST_KEY_BITRATE]=t,this.declareStateChange(n,i)},this.enqueueSeekEvent=function(e,t){var n={};n[P.REQUEST_EVENT_KEY_SEEK_ACT_TYPE]=e,0<=t&&(n[P.REQUEST_EVENT_KEY_SEEK_TO_POS]=t),this.enqueueEvent(P.EVENT_TYPE_SEEK,n)},this.enqueueResolutionWidthChangeEvent=function(e,t){var n={},i={};-1!==e&&(i[P.REQUEST_KEY_VIDEO_WIDTH]=e),n[P.REQUEST_KEY_VIDEO_WIDTH]=t,this.declareStateChange(n,i)},this.enqueueResolutionHeightChangeEvent=function(e,t){var n={},i={};-1!==e&&(i[P.REQUEST_KEY_VIDEO_HEIGHT]=e),n[P.REQUEST_KEY_VIDEO_HEIGHT]=t,this.declareStateChange(n,i)},this.enqueueConnectionTypeChangeEvent=function(e,t){var n={},i={};null!==e&&(i[P.REQUEST_KEY_CONNECTION_TYPE]=e),n[P.REQUEST_KEY_CONNECTION_TYPE]=t,this.declareStateChange(n,i)},this.enqueueLinkEncryptionChangeEvent=function(e,t){var n={},i={};null!==e&&(i[P.REQUEST_KEY_LINK_ENCRYPTION]=e),n[P.REQUEST_KEY_LINK_ENCRYPTION]=t,this.declareStateChange(n,i)},this.enqueueCDNServerIPChangeEvent=function(e,t){var n={},i={};x.isValidString(e)&&(i[P.REQUEST_CDN_SERVER_IP]=e),n[P.REQUEST_CDN_SERVER_IP]=t,this.declareStateChange(n,i)},this.enqueuePauseJoinChangeEvent=function(e,t){var n={},i={};i[P.REQUEST_KEY_PAUSE_JOIN]=e,n[P.REQUEST_KEY_PAUSE_JOIN]=t,this.declareStateChange(n,i)},this.enqueuePlayerStateChangeEvent=function(e,t){var n={},i={};n[P.REQUEST_KEY_PLAYER_STATE]=P.convertPlayerState(t),i[P.REQUEST_KEY_PLAYER_STATE]=P.convertPlayerState(e),this.declareStateChange(n,i)},this.declareStateChange=function(e,t){var n={};n[P.REQUEST_STATE_CHANGE_EVENT_KEY_NEW]=e,null!=t&&0<x.dictCount(t)&&(n[P.REQUEST_STATE_CHANGE_EVENT_KEY_OLD]=t),this.enqueueEvent(P.EVENT_TYPE_STATE_CHANGE,n)},this.enqueueCustomEvent=function(e,t){var n={};n[P.REQUEST_CUSTOM_EVENT_KEY_NAME]=e,n[P.REQUEST_CUSTOM_EVENT_KEY_ATTRIBUTES]=t,this.enqueueEvent(P.EVENT_TYPE_CUSTOM,n)},this.cancelHeartbeatTimer=function(){null!=g._heartbeatTimerCancel&&(g._heartbeatTimerCancel(),g._heartbeatTimerCancel=null)},this.resetHeartbeatTimer=function(){g.cancelHeartbeatTimer();var e=1e3*g._clientSettings.heartbeatInterval;g._heartbeatTimerCancel=g._timer.create(g.sendHeartbeat,e,"Session.sendHeartbeat")},this.cancelRfpsTimer=function(){null!=g._rfpsTimerCancel&&(g._rfpsTimerCancel(),g._rfpsTimerCancel=null)},this.startRfpsTimer=function(){g.cancelRfpsTimer(),g._rfpsTimerCancel=g._timer.create(g.countRfps,g._rfpsTimerInterval,"Session.startRfpsTimer")},this.createHeartbeatInfo=function(){var e={err:"pending"};e.seq=g._heartbeatSequenceNumber-1,e.sentAt=g.getSessionTime(),e.rtt=-1,g._heartbeatInfos.push(e)},this.updateHeartbeatInfoOnFailure=function(e,t){for(var n=0;n<g._heartbeatInfos.length;n++){var i=g._heartbeatInfos[n];i.seq===e&&(i.rtt=g.getSessionTime()-i.sentAt,i.err=t)}},this.updateHeartbeatInfoOnSuccess=function(e){for(var t=0;t<g._heartbeatInfos.length;t++){var n=g._heartbeatInfos[t];n.seq===e&&(n.rtt=g.getSessionTime()-n.sentAt,n.err="ok")}},this.removeOutdatedHeartbeatInfos=function(){for(var e=g._clientConfig.get(G.CONFIG_KEY_MAX_HEARTBEAT_INFOS),t=[],n=0;n<g._heartbeatInfos.length;n++)g._heartbeatInfos[n].seq<g._heartbeatSequenceNumber-e&&t.push(n);for(var i=[],a=0;a<g._heartbeatInfos.length;a++)g._heartbeatInfos[a].seq,t.indexOf(a)<0&&i.push(g._heartbeatInfos[a]);g._heartbeatInfos=i},this.compileHeartbeatInfos=function(){g.removeOutdatedHeartbeatInfos();for(var e=[],t=0;t<g._heartbeatInfos.length;t++){var n=g._heartbeatInfos[t],i={};i[P.REQUEST_HEARTBEAT_INFO_KEY_SEQUENCE_NUMBER]=n.seq,i[P.REQUEST_HEARTBEAT_INFO_KEY_ROUNDTRIP_TIME]=n.rtt,i[P.REQUEST_HEARTBEAT_INFO_KEY_STATUS]=n.err,e.push(i)}return e},this.makeHeartbeat=function(){var e=g._eventQueue.flush();if(g.isGlobalSession()&&0===e.length)return null;var t=new L;if(t.setMessageType(P.MESSAGE_TYPE_SESSION_HEARTBEAT),t.setCustomerKey(g._clientSettings.customerKey),t.setClientId(g._clientConfig.get(G.CONFIG_KEY_CLIENT_ID)),t.setSessionId(g._session._id),t.setSequenceNumber(g._heartbeatSequenceNumber),t.setProtocolVersion(P.version),t.setClientVersion(n.version),t.setInstanceId(g._client.getId()),t.setCapfield(0),null!=g._connectionType&&t.setConnectionType(g._connectionType),null!=g._linkEncryption&&t.setLinkEncryption(g._linkEncryption),x.isValidString(g._cdnServerIP)&&t.setCDNServerIP(g._cdnServerIP),t.setPlatformMetadataSchema(P.SDK_METADATA_SCHEMA),null!=g._browserName&&t.setBrowserName(g._browserName),null!=g._browserVersion&&t.setBrowserVersion(g._browserVersion),null!=g._deviceBrand&&t.setDeviceBrand(g._deviceBrand),null!=g._deviceManufacturer&&t.setDeviceManufacturer(g._deviceManufacturer),null!=g._deviceModel&&t.setDeviceModel(g._deviceModel),null!=g._deviceType&&t.setDeviceType(g._deviceType),null!=g._deviceVersion&&t.setDeviceVersion(g._deviceVersion),null!=g._frameworkName&&t.setFrameworkName(g._frameworkName),null!=g._frameworkVersion&&t.setFrameworkVersion(g._frameworkVersion),null!=g._operatingSystemName&&t.setOperatingSystemName(g._operatingSystemName),null!=g._operatingSystemVersion&&t.setOperatingSystemVersion(g._operatingSystemVersion),null!=g._deviceCategory&&t.setDeviceCategory(g._deviceCategory),null!=g._playerStateManager&&(g._moduleName=g._playerStateManager.getModuleName(),null!=g._moduleName&&t.setModuleName(g._moduleName)),null!=g._playerStateManager&&(g._moduleVersion=g._playerStateManager.getModuleVersion(),null!=g._moduleVersion&&t.setModuleVersion(g._moduleVersion)),null!=g._viewerId&&t.setViewerId(g._viewerId),0<x.dictCount(g._tags)&&t.setTags(g._tags),g.isVideoSession()||g.isAdSession()){g.isAdSession()&&t.setIsAdSession(),null!=g._assetName&&t.setAssetName(g._assetName),t.setSessionFlags(g._sessionFlags);var i,a,r,o=P.convertPlayerState(g._playerState);t.setPlayerState(o),t.setPauseJoin(g._pauseJoin),null!=g._playerName&&t.setPlayerName(g._playerName),null!=g._isLive&&t.setIsLive(g._isLive),0<g._contentLengthSec&&t.setContentLength(g._contentLengthSec),0<g._bitrateKbps&&t.setBitrate(g._bitrateKbps),null!==g._resource&&t.setResource(g._resource),0<g._encodedFrameRate&&t.setEncodedFrameRate(g._encodedFrameRate),null!=g._playerStateManager&&(i=J.Integer(g._playerStateManager.getPHT(),0,null,-1),a=J.Integer(g._playerStateManager.getBufferLength(),0,null,-1),r=g._playerStateManager.getSignalStrength()),0<=i&&t.setPlayheadTime(i),0<a&&t.setBufferLength(a);var s=g.updateAverageFrameRate();0<s&&t.setAverageFrameRate(s),0<g._playingFpsTotal&&t.setRfpsTotal(J.Integer(g._playingFpsTotal,0,null,-1)),0<g._playingFpsObservationCount&&t.setRfpsObservationCount(J.Integer(g._playingFpsObservationCount,0,null,-1)),r<=0&&t.setSignalStrength(r),null!=g._streamUrl&&t.setStreamUrl(g._streamUrl),0<g._width&&t.setStreamWidth(g._width),0<g._height&&t.setStreamHeight(g._height)}else t.setSessionFlags(P.SessionFlags.GLOBAL);if(0<e.length&&t.setEvents(e),t.setCapabilities(g._capabilities),t.setIsSdkClient(!0),g._clientConfig.get(G.CONFIG_KEY_SEND_LOGS)&&t.setLogs(g._logBuffer.flush()),0<g._clientConfig.get(G.CONFIG_KEY_MAX_HEARTBEAT_INFOS)){var _=g.compileHeartbeatInfos();0<_.length&&t.setHeartbeatInfos(_)}return t.setSessionStartTime(g._startTimeMs),t.setSessionTime(g.getSessionTime()),g._heartbeatSequenceNumber++,t.get()},this.sendHeartbeat=function(){if(!g._cleanedUp){var e=g.makeHeartbeat();null!=e&&g.postHeartbeat(e)}},this.countRfps=function(){if(g._playerState===s.PlayerState.PLAYING){var e=g._playerStateManager.getRenderedFrameRate();0<=e&&(g._playingFpsTotal+=e,g._playingFpsObservationCount++)}},this.updateAverageFrameRate=function(){if(g._playerState!==s.PlayerState.PLAYING)return-1;var e=g._playerStateManager.getRenderedFrameRate();return 0<=e?(g._playingFpsTotal+=e,g._playingFpsObservationCount++,x.Int32.Cast(1*g._playingFpsTotal/g._playingFpsObservationCount)):-1},this.postHeartbeat=function(e){g.createHeartbeatInfo();var t=g._heartbeatSequenceNumber-1;g._logger.info("postHeartbeat(): Send HB["+t+"]"+g.sessionTypeTag()),g._gatewayControl.send(e,function(e,n){g.onHeartbeatResponse(e,n,t)})},this.onHeartbeatResponse=function(e,t,n){g._cleanedUp||g._exceptionCatcher.runProtected("onHeartbeatResponse",function(){if(e){var i=t;if(null!=i){g._logger.debug("onHeartbeatResponse(): received valid response for HB["+n+"]"),g.updateHeartbeatInfoOnSuccess(n);var a=i[P.RESPONSE_KEY_CLIENT_ID];null!=a&&a!=g._clientConfig.get(G.CONFIG_KEY_CLIENT_ID)&&(g._logger.debug("onHeartbeatResponse(): setting the client id to "+a+" (from gateway)"),g._clientConfig.set(G.CONFIG_KEY_CLIENT_ID,a),g._clientConfig.save());var r=i[P.RESPONSE_KEY_STATUS];null!=r&&r!=P.RESPONSE_STATUS_NO_ERRORS&&g._logger.error("onHeartbeatResponse(): error from gateway: "+r);var o=i[P.RESPONSE_KEY_CONFIG];if("object"==typeof o){var s=o[P.RESPONSE_CONFIG_KEY_MAX_HEARTBEAT_INFOS];null!=s&&g._clientConfig.get(G.CONFIG_KEY_MAX_HEARTBEAT_INFOS)!==s&&(g._logger.debug("onHeartbeatResponse(): setting Maximum Heartbeat Infos to "+s+" (from gateway)"),g._clientConfig.set(G.CONFIG_KEY_MAX_HEARTBEAT_INFOS,s));var _=o[P.RESPONSE_CONFIG_KEY_SEND_LOGS],l=null!=_&&x.AsBoolean(_);l!==g._clientConfig.get(G.CONFIG_KEY_SEND_LOGS)&&(g._logger.debug("onHeartbeatResponse(): turning "+(l?"on":"off")+" sending of logs"),g._clientConfig.set(G.CONFIG_KEY_SEND_LOGS,l));var u=o[P.RESPONSE_CONFIG_KEY_HEARTBEAT_INTERVAL];if(null!=u){var c=x.Int32.Cast(u);c!=g._clientSettings.heartbeatInterval&&(g._logger.debug("onHeartbeatResponse(): received hbIntervalMs from gateway: "+c),g._clientSettings.heartbeatInterval=c,null!=g._heartbeatTimerCancel&&g.resetHeartbeatTimer())}var E=o[P.RESPONSE_CONFIG_KEY_GATEWAY_URL];null!=E&&E!=g._clientSettings.gatewayUrl&&(g._logger.debug("onHeartbeatResponse(): received gatewayUrl from gateway: "+E),g._clientSettings.gatewayUrl=E)}}else g._logger.warning("onHeartbeatResponse(): decoded heartbeat response is null.")}else{var h=t;x.isValidString(h)?x.stringStartsWith(h,"HTTP timeout")?g._logger.warning("onHeartbeatResponse(): "+h):g._logger.error("onHeartbeatResponse(): failed to send heartbeat: "+h):(h=Y.DEFAULT_HEARTBEAT_ERROR_MESSAGE,g._logger.error("onHeartbeatResponse(): "+h)),g.updateHeartbeatInfoOnFailure(n,h)}})},this.getSessionTime=function(){return x.Int32.Cast(g._time.current()-g._startTimeMs)},this.getNextEventNumber=function(){return this._eventQueue.getNumber()},this.sessionTypeTag=function(){return this.isGlobalSession()?" (global session)":""},this.isGlobalSession=function(){return this._global==K.SESSION_TYPE.GLOBAL},this.isVideoSession=function(){return this._global==K.SESSION_TYPE.VIDEO},this.isAdSession=function(){return this._global==K.SESSION_TYPE.AD}};K.DEFAULT_VIDEO_SESSION_FLAGS=P.SessionFlags.VIDEO+P.SessionFlags.QUALITY_METRICS+P.SessionFlags.BITRATE_METRICS,K.SESSION_TYPE={VIDEO:"Video",GLOBAL:"Global",AD:"Ad"};var Y=(t.IMonitor=function(){this.onPlayerStateChange=function(e){},this.onBitrateChange=function(e){},this.onSeekEvent=function(e,t){},this.onEncodedFrameRateChange=function(e){},this.onRenderedFrameRateChange=function(e){},this.onContentLengthChange=function(e){},this.onPlayheadTimeChange=function(e){},this.onStreamUrlChange=function(e){},this.onBufferLengthChange=function(e){},this.onPlayerTypeChange=function(e){},this.onPlayerVersionChange=function(e){},this.onStreamResolutionWidthChange=function(e){},this.onStreamResolutionHeightChange=function(e){},this.onConnectionTypeChange=function(e){},this.onLinkEncryptionChange=function(e){},this.onSignalStrengthChange=function(e){},this.onError=function(e,t){},this.onRelease=function(){},this.onCDNServerIPChange=function(e){}},t.Session=function(){var t=this;t._contentMetadata=null,t._playerStateManager=null,t._id=0,t._global=K.SESSION_TYPE.VIDEO,t._cleaningUp=!1,t._cleanedUp=!1,t._adPlaying=!1,t._adStream=null,t._adPlayer=null,t._adPosition=null,t._ignorePlayerState=!1,t._pooledPlayerState=s.PlayerState.NOT_MONITORED,t._ignoreBitrateAndResource=!1,t._ignorePlayheadTimeandBufferLength=!1,t._ignoreEncodedFrameRateAndDuration=!1,t._ignoreError=!1,function(e,t,n,i,a,r,o,s){this._id=e,this._global=t,this._contentMetadata=n,this._clientConfig=i,this._systemMetadata=a,this._cwsSession=r,this._exceptionCatcher=o,this._logger=s,this._logger.setModuleName("Session"),this._logger.setSessionId(x.ToString(this._id))}.apply(t,arguments),this.start=function(){t.isVideoSession()||t.isAdSession()?t._logger.info("start(): assetName="+t._contentMetadata.assetName):t._logger.info("start()"+t.sessionTypeTag()),t._cwsSession.start(this),t._clientConfig.isReady()?t.initiateSession():t._clientConfig.register(function(){t.initiateSession()})},this.cleanup=function(){t._logger.info("cleanup()"+t.sessionTypeTag()),t._cleaningUp=!0,t._cwsSession.willEndSoon(),t._clientConfig.isReady()?t.endCwsSessionAndCleanupAll():t._clientConfig.register(function(){t.endCwsSessionAndCleanupAll()})},this.cleanupAll=function(){t._logger.debug("cleanupAll()"+t.sessionTypeTag()),(t.isVideoSession()||t.isAdSession())&&null!=t._playerStateManager&&t.detachPlayer(),t._contentMetadata=null,t._logger.setSessionId(null),t._logger=null,t._exceptionCatcher=null,t._client=null,t._clientConfig=null,t._systemMetadata=null,t._cwsSession.cleanup(),t._cwsSession=null,t._cleanedUp=!0},this.endCwsSessionAndCleanupAll=function(){t._cwsSession.end(),t.cleanupAll()},this.initiateSession=function(){t._cwsSession.initialize(),t.setStatesFromSystemMetadata(),(t.isVideoSession()||t.isAdSession())&&(t.setStatesFromContentMetadata(),t.enqueueEventForContentMetadata()),t._cwsSession.startSendingHeartbeats()},this.enqueueEventForContentMetadata=function(){var n={};if(null!=t._contentMetadata.assetName?n[P.REQUEST_KEY_ASSET_NAME]=t._contentMetadata.assetName:t._logger.warning("enqueueEventForContentMetadata(): assetName was not set."),null!=t._contentMetadata.applicationName?(void 0===n[P.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(n[P.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),n[P.REQUEST_KEY_STREAM_METADATA_CHANGE][P.REQUEST_KEY_PLAYER_NAME]=t._contentMetadata.applicationName):t._logger.warning("enqueueEventForContentMetadata(): applicationName was not set."),null!=t._contentMetadata.streamUrl?n[P.REQUEST_KEY_STREAM_URL]=t._contentMetadata.streamUrl:t._logger.warning("enqueueEventForContentMetadata(): streamUrl was not set."),null!=t._contentMetadata.viewerId?(void 0===n[P.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(n[P.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),n[P.REQUEST_KEY_STREAM_METADATA_CHANGE][P.REQUEST_KEY_VIEWER_ID]=t._contentMetadata.viewerId):t._logger.warning("enqueueEventForContentMetadata(): viewerId was not set."),null!=t._contentMetadata.defaultResource?n[P.REQUEST_KEY_RESOURCE]=t._contentMetadata.defaultResource:t._logger.warning("enqueueEventForContentMetadata(): defaultResource was not set."),-1<t._contentMetadata.duration?n[P.REQUEST_KEY_CONTENT_LENGTH]=t._contentMetadata.duration:t._logger.warning("enqueueEventForContentMetadata(): duration was not set."),-1<t._contentMetadata.encodedFrameRate?n[P.REQUEST_KEY_ENCODED_FRAME_RATE]=t._contentMetadata.encodedFrameRate:t._logger.warning("enqueueEventForContentMetadata(): encodedFrameRate was not set."),t._contentMetadata.streamType!=a.StreamType.UNKNOWN?t._contentMetadata.streamType==e.ContentMetadata.StreamType.LIVE?n[P.REQUEST_KEY_IS_LIVE]=!0:n[P.REQUEST_KEY_IS_LIVE]=!1:t._logger.warning("enqueueEventForContentMetadata(): streamType was not set."),0<x.dictCount(t._contentMetadata.custom))for(var i in n[P.REQUEST_KEY_TAGS]={},t._contentMetadata.custom)n[P.REQUEST_KEY_TAGS][i]=t._contentMetadata.custom[i];else t._logger.warning("enqueueEventForContentMetadata(): custom tags were not set.");0<x.dictCount(n)&&t._cwsSession.declareStateChange(n,null)},this.setStatesFromSystemMetadata=function(){t._logger.debug("setStatesFromSystemMetadata()");var e=t._systemMetadata.get(),n=e[$.BROWSER_NAME];null!=n&&t._cwsSession.setBrowserName(n);var i=e[$.BROWSER_VERSION];null!=i&&t._cwsSession.setBrowserVersion(i);var a=e[$.DEVICE_BRAND];null!=a&&t._cwsSession.setDeviceBrand(a);var r=e[$.DEVICE_MANUFACTURER];null!=r&&t._cwsSession.setDeviceManufacturer(r);var o=e[$.DEVICE_MODEL];null!=o&&t._cwsSession.setDeviceModel(o);var s=e[$.DEVICE_TYPE];null!=s&&t._cwsSession.setDeviceType(s);var _=e[$.DEVICE_VERSION];null!=_&&t._cwsSession.setDeviceVersion(_);var l=e[$.FRAMEWORK_NAME];null!=l&&t._cwsSession.setFrameworkName(l);var u=e[$.FRAMEWORK_VERSION];null!=u&&t._cwsSession.setFrameworkVersion(u);var c=e[$.OPERATING_SYSTEM_NAME];null!=c&&t._cwsSession.setOperatingSystemName(c);var E=e[$.OPERATING_SYSTEM_VERSION];null!=E&&t._cwsSession.setOperatingSystemVersion(E);var g=e[$.DEVICE_CATEGORY];null!=g&&t._cwsSession.setDeviceCategory(g)},this.setStatesFromContentMetadata=function(){if(t._logger.debug("setStatesFromContentMetadata()"),null!=t._contentMetadata.defaultResource&&t._cwsSession.setResource(t._contentMetadata.defaultResource),null!=t._contentMetadata.streamUrl&&t._cwsSession.setStreamUrl(t._contentMetadata.streamUrl),0<t._contentMetadata.duration&&t._cwsSession.setContentLength(t._contentMetadata.duration),0<t._contentMetadata.encodedFrameRate&&t._cwsSession.setEncodedFrameRate(t._contentMetadata.encodedFrameRate),t._contentMetadata.streamType!==a.StreamType.UNKNOWN){var e=t._contentMetadata.streamType===a.StreamType.LIVE;t._cwsSession.setIsLive(e)}null!=t._contentMetadata.assetName&&t._cwsSession.setAssetName(t._contentMetadata.assetName),null!=t._contentMetadata.viewerId&&t._cwsSession.setViewerId(t._contentMetadata.viewerId),null!=t._contentMetadata.applicationName&&t._cwsSession.setPlayerName(t._contentMetadata.applicationName),0<x.dictCount(t._contentMetadata.custom)&&t._cwsSession.setTags(t._contentMetadata.custom)},this.onPlayerStateChange=function(e){return t._logger.debug("onPlayerStateChange(): "+e),t._cwsSession._playerState!=e?(t._cwsSession._playerState==s.PlayerState.NOT_MONITORED&&e!=s.PlayerState.NOT_MONITORED&&(t._pooledPlayerState=e),t._ignorePlayerState?void t._logger.debug("onPlayerStateChange(): "+e+" (pooled, "+(t._adPlaying?"ad playing":"preloading")+")"):void t._cwsSession.setPlayerState(e)):void 0},this.onBitrateChange=function(e){return t._logger.debug("onBitrateChange(): "+e),t._ignoreBitrateAndResource?void t._logger.info("onBitrateChange(): ignored"):void t._cwsSession.setBitrateKbps(e)},this.onSeekEvent=function(e,n){null==n||x.isInteger(n)||(t._logger.error("onSeekEvent(): Ignored non-integer seekToPosition data: "+n),n=-1),t._cwsSession.enqueueSeekEvent(e,n)},this.onEncodedFrameRateChange=function(e){t._logger.debug("onEncodedFrameRateChange(): "+e),0<t._contentMetadata.encodedFrameRate||(0<e?t._ignoreEncodedFrameRateAndDuration?t._logger.info("onEncodedFrameRateChange(): Ignored encoded frame rate data: "+e+" (ads)"):(t._cwsSession.setEncodedFrameRate(e),t._logger.info("onEncodedFrameRateChange(): Received encoded frame rate data: "+e)):t._logger.warning("onEncodedFrameRateChange(): Ignored invalid encoded frame rate data: "+e))},this.onContentLengthChange=function(e){t._logger.debug("onContentLengthChange(): "+e),0<t._contentMetadata.duration||(0<e?t._ignoreEncodedFrameRateAndDuration?t._logger.info("setContentLength(): Ignored content length data: "+e+" (ads)"):(t._cwsSession.setContentLength(e),t._logger.info("setContentLength(): Received content length data: "+e)):t._logger.warning("setContentLength(): Ignored invalid content length data: "+e))},this.onStreamUrlChange=function(e){t._logger.debug("onStreamUrlChange(): "+e),null==t._contentMetadata.streamUrl&&t._cwsSession.setStreamUrl(e)},this.onStreamResolutionWidthChange=function(e){t._logger.debug("onStreamResolutionWidthChange(): "+e),t._cwsSession.setStreamResolutionWidth(e)},this.onStreamResolutionHeightChange=function(e){t._logger.debug("onStreamResolutionHeightChange(): "+e),t._cwsSession.setStreamResolutionHeight(e)},this.onConnectionTypeChange=function(e){t._logger.debug("onConnectionTypeChange(): "+e),t._cwsSession.setConnectionType(e)},this.onLinkEncryptionChange=function(e){t._logger.debug("onLinkEncryptionChange(): "+e),t._cwsSession.setLinkEncryption(e)},this.onPlayerTypeChange=function(e){t._logger.debug("onPlayerTypeChange(): "+e),null==t._cwsSession.getFrameworkName()&&t._cwsSession.setFrameworkName(e)},this.onPlayerVersionChange=function(e){t._logger.debug("onPlayerVersionChange(): "+e),null==t._cwsSession.getFrameworkVersion()&&t._cwsSession.setFrameworkVersion(e)},this.onCDNServerIPChange=function(e){t._logger.debug("onCDNServerIPChange(): "+e),t._cwsSession.setCDNServerIP(e)},this.onError=function(e,n){t._logger.debug("onError(): "+e+" ("+n+")"),t.reportError(e,n)},this.onRelease=function(){t._logger.debug("onRelease()"),t.detachPlayer()},this.adStart=function(n,i,a){return t._logger.debug("adStart(): adStream="+n+" adPlayer="+i+" adPosition="+a),t._adPlaying?void t._logger.warning("adStart(): multiple adStart calls, ignoring"):(t._adPlaying=!0,t._adStream=n,t._adPlayer=i,t._adPosition=a,t._cwsSession._hasJoined||t._cwsSession.togglePauseJoin(!0),void(t._adStream==e.Client.AdStream.CONTENT||t._adPlayer==e.Client.AdPlayer.SEPARATE?(t._cwsSession._playerState!==s.PlayerState.NOT_MONITORED&&(t._pooledPlayerState=t._cwsSession._playerState),t._cwsSession.setPlayerState(s.PlayerState.NOT_MONITORED),t._ignorePlayerState=!0):t._adStream==e.Client.AdStream.SEPARATE&&t._adPlayer==e.Client.AdPlayer.CONTENT&&(t._cwsSession._playerState!==s.PlayerState.NOT_MONITORED&&(t._pooledPlayerState=t._cwsSession._playerState),t._cwsSession.setPlayerState(s.PlayerState.NOT_MONITORED),t._ignorePlayerState=!0,t._ignoreBitrateAndResource=!0,t._ignoreEncodedFrameRateAndDuration=!0,t._ignorePlayheadTimeandBufferLength=!0,t._ignoreError=!0)))},this.adEnd=function(){return t._logger.debug("adEnd()"),t._adPlaying?(t._cwsSession._hasJoined||t._cwsSession.togglePauseJoin(!1),t._adStream==e.Client.AdStream.CONTENT||t._adPlayer==e.Client.AdPlayer.SEPARATE?t._preloading||(t._ignorePlayerState=!1,t._cwsSession.setPlayerState(t._pooledPlayerState)):t._adStream==e.Client.AdStream.SEPARATE&&t._adPlayer==e.Client.AdPlayer.CONTENT&&(t._ignoreBitrateAndResource=!1,t._ignoreEncodedFrameRateAndDuration=!1,t._ignorePlayheadTimeandBufferLength=!1,t._ignoreError=!1,t._preloading||(t._ignorePlayerState=!1,t._cwsSession.setPlayerState(t._pooledPlayerState))),t._adPlaying=!1,void(t._adStream=t._adPlayer=t._adPosition=null)):void t._logger.debug("adEnd(): called before adStart, ignoring")},this.detachPlayer=function(){t._logger.debug("detachPlayer()"),null!==t._playerStateManager&&(t._exceptionCatcher.runProtected("Session.detachPlayer",function(){t._playerStateManager.removeMonitoringNotifier()}),t._playerStateManager=null,t._cwsSession.setPlayerStateManager(null),t._cwsSession.setPlayerState(s.PlayerState.NOT_MONITORED))},this.attachPlayer=function(e){return t._logger.debug("attachPlayer()"),null!=t._playerStateManager?void t._logger.error("attachPlayer(): detach current PlayerStateManager first"):void t._exceptionCatcher.runProtected("Session.attachPlayer()",function(){e.setMonitoringNotifier(t,t._id)?(e.pushCurrentState(),t._playerStateManager=e,t._cwsSession.setPlayerStateManager(t._playerStateManager)):t._logger.error("attachPlayer(): instance of PlayerStateManager is already attached to a session")})},this.getPlayerStateManager=function(){return t._logger.debug("getPlayerStateManager()"),t._playerStateManager},this.contentPreload=function(){return t._logger.debug("contentPreload()"),t._preloading?void t._logger.debug("contentPreload(): called twice, ignoring"):(t._preloading=!0,void(t._ignorePlayerState=!0))},this.contentStart=function(){return t._logger.debug("contentStart()"),t._preloading?(t._preloading=!1,void(t._adPlaying||(t._ignorePlayerState=!1,t._cwsSession.setPlayerState(t._pooledPlayerState)))):void t._logger.warning("contentStart(): called without contentPreload, ignoring")},this.reportError=function(n,i){if(t._logger.info("reportError(): "+n),x.isValidString(n))if(i===e.Client.ErrorSeverity.FATAL||i===e.Client.ErrorSeverity.WARNING)if(t._ignoreError)t._logger.debug("reportError(): ignored");else{var a=i===e.Client.ErrorSeverity.FATAL;t._cwsSession.sendError(n,a)}else t._logger.error("reportError(): invalid error severity: "+i);else t._logger.error("reportError(): invalid error message string: "+n)},this.updateContentMetadata=function(e){t._logger.debug("updateContentMetadata(): enter"),t._exceptionCatcher.runProtected("Session.updateContentMetadata",function(){t.mergeContentMetadata(e),t.setStatesFromContentMetadata()})},this.sendCustomEvent=function(e,n){t._logger.info("sendEvent(): eventName="+e+t.sessionTypeTag()),t._cwsSession.enqueueCustomEvent(e,n)},this.mergeContentMetadata=function(n){var i={},r={};if(x.isValidString(n.assetName)&&(t._contentMetadata.assetName!=n.assetName?(null!=t._contentMetadata.assetName&&(i[P.REQUEST_KEY_ASSET_NAME]=t._contentMetadata.assetName),r[P.REQUEST_KEY_ASSET_NAME]=n.assetName,t._contentMetadata.assetName=n.assetName):t._logger.warning("mergeContentMetadata(): assetName was not changed.")),x.isValidString(n.applicationName)&&(t._contentMetadata.applicationName!=n.applicationName?(null!=t._contentMetadata.applicationName&&(void 0===i[P.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(i[P.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),i[P.REQUEST_KEY_STREAM_METADATA_CHANGE][P.REQUEST_KEY_PLAYER_NAME]=t._contentMetadata.applicationName),void 0===r[P.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(r[P.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),r[P.REQUEST_KEY_STREAM_METADATA_CHANGE][P.REQUEST_KEY_PLAYER_NAME]=n.applicationName,t._contentMetadata.applicationName=n.applicationName):t._logger.warning("mergeContentMetadata(): applicationName was not changed.")),x.isValidString(n.streamUrl)&&(t._contentMetadata.streamUrl!=n.streamUrl?(null!=t._contentMetadata.streamUrl&&(i[P.REQUEST_KEY_STREAM_URL]=t._contentMetadata.streamUrl),r[P.REQUEST_KEY_STREAM_URL]=n.streamUrl,t._contentMetadata.streamUrl=n.streamUrl):t._logger.warning("mergeContentMetadata(): streamUrl was not changed.")),x.isValidString(n.viewerId)&&(t._contentMetadata.viewerId!=n.viewerId?(null!=t._contentMetadata.viewerId&&(void 0===i[P.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(i[P.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),i[P.REQUEST_KEY_STREAM_METADATA_CHANGE][P.REQUEST_KEY_VIEWER_ID]=t._contentMetadata.viewerId),void 0===r[P.REQUEST_KEY_STREAM_METADATA_CHANGE]&&(r[P.REQUEST_KEY_STREAM_METADATA_CHANGE]={}),r[P.REQUEST_KEY_STREAM_METADATA_CHANGE][P.REQUEST_KEY_VIEWER_ID]=n.viewerId,t._contentMetadata.viewerId=n.viewerId):t._logger.warning("mergeContentMetadata(): viewerId was not changed.")),x.isValidString(n.defaultResource)&&(t._contentMetadata.defaultResource!=n.defaultResource?(null!=t._contentMetadata.defaultResource&&(i[P.REQUEST_KEY_RESOURCE]=t._contentMetadata.defaultResource),r[P.REQUEST_KEY_RESOURCE]=n.defaultResource,t._contentMetadata.defaultResource=n.defaultResource):t._logger.warning("mergeContentMetadata(): defaultResource was not changed.")),x.isInteger(n.duration)&&0<n.duration&&(t._contentMetadata.duration!=n.duration?(0<t._cwsSession._contentLengthSec&&(i[P.REQUEST_KEY_CONTENT_LENGTH]=t._cwsSession._contentLengthSec),r[P.REQUEST_KEY_CONTENT_LENGTH]=n.duration,t._contentMetadata.duration=n.duration):t._logger.warning("mergeContentMetadata(): duration was not changed.")),x.isInteger(n.encodedFrameRate)&&0<n.encodedFrameRate&&(t._contentMetadata.encodedFrameRate!=n.encodedFrameRate?(-1<t._contentMetadata.encodedFrameRate&&(i[P.REQUEST_KEY_ENCODED_FRAME_RATE]=t._contentMetadata.encodedFrameRate),r[P.REQUEST_KEY_ENCODED_FRAME_RATE]=n.encodedFrameRate,t._contentMetadata.encodedFrameRate=n.encodedFrameRate):t._logger.warning("mergeContentMetadata(): encodedFrameRate was not changed.")),n.streamType!=a.StreamType.UNKNOWN&&(t._contentMetadata.streamType!=n.streamType?(t._contentMetadata.streamType!=a.StreamType.UNKNOWN&&(t._contentMetadata.streamType==e.ContentMetadata.StreamType.LIVE?i[P.REQUEST_KEY_IS_LIVE]=!0:i[P.REQUEST_KEY_IS_LIVE]=!1),n.streamType==e.ContentMetadata.StreamType.LIVE?r[P.REQUEST_KEY_IS_LIVE]=!0:r[P.REQUEST_KEY_IS_LIVE]=!1,t._contentMetadata.streamType=n.streamType):t._logger.warning("mergeContentMetadata(): streamType was not changed.")),0<x.dictCount(n.custom)){var o={},s={};for(var _ in n.custom)t._contentMetadata.custom[_]!=n.custom[_]?(o[_]=n.custom[_],t._contentMetadata.custom[_]&&(s[_]=t._contentMetadata.custom[_]),t._contentMetadata.custom[_]=n.custom[_]):t._logger.info("mergeContentMetadata(): custom."+_+" was not changed.");0<x.dictCount(o)?(0<x.dictCount(s)&&(i[P.REQUEST_KEY_TAGS]=s),r[P.REQUEST_KEY_TAGS]=o):t._logger.warning("mergeContentMetadata(): custom was not changed.")}0<x.dictCount(r)&&t._cwsSession.declareStateChange(r,i)},this.isGlobalSession=function(){return t._global==K.SESSION_TYPE.GLOBAL},this.isVideoSession=function(){return t._global==K.SESSION_TYPE.VIDEO},this.isAdSession=function(){return t._global==K.SESSION_TYPE.AD},this.sessionTypeTag=function(){return t.isGlobalSession()?" (global session)":""}});Y.DEFAULT_HEARTBEAT_ERROR_MESSAGE="received no response (or a bad response) to heartbeat POST request";var V=t.SessionFactory=function(){var e=this;e._logger=null,e._logBuffer=null,e._nextSessionKey=0,e._sessionsByKey=null,function(t,n,i,a){e._client=t,e._clientSettings=n,e._clientConfig=i,e._systemFactory=a,e._logger=e._systemFactory.buildLogger(),e._logger.setModuleName("SessionFactory"),e._nextSessionKey=0,e._sessionsByKey={}}.apply(e,arguments),this.cleanup=function(){for(var t in e._logger=null,e._logBuffer=null,e._sessionsByKey)e._sessionsByKey[t].cleanup();e._sessionsByKey=null,e._nextSessionKey=0},this.newSessionKey=function(){var t=e._nextSessionKey;return e._nextSessionKey++,t},this.makeVideoSession=function(t,n){return null==t&&(t=new a),e.makeSession(t,n)},this.makeGlobalSession=function(t){return e.makeSession(t,K.SESSION_TYPE.GLOBAL)},this.generateSessionId=function(){return j.integer32()},this.makeSession=function(t,n){var i=t.clone(),a=e.generateSessionId(),r=e._systemFactory.buildSession(e._client,e._clientSettings,e._clientConfig,a,n,i),o=e.newSessionKey();return e.addSession(o,r),r.start(),o},this.getSession=function(t){var n=e._sessionsByKey[t];return null==n&&e._logger.error("Client: invalid sessionKey. Did you cleanup that session previously?"),n},this.getVideoSession=function(t){var n=this.getSession(t);return null!=n&&(n.isVideoSession()||n.isAdSession()||(e._logger.error("Client: invalid sessionKey. Did you cleanup that session previously?"),n=null)),n},this.addSession=function(t,n){e._sessionsByKey[t]=n},this.removeSession=function(t){delete e._sessionsByKey[t]},this.cleanupSession=function(t){var n=e.getSession(t);e.removeSession(t),n.cleanup()}},Q=t.CallbackWithTimeout=function(e){this._timer=e,this.getWrapperCallback=function(e,t,n){var i=!1;return this._timer.createOnce(function(){i||e(!(i=!0),n+" ("+t+" ms)")},t,"CallbackWithTimeout.wrap"),function(t,n){i||(i=!0,e(t,n))}}},G=t.Config=function(e,t,n){var i=this;this._logger=e,this._logger.setModuleName("Config"),this._storage=t,this._jsonInterface=n,this._defaultConfig={clientId:P.DEFAULT_CLIENT_ID,sendLogs:!1,maxHbInfos:P.DEFAULT_MAX_HEARTBEAT_INFOS},this._config=x.ObjectShallowCopy(this._defaultConfig),this._loaded=!1,this._loadedEmpty=!1,this._waitingConsumers=[],this.isReady=function(){return this._loaded},this.load=function(){this._storage.load(G.STORAGE_KEY,function(e,t){e?(i._parse(t),i._logger.debug("load(): configuration successfully loaded from local storage"+(i._loadedEmpty?" (was empty)":"")+".")):i._logger.error("load(): error loading configuration from local storage: "+t),i._loaded=!0,i._notify()})},this._parse=function(e){var t=this._jsonInterface.decode(e);if(null!=t){var n=t[G.CONFIG_STORAGE_KEY_CLIENT_ID];null!=n&&n!=P.DEFAULT_CLIENT_ID&&""!=n&&"null"!=n&&(this._config[G.CONFIG_KEY_CLIENT_ID]=n,this._logger.debug("parse(): loaded clientId="+n+" (from local storage)"))}else this._loadedEmpty=!0},this._marshall=function(){var e={};return e[G.CONFIG_STORAGE_KEY_CLIENT_ID]=this._config.clientId,this._logger.debug("_marshall(): saving clientId="+this._config.clientId+" (to local storage)"),this._jsonInterface.encode(e)},this.save=function(){this._storage.save(G.STORAGE_KEY,this._marshall(),function(e,t){e?i._logger.debug("save(): configuration successfully saved to local storage."):i._logger.error("save(): error saving configuration to local storage: "+t)})},this.register=function(e){return this.isReady()?void e():void this._waitingConsumers.push(e)},this.get=function(e){return this._loaded?this._config[e]:null},this.set=function(e,t){this._loaded&&(this._config[e]=t)},this._notify=function(){for(var e;null!=(e=this._waitingConsumers.shift());)e()}};G.STORAGE_KEY="sdkConfig",G.CONFIG_STORAGE_KEY_CLIENT_ID="clId",G.CONFIG_KEY_CLIENT_ID="clientId",G.CONFIG_KEY_SEND_LOGS="sendLogs",G.CONFIG_KEY_MAX_HEARTBEAT_INFOS="maxHbInfos";var B=t.EventQueue=function(){this._events=[],this._nextEventNumber=0,this.enqueue=function(e){this._events.push(e)},this.getNumber=function(){var e=this._nextEventNumber;return this._nextEventNumber++,e},this.flush=function(){var e=this._events;return this._events=[],e}},H=t.ExceptionCatcher=function(e,t,n){this._logger=e,this._logger.setModuleName("ExceptionCatcher"),this._ping=t,this._systemSettings=n,this.runProtected=function(e,t,n){try{t()}catch(t){if(null!=n)n(t);else{if(this._systemSettings.allowUncaughtExceptions)throw t;this.onUncaughtException(e,t)}}},this.onUncaughtException=function(e,t){var n="Uncaught exception: "+e+": "+t.toString();if(null!=this._ping)try{this._ping.send(n)}catch(e){this._logger.error("Caught exception while sending ping: "+e.toString())}this._logger.error(n)}},k=t.GatewayControl=function(e,t,n,i){var a=this;this._clientSettings=e,this._logger=t,this._logger.setModuleName("GatewayControl"),this._httpClient=n,this._jsonInterface=i,this.send=function(e,t){var n=this._jsonInterface.encode(e),i=this._clientSettings.gatewayUrl+P.gatewayPath;this._httpClient.request("POST",i,n,"application/json",function(e,n){if(e){var i=a._jsonInterface.decode(n);t(e,i)}else t(e,n)})}},x=t.Lang={};x.isMeaningfulString=function(e){return x.isValidString(e)&&null!=e&&"undefined"!=e&&"null"!=e},x.sanitizeStringToStringObject=function(e){var t={};for(var n in e)if(x.isMeaningfulString(n)){var i=e[n];x.isMeaningfulString(i)&&(t[n]=i)}return t},x.validateInterface=function(e,t,n){if(null==e)throw new Error("Expected "+n+" implementation is null.");for(var i in t)if("function"!=typeof e[i])throw new Error("Expected method "+i+" in "+n+" implementation.")},x.dictCount=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},x.ToString=function(e){return""+e},x.NumberToInt=function(e){return Math.floor(e)},x.NumberToUnsignedInt=function(e){return Math.abs(x.NumberToInt(e))},x.AsBoolean=function(e){return Boolean(e)},x.isValidString=function(e){return"string"==typeof e&&""!==e},x.stringStartsWith=function(e,t){return"string"==typeof e&&"string"==typeof t&&"function"==typeof e.indexOf&&0===e.indexOf(t)},x.isBoolean=function(e){return"boolean"==typeof e},x.UrlEncodeString=function(e){return escape(e)},x.isObject=function(e){return"object"==typeof e},x.ObjectToString=function(e){var t="";for(var n in e)t+=n+"="+e[n];return"Object{"+t+"}"},x.ObjectShallowCopyOmitNull=function(e){var t=x.ObjectShallowCopy(e);for(var n in t)null==t[n]&&delete t[n];return t},x.ObjectShallowCopy=function(e){var t={};for(var n in e)t[n]=e[n];return t},x.ObjectShallowEquals=function(e,t){if(typeof e!=typeof t)return!1;if(e instanceof Object&&t instanceof Object){if(x.dictCount(e)!==x.dictCount(t))return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}return e===t},x.isInteger=function(e){return"number"==typeof e&&Math.round(e)===e},x.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},x.ArrayEquals=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(x.isArray(e[n])&&x.isArray(t[n])){if(!x.ArrayEquals(e[n],t[n]))return!1}else if(e[n]!==t[n])return!1;return!0},x.isObjectDefinePropertyPresent=function(){return void 0!==Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()},x.defGet=function(e,t,n){if(x.isObjectDefinePropertyPresent())Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:n});else{if(void 0===e.__defineGetter__)throw new Error("JavaScript runtime must support either Object.defineProperty or __defineGetter__");e.__defineGetter__(t,n)}},x.defSet=function(e,t,n){if(x.isObjectDefinePropertyPresent())Object.defineProperty(e,t,{configurable:!0,set:n});else{if(void 0===e.__defineSetter__)throw new Error("JavaScript runtime must support either Object.defineProperty or __defineSetter__");e.__defineSetter__(t,n)}},function(){var e={two32:4294967296};e.MaxValue=e.two32-1,e.MinValue=0,x.UInt32=e,x.UInt32.Cast=function(t){var n=parseInt(t,10);return n>e.MaxValue?n%=e.two32:n<e.MinValue&&(n=-n%e.two32,n=e.two32-n),n},x.UInt32.InRange=function(t){var n=parseInt(t,10);return n<=e.MaxValue&&n>=e.MinValue};var t={MaxValue:2147483647,MinValue:-2147483648};x.Int32=t,x.Int32.Cast=function(e){var n=parseInt(e,10);return n>t.MaxValue?n%=t.MaxValue:n<t.MinValue&&(n=t.MaxValue-(n=-n%t.MaxValue)),n},x.Int32.InRange=function(e){var n=parseInt(e,10);return n<=t.MaxValue&&n>=t.MinValue}}();var W=t.LogBuffer=function(){this._buffer=[],this.add=function(e){32<=this._buffer.length&&this._buffer.shift(),this._buffer.push(e)},this.flush=function(){var e=this._buffer;return this._buffer=[],e}},q=t.Ping=function(e,t,i){this._isSendingPing=!1,this._cachedBasePingUrl=null,this._logger=e,this._logger.setModuleName("Ping"),this._httpClient=t,this._clientSettings=i,this.send=function(e){if(!this._isSendingPing){this._isSendingPing=!0;var t=this.getBasePingUrl()+"&d="+x.UrlEncodeString(e.toString());this._logger.error("send(): "+t),this._httpClient.request("GET",t,null,null,null),this._isSendingPing=!1}},this.getBasePingUrl=function(){if(!this._cachedBasePingUrl){var e=q.SERVICE_URL+"?comp="+q.COMPONENT_NAME+"&clv="+n.version;if(this._clientSettings&&(e+="&cid="+this._clientSettings.customerKey),e+="&sch="+P.SDK_METADATA_SCHEMA,!this._clientSettings)return e;this._cachedBasePingUrl=e}return this._cachedBasePingUrl}};q.COMPONENT_NAME="sdkjs",q.SERVICE_URL="https://pings.conviva.com/ping.ping";var j=t.Random={};j.maxUInt32=4294967295,j.maxInt32=2147483647,j.minInt32=-2147483648,j.integer32=function(){return Math.floor(Math.random()*j.maxUInt32)+j.minInt32},j.uinteger32=function(){return Math.floor(Math.random()*j.maxUInt32)};var J=t.Sanitize={};J.Integer=function(e,t,n,i){if(isNaN(e))return i;if("number"!=typeof e)return i;if(e==i)return i;var a=x.NumberToInt(e);return J.EnforceBoundaries(a,t,n)},J.EnforceBoundaries=function(e,t,n){return null!=n&&n<e?e=n:null!=t&&e<t&&(e=t),e},J.sanitizeSpecialIntegerValue=function(e){return-1==e||-2==e?e:e=J.Integer(e,0,null,-1)};var z=(t.StreamerError=function(){var e=this;e.errorCode=null,e.severity=n.ErrorSeverity.FATAL,function(t,n){e.errorCode=t,e.severity=n}.apply(e,arguments)},t.HttpClient=function(e,t,n,i){this._logger=e,this._logger.setModuleName("HttpClient"),this._httpInterface=t,this._callbackWithTimeout=n,this._systemSettings=i,this.request=function(e,t,n,i,a){var r=1e3*this._systemSettings.httpTimeout,o=this._callbackWithTimeout.getWrapperCallback(a,r,"HTTP timeout");this._logger.debug("request(): calling HttpInterface.makeRequest"),this._httpInterface.makeRequest(e,t,n,i,r,o)}}),X=t.Logger=function(e,t,n,i,a){this._loggingInterface=e,this._timeInterface=t,this._settings=n,this._logBuffer=i,this._packageName=a,this.debug=function(e){this.log(e,o.LogLevel.DEBUG)},this.info=function(e){this.log(e,o.LogLevel.INFO)},this.warning=function(e){this.log(e,o.LogLevel.WARNING)},this.error=function(e){this.log(e,o.LogLevel.ERROR)},this.log=function(e,t){var n=this.formatMessage(e,t);this._logBuffer.add(n),this._settings.logLevel<=t&&this._loggingInterface.consoleLog(n,t)},this.prependModuleName=function(e){var t=e;return"["+this._moduleName+"] "+t},this.prependPackageName=function(e){var t=e;return"["+this._packageName+"] "+t},this.prependConvivaNamespace=function(e){return"[Conviva] "+e},this.prependTime=function(e){return"["+(this._timeInterface.getEpochTimeMs()/1e3).toFixed(3).toString()+"] "+e},this.prependLogLevel=function(e,t){return"["+X.getLogLevelString(t)+"] "+e},this.prependSessionId=function(e){var t=e;return null!=this._sessionId&&(t="sid="+this._sessionId+" "+t),t},this.setSessionId=function(e){this._sessionId=e},this.setModuleName=function(e){this._moduleName=e},this.formatMessage=function(e,t){return this.prependConvivaNamespace(this.prependTime(this.prependLogLevel(this.prependPackageName(this.prependModuleName(this.prependSessionId(e))),t)))}};X.getLogLevelString=function(e){var t;switch(e){case o.LogLevel.ERROR:t="ERROR";break;case o.LogLevel.WARNING:t="WARNING";break;case o.LogLevel.INFO:t="INFO";break;case o.LogLevel.DEBUG:t="DEBUG"}return t};var Z=t.Storage=function(e,t,n,i){this._logger=e,this._logger.setModuleName("Storage"),this._storageInterface=t,this._callbackWithTimeout=n,this._systemSettings=i,this.load=function(e,t){var n=this._callbackWithTimeout.getWrapperCallback(t,1e3*this._systemSettings.storageTimeout,"storage load timeout");this._logger.debug("load(): calling StorageInterface.loadData"),this._storageInterface.loadData(Z.STORAGE_SPACE,e,n)},this.save=function(e,t,n){var i=this._callbackWithTimeout.getWrapperCallback(n,1e3*this._systemSettings.storageTimeout,"storage save timeout");this._logger.debug("save(): calling StorageInterface.saveData"),this._storageInterface.saveData(Z.STORAGE_SPACE,e,t,i)}};Z.STORAGE_SPACE="Conviva";var $=t.SystemMetadata=function(t,n,i){this._logger=t,this._logger.setModuleName("SystemMetadata"),this._metadataInterface=n,this._exceptionCatcher=i,this._cachedMetadata=null,this.get=function(){return this._cachedMetadata||this.retrieve(),this._cachedMetadata},this.retrieve=function(){function t(e,t){i._exceptionCatcher.runProtected("Session.getSystemMetadataSchema(): "+e,function(){var n=t[e];t[e]=n.call(i._metadataInterface)})}var n={};n[$.BROWSER_NAME]=this._metadataInterface.getBrowserName,n[$.BROWSER_VERSION]=this._metadataInterface.getBrowserVersion,n[$.DEVICE_BRAND]=this._metadataInterface.getDeviceBrand,n[$.DEVICE_MANUFACTURER]=this._metadataInterface.getDeviceManufacturer,n[$.DEVICE_MODEL]=this._metadataInterface.getDeviceModel,n[$.DEVICE_TYPE]=this._metadataInterface.getDeviceType,n[$.DEVICE_VERSION]=this._metadataInterface.getDeviceVersion,n[$.FRAMEWORK_NAME]=this._metadataInterface.getFrameworkName,n[$.FRAMEWORK_VERSION]=this._metadataInterface.getFrameworkVersion,n[$.OPERATING_SYSTEM_NAME]=this._metadataInterface.getOperatingSystemName,n[$.OPERATING_SYSTEM_VERSION]=this._metadataInterface.getOperatingSystemVersion,n[$.DEVICE_CATEGORY]=this._metadataInterface.getDeviceCategory;var i=this;for(var a in this._logger.debug("retrieve(): calling MetadataInterface methods"),n)t(a,n),x.isValidString(n[a])||delete n[a];var r=!1;if(void 0!==n[$.DEVICE_TYPE]){for(var o in e.Client.DeviceType)if(n[$.DEVICE_TYPE]===e.Client.DeviceType[o]){r=!0;break}r||delete n[$.DEVICE_TYPE]}if(r=!1,void 0!==n[$.DEVICE_CATEGORY]){for(var s in e.Client.DeviceCategory)if(n[$.DEVICE_CATEGORY]===e.Client.DeviceCategory[s]){r=!0;break}r||delete n[$.DEVICE_CATEGORY]}this._cachedMetadata=x.ObjectShallowCopyOmitNull(n)}};$.BROWSER_NAME="browserName",$.BROWSER_VERSION="browserVersion",$.DEVICE_BRAND="deviceBrand",$.DEVICE_MANUFACTURER="deviceManufacturer",$.DEVICE_MODEL="deviceModel",$.DEVICE_TYPE="deviceType",$.DEVICE_VERSION="deviceVersion",$.FRAMEWORK_NAME="frameworkName",$.FRAMEWORK_VERSION="frameworkVersion",$.OPERATING_SYSTEM_NAME="operatingSystemName",$.OPERATING_SYSTEM_VERSION="operatingSystemVersion",$.DEVICE_CATEGORY="deviceCategory";var ee=t.Time=function(e,t){this._timeInterface=e,this._logger=t,this._logger.setModuleName("Time"),this.current=function(){var e=this._timeInterface.getEpochTimeMs();return x.isInteger(e)||this._logger.error("current(): TimeInterface.getEpochTimeMs() did not return an integer ("+e+")"),e}},te=t.Timer=function(e,t,n){var i=this;this._logger=e,this._logger.setModuleName("Timer"),this._timerInterface=t,this._exceptionCatcher=n,this.create=function(e,t,n){return this.createTimer(function(){i._exceptionCatcher.runProtected(n,function(){e()})},t,n)},this.createOnce=function(e,t,n){var a={cancel:null},r=this.createTimer(function(){i._exceptionCatcher.runProtected(n,function(){a&&"function"==typeof a.cancel&&(a.cancel(),a.cancel=null,a=null),e()})},t,n);return a.cancel=r},this.createTimer=function(e,t,n){return this._logger.debug("createTimer(): calling TimerInterface.create"),this._timerInterface.createTimer(e,t,n)}}}()}(),e});var ConvivaHelper=function(e){this._testingEnvironment="testing"==e.env,this._client=null,this._contentSessionPlayerStateManager=null,this._currentConvivaSessionKey=Conviva.Client.NO_SESSION_KEY,this._systemFactory=null,this.setEnvironment=function(e){this._testingEnvironment="testing"===e},this.buildConvivaClient=function(){var t=this._testingEnvironment?function(){var t=e.testing,n=null;try{(n=new Conviva.ClientSettings(t.customerKey)).heartbeatInterval=5,t.gatewayUrl&&(n.gatewayUrl=t.gatewayUrl)}catch(t){}return n}():function(){var t=e.production,n=null;try{n=new Conviva.ClientSettings(t.customerKey)}catch(t){}return n}();null!=t&&(this._client=new Conviva.Client(t,this._systemFactory))},this.releaseConvivaClient=function(){null!=this._client&&(this._client.release(),this._client=null)},this.buildConvivaFactory=function(){var e,t,n=this._testingEnvironment?((t=new Conviva.SystemSettings).logLevel=Conviva.SystemSettings.LogLevel.DEBUG,t.allowUncaughtExceptions=!0,t):((e=new Conviva.SystemSettings).logLevel=Conviva.SystemSettings.LogLevel.ERROR,e),i=new Conviva.SystemInterface(new Time,new Timer,new Http,new Storage,new Metadata,new Logging);this._systemFactory=new Conviva.SystemFactory(i,n)},this.releaseConvivaFactory=function(){null!=this._systemFactory&&(this._systemFactory.release(),this._systemFactory=null)},this.initializeConviva=function(){this.buildConvivaFactory(),this.buildConvivaClient()},this.unloadConviva=function(){this.releaseConvivaClient(),this.releaseConvivaFactory()},this.createConvivaSession=function(e,t){if(this._currentConvivaSessionKey==Conviva.Client.NO_SESSION_KEY&&null!=this._client){var n=this.buildConvivaContentMetadata(e,t);this._currentConvivaSessionKey=this._client.createSession(n)}},this.cleanupConvivaSession=function(){this._currentConvivaSessionKey!=Conviva.Client.NO_SESSION_KEY&&null!=this._client&&(this._client.releasePlayerStateManager(this._contentSessionPlayerStateManager),this._contentSessionPlayerStateManager=null,this._client.cleanupSession(this._currentConvivaSessionKey),this._currentConvivaSessionKey=Conviva.Client.NO_SESSION_KEY)},this.attachPlayerToSession=function(){this._currentConvivaSessionKey!=Conviva.Client.NO_SESSION_KEY&&null!=this._client&&(this._contentSessionPlayerStateManager=this._client.getPlayerStateManager(),this._contentSessionPlayerStateManager.setClientMeasureInterface(new ClientMeasureInterface),this._client.attachPlayer(this._currentConvivaSessionKey,this._contentSessionPlayerStateManager))},this.updatePlayerState=function(e){switch(e){case"playing":this._contentSessionPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING);break;case"waiting":this._contentSessionPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING);break;case"ended":case"stopped":this._contentSessionPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED);break;case"pause":this._contentSessionPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED);break;default:this._contentSessionPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.UNKNOWN)}},this.detachPlayerFromSession=function(){this._currentConvivaSessionKey!=Conviva.Client.NO_SESSION_KEY&&null!=this._client&&this._client.detachPlayer(this._currentConvivaSessionKey)},this.contentSetBitrateKbps=function(e){null!=this._contentSessionPlayerStateManager&&this._contentSessionPlayerStateManager.setBitrateKbps(e)},this.contentSeeked=function(){null!=this._contentSessionPlayerStateManager&&this._contentSessionPlayerStateManager.setPlayerSeekEnd()},this.setPlayerWidthAndHeight=function(e,t){null!=this._contentSessionPlayerStateManager&&(this._contentSessionPlayerStateManager.setVideoResolutionWidth(e),this._contentSessionPlayerStateManager.setVideoResolutionHeight(t))},this.contentReportCustomEvent=function(e,t){null!=this._client&&this._currentConvivaSessionKey!=Conviva.Client.NO_SESSION_KEY&&this._client.sendCustomEvent(this._currentConvivaSessionKey,e+", "+t)},this.contentReportError=function(e,t){null!=this._client&&this._currentConvivaSessionKey!=Conviva.Client.NO_SESSION_KEY&&this._client.reportError(this._currentConvivaSessionKey,e,t)},this.buildConvivaContentMetadata=function(e,t){var n=new Conviva.ContentMetadata;return n.custom=t,n.assetName="["+t.id+"] "+t.title,n.streamUrl=t.url,n.streamType=t.live?Conviva.ContentMetadata.StreamType.LIVE:Conviva.ContentMetadata.StreamType.VOD,n.duration=t.durationSec,n.encodedFrameRate=t.frameRate,n.defaultBitrateKbps=t.bitrateKbps,n.defaultResource="Akamai",n.applicationName="BrightCoveHTML5Player ["+t.applicationName+"]",n.viewerId=e.id,null!=t&&null!=t.streamType&&(n.custom.streamType=t.streamType),n}};function Http(){(function(){}).apply(this,arguments),this.makeRequest=function(e,t,n,i,a,r){return this.makeRequestStandard.apply(this,arguments)},this.makeRequestStandard=function(e,t,n,i,a,r){var o=new XMLHttpRequest;return o.open(e,t,!0),i&&o.overrideMimeType&&(o.overrideMimeType=i),i&&o.setRequestHeader&&o.setRequestHeader("Content-Type",i),0<a&&(o.timeout=a,o.ontimeout=function(){o.ontimeout=o.onreadystatechange=null,r&&r(!1,"timeout after "+a+" ms")}),o.onreadystatechange=function(){4===o.readyState&&(o.ontimeout=o.onreadystatechange=null,200==o.status?r&&r(!0,o.responseText):r&&r(!1,"http status "+o.status))},o.send(n),null},this.release=function(){}}function Logging(){(function(){}).apply(this,arguments),this.consoleLog=function(e,t){"undefined"!=typeof console&&(console.log&&t===Conviva.SystemSettings.LogLevel.DEBUG||t===Conviva.SystemSettings.LogLevel.INFO?console.log(e):console.warn&&t===Conviva.SystemSettings.LogLevel.WARNING?console.warn(e):console.error&&t===Conviva.SystemSettings.LogLevel.ERROR&&console.error(e))},this.release=function(){}}function Metadata(){(function(){}).apply(this,arguments),this.getBrowserName=function(){return null},this.getBrowserVersion=function(){return null},this.getDeviceBrand=function(){return null},this.getDeviceManufacturer=function(){return null},this.getDeviceModel=function(){return null},this.getDeviceType=function(){return Conviva.Client.DeviceType.DESKTOP},this.getDeviceVersion=function(){return null},this.getFrameworkName=function(){return"HTML5"},this.getFrameworkVersion=function(){return null},this.getOperatingSystemName=function(){return null},this.getOperatingSystemVersion=function(){return null},this.getDeviceCategory=function(){return Conviva.Client.DeviceCategory.WEB},this.release=function(){}}function Storage(){(function(){}).apply(this,arguments),this.saveData=function(e,t,n,i){var a=e+"."+t;try{localStorage.setItem(a,n),i(!0,null)}catch(e){i(!1,e.toString())}},this.loadData=function(e,t,n){var i=e+"."+t;try{n(!0,localStorage.getItem(i))}catch(e){n(!1,e.toString())}},this.release=function(){}}var SystemInterfaceFactory=function(){this.build=function(){return new Conviva.SystemInterface(new Time,new Timer,new Http,new Storage,new Metadata,new Logging)}};function Time(){(function(){}).apply(this,arguments),this.getEpochTimeMs=function(){return(new Date).getTime()},this.release=function(){}}function Timer(){(function(){}).apply(this,arguments),this.createTimer=function(e,t,n){var i=setInterval(e,t);return function(){-1!==i&&(clearInterval(i),i=-1)}},this.release=function(){}}
    function log(m, p) {
        if (!p) {
            console.log(m)
        }
    }
    var prod = false;
    var adobe = true;
    
    var options = { "testing": { "gatewayUrl": "https://conviva.testonly.conviva.com", "customerKey": "da861ec60544e99da6f83ba0361417edf030f2c8" }, "production": { "gatewayUrl": "https://cws.conviva.com", "customerKey": "cefef1993557ccaad08847f77689343223365e06" }, "env": "testing", "version": "0.11", "adobe": true };
    
    if (!options) {
        console.log("Options has not been added, please add the options on video cloud")
    } else {
        //prod = !(window.localStorage.getItem("sdsat_debug") == 'true') || (options["env"] == "production");
        adobe = options["adobe"];
    }


    var myPlayer = player;
    var isContentLoaded = false;
    var videoDuration;
    var mediaName;
    var mediaPlayerName = window.location.hostname || "kdss.ddns.net";
    var currentTime;
    var isPlaying = false;
    var videoEnd = false;
    var bitRate = 0;

    var metadata = {};
    var firstPlay = false;
    convivaHelper = new ConvivaHelper(options);
    convivaHelper.initializeConviva();
    convivaHelper._testingEnvironment = prod; // set to false in production 
    var viewerID = "random:" + Math.random() * 1e9;
 
    if (adobe) {
        viewerID = s.visitor.getMarketingCloudVisitorID() || "random:" + Math.random() * 1e9;
    }

    function ABDMediaOPEN() {
        log("++ IN ABDMediaOPEN TOP ++", prod);

        //Check the metadata is loaded
        if (isContentLoaded) {
            log("++ IN ABDMediaOPEN content loaded ++", prod);
            //Get all required metadata
            currentTime = myPlayer.getPosition();
            mediaName = myPlayer.getSources()[0].name || myPlayer.getSources()[0].url;
            videoDuration = myPlayer.getDuration();
            metadata = {};

            //metadata["id"] = myPlayer.mediainfo.id;
            metadata["title"] = mediaName;
            metadata["url"] = myPlayer.getSources()[0].url;
            metadata["live"] = myPlayer.getDuration()==0 ? true : false;
            metadata["durationSec"] = videoDuration;
            metadata["streamType"] = myPlayer.getSources()[0].type;
            metadata["applicationName"] = window.location.hostname;
          
           	//when live streaming append the matchname from the datalayer
            if (typeof dataLayer !== 'undefined' && dataLayer.filter(e=>e.event === 'matchView').length > 0 && myPlayer.getDuration()==0) {
                metadata["title"] = mediaName + " - " +dataLayer.filter(obj => obj.event === 'matchView')[0]['matchName'];
            }
			
			//when unily grab the page title as well
			var top_url = top_url = (window.location != window.parent.location) ? document.referrer != "" ? document.referrer : document.location.href : document.location.href;
      var t_test = new URL(top_url);

			if(/telstra\.unily\.com/.test(top_url) && t_test.pathname.length >0){
				metadata["title"] = mediaName + " ["+t_test.pathname+"]";
			}		
				
            //custom 
            //metadata["assetID"] = myPlayer.mediainfo.id;
            metadata["channel"] = window.location.hostname;
            metadata["playerName"] = getPlayerName();

            metadata["viewerID"] = viewerID;

            //createConvivaSession
            userData = {}
            userData["id"] = viewerID;
            userData["hostname"] = window.location.hostname;

            //add all custom fields 
            //Object.assign(metadata, myPlayer.mediainfo.customFields);

            log(JSON.stringify(metadata), prod)

            //Open adobe Analytics Media Module	

            adobe && s.Media.open(mediaName, videoDuration, mediaPlayerName);

            //Check if video is playing
            if (isPlaying) {
                log("++IN ABDMediaOPEN video is playing " + mediaName + " | " + videoDuration, prod);
                //Play Adobe Analytics Media module from beginning.
                adobe && s.Media.play(mediaName, currentTime);
            }
        }
    }

    //Used to reset the variables as when the next videos play, the play event is called before loadstart ...
    function resetVariables() {
        isContentLoaded = false;
        videoDuration = currentTime = "";
        videoEnd = true;
        bitRate=0;
    }

    myPlayer.on('loadstart', function () {
        log("++loadstart - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        firstPlay = true;
        //Check that metadata is loaded
        if (myPlayer.getSources()[0].name || myPlayer.getSources()[0].url) {
            isContentLoaded = true;
            //Initiate Adobe Analytics Media Module tracking && Conviva Analytics
        }
    });

    myPlayer.on('play', function () {
        log("++Played - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        isPlaying = true;
        if (firstPlay) {
            log("++ First Play via played - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
            firstPlay = false;
            isContentLoaded = true;
            ABDMediaOPEN();
            convivaHelper.createConvivaSession(userData, metadata);
            convivaHelper.attachPlayerToSession();
            
            const tech_ = myPlayer.tech_;
	        if (tech_) {
	            const hls = tech_.hls; // Brightcove hls plugin
	            if (hls && hls.playlists && hls.playlists.media) {
	                const media = hls.playlists.media();
	                if (media && media.attributes && media.attributes.BANDWIDTH) {
	                    bitRate = media.attributes.BANDWIDTH/1e3;
	                    convivaHelper.contentSetBitrateKbps(bitRate);
	                    log(bitRate, prod);
	                }
	            }
	        }
        }

        if (videoEnd) { //user has restarted video from end 
            videoEnd = false;
            isContentLoaded = true;
            ABDMediaOPEN();
            convivaHelper.createConvivaSession(userData, metadata);
            convivaHelper.attachPlayerToSession();

        }

        //Check if metadata loaded - needed to make sure correct video media module instance is tracked.
        if (isContentLoaded) {
            currentTime = myPlayer.getPosition();
            //Play Adobe Analytics Media module from the current head.
            if (adobe) {
                s.eVar63 = mediaName
                s.Media.play(mediaName, currentTime);

            }

        }
    });

    myPlayer.on("playing", function () {
        log("++ In Playing ++", prod)

        convivaHelper.setPlayerWidthAndHeight(myPlayer.getStats().width, myPlayer.getStats().height);
        convivaHelper.updatePlayerState("playing");
    });


    myPlayer.on('pause', function () {
        isPlaying = false;
        log("++paused - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        //Check if metadata loaded - needed to make sure correct video media module instance is tracked.
        if (isContentLoaded) {
            currentTime = myPlayer.getPosition();
            //Play Adobe Analytics Media module from the current head.
            adobe && s.Media.stop(mediaName, currentTime);
            convivaHelper.updatePlayerState("pause");
        }
    });

    myPlayer.on('progress', function () {
        log("progressed - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);

    });

    myPlayer.on('resize', function () {
        log("resized - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
    });

    myPlayer.on('seeked', function () {
        log("++seeked - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        //Check if metadata loaded - needed to make sure correct video media module instance is tracked.
        if (isContentLoaded) {
            currentTime = myPlayer.getPosition();
            //Play Adobe Analytics Media module from the current head.
            adobe && s.Media.play(mediaName, currentTime);
            convivaHelper.contentSeeked();
        }
    });

    myPlayer.on('seeking', function () {
        log("++seeking - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        //Check if metadata loaded - needed to make sure correct video media module instance is tracked.
        if (isContentLoaded) {
            currentTime = myPlayer.getPosition();
            //Play Adobe Analytics Media module from the current head.
            adobe && s.Media.stop(mediaName, currentTime);
        }
    });

    myPlayer.on('stalled', function () {
        log("++stalled - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        //Check if metadata loaded - needed to make sure correct video media module instance is tracked.

    });


    myPlayer.on('timeupdate', function () {
        log("++timeupdate - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
    });

    myPlayer.on('volumechange', function () {
        log("++volumechange - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
    });

    myPlayer.on('waiting', function () {
        log("++waiting - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        if (isContentLoaded) {
            convivaHelper.updatePlayerState("waiting");
        }
    });

    myPlayer.on('durationchange', function () {
        log("++durationchange - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
    });

    myPlayer.on('ended', function () {
        log("++ended - " + mediaName, prod);
        //Check if metadata loaded - needed to make sure correct video media module instance is tracked.
        if (isContentLoaded) {
            currentTime = myPlayer.getPosition();
            //Play Adobe Analytics Media module from the current head.
            adobe && s.Media.stop(mediaName, currentTime);
            adobe && s.Media.close(mediaName);
            convivaHelper.updatePlayerState("ended");
            convivaHelper.cleanupConvivaSession();
            resetVariables();
        }
    });

    myPlayer.on("bc-catalog-error", function () {
        log("++ In Catalog Error ++", prod);
        const error = myPlayer.error_;
        const code = error.code;
        const message = error.message;
        const type = error.type;
        convivaHelper.contentReportError(code + ": " + message + " " + type, Conviva.Client.ErrorSeverity.FATAL);
        convivaHelper.cleanupConvivaSession();
    });

    myPlayer.on("error", function () {
        log("++ In Error ++", prod);
        const error = myPlayer.error_;
        const code = error.code;
        const message = error.message;
        const type = error.type;
        convivaHelper.contentReportError(code + ": " + message + " " + type, Conviva.Client.ErrorSeverity.FATAL);
        convivaHelper.cleanupConvivaSession();
    });

    myPlayer.on('fullscreenchange', function () {
        log("++fullscreenchange - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
    });

    myPlayer.on('loadedalldata', function () {
        log("++loadedalldata - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);

    });
    
    myPlayer.on('loadeddata', function () {
        log("++loadeddata - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        const tech_ = myPlayer.tech_;
        if (tech_) {
            const hls = tech_.hls; // Brightcove hls plugin
            if (hls && hls.playlists && hls.playlists.media) {
                const media = hls.playlists.media();
                if (media && media.attributes && media.attributes.BANDWIDTH) {
                    bitRate = media.attributes.BANDWIDTH/1e3;
                    convivaHelper.contentSetBitrateKbps(bitRate);
                    log(bitRate, prod);
                }
            }
        }
    });

    myPlayer.on('loadedmetadata', function () {
        log("++loadedmetadata - " + myPlayer.getSources()[0].name || myPlayer.getSources()[0].url, prod);
        if (myPlayer.getSources()[0].name || myPlayer.getSources()[0].url) {
            isContentLoaded = true;
            //Initiate Adobe Analytics Media Module tracking && Conviva Analytics
            ABDMediaOPEN();
        }
    });

    function getPlayerName() {
        var hostname = window.location.hostname.replace(/^(www\.|m\.)/, '');

        aflSitesArray = new Object();
        aflSitesArray['afl.com.au'] = 'AFL Network';
        aflSitesArray['fantasy.afl.com.au'] = 'AFL Fantasy';
        aflSitesArray['tipping.afl.com.au'] = 'AFL Tipping';
        aflSitesArray['afc.com.au'] = 'Adelaide Crows';
        aflSitesArray['lions.com.au'] = 'Brisbane Lions';
        aflSitesArray['carltonfc.com.au'] = 'Carlton Blues';
        aflSitesArray['collingwoodfc.com.au'] = 'Collingwood Magpies';
        aflSitesArray['essendonfc.com.au'] = 'Essendon Bombers';
        aflSitesArray['fremantlefc.com.au'] = 'Fremantle';
        aflSitesArray['geelongcats.com.au'] = 'Geelong Cats';
        aflSitesArray['goldcoastfc.com.au'] = 'Gold Coast';
        aflSitesArray['gwsgiants.com.au'] = 'GWS';
        aflSitesArray['hawthornfc.com.au'] = 'Hawthorn Hawks';
        aflSitesArray['melbournefc.com.au'] = 'Melbourne Demons';
        aflSitesArray['nmfc.com.au'] = 'Kangaroos';
        aflSitesArray['portadelaidefc.com.au'] = 'Port Adelaide';
        aflSitesArray['richmondfc.com.au'] = 'Richmond Tigers';
        aflSitesArray['saints.com.au'] = 'St.Kilda Saints';
        aflSitesArray['sydneyswans.com.au'] = 'Sydney Swans';
        aflSitesArray['westcoasteagles.com.au'] = 'West Coast Eagles';
        aflSitesArray['westernbulldogs.com.au'] = 'Western Bulldogs';
        aflSitesArray['womens.afl'] = 'AFLW Network';
      
        return aflSitesArray[hostname] || "AFL test";
    }



</script>
<html>
